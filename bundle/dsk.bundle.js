/*! For license information please see dsk.bundle.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={231:(t,r,a)=>{a.d(r,{Z:()=>b});var o=a(140),i=a(973),c=a(278),u=a(930),l=a(614),p=a(832),d=a(122),h=a(707),y=a(448),m=a(514),g=(a(311),a(96)),v=a(969),_=a(61);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var o,i,c=[],u=!0,l=!1;try{for(a=a.call(t);!(u=(o=a.next()).done)&&(c.push(o.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==a.return||a.return()}finally{if(l)throw i}}return c}(t,r)||_unsupportedIterableToArray(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var b=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(ActorDSK,Actor);var r,a,b,k,w,x,O,S,P,T,I,E,C,A,D,R,L,G,j,M,z,N,H,K=_createSuper(ActorDSK);function ActorDSK(){return _classCallCheck(this,ActorDSK),K.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorDSK,[{key:"prepareDerivedData",value:function prepareDerivedData(){var t=this.system;try{t.canAdvance="character"==this.type;for(var r=0,a=Object.values(t.characteristics);r<a.length;r++){var o=a[r];o.value=o.initial+o.advances+(o.modifier||0)+o.gearmodifier,o.cost=game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(o.initial+o.advances,"Eig")}),o.refund=game.i18n.format("dsk.refundCost",{cost:p.Z._calculateAdvCost(o.initial+o.advances,"Eig",0)})}t.isMage=this.items.some((function(t){return["ahnengeschenk","ahnengabe"].includes(t.type)||"specialability"==t.type&&["ahnen"].includes(t.system.category)})),t.canAdvance&&(t.details.experience.current=t.details.experience.total-t.details.experience.spent),"character"!=this.type&&"npc"!=this.type||(t.stats.LeP.current=t.stats.LeP.initial+2*t.characteristics.ko.value,t.stats.AeP.current=t.guidevalue&&"-"!=t.guidevalue?ActorDSK._attrFromCharacteristic(t.guidevalue,t):0,t.stats.sk.value=(t.stats.sk.initial||0)+Math.round((t.characteristics.mu.value+t.characteristics.kl.value+t.characteristics.in.value)/3)-10,t.stats.zk.value=(t.stats.zk.initial||0)+Math.round((t.characteristics.ko.value+t.characteristics.ko.value+t.characteristics.kk.value)/3)-10,t.stats.ini.value=Math.round((t.characteristics.mu.value+t.characteristics.ge.value)/2)+(t.stats.ini.modifier||0),t.stats.LeP.min=-1*t.characteristics.ko.value),"creature"==this.type&&(t.stats.LeP.current=t.stats.LeP.initial,t.stats.AeP.current=t.stats.AeP.initial,t.stats.ini.value=t.stats.ini.current+(t.stats.ini.modifier||0)),t.stats.schips.max=Number(t.stats.schips.current)+Number(t.stats.schips.modifier)+t.stats.schips.gearmodifier,t.stats.regeneration.LePmax=t.stats.regeneration.LePTemp+t.stats.regeneration.LePMod+t.stats.regeneration.LePgearmodifier,t.stats.regeneration.AePmax=t.stats.regeneration.AePTemp+t.stats.regeneration.AePMod+t.stats.regeneration.AePgearmodifier,t.stats.LeP.max=Math.round((t.stats.LeP.current+t.stats.LeP.modifier+t.stats.LeP.advances)*t.stats.LeP.multiplier+t.stats.LeP.gearmodifier),t.stats.AeP.max=t.stats.AeP.current+t.stats.AeP.modifier+t.stats.AeP.advances+t.stats.AeP.gearmodifier,t.stats.gs.max=Math.max(0,t.stats.gs.initial+(t.stats.gs.modifier||0)+t.stats.gs.gearmodifier),t.stats.sk.max=t.stats.sk.value+t.stats.sk.modifier+t.stats.sk.gearmodifier,t.stats.zk.max=t.stats.zk.value+t.stats.zk.modifier+t.stats.zk.gearmodifier;t.stats.ini.value+=t.stats.ini.gearmodifier-Math.min(4,0);var i=Number((.01*t.stats.ini.value).toFixed(2));t.stats.ini.value*=t.stats.ini.multiplier||1,t.stats.ini.value=Math.round(t.stats.ini.value)+i;var u="creature"!=this.type||t.stats.LeP.max>=20,l=0;if(t.stats.LeP.max>0&&(u?(l=Math.floor(4*(1-t.stats.LeP.value/t.stats.LeP.max)),t.stats.LeP.value<=5&&(l=4)):l=Math.floor(5-5*t.stats.LeP.value/t.stats.LeP.max),l<8&&(l-=c.Z.vantageStep(this,game.i18n.localize("dsk.LocalizedIDs.ruggedFighter"))),l>0&&(l+=c.Z.vantageStep(this,game.i18n.localize("dsk.LocalizedIDs.sensitiveToPain")))),p.Z.isActiveGM()){var d=t.pain!=l;t.pain=l,d&&!v.Z.hasTrait(this,game.i18n.localize("dsk.LocalizedIDs.painImmunity"))&&this.addCondition("inpain",2*l,!0).then((function(){return t.pain=void 0})),c.Z.hasVantage(this,game.i18n.localize("dsk.LocalizedIDs.blind"))&&this.addCondition("blind"),c.Z.hasVantage(this,game.i18n.localize("dsk.LocalizedIDs.mute"))&&this.addCondition("mute"),c.Z.hasVantage(this,game.i18n.localize("dsk.LocalizedIDs.deaf"))&&this.addCondition("deaf"),this.isMerchant()&&this.prepareMerchant()}for(var h=0,y=Object.keys(t.status);h<y.length;h++){var m=y[h];t.status[m]=Math.clamped(t.status[m],0,8)}p.Z.isActiveGM()&&this.isMerchant()&&this.prepareMerchant(),t.maxDefense=this.maxDefenseValue()}catch(t){console.error("Something went wrong with preparing actor data: "+t+t.stack),ui.notifications.error(game.i18n.format("dsk.DSKError.PreparationError",{name:this.name})+t+t.stack)}}},{key:"prepareMerchant",value:(H=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if("loot"!=getProperty(this,"system.merchant.merchantType")){r.next=11;break}if(!getProperty(this,"system.merchant.locked")||this.hasCondition("locked")){r.next=6;break}return r.next=4,this.addCondition(ActorDSK.lockedCondition());case 4:r.next=11;break;case 6:if(getProperty(this,"system.merchant.locked")){r.next=11;break}if(!(t=this.effects.find((function(t){return"locked"==getProperty(t,"flags.core.statusId")})))){r.next=11;break}return r.next=11,this.deleteEmbeddedDocuments("ActiveEffect",[t.id]);case 11:case"end":return r.stop()}}),_callee,this)}))),function prepareMerchant(){return H.apply(this,arguments)})},{key:"isMerchant",value:function isMerchant(){return["merchant","loot"].includes(getProperty(this,"system.merchant.merchantType"))}},{key:"applyActiveEffects",value:function applyActiveEffects(){var t=this,r={},a=this.effects.reduce((function(r,a){if(a.disabled)return r;var o=1;if(a.origin){var i=a.origin.match(/[^.]+$/)[0],c=t.items.get(i);if(c){var u=!0;switch(c.type){case"meleeweapon":case"rangeweapon":case"armor":u=c.system.worn.value;break;case"equipment":u=!c.system.worn.wearable||c.system.worn.wearable&&c.system.worn.value;break;case"trait":u=!["meleeAttack","rangeAttack"].includes(c.system.traitType);break;case"ammunition":case"combatskill":case"poison":case"ahnengabe":case"ahnengeschenk":u=!1;break;case"specialability":u="Combat"!=c.system.category||[2,3].includes(c.system.subcategory),o=Number(c.system.level)||1;break;case"advantage":case"disadvantage":o=Number(c.system.level)||1}if(a.notApplicable=!u,!u)return r}}else{var l=a.getFlag("dsk","value");l&&(o=Number(l))}for(var p=0;p<o;p++)r.push.apply(r,_toConsumableArray(a.changes.map((function(t){return(t=foundry.utils.duplicate(t)).effect=a,t.priority=t.priority?t.priority:10*t.mode,t}))));return r}),[]);a.sort((function(t,r){return t.priority-r.priority}));var o,i=_createForOfIteratorHelper(a);try{for(i.s();!(o=i.n()).done;){var c=o.value,u=c.effect.apply(this,c);null!==u&&(r[c.key]=u)}}catch(t){i.e(t)}finally{i.f()}this.overrides=foundry.utils.expandObject(r)}},{key:"maxDefenseValue",value:function maxDefenseValue(){var t,r=this,a={parry:0,name:game.i18n.localize("dsk.noDefense")},o=[],i=[],c=_createForOfIteratorHelper(this.items);try{for(c.s();!(t=c.n()).done;){var u=t.value;if("combatskill"==u.type)o.push(ActorDSK._calculateCombatSkillValues(u,this.system));else if("meleeweapon"==u.type)getProperty(u,"system.worn.value")&&i.push(u);else if("trait"==u.type&&"meleeAttack"==u.system.traitType){var l=ActorDSK._prepareMeleetrait(u,this);l.parry>a.parry&&(a=l)}}}catch(t){c.e(t)}finally{c.f()}for(var p=function _loop(){var t=y[h],c=ActorDSK._prepareMeleeWeapon(t,o,r,i.filter((function(r){return r._id!=t._id&&!d.Z.isYieldedTwohanded(r)})));c.parry>=a.parry&&(a=c)},h=0,y=i;h<y.length;h++)p();return a}},{key:"preparePostRollAction",value:function preparePostRollAction(t){var r=t.flags.data,a={flags:{img:t.flags.img},rollMode:r.rollMode,speaker:t.speaker,template:r.template,title:r.title,user:t.user};return r.attackerMessage&&(a.attackerMessage=r.attackerMessage),r.defenderMessage&&(a.defenderMessage=r.defenderMessage),r.unopposedStartMessage&&(a.unopposedStartMessage=r.unopposedStartMessage),a}},{key:"useFateOnRoll",value:(N=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r,a){var o,i,c,u,l,d;return _regeneratorRuntime().wrap((function _callee2$(h){for(;;)switch(h.prev=h.next){case 0:("isTalented"==r||p.Z.fateAvailable(this,1==a))&&(o=t.flags.data,i=this.preparePostRollAction(t),0==a?(c=this.system.stats.schips.value-1,u="PointsRemaining"):(c=game.settings.get("dsk","groupschips").split("/")[0],u="GroupPointsRemaining"),l='<h3 class="center"><b>'.concat(game.i18n.localize("dsk.CHATFATE.fatepointUsed"),"</b></h3>\n                  ").concat(game.i18n.format("dsk.CHATFATE."+r,{character:"<b>"+this.name+"</b>"}),"<br>\n                  <b>").concat(game.i18n.localize("dsk.CHATFATE.".concat(u)),"</b>: ").concat(c),(d=o.preData).extra.actor=p.Z.getSpeaker(d.extra.speaker).toObject(!1),this["fate".concat(r)](l,i,d,t,o,a));case 1:case"end":return h.stop()}}),_callee2,this)}))),function useFateOnRoll(t,r,a){return N.apply(this,arguments)})},{key:"resetTargetAndMessage",value:function resetTargetAndMessage(t,r){var a;null!==(a=t.originalTargets)&&void 0!==a&&a.size&&(game.user.targets=t.originalTargets,game.user.targets.user=game.user),!t.defenderMessage&&t.startMessagesList&&(r.startMessagesList=t.startMessagesList)}},{key:"fatererollDamage",value:(z=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,a,o,i,c){var u,d=this;return _regeneratorRuntime().wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return r.fatePointDamageRerollUsed=!0,this.resetTargetAndMessage(i,r),h.next=4,renderTemplate("systems/dsk/templates/dialog/fateReroll-dialogDamage.html",{testData:a,postData:i.postData,singleDie:1==i.postData.characteristics.filter((function(t){return"damage"==t.char})).length});case 4:u=h.sent,new g.Z({title:game.i18n.localize("dsk.CHATFATE.selectDice"),content:u,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(u){var h,y,m,g,v,_,b,k,w,x;return _regeneratorRuntime().wrap((function _callee3$(O){for(;;)switch(O.prev=O.next){case 0:if(!((h=u.find(".dieSelected").map((function(){return Number($(this).attr("data-index"))})).get()).length>0)){O.next=27;break}return y=Roll.fromData(i.postData.damageRoll),O.t0=l.Z,O.next=6,new Roll(y.formula||y._formula).evaluate({async:!0});case 6:return O.t1=O.sent,O.next=9,O.t0.manualRolls.call(O.t0,O.t1,"dsk.CHATCONTEXT.rerollDamage");case 9:return m=O.sent,O.next=12,l.Z.showDiceSoNice(m,a.rollMode);case 12:for(g=0;g<m.dice.length;g++)m.dice[g].options.colorset="black";v=0,_=[],b=[],k=_createForOfIteratorHelper(h);try{for(k.s();!(w=k.n()).done;)x=w.value,_.push("".concat(y.terms[2*(x-2)].results[0].result,"/").concat(m.terms[2*v].results[0].result)),b.push({index:2*(x-2),val:m.terms[2*v].results[0].result}),v+=1}catch(t){k.e(t)}finally{k.f()}return y.editRollAtIndex(b),a.damageRoll=y,t+="<br><b>".concat(game.i18n.localize("dsk.Roll"),"</b>: ").concat(_.join(", ")),ChatMessage.create(p.Z.chatDataSetup(t)),d["".concat(i.postData.postFunction)]({testData:a,cardOptions:r},{rerenderMessage:o}),O.next=25,o.update({"flags.data.fatePointDamageRerollUsed":!0});case 25:return O.next=27,d.reduceSchips(c);case 27:case"end":return O.stop()}}),_callee3)})));return function callback(t){return u.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 6:case"end":return h.stop()}}),_callee4,this)}))),function fatererollDamage(t,r,a,o,i,c){return z.apply(this,arguments)})},{key:"fatereroll",value:(M=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r,a,o,i,c){var u,d=this;return _regeneratorRuntime().wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return r.fatePointDamageRerollUsed=!0,this.resetTargetAndMessage(i,r),h.next=4,renderTemplate("systems/dsk/templates/dialog/fateReroll-dialog.html",{testData:a,postData:i.postData,singleDie:1==i.postData.characteristics.filter((function(t){return"damage"!=t.char})).length});case 4:u=h.sent,new g.Z({title:game.i18n.localize("dsk.CHATFATE.selectDice"),content:u,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(u){var h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E;return _regeneratorRuntime().wrap((function _callee5$(C){for(;;)switch(C.prev=C.next){case 0:if(!((h=u.find(".dieSelected").map((function(){return Number($(this).attr("data-index"))})).get()).length>0)){C.next=28;break}y=[],m=_createForOfIteratorHelper(h);try{for(m.s();!(g=m.n()).done;)v=g.value,_=a.roll.terms[2*v],y.push(_.number+"d"+_.faces+"["+_.options.colorset+"]")}catch(t){m.e(t)}finally{m.f()}return C.t0=l.Z,C.next=8,new Roll(y.join("+")).evaluate({async:!0});case 8:return C.t1=C.sent,C.next=11,C.t0.manualRolls.call(C.t0,C.t1,"dsk.CHATCONTEXT.Reroll");case 11:return y=C.sent,C.next=14,l.Z.showDiceSoNice(y,a.rollMode);case 14:b=0,k=[],w=p.Z.getSpeaker(a.extra.speaker),x=game.i18n.localize("dsk.LocalizedIDs.traditionPhex"),O=w.items.some((function(t){return"specialability"==t.type&&t.name==x})),S=_createForOfIteratorHelper(h);try{for(S.s();!(P=S.n()).done;)T=P.value,I=a.source.system["characteristic".concat(T+1)],E=I?"".concat(game.i18n.localize("dsk.characteristics.".concat(I,".abbr"))," - "):"",k.push("".concat(E).concat(a.roll.terms[2*T].results[0].result,"/").concat(y.terms[2*b].results[0].result)),a.roll.terms[2*T].results[0].result=O?Math.min(y.terms[2*b].results[0].result,a.roll.terms[2*T].results[0].result):y.terms[2*b].results[0].result,b+=1}catch(t){S.e(t)}finally{S.f()}return t+="<br><b>".concat(game.i18n.localize("dsk.Roll"),"</b>: ").concat(k.join(", ")),ChatMessage.create(p.Z.chatDataSetup(t)),d["".concat(i.postData.postFunction)]({testData:a,cardOptions:r},{rerenderMessage:o}),C.next=26,o.update({"flags.data.fatePointRerollUsed":!0});case 26:return C.next=28,d.reduceSchips(c);case 28:case"end":return C.stop()}}),_callee5)})));return function callback(t){return u.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 6:case"end":return h.stop()}}),_callee6,this)}))),function fatereroll(t,r,a,o,i,c){return M.apply(this,arguments)})},{key:"fateisTalented",value:(j=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r,a,o,i){var c,u=this;return _regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:return r.talentedRerollUsed=!0,this.resetTargetAndMessage(i,r),t='<h3 class="center"><b>'.concat(game.i18n.localize("dsk.CHATFATE.fatepointUsed"),"</b></h3>\n              ").concat(game.i18n.format("dsk.CHATFATE.isTalented",{character:"<b>"+this.name+"</b>"}),"<br>"),d.next=5,renderTemplate("systems/dsk/templates/dialog/isTalentedReroll-dialog.html",{testData:a,postData:i.postData});case 5:c=d.sent,new g.Z({title:game.i18n.localize("dsk.CHATFATE.selectDice"),content:c,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:function(){var c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(c){var d,h,y,m,g,v,_,b,k,w,x,O,S;return _regeneratorRuntime().wrap((function _callee7$(P){for(;;)switch(P.prev=P.next){case 0:if(!((d=c.find(".dieSelected").map((function(){return Number($(this).attr("data-index"))})).get()).length>0)){P.next=23;break}h=[],y=_createForOfIteratorHelper(d);try{for(y.s();!(m=y.n()).done;)g=m.value,v=a.roll.terms[2*g],h.push(v.number+"d"+v.faces+"["+v.options.colorset+"]")}catch(t){y.e(t)}finally{y.f()}return P.t0=l.Z,P.next=8,new Roll(h.join("+")).evaluate({async:!0});case 8:return P.t1=P.sent,P.next=11,P.t0.manualRolls.call(P.t0,P.t1,"dsk.CHATCONTEXT.talentedReroll");case 11:return h=P.sent,P.next=14,l.Z.showDiceSoNice(h,a.rollMode);case 14:_=0,b=[],k=_createForOfIteratorHelper(d);try{for(k.s();!(w=k.n()).done;)x=w.value,O=a.source.system["characteristic".concat(x+1)],S=O?"".concat(game.i18n.localize("dsk.characteristics.".concat(O,".abbr"))," - "):"",b.push("".concat(S).concat(a.roll.terms[2*x].results[0].result,"/").concat(h.terms[2*_].results[0].result)),a.roll.terms[2*x].results[0].result=h.terms[2*_].results[0].result,_+=1}catch(t){k.e(t)}finally{k.f()}return t+="<b>".concat(game.i18n.localize("dsk.Roll"),"</b>: ").concat(b.join(", ")),ChatMessage.create(p.Z.chatDataSetup(t)),u["".concat(i.postData.postFunction)]({testData:a,cardOptions:r},{rerenderMessage:o}),P.next=23,o.update({"flags.data.talentedRerollUsed":!0});case 23:case"end":return P.stop()}}),_callee7)})));return function callback(t){return c.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 7:case"end":return d.stop()}}),_callee8,this)}))),function fateisTalented(t,r,a,o,i){return j.apply(this,arguments)})},{key:"reduceSchips",value:(G=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t){return _regeneratorRuntime().wrap((function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:if(0!=t){r.next=5;break}return r.next=3,this.update({"system.stats.schips.value":this.system.stats.schips.value-1});case 3:r.next=7;break;case 5:return r.next=7,ActorDSK.reduceGroupSchip();case 7:case"end":return r.stop()}}),_callee9,this)}))),function reduceSchips(t){return G.apply(this,arguments)})},{key:"modifyTokenAttribute",value:(L=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(t,r){var a,o,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee10$(p){for(;;)switch(p.prev=p.next){case 0:return a=l.length>2&&void 0!==l[2]&&l[2],o=!(l.length>3&&void 0!==l[3])||l[3],i=foundry.utils.getProperty(this.system,t),o?(a&&(r=Math.clamped(i.min||0,Number(i.value)+r,i.max)),c=_defineProperty({},"system.".concat(t,".value"),r)):(a&&(r=Number(i)+r),c=_defineProperty({},"system.".concat(t),r)),u=Hooks.call("modifyTokenAttribute",{attribute:t,value:r,isDelta:a,isBar:o},c),p.abrupt("return",!1!==u?this.update(c):this);case 6:case"end":return p.stop()}}),_callee10,this)}))),function modifyTokenAttribute(t,r){return L.apply(this,arguments)})},{key:"prepareBaseData",value:function prepareBaseData(){var t=this.system;mergeObject(t,{skillModifiers:_objectSpread({FP:[],step:[],QL:[],TPM:[],FW:[],botch:20,crit:1,global:[],conditional:{AePCost:[]},feature:{FP:[],step:[],QL:[],TPM:[],FW:[],AePCost:[]}},["ahnengabe","skill"].reduce((function(t,r){return t[r]={FP:[],step:[],QL:[],TPM:[],FW:[]},t}),{})),repeatingEffects:{startOfRound:{LeP:[],AeP:[]}},aepModifier:0,creatureBonus:[],stats:{initiative:{multiplier:1},LeP:{multiplier:1},regeneration:{LePgearmodifier:0,AePgearmodifier:0}},status:{encumbered:0,stunned:0,feared:0,inpain:0,selfconfidence:0},spellStats:{damage:"0"},meleeStats:{parry:0,attack:0,damage:"0",defenseMalus:0,botch:20,crit:1},rangeStats:{attack:0,damage:"0",defenseMalus:0,botch:20,crit:1},totalArmor:0,carryModifier:0});for(var r=0,a=Object.values(t.stats);r<a.length;r++){a[r].gearmodifier=0}for(var o=0,i=Object.values(t.characteristics);o<i.length;o++){i[o].gearmodifier=0}}},{key:"prepareSheet",value:function prepareSheet(t){var r=duplicate(this),a={system:{}};if(mergeObject(a,this.prepareItems(t)),a.canAdvance)for(var o=0,i=["LeP","AeP"];o<i.length;o++){var c=i[o];mergeObject(a.system,{stats:_defineProperty({},c,{cost:game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(r.system.stats[c].advances,"D")}),refund:game.i18n.format("dsk.refundCost",{cost:p.Z._calculateAdvCost(r.system.stats[c].advances,"D",0)})})})}return a}},{key:"_perpareItemAdvancementCost",value:function _perpareItemAdvancementCost(t){return t.cost=game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(t.system.level,t.system.StF)}),t.refund=game.i18n.format("dsk.refundCost",{cost:p.Z._calculateAdvCost(t.system.level,t.system.StF,0)}),t.canAdvance=this.system.canAdvance,t}},{key:"_setOnUseEffect",value:function _setOnUseEffect(t){getProperty(t,"flags.dsk.onUseEffect")&&(t.OnUseEffect=!0)}},{key:"getArmorEncumbrance",value:function getArmorEncumbrance(t,r){var a=r.reduce((function(t,r){return r.calculatedEncumbrance=Number(r.system.encumbrance),t+r.calculatedEncumbrance}),0);return Math.max(0,a-m.Z.abilityStep(t,game.i18n.localize("dsk.LocalizedIDs.inuredToEncumbrance")))}},{key:"prepareItems",value:function prepareItems(t){var r=this,a=this.toObject(!1),o=[],i=[],c=[],l=[],p=[],h=[],y=[],m=[],g=[],v=[],_=Object.fromEntries(Object.keys(u.Z.specialAbilityCategories).map((function(t){return[t,[]]}))),b=Object.fromEntries(Object.keys(u.Z.traitCategories).map((function(t){return[t,[]]}))),k={hasSpells:this.system.isMage,ahnengabe:[],ahnengeschenk:[]},w={body:[],social:[],knowledge:[],trade:[]},x={meleeweapons:{items:[],show:!1,dataType:"meleeweapon"},rangeweapons:{items:[],show:!1,dataType:"rangeweapon"},armor:{items:[],show:!1,dataType:"armor"},ammunition:{items:[],show:!1,dataType:"ammunition"},poison:{items:[],show:!1,dataType:"poison"}};for(var O in u.Z.equipmentTypes)x[O]={items:[],show:!1,dataType:O};x.misc.show=!0;for(var S=1;S<=Number(a.system.stats.schips.max);S++)v.push({value:S,cssClass:S<=Number(a.system.stats.schips.value)?"fullSchip":"emptySchip"});var P,T=new Map,I=_createForOfIteratorHelper(a.items.filter((function(t){return"equipment"==t.type&&"bags"==t.system.category})));try{for(I.s();!(P=I.n()).done;){var E=P.value;T.set(E._id,[])}}catch(t){I.e(t)}finally{I.f()}a.items=a.items.sort((function(t,r){return t.name.localeCompare(r.name)}));var C,A=a.system.totalArmor||0,D=0,R=!1,L=_createForOfIteratorHelper(a.items);try{for(L.s();!(C=L.n()).done;){var G=C.value;try{var j=getProperty(G,"system.parent_id");if("ammunition"==G.type&&g.push(ActorDSK._prepareitemStructure(G)),j&&j!=G._id&&T.has(j)){T.get(j).push(G);continue}switch(t.details&&t.details.includes(G._id)&&(G.detailed="shown"),G.type){case"skill":w[G.system.group].push(ActorDSK._calculatePW(this._perpareItemAdvancementCost(G,a.system),a.system));break;case"information":l.push(G);break;case"ahnengabe":k[G.type].push(ActorDSK._calculatePW(this._perpareItemAdvancementCost(G),a.system));break;case"ahnengeschenk":k[G.type].push(G);break;case"combatskill":o.push(ActorDSK._calculateCombatSkillValues(this._perpareItemAdvancementCost(G,a.system),a.system));break;case"ammunition":G.weight=parseFloat((G.system.weight*G.system.quantity).toFixed(3)),x.ammunition.items.push(ActorDSK.prepareMag(G)),x.ammunition.show=!0,D+=Number(G.weight);break;case"meleeweapon":G.weight=parseFloat((G.system.weight*G.system.quantity).toFixed(3)),G.toggleValue=getProperty(G.system,"worn.value")||!1,G.toggle=!0,this._setOnUseEffect(G),G.system.notInInventory||(x.meleeweapons.items.push(ActorDSK._prepareitemStructure(G)),x.meleeweapons.show=!0),G.toggleValue&&m.push(G),D+=Number(G.weight);break;case"rangeweapon":G.weight=parseFloat((G.system.weight*G.system.quantity).toFixed(3)),G.toggleValue=getProperty(G.system,"worn.value")||!1,G.toggle=!0,this._setOnUseEffect(G),x.rangeweapons.items.push(ActorDSK._prepareitemStructure(G)),x.rangeweapons.show=!0,D+=Number(G.weight);break;case"armor":G.toggleValue=getProperty(G.system,"worn.value")||!1,x.armor.items.push(ActorDSK._prepareitemStructure(G)),x.armor.show=!0,G.toggle=!0,this._setOnUseEffect(G),G.weight=parseFloat((G.system.weight*G.system.quantity).toFixed(3)),D+=parseFloat((G.system.weight*(G.toggleValue?Math.max(0,G.system.quantity-1):G.system.quantity)).toFixed(3)),G.system.worn.value&&(A+=Number(G.system.rs),p.push(G));break;case"trait":switch(G.system.traitType){case"rangeAttack":G=ActorDSK._prepareRangeTrait(G,a);break;case"meleeAttack":G=ActorDSK._prepareMeleetrait(G,a);break;case"armor":A+=Number(G.system.at)}b[G.system.traitType].push(G),R=!0;break;case"poison":G.weight=parseFloat((G.system.weight*G.system.quantity).toFixed(3)),x.poison.items.push(G),x.poison.show=!0,D+=Number(G.weight);break;case"equipment":G.weight=parseFloat((G.system.weight*G.system.quantity).toFixed(3)),G.toggle=getProperty(G,"system.worn.wearable")||!1,G.toggle&&(G.toggleValue=getProperty(G.system,"worn.value")||!1),this._setOnUseEffect(G),x[G.system.category].items.push(ActorDSK._prepareitemStructure(G)),x[G.system.category].show=!0,D+=Number(G.weight);break;case"advantage":this._setOnUseEffect(G),i.push(G);break;case"disadvantage":this._setOnUseEffect(G),c.push(G);break;case"specialability":this._setOnUseEffect(G),_[G.system.category].push(G)}}catch(t){this._itemPreparationError(G,t)}}}catch(t){L.e(t)}finally{L.f()}var M,z=_createForOfIteratorHelper(x.bags.items);try{for(z.s();!(M=z.n()).done;){var N=M.value;D+=this._setBagContent(N,T)}}catch(t){z.e(t)}finally{z.f()}var $,H=_createForOfIteratorHelper(x.rangeweapons.items);try{for(H.s();!($=H.n()).done;){var K=$.value;try{K.system.worn.value&&h.push(ActorDSK._prepareRangeWeapon(K,g,o,this))}catch(t){this._itemPreparationError(K,t)}}}catch(t){H.e(t)}finally{H.f()}for(var W=function _loop2(){var t=Z[B];try{y.push(ActorDSK._prepareMeleeWeapon(t,o,a,m.filter((function(r){return r._id!=t._id&&!d.Z.isYieldedTwohanded(r)}))))}catch(a){r._itemPreparationError(t,a)}},B=0,Z=m;B<Z.length;B++)W();var q=2*a.system.characteristics.kk.value+a.system.carryModifier,Y=this.getArmorEncumbrance(this,p);"creature"==this.type&&!this.canAdvance||this.isMerchant()||(Y+=2*Math.max(0,Math.ceil((D-q-5)/5))),this.addCondition("encumbered",Y,!0),D=parseFloat(D.toFixed(3));var U=duplicate(u.Z.characteristics);return U["-"]="-",{totalWeight:D,armorSum:A,carrycapacity:q,wornRangedWeapons:h,guidevalues:U,wornMeleeWeapons:y,advantages:i,disadvantages:c,specAbs:_,information:l,combatskills:o,hasTrait:R,traits:b,wornArmor:p,inventory:x,canAdvance:this.system.canAdvance,sheetLocked:a.system.sheetLocked,magic:k,allSkillsLeft:{body:w.body,social:w.social},allSkillsRight:{knowledge:w.knowledge,trade:w.trade},schips:v}}},{key:"setupWeapon",value:function setupWeapon(t,r,a,i){return a.mode=r,o.Z.getSubClass(t.type).setupDialog(null,a,t,this,i)}},{key:"setupSpell",value:function setupSpell(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return o.Z.getSubClass(t.type).setupDialog(null,r,t,this,a)}},{key:"checkEnoughXP",value:(R=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t){var r,a,o,i,c;return _regeneratorRuntime().wrap((function _callee11$(u){for(;;)switch(u.prev=u.next){case 0:if(this.system.canAdvance){u.next=2;break}return u.abrupt("return",!0);case 2:if(!isNaN(t)&&null!=t){u.next=4;break}return u.abrupt("return",!0);case 4:if(!(Number(this.system.details.experience.total)-Number(this.system.details.experience.spent)>=t)){u.next=8;break}return u.abrupt("return",!0);case 8:if(!Number(0==this.system.details.experience.total)){u.next=22;break}return r="<p>".concat(game.i18n.localize("dsk.DSKError.zeroXP"),"</p><label>").concat(game.i18n.localize("dsk.APValue"),': </label><input type="number" name="APsel" value="150"/>'),a=0,o=!1,u.next=14,new Promise((function(t,a){new Dialog({title:game.i18n.localize("dsk.DSKError.NotEnoughXP"),content:r,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(r){t([!0,r.find('[name="APsel"]')[0].value])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){t([!1,0])}}}}).render(!0)}));case 14:if(i=u.sent,c=_slicedToArray(i,2),o=c[0],a=c[1],!o){u.next=22;break}return u.next=21,this.update({"system.details.experience.total":Number(a)});case 21:return u.abrupt("return",!0);case 22:return ui.notifications.error(game.i18n.localize("dsk.DSKError.NotEnoughXP")),u.abrupt("return",!1);case 24:case"end":return u.stop()}}),_callee11,this)}))),function checkEnoughXP(t){return R.apply(this,arguments)})},{key:"getSkillModifier",value:function getSkillModifier(t,r){for(var a=this,o=[],i=function _loop3(){var i=u[c],l="step"==i?"":i;o.push.apply(o,_toConsumableArray(a.system.skillModifiers[i].filter((function(r){return r.target==t})).map((function(t){return{name:t.source,value:t.value,type:l}})))),a.system.skillModifiers[r]&&o.push.apply(o,_toConsumableArray(a.system.skillModifiers[r][i].map((function(t){return{name:t.source,value:t.value,type:l}}))))},c=0,u=["FP","step","QL","TPM","FW"];c<u.length;c++)i();return o}},{key:"setupSkill",value:function setupSkill(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return o.Z.getSubClass(t.type).setupDialog(null,r,t,this,a)}},{key:"_updateAPs",value:(D=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(t){var r,a,o,i=arguments;return _regeneratorRuntime().wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},!this.system.canAdvance){c.next=12;break}if(isNaN(t)||null==t){c.next=11;break}return a=Number(t),r["system.details.experience.spent"]=Number(this.system.details.experience.spent)+a,c.next=7,this.update(r);case 7:o=game.i18n.format(a>0?"dsk.advancementCost":"dsk.refundCost",{cost:Math.abs(a)}),(0,h.p0)(o),c.next=12;break;case 11:ui.notifications.error(game.i18n.localize("dsk.DSKError.APUpdateError"));case 12:case"end":return c.stop()}}),_callee12,this)}))),function _updateAPs(t){return D.apply(this,arguments)})},{key:"setupRegeneration",value:function setupRegeneration(t){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0,p=game.i18n.localize("dsk.regenerationTest"),d={source:{type:"regenerate",system:{}},opposable:!1,extra:{statusId:t,actor:this.toObject(!1),options:a,speaker:o.Z.buildSpeaker(this.actor,c)}};d.extra.actor.isMage=this.system.isMage;var h=i.Z.getRollModifiers(d.extra.actor,d.source),y={title:p,template:"/systems/dsk/templates/dialog/regeneration-dialog.html",data:{rollMode:a.rollMode,regenerationInterruptOptions:u.Z.regenerationInterruptOptions,regnerationCampLocations:u.Z.regnerationCampLocations,showAepModifier:this.system.isMage,situationalModifiers:h,modifier:a.modifier||0},callback:function callback(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.situationalModifiers=ActorDSK._parseModifiers(t),m.rollMode=t.find('[name="rollMode"]').val(),d.situationalModifiers.push({name:game.i18n.localize("dsk.camplocation")+" - "+t.find('[name="regnerationCampLocations"] option:selected').text(),value:t.find('[name="regnerationCampLocations"]').val()},{name:game.i18n.localize("dsk.interruption")+" - "+t.find('[name="regenerationInterruptOptions"] option:selected').text(),value:t.find('[name="regenerationInterruptOptions"]').val()}),d.regenerationFactor=t.find('[name="badEnvironment"]').is(":checked")?.5:1;for(var o=["LeP","AeP"],i={},c=0,u=o;c<u.length;c++){var l=u[c];d["".concat(l,"Modifier")]=Number(t.find('[name="'.concat(l,'Modifier"]')).val()||0),d["regeneration".concat(l)]=Number(r.system.stats.regeneration["".concat(l,"max")]);var p=t.find('[name="regenerate'.concat(l,'"]')).is(":checked")?1:0;d["regenerate".concat(l)]=p,p&&(i["system.stats.regeneration.".concat(l,"Temp")]=0)}return mergeObject(d.extra.options,a),r.update(i),{testData:d,cardOptions:m}}},m=this._setupCardOptions("systems/dsk/templates/chat/roll/regeneration-card.html",p,c);return l.Z.setupDialog({dialogOptions:y,testData:d,cardOptions:m})}},{key:"setupCharacteristic",value:function setupCharacteristic(t){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,c=(this.system.characteristics[t],game.i18n.localize("dsk.characteristics.".concat(t,".name"))+" "+game.i18n.localize("dsk.probe")),u={opposable:!1,source:{type:"char",system:{characteristic1:t,characteristic2:t}},extra:{characteristicId:t,actor:this.toObject(!1),options:a,speaker:o.Z.buildSpeaker(this,i)}},p={title:c,template:"/systems/dsk/templates/dialog/characteristic-dialog.html",data:{rollMode:a.rollMode,modifier:a.modifier||0,characteristics:[1,2].map((function(r){return t})),hasSchips:o.Z.hasSchips(this)},callback:function callback(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.rollMode=t.find('[name="rollMode"]').val(),u.situationalModifiers=ActorDSK._parseModifiers(t),ActorDSK.schipsModifier(t,u.situationalModifiers),u.situationalModifiers.some((function(t){return t.name==game.i18n.localize("dsk.schips")}))&&r.reduceSchips(0),o.Z.changeChars.apply(o.Z,[u.source].concat(_toConsumableArray([0,1].map((function(r){return t.find('[name="characteristics'.concat(r,'"]')).val()}))))),mergeObject(u.extra.options,a),{testData:u,cardOptions:d}}},d=this._setupCardOptions("systems/dsk/templates/chat/roll/characteristic-card.html",c,i);return l.Z.setupDialog({dialogOptions:p,testData:u,cardOptions:d})}},{key:"_setupCardOptions",value:function _setupCardOptions(t,r,a){var o=game.canvas.tokens.get(a),i={speaker:{alias:o?o.name:this.prototypeToken.name,actor:this.id},title:r,template:t,flags:{img:this.prototypeToken.randomImg?this.img:this.prototypeToken.img}};if(this.token)i.speaker.alias=this.token.name,i.speaker.token=this.token.id,i.speaker.scene=canvas.scene.id,i.flags.img=this.token.img;else{var c=ChatMessage.getSpeaker();c.actor==this.id&&(i.speaker.alias=c.alias,i.speaker.token=c.token,i.speaker.scene=c.scene,i.flags.img=c.token?canvas.tokens.get(c.token).img:i.flags.img)}return i}},{key:"consumeAmmunition",value:(A=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(t){var r;return _regeneratorRuntime().wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:if(!t.extra.ammo||t.extra.ammoDecreased){a.next=9;break}if(t.extra.ammoDecreased=!0,!t.extra.ammo._id){a.next=7;break}return r={_id:t.extra.ammo._id},"mag"==t.extra.ammo.system.ammunitionType?t.extra.ammo.system.mag.value<=0?(t.extra.ammo.system.quantity--,r["system.quantity"]=t.extra.ammo.system.quantity,r["system.mag.value"]=t.extra.ammo.system.mag.max-1):r["system.mag.value"]=t.extra.ammo.system.mag.value-1:(t.extra.ammo.system.quantity--,r["system.quantity"]=t.extra.ammo.system.quantity),a.next=7,this.updateEmbeddedDocuments("Item",[r,{_id:t.source._id,"system.reloadTimeprogress":0}]);case 7:case 13:a.next=18;break;case 9:if("rangeweapon"!=t.source.type&&("trait"!=t.source.type||"rangeAttack"!=t.source.system.traitType)||t.extra.ammoDecreased){a.next=15;break}return t.extra.ammoDecreased=!0,a.next=13,this.updateEmbeddedDocuments("Item",[{_id:t.source._id,"system.reloadTimeprogress":0}]);case 15:if(!["ahnengabe"].includes(t.source.type)||"emptyActor"==t.extra.speaker.token){a.next=18;break}return a.next=18,this.updateEmbeddedDocuments("Item",[{_id:t.source._id,"system.castingTime.progress":0,"system.castingTime.modified":0}]);case 18:case"end":return a.stop()}}),_callee13,this)}))),function consumeAmmunition(t){return A.apply(this,arguments)})},{key:"basicTest",value:(C=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(t){var r,a,o,i,c,u,p,d=arguments;return _regeneratorRuntime().wrap((function _callee14$(h){for(;;)switch(h.prev=h.next){case 0:return r=t.testData,a=t.cardOptions,o=d.length>1&&void 0!==d[1]?d[1]:{},h.next=4,l.Z.rollDices(r,a);case 4:return r=h.sent,h.next=7,l.Z.rollTest(r);case 7:return i=h.sent,r.extra.options.other&&(i.other||(i.other=[]),(c=i.other).push.apply(c,_toConsumableArray(r.extra.options.other))),i.postFunction="basicTest",game.user.targets.size&&(a.isOpposedTest=r.opposable,u=" - ".concat(game.i18n.localize("dsk.Opposed")),a.isOpposedTest&&a.title.match(u+"$")!=u&&(a.title+=u)),h.next=13,this.consumeAmmunition(r);case 13:if(o.suppressMessage){h.next=20;break}return h.next=16,l.Z.renderRollCard(a,i,o.rerenderMessage);case 16:return p=h.sent,h.next=19,y.Z.handleOpposedTarget(p);case 19:i.messageId=p.id;case 20:return h.abrupt("return",{result:i,cardOptions:a,options:o});case 21:case"end":return h.stop()}}),_callee14,this)}))),function basicTest(t){return C.apply(this,arguments)})},{key:"tokenScrollingText",value:function tokenScrollingText(t){var r,a,o=_createForOfIteratorHelper(this.isToken?[null===(r=this.token)||void 0===r?void 0:r.object]:this.getActiveTokens(!0));try{for(o.s();!(a=o.n()).done;){var i=a.value;if(i){var c,u=0,l=_createForOfIteratorHelper(t);try{for(l.s();!(c=l.n()).done;){var p=c.value;canvas.interface.createScrollingText(i.center,p.value,{anchor:u,direction:p.value>0?2:1,fontSize:game.settings.get("dsk","scrollingFontsize"),stroke:p.stroke,strokeThickness:1,jitter:.25,duration:1e3}),u+=1}}catch(t){l.e(t)}finally{l.f()}}}}catch(t){o.e(t)}finally{o.f()}}},{key:"_preUpdate",value:(E=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(t,r,a){var o,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee15$(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,_get(_getPrototypeOf(ActorDSK.prototype),"_preUpdate",this).call(this,t,r,a);case 2:for(o={LeP:9109504,AeP:723929},i=[],c=0,u=Object.keys(o);c<u.length;c++)l=u[c],(p=getProperty(t,"system.stats.".concat(l,".value")))&&i.push({value:p-this.system.stats[l].value,stroke:o[l]});i.length&&this.tokenScrollingText(i);case 6:case"end":return d.stop()}}),_callee15,this)}))),function _preUpdate(t,r,a){return E.apply(this,arguments)})},{key:"_itemPreparationError",value:function _itemPreparationError(t,r){console.error("Something went wrong with preparing item "+t.name+": "+r),console.warn(r),console.warn(t),ui.notifications.error("Something went wrong with preparing item "+t.name+": "+r)}},{key:"_setBagContent",value:function _setBagContent(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=0;if(r.has(t._id)){t.children=[];var i=0;!t.toggleValue&&a&&(o-=t.weight);var c,u=_createForOfIteratorHelper(r.get(t._id));try{for(u.s();!(c=u.n()).done;){var l=c.value;l.weight=Number(parseFloat((l.system.weight*l.system.quantity).toFixed(3))),i+=l.weight,t.children.push(ActorDSK._prepareitemStructure(l)),r.has(l._id)&&(i+=this._setBagContent(l,r,!1))}}catch(t){u.e(t)}finally{u.f()}!t.toggleValue&&a||(o+=i),t.bagweight="".concat(i.toFixed(3),"/").concat(t.system.capacity||0)}return o}},{key:"applyDamage",value:(I=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(t){var r;return _regeneratorRuntime().wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:return r=Math.min(this.system.stats.LeP.max,this.system.stats.LeP.value-t),a.next=3,this.update({"system.stats.LeP.value":r});case 3:case"end":return a.stop()}}),_callee16,this)}))),function applyDamage(t){return I.apply(this,arguments)})},{key:"applyRegeneration",value:(T=_asyncToGenerator(_regeneratorRuntime().mark((function _callee17(t,r){var a;return _regeneratorRuntime().wrap((function _callee17$(o){for(;;)switch(o.prev=o.next){case 0:return a={"system.stats.LeP.value":Math.min(this.system.stats.LeP.max,this.system.stats.LeP.value+(t||0)),"system.stats.AeP.value":Math.min(this.system.stats.AeP.max,this.system.stats.AeP.value+(r||0))},o.next=3,this.update(a);case 3:case"end":return o.stop()}}),_callee17,this)}))),function applyRegeneration(t,r){return T.apply(this,arguments)})},{key:"applyMana",value:(P=_asyncToGenerator(_regeneratorRuntime().mark((function _callee18(t){var r;return _regeneratorRuntime().wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:if(!((r=Math.min(this.system.stats.AeP.max,this.system.stats.AeP.value-t))>=0)){a.next=7;break}return a.next=4,this.update(_defineProperty({},"data.stats.AeP.value",r));case 4:return a.abrupt("return",!0);case 7:return ui.notifications.error(game.i18n.localize("dsk.DSKError.NotEnoughAeP")),a.abrupt("return",!1);case 9:case"end":return a.stop()}}),_callee18,this)}))),function applyMana(t){return P.apply(this,arguments)})},{key:"actorEffects",value:(S=_asyncToGenerator(_regeneratorRuntime().mark((function _callee19(){var t,r,a=this;return _regeneratorRuntime().wrap((function _callee19$(o){for(;;)switch(o.prev=o.next){case 0:if(t=["dead"],o.t0=game.user.isGM||this.testUserPermission(game.user,"OBSERVER"),o.t0){o.next=6;break}return o.next=5,game.settings.get("dsk","hideEffects");case 5:o.t0=!o.sent;case 6:return r=o.t0,o.abrupt("return",r?this.effects.filter((function(t){return!t.disabled&&!t.notApplicable&&(game.user.isGM||!t.getFlag("dsk","hidePlayers"))&&!t.getFlag("dsk","hideOnToken")&&(t.origin==a.uuid||!t.origin)})):this.effects.filter((function(r){return t.includes(r.getFlag("core","statusId"))})));case 8:case"end":return o.stop()}}),_callee19,this)}))),function actorEffects(){return S.apply(this,arguments)})},{key:"_preCreate",value:(O=_asyncToGenerator(_regeneratorRuntime().mark((function _callee20(t,r,a){var o;return _regeneratorRuntime().wrap((function _callee20$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,_get(_getPrototypeOf(ActorDSK.prototype),"_preCreate",this).call(this,t,r,a);case 2:o={},t.img||(o.img="icons/svg/mystery-man-black.svg"),"character"==t.type&&mergeObject(o,{prototypeToken:{sight:{enabled:!0},actorLink:!0}}),this.updateSource(o);case 6:case"end":return i.stop()}}),_callee20,this)}))),function _preCreate(t,r,a){return O.apply(this,arguments)})},{key:"markDead",value:(x=_asyncToGenerator(_regeneratorRuntime().mark((function _callee21(t){var r,a,o,i;return _regeneratorRuntime().wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:r=this.getActiveTokens(),a=_createForOfIteratorHelper(r),c.prev=2,a.s();case 4:if((o=a.n()).done){c.next=11;break}if(!(i=o.value).combatant){c.next=9;break}return c.next=9,i.combatant.update({defeated:t});case 9:c.next=4;break;case 11:c.next=16;break;case 13:c.prev=13,c.t0=c.catch(2),a.e(c.t0);case 16:return c.prev=16,a.f(),c.finish(16);case 19:case"end":return c.stop()}}),_callee21,this,[[2,13,16,19]])}))),function markDead(t){return x.apply(this,arguments)})},{key:"_dependentEffects",value:(w=_asyncToGenerator(_regeneratorRuntime().mark((function _callee22(t,r,a){var o;return _regeneratorRuntime().wrap((function _callee22$(r){for(;;)switch(r.prev=r.next){case 0:if(!(["inpain"].includes(t)&&this.system.status[t]>7)){r.next=5;break}return r.next=3,this.addCondition("incapacitated");case 3:r.next=18;break;case 5:if(!(["stunned"].includes(t)&&this.system.status[t]>7)){r.next=10;break}return r.next=8,this.addCondition("unconscious");case 8:r.next=18;break;case 10:if(!(["feared"].includes(t)&&this.system.status[t]>7)){r.next=15;break}return r.next=13,this.addCondition("panic");case 13:r.next=18;break;case 15:if(!(["encumbered"].includes(t)&&this.system.status[t]>7)){r.next=18;break}return r.next=18,this.addCondition("fixated");case 18:if("dead"!=t||!game.combat){r.next=21;break}return r.next=21,this.markDead(!0);case 21:if("unconscious"!=t){r.next=24;break}return r.next=24,this.addCondition("prone");case 24:if(!(a>0&&"inpain"==t&&!this.hasCondition("bloodrush")&&c.Z.hasVantage(this,game.i18n.localize("dsk.LocalizedIDs.frenzy")))){r.next=29;break}return r.next=27,this.addCondition("bloodrush");case 27:o=p.Z.replaceConditions("".concat(game.i18n.format("dsk.CHATNOTIFICATION.gainsBloodrush",{character:"<b>"+this.name+"</b>"}))),ChatMessage.create(p.Z.chatDataSetup(o));case 29:case"end":return r.stop()}}),_callee22,this)}))),function _dependentEffects(t,r,a){return w.apply(this,arguments)})},{key:"addCondition",value:(k=_asyncToGenerator(_regeneratorRuntime().mark((function _callee23(t){var r,a,o,c=arguments;return _regeneratorRuntime().wrap((function _callee23$(u){for(;;)switch(u.prev=u.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:1,a=c.length>2&&void 0!==c[2]&&c[2],o=!(c.length>3&&void 0!==c[3])||c[3],"bleeding"!=t){u.next=7;break}return u.next=6,d.Z.bleedingMessage(this);case 6:case 9:return u.abrupt("return",u.sent);case 7:return u.next=9,i.Z.addCondition(this,t,r,a,o);case 10:case"end":return u.stop()}}),_callee23,this)}))),function addCondition(t){return k.apply(this,arguments)})},{key:"removeCondition",value:(b=_asyncToGenerator(_regeneratorRuntime().mark((function _callee24(t){var r,a,o,c=arguments;return _regeneratorRuntime().wrap((function _callee24$(u){for(;;)switch(u.prev=u.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:1,a=!(c.length>2&&void 0!==c[2])||c[2],o=c.length>3&&void 0!==c[3]&&c[3],u.next=5,i.Z.removeCondition(this,t,r,a,o);case 5:return u.abrupt("return",u.sent);case 6:case"end":return u.stop()}}),_callee24,this)}))),function removeCondition(t){return b.apply(this,arguments)})},{key:"hasCondition",value:function hasCondition(t){return i.Z.hasCondition(this,t)}}],[{key:"create",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee25(t,r){var a,o,i;return _regeneratorRuntime().wrap((function _callee25$(c){for(;;)switch(c.prev=c.next){case 0:if(!(t instanceof Array||t.items)){c.next=4;break}return c.next=3,_get(_getPrototypeOf(ActorDSK),"create",this).call(this,t,r);case 3:case 16:return c.abrupt("return",c.sent);case 4:return t.img&&"icons/svg/mystery-man.svg"!=t.img||(t.img="icons/svg/mystery-man-black.svg"),a=["skill","combatskill"],["character","npc"].includes(t.type)&&a.push("meleeweapon","specialability"),c.next=9,p.Z.allSkills(a);case 9:return t.items=c.sent,o={character:3,npc:1,creature:0},i=getProperty(t,"system.stats.schips.current")||o[t.type]||0,t.system={stats:{schips:{current:i,value:i}}},"creature"!=t.type&&[void 0,0].includes(getProperty(t,"system.stats.LeP.value"))&&mergeObject(t,{system:{stats:{LeP:{value:16}}}}),c.next=16,_get(_getPrototypeOf(ActorDSK),"create",this).call(this,t,r);case 17:case"end":return c.stop()}}),_callee25,this)}))),function create(t,r){return a.apply(this,arguments)})},{key:"_calculateCombatSkillValues",value:function _calculateCombatSkillValues(t,r){return(t=ActorDSK._calculatePW(t,r)).system.attack=t.PW,"melee"==t.system.weapontype?t.system.parry=Math.round(.25*t.PW):t.system.parry=0,t.cost=game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(t.system.level,t.system.StF)}),t}},{key:"lockedCondition",value:function lockedCondition(){return{label:game.i18n.localize("dsk.MERCHANT.locked"),icon:"icons/svg/padlock.svg",flags:{core:{statusId:"locked"},dsk:{value:null,editable:!0,noEffect:!0,hidePlayers:!0,description:game.i18n.localize("dsk.MERCHANT.locked"),custom:!0}}}}},{key:"armorValue",value:function armorValue(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.items.filter((function(t){return"armor"==t.type&&1==t.system.worn.value}));r.origin&&(a=a.map((function(a){var o=mergeObject(duplicate(r),{armor:a});return _.Z.applyRollTransformation(t,o,4).options.armor})));var o=a.reduce((function(t,r){return t+r.system.rs}),0),i=t.items.filter((function(t){return"trait"==t.type&&"armor"==t.system.traitType})).reduce((function(t,r){return t+Number(r.system.at)}),0);return{wornArmor:a,armor:o+i+(t.system.totalArmor||0)}}},{key:"_prepareRangeTrait",value:function _prepareRangeTrait(t,r){return t.attack=Number(t.system.at)+Number(r.system.rangeStats.attack),t.LZ=Number(t.system.lz),t.LZ>0&&ActorDSK.buildReloadProgress(t),this._parseDmg(t)}},{key:"_prepareRangeWeapon",value:function _prepareRangeWeapon(t,r,a,o){var i,c=a.find((function(r){return r.name==t.system.combatskill}));if(t.calculatedRange=t.system.rw,c){if(t.attack=Number(c.system.attack)+Number(o.system.rangeStats.attack),"-"!=t.system.ammunitionType&&(t.ammo=r.filter((function(r){return r.system.ammunitionType==t.system.ammunitionType})),i=r.find((function(r){return r._id==t.system.currentAmmo})))){var u=Number(i.system.rangeMultiplier)||1;t.calculatedRange=t.calculatedRange.split("/").map((function(t){return Math.round(Number(t)*u)})).join("/"),t.attack+=Number(i.system.atmod)||0,"mag"==i.system.ammunitionType&&(t.ammoMax=i.system.mag.max,t.ammoCurrent=i.system.mag.value)}t.LZ=ActorDSK.calcLZ(t,o),t.LZ>0&&ActorDSK.buildReloadProgress(t)}else ui.notifications.error(game.i18n.format("dsk.DSKError.unknownCombatSkill",{skill:t.system.combatskill,item:t.name}));return this._parseDmg(t,i)}},{key:"_prepareMeleetrait",value:function _prepareMeleetrait(t,r){return t.attack=Number(t.system.at),t.parry=Math.max(0,(Number(t.system.pa)||Math.round(t.attack/4))+Number(r.system.meleeStats.parry)),this._parseDmg(t)}},{key:"_prepareMeleeWeapon",value:function _prepareMeleeWeapon(t,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=r.find((function(r){return r.name==t.system.combatskill}));if(i){t.attack=Number(i.system.attack)+Number(t.system.aw),t.parry=Math.max(0,i.system.parry+Number(t.system.vw)+Number(a.system.meleeStats.parry)+(t.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Shields")?Number(t.system.vw):0)),t.yieldedTwoHand=d.Z.isYieldedTwohanded(t),t.yieldedTwoHand||(o||(o=duplicate(a.items).filter((function(r){return"meleeweapon"==r.type&&r.system.worn.value&&r._id!=t._id&&!d.Z.isYieldedTwohanded(r)}))),o.length>0&&(t.parry+=Math.max.apply(Math,_toConsumableArray(o.map((function(t){return t.system.vwoffhand})))),t.attack+=Math.max.apply(Math,_toConsumableArray(o.map((function(t){return t.system.awoffhand}))))));var c=0;t.system.worn.wrongGrip&&t.yieldedTwoHand&&(t.parry-=1,c+=1),t=this._parseDmg(t),c>0&&(t.extraDamage=c,t.damageAdd=Roll.safeEval(t.damageAdd+" + "+Number(c)),t.damageAdd=(t.damageAdd>0?"+":"")+t.damageAdd)}else ui.notifications.error(game.i18n.format("dsk.DSKError.unknownCombatSkill",{skill:t.system.combatskill,item:t.name}));return t}},{key:"_parseDmg",value:function _parseDmg(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=new Roll(t.system.tp.replace(/[Ww]/g,"d"),{async:!1}),i="",c="",u="+",l=_createForOfIteratorHelper(o.terms);try{for(l.s();!(r=l.n()).done;){var p=r.value;p.faces?i=p.number+"d"+p.faces:p.operator?u=p.operator:p.number&&(c+=Number("".concat(u).concat(p.number)))}}catch(t){l.e(t)}finally{l.f()}if(a){var d=getProperty(a,"system.damageMod");Number(d)?c+="+".concat(Number(d)):d&&(t.damageBonusDescription=", ".concat(d," ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")," ").concat(a.name))}return c&&(c=Roll.safeEval(c)),t.damagedie=i||"0d6",t.damageAdd=""!=c?(Number(c)>=0?"+":"")+c:"",t}},{key:"calcLZ",value:function calcLZ(t,r){var a=1,o=0;t.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Throwing Weapons")?o=-1*m.Z.abilityStep(r,game.i18n.localize("dsk.LocalizedIDs.quickdraw")):t.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Crossbows")&&m.Z.hasAbility(r,game.i18n.localize("dsk.LocalizedIDs.quickload"))?a=.5:o=-1*m.Z.abilityStep(r,game.i18n.localize("dsk.LocalizedIDs.quickload"));var i="".concat(t.system.lz).split("/");if("mag"==t.system.ammunitionType){var c=r.items.find((function(r){return r.id==t.system.currentAmmo||r._id==t.system.currentAmmo})),u=0;c&&(c=p.Z.toObjectIfPossible(c)).system.mag.value<=0&&(u=1),i=i[u]||i[0]}else i=i[0];return Math.max(0,Math.round(Number(i)*a)+o)}},{key:"_attrFromCharacteristic",value:function _attrFromCharacteristic(t,r){return r.characteristics[t].value}},{key:"_calculatePW",value:function _calculatePW(t,r){return t.PW=Math.round((ActorDSK._attrFromCharacteristic(t.system.characteristic1,r)+ActorDSK._attrFromCharacteristic(t.system.characteristic2,r))/2)+5+(t.system.level||0),t}},{key:"buildReloadProgress",value:function buildReloadProgress(t){var r=t.system.reloadTimeprogress/t.LZ;t.title=game.i18n.format("dsk.WEAPON.loading",{status:"".concat(t.system.reloadTimeprogress,"/").concat(t.LZ)}),t.progress="".concat(t.system.reloadTimeprogress,"/").concat(t.LZ),r>=1&&(t.title=game.i18n.localize("dsk.WEAPON.loaded")),this.progressTransformation(t,r)}},{key:"progressTransformation",value:function progressTransformation(t,r){r>=.5?(t.transformRight="181deg",t.transformLeft="".concat(Math.round(360*r-179),"deg")):(t.transformRight="".concat(Math.round(360*r+1),"deg"),t.transformLeft=0)}},{key:"_prepareitemStructure",value:function _prepareitemStructure(t){var r=getProperty(t,"flags.dsk.enchantments");return r&&r.length>0?t.enchantClass="rar":t.effects.length>0&&(t.enchantClass="common"),t}},{key:"prepareMag",value:function prepareMag(t){return"mag"==t.system.ammunitiongroup&&(t.structureMax=t.system.mag.max,t.structureCurrent=t.system.mag.value),t}},{key:"_parseModifiers",value:function _parseModifiers(t,r){var a=[];return t.find('[name="situationalModifiers"] option:selected').each((function(){var t=$(this).val(),r={name:$(this).text().trim().split("[")[0],value:isNaN(t)?t:Number(t),type:$(this).attr("data-type")};"dmg"==r.type&&(r.damageBonus=r.value,r.value=0),$(this).attr("data-specAbId")&&(r.specAbId=$(this).attr("data-specAbId")),$(this).attr("data-armorPen")&&(r.armorPen=$(this).attr("data-armorPen")),a.push(r)})),a.push({name:game.i18n.localize("dsk.manual"),value:Number(t.find('[name="testModifier"]').val()),type:""}),a}},{key:"schipsModifier",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee26(t,r){return _regeneratorRuntime().wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:t.find('[name="schips"]').is(":checked")&&r.push({name:game.i18n.localize("dsk.schips"),value:5,type:""});case 1:case"end":return a.stop()}}),_callee26)}))),function schipsModifier(t,a){return r.apply(this,arguments)})}]),ActorDSK}()},582:(t,r,a)=>{a.d(r,{Z:()=>m});var o=a(231),i=a(140),c=a(278),u=a(614),l=a(832),p=a(514),d=a(96),h=a(564),y=a(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var m=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(DSKCombatDialog,t);var r,a=_createSuper(DSKCombatDialog);function DSKCombatDialog(){return _classCallCheck(this,DSKCombatDialog),a.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKCombatDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(DSKCombatDialog.prototype),"activateListeners",this).call(this,t);var a=t.find(".specAbs");a.mouseenter((function(t){if(0==t.currentTarget.getElementsByClassName("hovermenu").length){var a=document.createElement("div");a.classList.add("hovermenu");var o=document.createElement("i");o.classList.add("fas","fa-comment"),o.title=game.i18n.localize("dsk.SHEET.PostItem"),o.addEventListener("mousedown",r._postItem,!1),a.appendChild(o),t.currentTarget.appendChild(a)}})),a.mouseleave((function(t){var a=t.toElement||t.relatedTarget;a.parentNode!=r&&a!=r&&t.currentTarget.querySelectorAll(".hovermenu").forEach((function(t){return t.remove()}))})),t.on("mousedown",".specAbs",(function(a){if(t.find(".opportunityAttack").is(":checked"))ui.notifications.error(game.i18n.localize("dsk.DSKError.opposedAttackNoSpecAbs"));else{var o=$(a.currentTarget),i=Number(o.attr("data-step")),c=Number(o.attr("data-maxStep")),u=Number(o.attr("data-category"));if(0==a.button){if(i=Math.min(c,i+1),[0,1].includes(u)&&game.settings.get("dsk","limitCombatSpecAbs")){var l=o.siblings('[data-category="'.concat(u,'"]'));l.removeClass("active").attr("data-step",0),l.find(".step").text(h.Z.roman[0])}}else 2==a.button&&(i=Math.clamped(c,0,i-1));o.attr("data-step",i),i>0?o.addClass("active"):o.removeClass("active"),o.find(".step").text(h.Z.roman[i]),r.calculateModifier()}})),t.find(".opportunityAttack").change((function(r){if($(r.currentTarget).is(":checked")){var a,o=function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}(t.find(".specAbs"));try{for(o.s();!(a=o.n()).done;){var i=a.value;$(i).removeClass("active").attr("data-step",0).find(".step").text("")}}catch(t){o.e(t)}finally{o.f()}}})),t.on("change","input,select",(function(t){return r.calculateModifier(t)})),t.find(".modifiers option").mousedown((function(t){r.calculateModifier(t)})),t.find(".quantity-click").mousedown((function(t){return r.calculateModifier(t)}));var o=this.readTargets();this.calculateModifier();var i=this;this.checkTargets=setInterval((function(){o=i.compareTargets(t,o)}),500)}},{key:"close",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t,r=arguments;return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},clearInterval(this.checkTargets),a.next=4,_get(_getPrototypeOf(DSKCombatDialog.prototype),"close",this).call(this,t);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}}),_callee,this)}))),function close(){return r.apply(this,arguments)})},{key:"_postItem",value:function _postItem(t){t.stopPropagation();var r=$(t.currentTarget).closest(".specAbs"),a=r.attr("data-actor"),o=r.attr("data-id");return game.actors.get(a).items.get(o).postItem(),!1}},{key:"recallSettings",value:function recallSettings(t,r,a){return _get(_getPrototypeOf(DSKCombatDialog.prototype),"recallSettings",this).call(this,t,r,a),this.prepareWeapon(),this}},{key:"prepareWeapon",value:function prepareWeapon(){var t,r=this.dialogData.source,a=l.Z.getSpeaker(this.dialogData.speaker);if(a)if(["meleeweapon","rangeweapon"].includes(r.type)){var i=r.system.combatskill,c=o.Z._calculateCombatSkillValues(a.items.find((function(t){return"combatskill"==t.type&&t.name==i})).toObject(),a.system);switch(r.type){case"meleeweapon":t=o.Z._prepareMeleeWeapon(r,[c],a);break;case"rangeweapon":t=o.Z._prepareRangeWeapon(r,[],[c],a)}"attack"==this.dialogData.mode&&(this.dialogData.rollValue=t.attack)}else"attack"==this.dialogData.mode&&(this.dialogData.rollValue=Number(r.system.at))}},{key:"prepareFormRecall",value:function prepareFormRecall(t){if(_get(_getPrototypeOf(DSKCombatDialog.prototype),"prepareFormRecall",this).call(this,t),canvas.scene&&game.settings.get("dsk","sightAutomationEnabled")){for(var r=canvas.scene?canvas.scene.darkness:0,a=game.settings.get("dsk","sightOptions").split("|").map((function(t){return Number(t)})),o=0;a[o]<=r;)o+=1;var i=l.Z.getSpeaker(this.dialogData.speaker);if(i){var u=c.Z.vantageStep(i,game.i18n.localize("dsk.LocalizedIDs.darksight"))+p.Z.abilityStep(i,game.i18n.localize("dsk.LocalizedIDs.sappeurStyle")),d=p.Z.abilityStep(i,game.i18n.localize("dsk.LocalizedIDs.blindFighting"));o<4&&o>0&&(u>1?o=0:(o=Math.max(0,o-u),o=Math.min(4,o+c.Z.vantageStep(i,game.i18n.localize("dsk.LocalizedIDs.nightBlind"))))),o=Math.max(0,o-d)}var h=t.find('[name="vision"] option:nth-child('.concat(o+1,")"));h.length&&(h[0].selected=!0)}}},{key:"calculateModifier",value:function calculateModifier(){if("damage"!=this.dialogData.mode){var t=this.dialogData.source,r="trait"==t.type&&"meleeAttack"==getProperty(t,"system.traitType")||"meleeweapon"==t.type,a={source:this.dialogData.source,extra:{options:{}}},o=l.Z.getSpeaker(this.dialogData.speaker);r?DSKCombatDialog.resolveMeleeDialog(a,{},this.element,o,{},-3,this.dialogData.mode):DSKCombatDialog.resolveRangeDialog(a,{},this.element,o,{},this.dialogData.mode),this.dialogData.modifier=u.Z._situationalModifiers(a),this.updateRollButton(this.readTargets())}}}],[{key:"defaultOptions",get:function get(){var t=_get(_getPrototypeOf(DSKCombatDialog),"defaultOptions",this);return mergeObject(t,{width:700,resizable:!0}),t}},{key:"resolveMeleeDialog",value:function resolveMeleeDialog(t,r,a,o,c,u,l){var d;this._resolveDefault(t,r,a,o,c);var h=new FormDataExtended(a.find("form")[0]).object;t.opposingWeaponSize=h.weaponsize,t.narrowSpace=h.narrowSpace,t.attackOfOpportunity=this.attackOfOpportunity(t.situationalModifiers,h),(d=t.situationalModifiers).push.apply(d,[i.Z.parseValueType(game.i18n.localize("dsk.sight"),h.vision||0),{name:game.i18n.localize("dsk.attackFromBehind"),value:h.attackFromBehind?-4:0},{name:game.i18n.localize("dsk.MODS.damage"),damageBonus:h.damageModifier,value:0,step:1},{name:game.i18n.format("dsk.defenseCount",{malus:u}),value:(Number(h.defenseCount)||0)*u},{name:game.i18n.localize("dsk.wrongHand"),value:h.wrongHand?-4:0},{name:game.i18n.localize("dsk.advantageousPosition"),value:h.advantageousPosition?2:0},{name:game.i18n.localize("dsk.sizeCategory"),value:y.Z.meleeSizeModifier[h.size]}].concat(_toConsumableArray(i.Z.getSpecAbModifiers(a,l)))),"attack"==l&&t.situationalModifiers.push({name:game.i18n.localize("dsk.doubleAttack"),value:h.doubleAttack?-3+Math.floor(1.5*p.Z.abilityStep(o,game.i18n.localize("dsk.LocalizedIDs.twoWeaponCombat"))):0})}},{key:"resolveRangeDialog",value:function resolveRangeDialog(t,r,a,o,c){var u;this._resolveDefault(t,r,a,o,c);var l=new FormDataExtended(a.find("form")[0]).object;t.rangeModifier=l.distance,(u=t.situationalModifiers).push.apply(u,[{name:game.i18n.localize("dsk.target")+" "+a.find('[name="targetMovement"] option:selected').text(),value:Number(l.targetMovement)||0},{name:game.i18n.localize("dsk.shooter")+" "+a.find('[name="shooterMovement"] option:selected').text(),value:Number(l.shooterMovement)||0},{name:game.i18n.localize("dsk.mount")+" "+a.find('[name="mountedOptions"] option:selected').text(),value:Number(l.mountedOptions)||0},{name:game.i18n.localize("dsk.rangeMovementOptions.QUICKCHANGE"),value:l.quickChange?-4:0},{name:game.i18n.localize("dsk.MODS.combatTurmoil"),value:l.combatTurmoil?-2:0},{name:game.i18n.localize("dsk.aim"),value:Number(l.aim)||0},{name:game.i18n.localize("dsk.MODS.damage"),damageBonus:l.damageModifier,value:0,step:1},{name:game.i18n.localize("dsk.sight"),value:Number(l.vision||0)}].concat(_toConsumableArray(i.Z.getSpecAbModifiers(a,"attack")),[{name:game.i18n.localize("dsk.sizeCategory"),value:y.Z.rangeSizeModifier[l.size]}]))}},{key:"_resolveDefault",value:function _resolveDefault(t,r,a,i,c){r.rollMode=a.find('[name="rollMode"]').val(),t.situationalModifiers=o.Z._parseModifiers(a),o.Z.schipsModifier(a,t.situationalModifiers),t.vw=a.find('[name="vw"]').val(),mergeObject(t.extra.options,c)}},{key:"attackOfOpportunity",value:function attackOfOpportunity(t,r){var a=r.opportunityAttack?-8:0;if(a){t.push({name:game.i18n.localize("dsk.opportunityAttack"),value:a});var o=game.i18n.localize("dsk.LocalizedIDs.enemySense");game.user.targets.forEach((function(r){r.actor&&r.actor.items.find((function(t){return"specialability"==t.type&&t.name==o}))&&t.push({name:o,value:a})}))}return 0!=a}},{key:"getRollButtons",value:function getRollButtons(t,r,a,i){var c,u=d.Z.getRollButtons(t,r,a,i);if("rangeweapon"==t.source.type||"trait"==t.source.type&&"rangeAttack"==t.source.system.traitType){var p="trait"==t.source.type?Number(t.source.system.lz):o.Z.calcLZ(t.source,t.extra.actor),h=t.source.system.reloadTimeprogress;h<p&&mergeObject(u,{reloadButton:{label:"".concat(game.i18n.localize("dsk.WEAPON.reload")," (").concat(h,"/").concat(p,")"),callback:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var r,a;return _regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,l.Z.getSpeaker(t.extra.speaker);case 2:return r=o.sent,o.next=5,r.updateEmbeddedDocuments("Item",[{_id:t.source._id,"system.reloadTimeprogress":h+1}]);case 5:return a=game.i18n.format("dsk.WEAPON.isReloading",{actor:t.extra.actor.name,item:t.source.name,status:"".concat(h+1,"/").concat(p)}),o.next=8,ChatMessage.create(l.Z.chatDataSetup(a));case 8:case"end":return o.stop()}}),_callee2)}))),function callback(){return c.apply(this,arguments)})}})}return u}}]),DSKCombatDialog}(h.Z)},96:(t,r,a)=>{a.d(r,{Z:()=>d});var o=a(582),i=a(564),c=a(231);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var u=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(SkillDialogDSK,t);var r=_createSuper(SkillDialogDSK);function SkillDialogDSK(){return _classCallCheck(this,SkillDialogDSK),r.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(SkillDialogDSK,[{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(SkillDialogDSK.prototype),"activateListeners",this).call(this,t),t.on("change","input,select",(function(t){return r.rememberFormData(t)}));var a=this.readTargets(),o=this;this.checkTargets=setInterval((function(){a=o.compareTargets(t,a)}),500),this.rememberFormData(),t.on("mousedown",".quantity-click",(function(t){return r.rememberFormData(t)})),t.find(".modifiers option").mousedown((function(t){r.rememberFormData(t)}))}},{key:"rememberFormData",value:function rememberFormData(t){new FormDataExtended(this.element.find("form")[0]).object.situationalModifiers=c.Z._parseModifiers(this._element)}}],[{key:"getRollButtons",value:function getRollButtons(t,r,a,o){var i=d.getRollButtons(t,r,a,o);i.rollButton.label=game.i18n.localize("dsk.Opposed");var c={nonOpposedButton:{label:game.i18n.localize("dsk.Roll"),callback:function callback(o){game.dsk.memory.remember(t.extra.speaker,t.source,t.mode,o),t.opposable=!1,a(r.callback(o))}}};return mergeObject(c,i),c}},{key:"defaultOptions",get:function get(){var t=_get(_getPrototypeOf(SkillDialogDSK),"defaultOptions",this);return mergeObject(t,{width:700,resizable:!0}),t}}]),SkillDialogDSK}(i.Z),l=a(832);function dialog_spell_typeof(t){return dialog_spell_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_spell_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_spell_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_spell_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_spell_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dialog_spell_get(){return dialog_spell_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dialog_spell_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dialog_spell_get.apply(this,arguments)}function dialog_spell_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_spell_getPrototypeOf(t)););return t}function dialog_spell_setPrototypeOf(t,r){return dialog_spell_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_spell_setPrototypeOf(t,r)}function dialog_spell_createSuper(t){var r=function dialog_spell_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dialog_spell_getPrototypeOf(t);if(r){var i=dialog_spell_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dialog_spell_possibleConstructorReturn(this,a)}}function dialog_spell_possibleConstructorReturn(t,r){if(r&&("object"===dialog_spell_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_spell_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_spell_getPrototypeOf(t){return dialog_spell_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_spell_getPrototypeOf(t)}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var p=function(t){!function dialog_spell_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_spell_setPrototypeOf(t,r)}(DSKpellDialog,t);var r,a=dialog_spell_createSuper(DSKpellDialog);function DSKpellDialog(){return dialog_spell_classCallCheck(this,DSKpellDialog),a.apply(this,arguments)}return function dialog_spell_createClass(t,r,a){return r&&dialog_spell_defineProperties(t.prototype,r),a&&dialog_spell_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKpellDialog,[{key:"prepareFormRecall",value:function prepareFormRecall(t){dialog_spell_get(dialog_spell_getPrototypeOf(DSKpellDialog.prototype),"prepareFormRecall",this).call(this,t),t.find(".spellModifier").trigger("change")}},{key:"recalcSpellModifiers",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var a,o,i,c,u,l,p,d,h,y,m,g;return _regeneratorRuntime().wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:if(a=t,o=duplicate(this.dialogData.source),i=a.find(".castingTime"),c=a.find(".aspcost"),u=a.find(".reach"),a.find(".maintainCost"),l=a.find(".ritual").length>0,p=a.find(".maxMods"),!(a.find(".spellModifier:checked").length>Number(p.text()))){v.next=13;break}return r&&(r.currentTarget.checked=!1),p.addClass("emphasize"),setTimeout((function(){p.removeClass("emphasize")}),600),v.abrupt("return");case 13:d=o.system.AeP,h=o.system.range,y=d,a.find(".variableBaseCost")["true"==o.system.variableBaseCost?"show":"hide"](),m=0,a.find(".spellModifier[data-cost]:checked").each((function(t,r){y*=r.value<0?.5:2,m+=Number(r.value)})),y<1?r&&(r.currentTarget.checked=!1):(c.text(y),c.attr("data-mod",m)),m=0,y=2,a.find(".spellModifier[data-castingTime]:checked").each((function(t,r){if(l){var a=DSKpellDialog.bigTimes.indexOf(Number(y));if(null!=a){var o=a+(r.value>0?1:-1);o<DSKpellDialog.bigTimes.length&&o>=0?y=DSKpellDialog.bigTimes[o]:ui.notifications.error(game.i18n.localize("dsk.DSKError.CastingTimeLimit"))}else ui.notifications.error(game.i18n.localize("dsk.DSKError.TimeCannotBeParsed"))}else y*=r.value>0?2:.5;m+=Number(r.value)})),y<1?r&&(r.currentTarget.checked=!1):(i.text(y),i.attr("data-mod",m)),m=0,g=game.i18n.localize("dsk.ReverseSpellRanges."+h),u.text(h),a.find(".spellModifier[data-reach]:checked").each((function(t,a){if("self"==g)a.checked=!1;else if("touch"==g)u.text("4 "+game.i18n.localize("dsk.step")),m+=Number(a.value);else{var o=h.split(" ");g=Number(o[0]),isNaN(g)?(r&&(r.currentTarget.checked=!1),ui.notifications.error(game.i18n.localize("dsk.DSKError.RangeCannotBeParsed"))):(u.text(2*g+" "+game.i18n.localize("dsk.step")),m+=Number(a.value))}})),u.attr("data-mod",m),t.find(".reloadButton").prop("disabled",Number(t.find(".castingTime").text())<2);case 31:case"end":return v.stop()}}),_callee,this)}))),function recalcSpellModifiers(t,a){return r.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;dialog_spell_get(dialog_spell_getPrototypeOf(DSKpellDialog.prototype),"activateListeners",this).call(this,t),t.find(".reloadButton").prop("disabled",Number(t.find(".castingTime").text())<2),t.find(".specAbs").mousedown((function(a){$(a.currentTarget).toggleClass("active"),r.recalcSpellModifiers(t)})),t.find(".variableBaseCost").change((function(t){var r=$(t.currentTarget).parents(".skill-test"),a=r.find(".aspcost").attr("data-base"),o=$(t.currentTarget).val();r.find(".aspcost").attr("data-base",o),r.find(".aspcost").text(Number(r.find(".aspcost").text())*o/a)})),t.find(".spellModifier").change((function(a){return r.recalcSpellModifiers(t,a)}));var a=this.readTargets();0==a.length&&this.setRollButtonWarning();var o=this;this.checkTargets=setInterval((function(){a=o.compareTargets(t,a)}),500)}}],[{key:"defaultOptions",get:function get(){var t=dialog_spell_get(dialog_spell_getPrototypeOf(DSKpellDialog),"defaultOptions",this);return mergeObject(t,{width:700,resizable:!0}),t}},{key:"getRollButtons",value:function getRollButtons(t,r,a,o){var i,c=d.getRollButtons(t,r,a,o);if(["spell","liturgy"].includes(t.source.type)){var u=Number(t.source.system.castingTime.value),p=t.source.system.castingTime.progress,h=t.source.system.castingTime.modified;if(u&&"emptyActor"!=t.extra.speaker.token){var y=h>0?" (".concat(p,"/").concat(h,")"):"";mergeObject(c,{reloadButton:{label:"".concat(game.i18n.localize("dsk.SPELL.reload")).concat(y),callback:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(r){var a,o,i;return _regeneratorRuntime().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,l.Z.getSpeaker(t.extra.speaker);case 2:return a=c.sent,o={_id:t.source._id,"system.castingTime.progress":p+1},0==h&&(h=Number(r.find(".castingTime").text())-1,o["system.castingTime.modified"]=h),c.next=7,a.updateEmbeddedDocuments("Item",[o]);case 7:return i=game.i18n.format("dsk.SPELL.isReloading",{actor:t.extra.actor.name,item:t.source.name,status:"".concat(p+1,"/").concat(h)}),c.next=10,ChatMessage.create(l.Z.chatDataSetup(i));case 10:case"end":return c.stop()}}),_callee2)}))),function callback(t){return i.apply(this,arguments)})}})}}return c}}]),DSKpellDialog}(i.Z);function dialog_dsk_typeof(t){return dialog_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_dsk_typeof(t)}function dialog_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_dsk_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dialog_dsk_get(){return dialog_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dialog_dsk_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dialog_dsk_get.apply(this,arguments)}function dialog_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_dsk_getPrototypeOf(t)););return t}function dialog_dsk_setPrototypeOf(t,r){return dialog_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_dsk_setPrototypeOf(t,r)}function dialog_dsk_createSuper(t){var r=function dialog_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dialog_dsk_getPrototypeOf(t);if(r){var i=dialog_dsk_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dialog_dsk_possibleConstructorReturn(this,a)}}function dialog_dsk_possibleConstructorReturn(t,r){if(r&&("object"===dialog_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_dsk_getPrototypeOf(t){return dialog_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_dsk_getPrototypeOf(t)}_defineProperty(p,"rollChanges",["defenseMalus"]),_defineProperty(p,"bigTimes",[5,30,120,480,960,1920]);var d=function(t){!function dialog_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_dsk_setPrototypeOf(t,r)}(DSKDialog,t);var r=dialog_dsk_createSuper(DSKDialog);function DSKDialog(){return dialog_dsk_classCallCheck(this,DSKDialog),r.apply(this,arguments)}return function dialog_dsk_createClass(t,r,a){return r&&dialog_dsk_defineProperties(t.prototype,r),a&&dialog_dsk_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKDialog,[{key:"activateListeners",value:function activateListeners(t){dialog_dsk_get(dialog_dsk_getPrototypeOf(DSKDialog.prototype),"activateListeners",this).call(this,t),t.find(".dieButton").click((function(t){var r=$(t.currentTarget);"true"==r.attr("data-single")&&r.closest(".dialog-content").find(".dieButton").removeClass("dieSelected"),r.toggleClass("dieSelected")}))}}],[{key:"getDialogForItem",value:function getDialogForItem(t){switch(t){case"rangeweapon":case"meleeweapon":case"trait":return o.Z;case"ahnengabe":return p;case"skill":return u}return DSKDialog}},{key:"getRollButtons",value:function getRollButtons(t,r,a,o){var i={rollButton:{label:game.i18n.localize("dsk.check"),callback:function callback(o){game.dsk.memory.remember(t.extra.speaker,t.source,t.mode,o),a(r.callback(o))}}};return game.user.isGM&&mergeObject(i,{cheat:{label:game.i18n.localize("dsk.DIALOG.cheat"),callback:function callback(o){game.dsk.memory.remember(t.extra.speaker,t.source,t.mode,o),a(r.callback(o,{cheat:!0}))}}}),i}},{key:"defaultOptions",get:function get(){var t=dialog_dsk_get(dialog_dsk_getPrototypeOf(DSKDialog),"defaultOptions",this);return mergeObject(t,{resizable:!0}),t}}]),DSKDialog}(i.Z)},564:(t,r,a)=>{a.d(r,{Z:()=>u});var o=a(122),i=a(565);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var c=function(t){_inherits(AddTargetDialog,Dialog);var r,a,o=_createSuper(AddTargetDialog);function AddTargetDialog(){return _classCallCheck(this,AddTargetDialog),o.apply(this,arguments)}return _createClass(AddTargetDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(AddTargetDialog.prototype),"activateListeners",this).call(this,t);var a=t.find(".combatant");a.click((function(t){return r.setTargets(t)})),a.hover(this._onCombatantHoverIn.bind(this),this._onCombatantHoverOut.bind(this)),a.mousedown((function(t){return r._onRightClick(t)}))}},{key:"_onCombatantHoverOut",value:function _onCombatantHoverOut(t){this._getCombatApp()._onCombatantHoverOut(t)}},{key:"_onCombatantHoverIn",value:function _onCombatantHoverIn(t){this._getCombatApp()._onCombatantHoverIn(t)}},{key:"_onRightClick",value:function _onRightClick(t){if(2==t.button){var r=game.combat.combatants.get(t.currentTarget.dataset.combatantId);if(r.token)return canvas.animatePan({x:r.token.x,y:r.token.y})}}},{key:"_getCombatApp",value:function _getCombatApp(){return game.combats.apps[0]}},{key:"setTargets",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,a;return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:(r=t.originalEvent.shiftKey)||$(t.currentTarget).closest(".directory").find(".combatant").removeClass("selectedTarget"),$(t.currentTarget).addClass("selectedTarget"),a=t.currentTarget.dataset.combatantId,game.combat.combatants.get(a).token.object.setTarget(!0,{user:game.user,releaseOthers:!r,groupSelection:!0});case 6:case"end":return o.stop()}}),_callee)}))),function setTargets(t){return a.apply(this,arguments)})}],[{key:"getDialog",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var r,a,o,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return a=Array.from(game.user.targets).map((function(t){return t.id})),o=[],c=canvas.scene?null===(r=canvas.scene.tokens.get(t.token))||void 0===r?void 0:r.object:void 0,game.combat&&game.combat.combatants.forEach((function(t){if(t.visible){if(t.isSelected=a.includes(t.token.id),c&&t.token){var r=canvas.scene.tokens.get(t.token.id).object;t.distance=i.Z.rangeFinder(c,r),t.distance.distanceSum=Number(t.distance.distanceSum.toFixed(1))}o.push(t)}})),u.t0=AddTargetDialog,u.t1=game.i18n.localize("dsk.DIALOG.addTarget"),u.next=8,renderTemplate("systems/dsk/templates/dialog/addTarget-dialog.html",{selectables:o});case 8:return u.t2=u.sent,u.t3={},u.t4={title:u.t1,content:u.t2,default:"yes",buttons:u.t3},u.abrupt("return",new u.t0(u.t4));case 12:case"end":return u.stop()}}),_callee2)}))),function getDialog(t){return r.apply(this,arguments)})}]),AddTargetDialog}();function dialog_shared_typeof(t){return dialog_shared_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_shared_typeof(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function dialog_shared_regeneratorRuntime(){dialog_shared_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_shared_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function dialog_shared_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function dialog_shared_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){dialog_shared_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){dialog_shared_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_shared_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_shared_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dialog_shared_get(){return dialog_shared_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dialog_shared_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dialog_shared_get.apply(this,arguments)}function dialog_shared_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_shared_getPrototypeOf(t)););return t}function dialog_shared_setPrototypeOf(t,r){return dialog_shared_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_shared_setPrototypeOf(t,r)}function dialog_shared_createSuper(t){var r=function dialog_shared_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dialog_shared_getPrototypeOf(t);if(r){var i=dialog_shared_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dialog_shared_possibleConstructorReturn(this,a)}}function dialog_shared_possibleConstructorReturn(t,r){if(r&&("object"===dialog_shared_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_shared_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_shared_getPrototypeOf(t){return dialog_shared_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_shared_getPrototypeOf(t)}var u=function(t){!function dialog_shared_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_shared_setPrototypeOf(t,r)}(DialogShared,Dialog);var r,a,i,u,l=dialog_shared_createSuper(DialogShared);function DialogShared(){return dialog_shared_classCallCheck(this,DialogShared),l.apply(this,arguments)}return function dialog_shared_createClass(t,r,a){return r&&dialog_shared_defineProperties(t.prototype,r),a&&dialog_shared_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DialogShared,[{key:"recallSettings",value:function recallSettings(t,r,a){return this.recallData=game.dsk.memory.recall(t,r,a),this.dialogData={mode:a,speaker:t,source:r},this}},{key:"_render",value:(u=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee(t,r){return dialog_shared_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,dialog_shared_get(dialog_shared_getPrototypeOf(DialogShared.prototype),"_render",this).call(this,t,r);case 2:this.prepareFormRecall($(this._element));case 3:case"end":return a.stop()}}),_callee,this)}))),function _render(t,r){return u.apply(this,arguments)})},{key:"setRollButtonWarning",value:function setRollButtonWarning(){if("attack"==this.dialogData.mode){var t=game.i18n.localize("dsk.DIALOG.noTarget");return'<span class="missingTarget"><i class="fas fa-exclamation-circle"></i> '.concat(t,"</span>")}return""}},{key:"setMultipleTargetsWarning",value:function setMultipleTargetsWarning(){if("attack"==this.dialogData.mode){var t=game.i18n.localize("dsk.DIALOG.multipleTarget");return'<span class="multipleTarget"><i class="fas fa-exclamation-circle"></i> '.concat(t,"</span>")}return""}},{key:"renderRollValueDie",value:function renderRollValueDie(){if(this.dialogData.rollValue&&"damage"!=this.dialogData.mode){var t="attack"==this.dialogData.mode?"die-mu":"die-in",r=this.dialogData.modifier||0;return'<span class="rollValue '.concat(t,' d20">').concat(this.dialogData.rollValue+r,"</span>")}return""}},{key:"updateRollButton",value:(i=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee2(t){var r;return dialog_shared_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:r=this.renderRollValueDie()+game.i18n.localize("dsk.Roll"),t.length>0?t.length>1&&(r+=this.setMultipleTargetsWarning()):r+=this.setRollButtonWarning(),$(this._element).find(".dialog-buttons .rollButton").html(r);case 3:case"end":return a.stop()}}),_callee2,this)}))),function updateRollButton(t){return i.apply(this,arguments)})},{key:"updateTargets",value:(a=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee3(t,r){var a;return dialog_shared_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,renderTemplate("systems/dsk/templates/dialog/parts/targets.html",{targets:r});case 2:a=o.sent,t.find(".targets").html(a),this.updateRollButton(r);case 5:case"end":return o.stop()}}),_callee3,this)}))),function updateTargets(t,r){return a.apply(this,arguments)})},{key:"removeTarget",value:function removeTarget(t){var r=t.currentTarget.dataset.id;$(t.currentTarget).remove();var a=[];game.user.targets.forEach((function(t){r!=t.id&&a.push(t.id)})),game.user.updateTokenTargets(a)}},{key:"readTargets",value:function readTargets(){var t=[];return game.user.targets.forEach((function(r){r.actor&&t.push({name:r.actor.name,img:r.actor.img,id:r.id})})),t}},{key:"compareTargets",value:function compareTargets(t,r){var a=this.readTargets();return JSON.stringify(r)!=JSON.stringify(a)&&(r=a,this.updateTargets(t,r)),r}},{key:"activateListeners",value:function activateListeners(t){var r=this;dialog_shared_get(dialog_shared_getPrototypeOf(DialogShared.prototype),"activateListeners",this).call(this,t),t.find(".quantity-click").mousedown((function(t){var r=t.currentTarget.dataset.quantityfocus,a=$(t.currentTarget);if(!r||a.is(":focus")){var i={val:Number(a.val())};o.Z.increment(t,i,"val"),a.val(i.val)}else setTimeout((function(){a.select()}))})),t.find(".modifiers option").mousedown((function(t){return t.preventDefault(),$(t.currentTarget).prop("selected",!$(t.currentTarget).prop("selected")),!1})),t.on("click",".rollTarget",(function(t){return r.removeTarget(t)})),t.on("click",".addTarget",(function(t){return r.addTarget(t)}))}},{key:"addTarget",value:(r=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee4(t){return dialog_shared_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.getDialog(this.dialogData.speaker);case 2:t.sent.render(!0);case 3:case"end":return t.stop()}}),_callee4,this)}))),function addTarget(t){return r.apply(this,arguments)})},{key:"prepareFormRecall",value:function prepareFormRecall(t){var r=this;if(this.recallData)for(var a in this.recallData)if("specAbs"==a){var o,i=_createForOfIteratorHelper(this.recallData[a]);try{for(i.s();!(o=i.n()).done;){var c=o.value,u=t.find('.specAbs[data-id="'.concat(c.id,'"]'));u.addClass("active").attr("data-step",c.step),u.find(".step").text(DialogShared.roman[c.step])}}catch(t){i.e(t)}finally{i.f()}}else{var l=t.find('[name="'.concat(a,'"]'));if(Array.isArray(this.recallData[a])){var p,d=_createForOfIteratorHelper(l.find("option"));try{var h=function _loop(){var t=p.value,o=r.recallData[a].find((function(r){return r.name==$(t).text().trim()}));o&&(t.selected=o.selected)};for(d.s();!(p=d.n()).done;)h()}catch(t){d.e(t)}finally{d.f()}}else"checkbox"==l.attr("type")?l[0].checked=this.recallData[a]:l.val(this.recallData[a])}}}]),DialogShared}();!function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}(u,"roman",[""," I"," II"," III"," IV"," V"," VI"," VII"," VIII"," IX"," X"])},147:(t,r,a)=>{a.d(r,{Y:()=>initImagePopoutTochat,d:()=>showPopout});var o=a(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function initImagePopoutTochat(){Hooks.on("getImagePopoutHeaderButtons",(function(t,r){var a;r.unshift({class:"posttochat",icon:"fas fa-comment",onclick:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",postImage(t));case 1:case"end":return r.stop()}}),_callee)}))),function onclick(){return a.apply(this,arguments)})})}))}function postImage(t){return _postImage.apply(this,arguments)}function _postImage(){return(_postImage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var r,a;return _regeneratorRuntime().wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return r=t.object,i.next=3,renderTemplate("systems/dsk/templates/chat/imagetochat.html",{image:r});case 3:a=i.sent,ChatMessage.create(o.Z.chatDataSetup(a));case 5:case"end":return i.stop()}}),_callee2)})))).apply(this,arguments)}function showPopout(t){var r=t.currentTarget.dataset;o.Z.showArtwork(r,!1)}},846:(t,r,a)=>{a.d(r,{q:()=>conditionsMatcher,v:()=>setEnrichers});var o=a(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function setEnrichers(){var t,r={Rq:"roll"},a={Rq:"dice"},i={Rq:""},c=/(-|\+)?\d+/,u=/\[[a-zA-z&; -]+/,l=/[\[\]]/g;if(!o.Z.statusRegex){var p=o.Z.statusEffects.map((function(t){return game.i18n.localize(t.label).toLowerCase()})),d=["dsk.status","dsk.condition","dsk.level","dsk.levels"].map((function(t){return game.i18n.localize(t)})).join("|");o.Z.statusRegex={effects:p,regex:new RegExp("(".concat(d,") (").concat(p.join("|"),")"),"gi")}}CONFIG.TextEditor.enrichers.push({pattern:/@(Rq|Ch)\[[a-zA-z&; -]+ (-|\+)?\d+\]/g,enricher:function enricher(t,o){var p=t[0],d=t[1],h=Number(p.match(c)[0]),y=p.replace(h,"").match(u)[0].replace(l,"").trim();return $('<a class="roll-button request-'.concat(r[d],'" data-type="skill" data-modifier="').concat(h,'" data-name="').concat(y,'"><em class="fas fa-').concat(a[d],'"></em>').concat(i[d]).concat(y," ").concat(h,"</a>"))[0]}},{pattern:o.Z.statusRegex.regex,enricher:function enricher(t,r){return $(conditionsMatcher(t))[0]}},{pattern:/@Info\[[a-zA-z&; -\.0-9]+\]/g,enricher:(t=function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(t,r){var a,o,i;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return a=t[0].match(/(?:\[)(.*?)(?=\])/)[0].slice(1),r.next=3,fromUuid(a);case 3:if((o=r.sent)&&"information"==o.type){r.next=6;break}return r.abrupt("return",$('<a class="content-link broken"><i class="fas fa-unlink"></i>info</a>')[0]);case 6:if(game.user.isGM){r.next=8;break}return r.abrupt("return",$('<a class="content-link"><i class="fas fa-mask"></i>'.concat(game.i18n.localize("dsk.GM notes"),"</a>"))[0]);case 8:return r.next=10,renderTemplate("systems/dsk/templates/items/infopreview.html",{item:o});case 10:return i=r.sent,r.abrupt("return",$(i)[0]);case 12:case"end":return r.stop()}}),_callee)}))),function enricher(r,a){return t.apply(this,arguments)})})}function conditionsMatcher(t){var r=t[0].split(" "),a=r.shift();r=r.join(" ");var i=o.Z.statusEffects[o.Z.statusRegex.effects.indexOf(r.toLowerCase())];return"<span>".concat(a,' <a class="chatButton chat-condition" data-id="').concat(i.id,'"><img src="').concat(i.icon,'"/>').concat(r,"</a></span>")}},140:(t,r,a)=>{a.d(r,{Z:()=>j});var o=a(231),i=a(973),c=a(278),u=a(614),l=a(832),p=a(930),d=a(582),h=a(122),y=a(514),m=a(565);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}Hooks.once("ready",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(g.creatureData){r.next=11;break}return r.next=3,fetch("systems/dsk/lazy/creaturetype/".concat(game.i18n.lang,".json"));case 3:return t=r.sent,r.next=6,t.json();case 6:g.creatureData=r.sent,g.magical=game.i18n.localize("dsk.WEAPON.magical"),g.clerical=game.i18n.localize("dsk.WEAPON.clerical"),g.silverPlated=game.i18n.localize("dsk.WEAPON.silverPlated"),game.dsk.apps.CreatureType=g;case 11:case"end":return r.stop()}}),_callee)}))));var g=function(){function CreatureType(t){_classCallCheck(this,CreatureType),this.creatureClass=t,this.spellImmunities=[],this.poisonImmunity=!1,this.diseaseImmunity=!1}return _createClass(CreatureType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!1}},{key:"damageModifier",value:function damageModifier(t){return[]}},{key:"spellImmunity",value:function spellImmunity(t){return this.spellImmunities.some((function(r){return t.includes(r)}))}},{key:"spellArmorModifier",value:function spellArmorModifier(t){return 0}},{key:"poisonImmunity",value:function poisonImmunity(){return this.poisonImmunity}},{key:"diseaseImmunity",value:function diseaseImmunity(){return this.diseaseImmunity}},{key:"spellResistanceModifier",value:function spellResistanceModifier(t){return 0}},{key:"weaponAttributes",value:function weaponAttributes(t){return getProperty(t,"system.effect.attributes")||""}},{key:"getTypeByClass",value:function getTypeByClass(t){return Object.keys(CreatureType.creatureData.types).find((function(r){return CreatureType.creatureData.types[r]===t}))}},{key:"isAttackItem",value:function isAttackItem(t){return["meleeweapon","trait","rangeweapon"].includes(t.type)&&function isNotEmpty(t){return!(!t||0===t.length)}(this.weaponAttributes(t))}},{key:"attributesRegex",value:function attributesRegex(t){var r=this.weaponAttributes(t);return new RegExp("(".concat(r.split(",").map((function(t){return l.Z.escapeRegex(t.split("(")[0].trim())})).join("|"),")"),"i")}}],[{key:"detectCreatureType",value:function detectCreatureType(t){var r=this,a=t.system.details.species;return Object.keys(CreatureType.creatureData.types).filter((function(t){return a.indexOf(t)>=0})).map((function(t){return r.getClass(CreatureType.creatureData.types[t],a)}))}},{key:"getClass",value:function getClass(t,r){return new(0,{DemonType:w,ChimeraType:_,DaimonidType:b,DragonType:k,ElementalType:x,FairyType:O,GhostType:S,GolemType:P,HomunculiType:T,IntelligentCreatureType:I,PlantType:E,AnimalType:C,UndeadType:A,SupernaturalType:D,MagicalConstructType:R,WerCreatureType:L,VampireType:G}[t])(r)}},{key:"creatureTypeName",value:function creatureTypeName(t){if("creature"==t.type){var r=t.system.species;return Object.keys(CreatureType.creatureData.types).filter((function(t){return r.indexOf(t)>=0}))[0]}return t.system.details.species}},{key:"addCreatureTypeModifiers",value:function addCreatureTypeModifiers(t,r,a,o){var i,c=CreatureType.detectCreatureType(t),u=["spell","ceremony","liturgy","ritual"].includes(r.type),l=_createForOfIteratorHelper(c);try{for(l.s();!(i=l.n()).done;){var p=i.value,d=p.damageModifier(r);if(u){var h,y=_createForOfIteratorHelper(d);try{for(y.s();!(h=y.n()).done;){h.value.armorPen=p.spellResistanceModifier(t)}}catch(t){y.e(t)}finally{y.f()}}a.push.apply(a,_toConsumableArray(d))}}catch(t){l.e(t)}finally{l.f()}a.push.apply(a,_toConsumableArray(this.creatureBonusDamage(t,o))),CreatureType.addVulnerabilitiesToSource(t,r,a)}},{key:"addVulnerabilitiesToSource",value:function addVulnerabilitiesToSource(t,r,a){var o=getProperty(t,"system.vulnerabilities");o&&(["meleeweapon","rangeweapon"].includes(r.type)&&getProperty(o,"combatskill").reduce((function(t,o){if(o.target==r.system.combatskill){var i=(/\*/.test(o.value)?Number(o.value.replace("*",""))>1:Number(o.value)>0)?"WEAPON.vulnerableTo":"WEAPON.resistantTo";a.push.apply(a,_toConsumableArray(CreatureType.buildDamageMod("".concat(game.i18n.format(i,{name:r.system.combatskill})," (").concat(o.source,")"),o.value)))}}),a))}},{key:"creatureBonusDamage",value:function creatureBonusDamage(t,r){var a,o=[],i=t.system.details.species,c=_createForOfIteratorHelper(getProperty(r,"system.creatureBonus"));try{for(c.s();!(a=c.n()).done;){var u=a.value;i.indexOf(u.target)>=0&&o.push.apply(o,_toConsumableArray(this.buildDamageMod(u.source,u.value,!0)))}}catch(t){c.e(t)}finally{c.f()}return o}},{key:"buildDamageMod",value:function buildDamageMod(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return[{name:t,value:r,selected:a,type:"dmg",source:game.i18n.localize("dsk.target")}]}}]),CreatureType}();_defineProperty(g,"creatureData",void 0),_defineProperty(g,"magical",void 0),_defineProperty(g,"clerical",void 0);var v=function(t){_inherits(VulnerableToLifeGods,t);var r=_createSuper(VulnerableToLifeGods);function VulnerableToLifeGods(){return _classCallCheck(this,VulnerableToLifeGods),r.apply(this,arguments)}return _createClass(VulnerableToLifeGods,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r,a=this.attributesRegex(t),o=_createForOfIteratorHelper(g.creatureData.godOfLife);try{for(o.s();!(r=o.n()).done;){var i=r.value,c="".concat(g.clerical," (").concat(i,")");if(a.test(c))return g.buildDamageMod(c,"*2")}}catch(t){o.e(t)}finally{o.f()}}return _get(_getPrototypeOf(VulnerableToLifeGods.prototype),"damageModifier",this).call(this,t)}}]),VulnerableToLifeGods}(g),_=function(t){_inherits(ChimeraType,t);var r=_createSuper(ChimeraType);function ChimeraType(){return _classCallCheck(this,ChimeraType),r.apply(this,arguments)}return _createClass(ChimeraType)}(v),b=function(t){_inherits(DaimonidType,t);var r=_createSuper(DaimonidType);function DaimonidType(t){var a;return _classCallCheck(this,DaimonidType),(a=r.call(this,t)).spellImmunities=["Influence","Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a}return _createClass(DaimonidType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)&&this.attributesRegex(t).test(g.clerical))return g.buildDamageMod(g.clerical,"*2");return _get(_getPrototypeOf(DaimonidType.prototype),"damageModifier",this).call(this,t)}}]),DaimonidType}(g),k=function(t){_inherits(DragonType,t);var r=_createSuper(DragonType);function DragonType(){return _classCallCheck(this,DragonType),r.apply(this,arguments)}return _createClass(DragonType)}(g),w=function(t){_inherits(DemonType,t);var r=_createSuper(DemonType);function DemonType(t){var a;return _classCallCheck(this,DemonType),(a=r.call(this,t)).spellImmunities=["Influence","Transformation","Healing","Illusion"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a.poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(DemonType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r=this.attributesRegex(t);if(r.test(g.clerical))return g.buildDamageMod("".concat(g.clerical," (").concat(g.creatureData.opposingGod,")"),"*2",!1);if(r.test(g.magical))return _get(_getPrototypeOf(DemonType.prototype),"damageModifier",this).call(this,t)}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return _get(_getPrototypeOf(DemonType.prototype),"damageModifier",this).call(this,t);return g.buildDamageMod(this.getTypeByClass("DemonType"),"*0.5")}},{key:"spellArmorModifier",value:function spellArmorModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"spellResistanceModifier",value:function spellResistanceModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"ignoredCondition",value:function ignoredCondition(t){return!0}}]),DemonType}(g),x=function(t){_inherits(ElementalType,t);var r=_createSuper(ElementalType);function ElementalType(t){var a;return _classCallCheck(this,ElementalType),(a=r.call(this,t)).poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(ElementalType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){if(this.attributesRegex(t).test(g.magical))return _get(_getPrototypeOf(ElementalType.prototype),"damageModifier",this).call(this,t)}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return g.buildDamageMod(this.getTypeByClass("ElementalType"),"*1");return g.buildDamageMod(this.getTypeByClass("ElementalType"),"*0.5")}},{key:"spellArmorModifier",value:function spellArmorModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"spellResistanceModifier",value:function spellResistanceModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"ignoredCondition",value:function ignoredCondition(t){return!0}}]),ElementalType}(g),O=function(t){_inherits(FairyType,t);var r=_createSuper(FairyType);function FairyType(t){var a;return _classCallCheck(this,FairyType),(a=r.call(this,t)).spellImmunities=["Illusion"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a.poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(FairyType)}(g),S=function(t){_inherits(GhostType,t);var r=_createSuper(GhostType);function GhostType(t){var a;return _classCallCheck(this,GhostType),(a=r.call(this,t)).spellImmunities=["Illusion","Healing","Telekinesis","Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a.poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(GhostType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r,a=this.attributesRegex(t),o=_createForOfIteratorHelper(g.creatureData.godOfDeath);try{for(o.s();!(r=o.n()).done;){var i=r.value,c="".concat(g.clerical," (").concat(i,")");if(a.test(c))return[]}}catch(t){o.e(t)}finally{o.f()}if((a=this.attributesRegex(t)).test(g.clerical))return g.buildDamageMod(g.clerical,"*0.5");if(a.test(g.magical))return g.buildDamageMod(g.magical,"*0.5")}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return g.buildDamageMod(g.magical,"*0.5");return g.buildDamageMod(this.getTypeByClass("GhostType"),"*0")}},{key:"ignoredCondition",value:function ignoredCondition(t){return!["feared","inpain","confused"].includes(t)}}]),GhostType}(g),P=function(t){_inherits(GolemType,t);var r=_createSuper(GolemType);function GolemType(t){var a;return _classCallCheck(this,GolemType),(a=r.call(this,t)).spellImmunities=["Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a.poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(GolemType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!["confused","paralysed"].includes(t)}}]),GolemType}(v),T=function(t){_inherits(HomunculiType,t);var r=_createSuper(HomunculiType);function HomunculiType(t){var a;return _classCallCheck(this,HomunculiType),(a=r.call(this,t)).spellImmunities=["Healing"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a}return _createClass(HomunculiType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!["inpain","encumbered","stunned","feared","paralysed","confused"].includes(t)}}]),HomunculiType}(v),I=function(t){_inherits(IntelligentCreatureType,t);var r=_createSuper(IntelligentCreatureType);function IntelligentCreatureType(){return _classCallCheck(this,IntelligentCreatureType),r.apply(this,arguments)}return _createClass(IntelligentCreatureType)}(g),E=function(t){_inherits(PlantType,t);var r=_createSuper(PlantType);function PlantType(){return _classCallCheck(this,PlantType),r.apply(this,arguments)}return _createClass(PlantType)}(g),C=function(t){_inherits(AnimalType,t);var r=_createSuper(AnimalType);function AnimalType(){return _classCallCheck(this,AnimalType),r.apply(this,arguments)}return _createClass(AnimalType)}(g),A=function(t){_inherits(UndeadType,t);var r=_createSuper(UndeadType);function UndeadType(t){var a;return _classCallCheck(this,UndeadType),(a=r.call(this,t)).spellImmunities=["Influence","Healing","Illusion"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a.poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(UndeadType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r,a=this.attributesRegex(t),o=_createForOfIteratorHelper(g.creatureData.godOfDeath);try{for(o.s();!(r=o.n()).done;){var i=r.value,c="".concat(g.clerical," (").concat(i,")");if(a.test(c))return g.buildDamageMod(c,"*2")}}catch(t){o.e(t)}finally{o.f()}}return _get(_getPrototypeOf(UndeadType.prototype),"damageModifier",this).call(this,t)}},{key:"ignoredCondition",value:function ignoredCondition(t){return!["paralysed"].includes(t)}}]),UndeadType}(g),D=function(t){_inherits(SupernaturalType,t);var r=_createSuper(SupernaturalType);function SupernaturalType(){return _classCallCheck(this,SupernaturalType),r.apply(this,arguments)}return _createClass(SupernaturalType)}(g),R=function(t){_inherits(MagicalConstructType,t);var r=_createSuper(MagicalConstructType);function MagicalConstructType(t){var a;return _classCallCheck(this,MagicalConstructType),(a=r.call(this,t)).spellImmunities=["Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),a.poisonImmunity=!0,a.diseaseImmunity=!0,a}return _createClass(MagicalConstructType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!["stunned","feared","paralysed","confused"].includes(t)}}]),MagicalConstructType}(g),L=function(t){_inherits(WerCreatureType,t);var r=_createSuper(WerCreatureType);function WerCreatureType(){return _classCallCheck(this,WerCreatureType),r.apply(this,arguments)}return _createClass(WerCreatureType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){if(this.attributesRegex(t).test(g.silverPlated))return g.buildDamageMod(this.getTypeByClass("WerCreatureType"),"*2")}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return _get(_getPrototypeOf(WerCreatureType.prototype),"damageModifier",this).call(this,t);return g.buildDamageMod(this.getTypeByClass("WerCreatureType"),"*0.5")}}]),WerCreatureType}(g),G=function(t){_inherits(VampireType,t);var r=_createSuper(VampireType);function VampireType(){return _classCallCheck(this,VampireType),r.apply(this,arguments)}return _createClass(VampireType,[{key:"damageModifier",value:function damageModifier(t){return["spell","ceremony","liturgy","ritual"].includes(t.type)?_get(_getPrototypeOf(VampireType.prototype),"damageModifier",this).call(this,t):g.buildDamageMod(this.getTypeByClass("VampireType"),"*0.5")}}]),VampireType}(g);function item_dsk_typeof(t){return item_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},item_dsk_typeof(t)}function item_dsk_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=item_dsk_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){item_dsk_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function item_dsk_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function item_dsk_toConsumableArray(t){return function item_dsk_arrayWithoutHoles(t){if(Array.isArray(t))return item_dsk_arrayLikeToArray(t)}(t)||function item_dsk_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||item_dsk_unsupportedIterableToArray(t)||function item_dsk_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function item_dsk_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return item_dsk_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?item_dsk_arrayLikeToArray(t,r):void 0}}function item_dsk_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function item_dsk_regeneratorRuntime(){item_dsk_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==item_dsk_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function item_dsk_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function item_dsk_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){item_dsk_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){item_dsk_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function item_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function item_dsk_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function item_dsk_createClass(t,r,a){return r&&item_dsk_defineProperties(t.prototype,r),a&&item_dsk_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function item_dsk_get(){return item_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=item_dsk_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},item_dsk_get.apply(this,arguments)}function item_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=item_dsk_getPrototypeOf(t)););return t}function item_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&item_dsk_setPrototypeOf(t,r)}function item_dsk_setPrototypeOf(t,r){return item_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},item_dsk_setPrototypeOf(t,r)}function item_dsk_createSuper(t){var r=function item_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=item_dsk_getPrototypeOf(t);if(r){var i=item_dsk_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return item_dsk_possibleConstructorReturn(this,a)}}function item_dsk_possibleConstructorReturn(t,r){if(r&&("object"===item_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function item_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function item_dsk_getPrototypeOf(t){return item_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},item_dsk_getPrototypeOf(t)}var j=function(t){item_dsk_inherits(ItemDSK,Item);var r,a,o,u,d,h,v,_,b=item_dsk_createSuper(ItemDSK);function ItemDSK(){return item_dsk_classCallCheck(this,ItemDSK),b.apply(this,arguments)}return item_dsk_createClass(ItemDSK,[{key:"addCondition",value:(_=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee(t){var r,a,o,c=arguments;return item_dsk_regeneratorRuntime().wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:1,a=c.length>2&&void 0!==c[2]&&c[2],o=!(c.length>3&&void 0!==c[3])||c[3],u.next=5,i.Z.addCondition(this,t,r,a,o);case 5:return u.abrupt("return",u.sent);case 6:case"end":return u.stop()}}),_callee,this)}))),function addCondition(t){return _.apply(this,arguments)})},{key:"_dependentEffects",value:(v=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee2(t,r,a){return item_dsk_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),_callee2)}))),function _dependentEffects(t,r,a){return v.apply(this,arguments)})},{key:"removeCondition",value:(h=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee3(t){var r,a,o,c=arguments;return item_dsk_regeneratorRuntime().wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:1,a=!(c.length>2&&void 0!==c[2])||c[2],o=c.length>3&&void 0!==c[3]&&c[3],u.abrupt("return",i.Z.removeCondition(this,t,r,a,o));case 4:case"end":return u.stop()}}),_callee3,this)}))),function removeCondition(t){return h.apply(this,arguments)})},{key:"hasCondition",value:function hasCondition(t){return i.Z.hasCondition(this,t)}},{key:"postItem",value:(d=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee4(){return item_dsk_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:ItemDSK.getSubClass(this.type)._postItem(this);case 1:case"end":return t.stop()}}),_callee4,this)}))),function postItem(){return d.apply(this,arguments)})}],[{key:"defaultImages",value:function defaultImages(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a="".concat(t).concat(r);return{effectwrapper:"icons/svg/aura.svg",information:"systems/dsk/icons/categories/DSK-Auge.webp",ammunition:"systems/dsk/icons/categories/arrow.webp",equipment:"systems/dsk/icons/categories/equipment.webp",advantage:"systems/dsk/icons/categories/advantage.webp",disadvantage:"systems/dsk/icons/categories/disadvantage.webp",specialability:"systems/dsk/icons/categories/specialability.webp",combatskill:"systems/dsk/icons/categories/combatskill.webp",ahnengabe:"systems/dsk/icons/categories/ahnengabe.webp",armor:"systems/dsk/icons/categories/armor.webp",rangeweapon:"systems/dsk/icons/categories/rangeweapon.webp",meleeweapon:"systems/dsk/icons/categories/meleeweapon.webp",ahnengeschenk:"systems/dsk/icons/categories/ahnengeschenk.webp",culture:"systems/dsk/icons/categories/culture.webp",profession:"systems/dsk/icons/categories/profession.webp",poison:"systems/dsk/icons/categories/poison.webp",trait:"systems/dsk/icons/categories/trait.webp"}[a]}},{key:"defaultIcon",value:function defaultIcon(t){t.img&&""!=t.img||(t.img=this.defaultImages(t.type)||"systems/dsk/icons/blank.webp")}},{key:"attackStatEffect",value:function attackStatEffect(t,r){0!=r&&t.push({name:game.i18n.localize("dsk.statuseffects"),value:r,selected:!0})}},{key:"prepareRangeAttack",value:function prepareRangeAttack(t,r,a,o,i,u){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;t.push.apply(t,item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.restrictedSenseSight"),-2))),this.getCombatSkillModifier(r,o,t);var d=this.getTargetSizeAndModifier(r,o,t,a),h=-1*Number(r.system.rangeStats.defenseMalus);0!=h&&t.push({name:"".concat(game.i18n.localize("dsk.statuseffects")," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),value:h,type:"defenseMalus",selected:!0});var g=_objectSpread({},p.Z.rangeWeaponModifiers);delete g[c.Z.hasVantage(r,game.i18n.localize("dsk.LocalizedIDs.senseOfRange"))?"long":"rangesense"],y.Z.hasAbility(r,game.i18n.localize("dsk.LocalizedIDs.extremeShot"))||delete g.extreme;var v=y.Z.hasAbility(r,game.i18n.localize("dsk.LocalizedIDs.drivingArcher")),_=v?duplicate(p.Z.drivingArcherOptions):duplicate(p.Z.mountedRangeOptions);mergeObject(a,{rangeOptions:g,rangeDistance:Object.keys(g)[m.Z.distanceModifier(game.canvas.tokens.get(i),o,l)],sizeOptions:p.Z.rangeSizeCategories,visionOptions:p.Z.rangeVision,mountedOptions:_,shooterMovementOptions:p.Z.shooterMovementOptions,targetMovementOptions:p.Z.targetMomevementOptions,targetSize:d,combatSpecAbs:u,aimOptions:p.Z.aimOptions})}},{key:"prepareMeleeAttack",value:function prepareMeleeAttack(t,r,a,o,i,c){var u="short";game.user.targets.forEach((function(t){if(t.actor){var r=t.actor.items.filter((function(t){return"meleeweapon"==t.type&&t.system.worn.value||"trait"==t.type&&"meleeAttack"==t.system.traitType&&t.system.pa}));r.length>0&&(u=r[0].system.rw)}}));var l=this.getTargetSizeAndModifier(r,o,t,a);this.getCombatSkillModifier(r,o,t);var d=-1*Number(r.system.meleeStats.defenseMalus);0!=d&&t.push({name:"".concat(game.i18n.localize("dsk.statuseffects")," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),value:d,type:"defenseMalus",selected:!0}),mergeObject(a,{visionOptions:p.Z.meleeRangeVision(),weaponSizes:p.Z.meleeRanges,melee:!0,showAttack:!0,targetWeaponSize:u,combatSpecAbs:i,meleeSizeOptions:p.Z.meleeSizeCategories,targetSize:l,constricted:r.hasCondition("constricted"),wrongHandDisabled:c,offHand:!c&&getProperty(o,"system.worn.offHand")})}},{key:"parseValueType",value:function parseValueType(t,r){var a="";return/^\*/.test(r)&&(a="*",r=r.substring(1).replace(",",".")),{name:t,value:Number(r),type:a}}},{key:"getSpecAbModifiers",value:function getSpecAbModifiers(t,r){var a,o=[],i=item_dsk_createForOfIteratorHelper(t.find(".specAbs"));try{for(i.s();!(a=i.n()).done;){var c=a.value,u=Number($(c).attr("data-step"));if(u>0){var l="attack"==r?$(c).attr("data-atbonus"):$(c).attr("data-pabonus"),p=l.split(",").reduce((function(t,r){return t+Number(r)}),0);o.push({name:$(c).find("a").text(),value:isNaN(p)?Number(l.replace("*","")):Number(p)*u,damageBonus:$(c).attr("data-tpbonus"),dmmalus:$(c).attr("data-dmmalus")*u,step:u,specAbId:$(c).attr("data-id"),type:/^\*/.test(l)?"*":void 0})}}}catch(t){i.e(t)}finally{i.f()}return o}},{key:"getTargetSizeAndModifier",value:function getTargetSizeAndModifier(t,r,a,o){var i="average",c=0;return game.user.targets.forEach((function(o){if(o.actor){var u=getProperty(o.actor,"system.details.size");u&&(i=u),g.addCreatureTypeModifiers(o.actor,r,a,t),c=Math.max(c,o.actor.system.maxDefense.parry)}})),o.vw=c,i}},{key:"getCombatSkillModifier",value:function getCombatSkillModifier(t,r,a){if("trait"!=r.type){var o,i=t.items.find((function(t){return"combatskill"==t.type&&t.name==r.system.combatskill})),c=item_dsk_createForOfIteratorHelper(i.effects);try{for(c.s();!(o=c.n()).done;){var u,l=item_dsk_createForOfIteratorHelper(o.value.changes);try{for(l.s();!(u=l.n()).done;){var p=u.value;switch(p.key){case"system.rangeStats.defenseMalus":case"system.meleeStats.defenseMalus":a.push({name:"".concat(i.name," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),value:-1*p.value,type:"defenseMalus",selected:!0})}}}catch(t){l.e(t)}finally{l.f()}}}catch(t){c.e(t)}finally{c.f()}}}},{key:"buildCombatSpecAbs",value:function buildCombatSpecAbs(t,r,a,o){var i;a?(a.push(game.i18n.localize("dsk.LocalizedIDs.all")),a=a.map((function(t){return t.toLowerCase()})),i=function searchFilter(t,r){return t.system.combatskills.split(/;|,/).map((function(t){return t.trim().toLowerCase()})).filter((function(t){return r.includes(t.replace(/ \([a-zA-Z ]*\)/,""))})).length>0}):i=function searchFilter(){return!0};var c=t.items.filter((function(t){return"specialability"==t.type&&r.includes(t.system.category)&&""!=t.system.effect&&i(t,a)})),u=[],l=game.i18n.localize("dsk.LocalizedAbilityModifiers.at"),d=game.i18n.localize("dsk.LocalizedAbilityModifiers.tp"),h=game.i18n.localize("dsk.LocalizedAbilityModifiers.pa"),y=game.i18n.localize("dsk.LocalizedAbilityModifiers.dm");if("attack"==o){var m,g=item_dsk_createForOfIteratorHelper(c);try{for(g.s();!(m=g.n()).done;){var v=m.value,_=ItemDSK.parseEffect(v.system.effect,t),b=_[l]||0,k=_[d]||0,w=_[y]||0;if(0!=b||0!=k||0!=w||v.effects.size>0){var x=game.i18n.localize(p.Z.combatSkillSubCategories[v.system.subcategory]);u.push({name:v.name,atbonus:b,tpbonus:k,dmmalus:w,label:"".concat(l,": ").concat(b,", ").concat(d,": ").concat(k,", ").concat(y,": ").concat(w),steps:v.system.level,category:{id:v.system.subcategory,css:"ab_".concat(v.system.subcategory),name:x},id:v.id,actor:t.id})}}}catch(t){g.e(t)}finally{g.f()}}else{var O,S=item_dsk_createForOfIteratorHelper(c);try{for(S.s();!(O=S.n()).done;){var P=O.value,T=ItemDSK.parseEffect(P.system.effect,t)[h]||0;if(0!=T){var I=game.i18n.localize(p.Z.combatSkillSubCategories[P.system.subcategory]);u.push({name:P.name,pabonus:T,tpbonus:0,dmmalus:0,label:"".concat(h,": ").concat(T),steps:P.system.level,category:{id:P.system.category.sub,css:"ab_".concat(P.system.subcategory),name:I},id:P.id,actor:t.id})}}}catch(t){S.e(t)}finally{S.f()}}return u}},{key:"getSkZkModifier",value:function getSkZkModifier(t,r){var a=[],o=[],i=["ahnengabe"].includes(r.type)&&""==r.system.effectFormula.trim();game.user.targets.size&&game.user.targets.forEach((function(t){if(t.actor){var r=0;if(i)r=g.detectCreatureType(t.actor).reduce((function(r,a){return r+a.spellResistanceModifier(t.actor)}),0);a.push(-1*t.actor.system.stats.sk.max-r),o.push(-1*t.actor.system.stats.zk.max-r)}})),mergeObject(t,{SKModifier:a.length>0?Math.min.apply(Math,a):0,ZKModifier:o.length>0?Math.min.apply(Math,o):0})}},{key:"create",value:(u=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee5(t,r){return item_dsk_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return this.defaultIcon(t),a.next=3,item_dsk_get(item_dsk_getPrototypeOf(ItemDSK),"create",this).call(this,t,r);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee5,this)}))),function create(t,r){return u.apply(this,arguments)})},{key:"changeChars",value:function changeChars(t,r,a){t.system.characteristic1=r,t.system.characteristic2=a}},{key:"getSubClass",value:function getSubClass(t){return game.dsk.config.ItemSubClasses[t]||ItemDSK}},{key:"areEquals",value:function areEquals(t,r){return t.type==r.type&&ItemDSK.getSubClass(t.type).checkEquality(t,r)}},{key:"checkEquality",value:function checkEquality(t,r){return r.type==t.type&&t.name==r.name&&t.system.description.value==r.system.description.value}},{key:"setupDialog",value:function setupDialog(t,r,a,o,i){return null}},{key:"buildSpeaker",value:function buildSpeaker(t,r){return{token:r,actor:t?t.id:void 0,scene:canvas.scene?canvas.scene.id:null}}},{key:"stackItems",value:(o=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee6(t,r,a){return item_dsk_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ItemDSK.getSubClass(t.type).combineItem(t,r,a);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}}),_callee6)}))),function stackItems(t,r,a){return o.apply(this,arguments)})},{key:"combineItem",value:(a=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee7(t,r,a){return item_dsk_regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return(t=duplicate(t)).system.quantity+=r.system.quantity,o.next=4,a.updateEmbeddedDocuments("Item",[t]);case 4:return o.abrupt("return",o.sent);case 5:case"end":return o.stop()}}),_callee7)}))),function combineItem(t,r,o){return a.apply(this,arguments)})},{key:"_chatLineHelper",value:function _chatLineHelper(t,r){return"<b>".concat(game.i18n.localize(t),"</b>: ").concat(r||"-")}},{key:"setupSubClasses",value:function setupSubClasses(){game.dsk.config.ItemSubClasses={meleeweapon:H,rangeweapon:K,armor:W,ammunition:B,equipment:Z,species:q,culture:Y,profession:U,advantage:V,disadvantage:J,specialability:X,ahnengeschenk:Q,ahnengabe:ee,poison:te,skill:re,combatskill:ne,effectwrapper:z,information:M,trait:N}}},{key:"hasSchips",value:function hasSchips(t){return getProperty(t.system,"stats.schips.value")>0}},{key:"parseEffect",value:function parseEffect(t,r){var a,o={},i=new RegExp(game.i18n.localize("dsk.CHARAbbrev.GS"),"gi"),c=item_dsk_createForOfIteratorHelper(t.split(/,|;/).map((function(t){return t.trim()})));try{for(c.s();!(a=c.n()).done;){var u=a.value.replace(/(\s+)/g," ").trim().split(" ");u[0]=u[0].replace(i,r.system.stats.gs.max),2==u.length&&(!isNaN(u[0])||/(=)?[+-]\d([+-]\d)?/.test(u[0])||/(=)?\d[dDwW]\d/.test(u[0])||/=\d+/.test(u[0])||/\*\d(\.\d)*/.test(u[0]))&&(null==o[u[1].toLowerCase()]?o[u[1].toLowerCase()]=[u[0]]:o[u[1].toLowerCase()].push(u[0]))}}catch(t){c.e(t)}finally{c.f()}return o}},{key:"chatData",value:function chatData(t,r){return[]}},{key:"_postItem",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee8(t){var r,a,o,i,c;return item_dsk_regeneratorRuntime().wrap((function _callee8$(u){for(;;)switch(u.prev=u.next){case 0:return r=duplicate(t),a=getProperty(r,"system.obfuscation.details"),o=getProperty(r,"system.obfuscation.description"),mergeObject(r,{properties:a?[]:ItemDSK.getSubClass(t.type).chatData(duplicate(r.system),t.name),descriptionObfuscated:o}),r.hasPrice="price"in r.system&&!a,r.hasPrice&&r.properties.push("<b>".concat(game.i18n.localize("dsk.price"),"</b>: ").concat(r.system.price)),t.pack&&(r.itemLink=t.link),r.img.includes("/blank.webp")&&(r.img=null),u.next=10,renderTemplate("systems/dsk/templates/chat/post-item.html",r);case 10:i=u.sent,c=l.Z.chatDataSetup(i),ChatMessage.create(c);case 13:case"end":return u.stop()}}),_callee8)}))),function _postItem(t){return r.apply(this,arguments)})}]),ItemDSK}(),M=function(t){item_dsk_inherits(ItemInformation,t);var r,a=item_dsk_createSuper(ItemInformation);function ItemInformation(){return item_dsk_classCallCheck(this,ItemInformation),a.apply(this,arguments)}return item_dsk_createClass(ItemInformation,null,[{key:"_postItem",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee9(t){var r,a;return item_dsk_regeneratorRuntime().wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,renderTemplate("systems/dsk/templates/chat/informationRequestRoll.html",{item:t});case 2:r=o.sent,a=l.Z.chatDataSetup(r),ChatMessage.create(a);case 5:case"end":return o.stop()}}),_callee9)}))),function _postItem(t){return r.apply(this,arguments)})}]),ItemInformation}(j),z=function(t){item_dsk_inherits(ItemEffectwrapper,t);var r=item_dsk_createSuper(ItemEffectwrapper);function ItemEffectwrapper(){return item_dsk_classCallCheck(this,ItemEffectwrapper),r.apply(this,arguments)}return item_dsk_createClass(ItemEffectwrapper)}(j),N=function(t){item_dsk_inherits(ItemTrait,t);var r=item_dsk_createSuper(ItemTrait);function ItemTrait(){return item_dsk_classCallCheck(this,ItemTrait),r.apply(this,arguments)}return item_dsk_createClass(ItemTrait,null,[{key:"chatData",value:function chatData(t,r){var a=[];switch(t.traitType){case"meleeAttack":a=[this._chatLineHelper("dsk.ABBR.AW",t.at),this._chatLineHelper("dsk.damage",t.damage),this._chatLineHelper("dsk.range",t.rw)];break;case"rangeAttack":a=[this._chatLineHelper("dsk.ABBR.AW",t.at),this._chatLineHelper("dsk.damage",t.damage),this._chatLineHelper("dsk.range",t.rw),this._chatLineHelper("dsk.reloadTime",t.lz)];break;case"armor":a=[this._chatLineHelper("dsk.protection",t.damage)]}return a}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,a,o,i){var c=(o=l.Z.toObjectIfPossible(o)).system.traitType,u=j.buildCombatSpecAbs(r,["Combat","animal"],void 0,a.mode);"attack"==a.mode&&"meleeAttack"==c?this.prepareMeleeAttack(t,r,a,o,u,!1):"attack"==a.mode&&"rangeAttack"==c&&this.prepareRangeAttack(t,r,a,o,i,u),this.attackStatEffect(t,Number(r.system["meleeAttack"==c?"meleeStats":"rangeStats"][a.mode]))}},{key:"setupDialog",value:function setupDialog(t,r,a,o,c){var l=r.mode,p=a.name+" "+game.i18n.localize("dsk."+l+"test");mergeObject(a.system,{characteristic1:"attack",characteristic2:"attack"});var y={opposable:!0,source:a,mode:l,extra:{actor:o.toObject(!1),options:r,speaker:j.buildSpeaker(o,c)}},m=h.Z.multipleDefenseValue(o,a.toObject()),g={rollMode:r.rollMode,mode:l,hasSchips:this.hasSchips(o),defenseCountString:game.i18n.format("dsk.defenseCount",{malus:m})},v=getProperty(a,"system.traitType"),_=o?i.Z.getRollModifiers(o,a,{mode:l}):[];this.getSituationalModifiers(_,o,g,a,c),g.situationalModifiers=_;var b={title:p,template:"/systems/dsk/templates/dialog/combatskill-enhanced-dialog.html",data:g,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"meleeAttack"==v?d.Z.resolveMeleeDialog(y,k,t,o,r,m,l):d.Z.resolveRangeDialog(y,k,t,o,r),y.situationalModifiers.some((function(t){return t.name==game.i18n.localize("dsk.schips")}))&&o.reduceSchips(0),y.isRangeDefense=g.isRangeDefense,Hooks.call("callbackDialogCombatDSK",y,o,t,a,c),{testData:y,cardOptions:k}}},k=o._setupCardOptions("systems/dsk/templates/chat/roll/combatskill-card.html",p,c);return u.Z.setupDialog({dialogOptions:b,testData:y,cardOptions:k})}}]),ItemTrait}(j),H=function(t){item_dsk_inherits(ItemMeleeweapon,t);var r=item_dsk_createSuper(ItemMeleeweapon);function ItemMeleeweapon(){return item_dsk_classCallCheck(this,ItemMeleeweapon),r.apply(this,arguments)}return item_dsk_createClass(ItemMeleeweapon,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.damage",t.tp),this._chatLineHelper("dsk.ABBR.awvw","".concat(t.aw," / ").concat(t.vw)),this._chatLineHelper("ITEM.TypeCombatskill",t.combatskill),this._chatLineHelper("dsk.range",game.i18n.localize("dsk.Range.".concat(t.rw)))]}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,a,o){var i=c.Z.hasVantage(r,game.i18n.localize("dsk.LocalizedIDs.ambidextrous")),u=[(o=l.Z.toObjectIfPossible(o)).system.combatskill],p=j.buildCombatSpecAbs(r,["Combat"],u,a.mode);"attack"==a.mode&&this.prepareMeleeAttack(t,r,a,o,p,i),this.attackStatEffect(t,Number(r.system.meleeStats[a.mode]))}},{key:"setupDialog",value:function setupDialog(t,r,a,o,c){var l=r.mode,p=a.name+" "+game.i18n.localize("dsk."+l+"test"),y=o.items.find((function(t){return"combatskill"==t.type&&t.name==a.system.combatskill}));mergeObject(a.system,{characteristic1:y.system.characteristic1,characteristic2:y.system.characteristic2});var m={opposable:!0,source:a,mode:l,extra:{actor:o.toObject(!1),options:r,speaker:j.buildSpeaker(o,c)}},g=h.Z.multipleDefenseValue(o,m.source),v={rollMode:r.rollMode,mode:l,hasSchips:this.hasSchips(o),defenseCountString:game.i18n.format("dsk.defenseCount",{malus:g})},_=o?i.Z.getRollModifiers(o,a,{mode:l}):[];this.getSituationalModifiers(_,o,v,a),v.situationalModifiers=_;var b={title:p,template:"/systems/dsk/templates/dialog/combatskill-enhanced-dialog.html",data:v,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.Z.resolveMeleeDialog(m,k,t,o,r,g,l),m.situationalModifiers.some((function(t){return t.name==game.i18n.localize("dsk.schips")}))&&o.reduceSchips(0),Hooks.call("callbackDialogCombatDSK",m,o,t,a,c),m.isRangeDefense=v.isRangeDefense,{testData:m,cardOptions:k}}},k=o._setupCardOptions("systems/dsk/templates/chat/roll/combatskill-card.html",p,c);return u.Z.setupDialog({dialogOptions:b,testData:m,cardOptions:k})}}]),ItemMeleeweapon}(j),K=function(t){item_dsk_inherits(ItemRangeweapon,t);var r,a,o=item_dsk_createSuper(ItemRangeweapon);function ItemRangeweapon(){return item_dsk_classCallCheck(this,ItemRangeweapon),o.apply(this,arguments)}return item_dsk_createClass(ItemRangeweapon,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.damage",t.tp),this._chatLineHelper("ITEM.TypeCombatskill",t.combatskill),this._chatLineHelper("dsk.range",t.rw)]}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,a,o,i){if("attack"==a.mode){var c=l.Z.toObjectIfPossible(o),u=[c.system.combatskill],p=j.buildCombatSpecAbs(r,["Combat"],u,a.mode),d=r.items.get(c.system.currentAmmo);if(d){d=d.toObject(!1);var h=getProperty(d.flags,"dsk.poison");h&&mergeObject(o.flags,{dsk:{poison:h}})}if(this.prepareRangeAttack(t,r,a,c,i,p,d),d){if(d.system.atmod&&t.push({name:"".concat(d.name," - ").concat(game.i18n.localize("dsk.atmod")),value:d.system.atmod,selected:!0,specAbId:c.system.currentAmmo}),d.system.damageMod||d.system.armorMod){var y={name:"".concat(d.name," - ").concat(game.i18n.localize("dsk.MODS.damage")),value:d.system.damageMod.replace(/wWD/g,"d")||0,type:"dmg",selected:!0,specAbId:c.system.currentAmmo};d.system.armorMod&&(y.armorPen=d.system.armorMod),t.push(y)}d.effects.length&&t.push({name:"".concat(d.name," - ").concat(game.i18n.localize("dsk.effect")),value:1,type:game.i18n.localize("dsk.effect"),selected:!0,specAbId:c.system.currentAmmo})}}this.attackStatEffect(t,Number(r.system.rangeStats[a.mode]))}},{key:"checkAmmunitionState",value:(a=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee10(t,r,a,o){var i,c,u;return item_dsk_regeneratorRuntime().wrap((function _callee10$(l){for(;;)switch(l.prev=l.next){case 0:return i=!0,"damage"!=o&&("infinite"==(c=t.system).ammunitionType||("-"==c.ammunitionType?(r.extra.ammo=duplicate(t),i=r.extra.ammo.system.quantity>0):(u=a.items.get(c.currentAmmo))?(r.extra.ammo=u.toObject(),i="mag"==c.ammunitionType?r.extra.ammo.system.quantity>1||r.extra.ammo.system.mag.value>0&&r.extra.ammo.system.quantity>0:r.extra.ammo.system.quantity>0):i=!1),i||"creature"!=a.type||(i=!0)),i||ui.notifications.error(game.i18n.localize("dsk.DSKError.NoAmmo")),l.abrupt("return",i);case 4:case"end":return l.stop()}}),_callee10)}))),function checkAmmunitionState(t,r,o,i){return a.apply(this,arguments)})},{key:"setupDialog",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee11(t,r,a,o,c){var l,p,h,y,m,g,v,_;return item_dsk_regeneratorRuntime().wrap((function _callee11$(t){for(;;)switch(t.prev=t.next){case 0:return l=r.mode,p=a.name+" "+game.i18n.localize("dsk."+l+"test"),h=o.items.find((function(t){return"combatskill"==t.type&&t.name==a.system.combatskill})),mergeObject(a.system,{characteristic1:h.system.characteristic1,characteristic2:h.system.characteristic2}),y={opposable:!0,source:a,mode:l,extra:{actor:o.toObject(!1),options:r,speaker:j.buildSpeaker(o,c)}},t.next=7,this.checkAmmunitionState(a,y,o,l);case 7:if(t.sent){t.next=9;break}return t.abrupt("return");case 9:return m={rollMode:r.rollMode,mode:l,hasSchips:this.hasSchips(o)},g=o?i.Z.getRollModifiers(o,a,{mode:l}):[],this.getSituationalModifiers(g,o,m,a,c),m.situationalModifiers=g,v={title:p,template:"/systems/dsk/templates/dialog/combatskill-enhanced-dialog.html",data:m,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.Z.resolveRangeDialog(y,_,t,o,r),y.situationalModifiers.some((function(t){return t.name==game.i18n.localize("dsk.schips")}))&&o.reduceSchips(0),Hooks.call("callbackDialogCombatDSK",y,o,t,a,c),{testData:y,cardOptions:_}}},_=o._setupCardOptions("systems/dsk/templates/chat/roll/combatskill-card.html",p,c),t.abrupt("return",u.Z.setupDialog({dialogOptions:v,testData:y,cardOptions:_}));case 16:case"end":return t.stop()}}),_callee11,this)}))),function setupDialog(t,a,o,i,c){return r.apply(this,arguments)})}]),ItemRangeweapon}(j),W=function(t){item_dsk_inherits(ItemArmor,t);var r=item_dsk_createSuper(ItemArmor);function ItemArmor(){return item_dsk_classCallCheck(this,ItemArmor),r.apply(this,arguments)}return item_dsk_createClass(ItemArmor,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.protection",t.rs)]}}]),ItemArmor}(j),B=function(t){item_dsk_inherits(ItemAmmunition,t);var r=item_dsk_createSuper(ItemAmmunition);function ItemAmmunition(){return item_dsk_classCallCheck(this,ItemAmmunition),r.apply(this,arguments)}return item_dsk_createClass(ItemAmmunition,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.ammunitionType",game.i18n.localize("dsk.ammunition.".concat(t.ammunitionType)))]}}]),ItemAmmunition}(j),Z=function(t){item_dsk_inherits(ItemEquipment,t);var r=item_dsk_createSuper(ItemEquipment);function ItemEquipment(){return item_dsk_classCallCheck(this,ItemEquipment),r.apply(this,arguments)}return item_dsk_createClass(ItemEquipment,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.equipmentType",game.i18n.localize("dsk.Equipment.".concat(t.category)))]}}]),ItemEquipment}(j),q=function(t){item_dsk_inherits(ItemSpecies,t);var r=item_dsk_createSuper(ItemSpecies);function ItemSpecies(){return item_dsk_classCallCheck(this,ItemSpecies),r.apply(this,arguments)}return item_dsk_createClass(ItemSpecies)}(j),Y=function(t){item_dsk_inherits(ItemCulture,t);var r=item_dsk_createSuper(ItemCulture);function ItemCulture(){return item_dsk_classCallCheck(this,ItemCulture),r.apply(this,arguments)}return item_dsk_createClass(ItemCulture)}(j),U=function(t){item_dsk_inherits(ItemProfession,t);var r=item_dsk_createSuper(ItemProfession);function ItemProfession(){return item_dsk_classCallCheck(this,ItemProfession),r.apply(this,arguments)}return item_dsk_createClass(ItemProfession)}(j),V=function(t){item_dsk_inherits(ItemAdvantage,t);var r=item_dsk_createSuper(ItemAdvantage);function ItemAdvantage(){return item_dsk_classCallCheck(this,ItemAdvantage),r.apply(this,arguments)}return item_dsk_createClass(ItemAdvantage,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.rule",t.rule)]}}]),ItemAdvantage}(j),J=function(t){item_dsk_inherits(ItemDisadvantage,t);var r=item_dsk_createSuper(ItemDisadvantage);function ItemDisadvantage(){return item_dsk_classCallCheck(this,ItemDisadvantage),r.apply(this,arguments)}return item_dsk_createClass(ItemDisadvantage)}(V),X=function(t){item_dsk_inherits(ItemSpecialability,t);var r=item_dsk_createSuper(ItemSpecialability);function ItemSpecialability(){return item_dsk_classCallCheck(this,ItemSpecialability),r.apply(this,arguments)}return item_dsk_createClass(ItemSpecialability,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.rule",t.rule)]}}]),ItemSpecialability}(j),Q=function(t){item_dsk_inherits(ItemAhnengeschenk,t);var r=item_dsk_createSuper(ItemAhnengeschenk);function ItemAhnengeschenk(){return item_dsk_classCallCheck(this,ItemAhnengeschenk),r.apply(this,arguments)}return item_dsk_createClass(ItemAhnengeschenk)}(j),ee=function(t){item_dsk_inherits(ItemAhnengabe,t);var r,a=item_dsk_createSuper(ItemAhnengabe);function ItemAhnengabe(){return item_dsk_classCallCheck(this,ItemAhnengabe),a.apply(this,arguments)}return item_dsk_createClass(ItemAhnengabe,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.AeP",t.AeP),this._chatLineHelper("dsk.distribution",t.distribution),this._chatLineHelper("dsk.duration",t.duration),this._chatLineHelper("dsk.range",t.range),this._chatLineHelper("dsk.targetCategory",t.targetCategory)]}},{key:"getCallbackData",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee12(t,r,a){var i;return item_dsk_regeneratorRuntime().wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:t.testDifficulty=0,t.situationalModifiers=o.Z._parseModifiers(r),o.Z.schipsModifier(r,t.situationalModifiers),t.situationalModifiers.some((function(t){return t.name==game.i18n.localize("dsk.schips")}))&&a.reduceSchips(0),i=new FormDataExtended(r.find("form")[0]).object,t.calculatedSpellModifiers={castingTime:r.find(".castingTime").text(),cost:r.find(".aspcost").text(),reach:r.find(".reach").text()},t.situationalModifiers.push({name:game.i18n.localize("dsk.removeGesture"),value:Number(i.removeGesture)||0},{name:game.i18n.localize("dsk.removeFormula"),value:Number(i.removeFormula)||0},{name:game.i18n.localize("dsk.zkModifier"),value:i.zkModifier||0},{name:game.i18n.localize("dsk.skModifier"),value:i.skModifier||0}),t.extensions=ItemAhnengabe.getSpecAbModifiers(r),t.advancedModifiers={chars:[0,1].map((function(t){return i["ch".concat(t)]})),fws:i.fw,qls:i.qs},j.changeChars.apply(j,[t.source].concat(item_dsk_toConsumableArray([0,1].map((function(t){return i["characteristics".concat(t)]})))));case 10:case"end":return c.stop()}}),_callee12)}))),function getCallbackData(t,a,o){return r.apply(this,arguments)})},{key:"getSpecAbModifiers",value:function getSpecAbModifiers(t){var r,a=[],o=item_dsk_createForOfIteratorHelper(t.find(".specAbs.active"));try{for(o.s();!(r=o.n()).done;){var i=r.value;a.push({name:i.dataset.name,title:i.getAttribute("title"),uuid:i.dataset.uuid})}}catch(t){o.e(t)}finally{o.f()}return a}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,a,o){t.push.apply(t,item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.magicalAttunement"),1,!0)).concat(item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.magicalRestriction"),-1,!0)),item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.boundToArtifact"),-1,!0)))),game.user.targets.size&&game.user.targets.forEach((function(a){a.actor&&g.addCreatureTypeModifiers(a.actor,o,t,r)})),t.push.apply(t,item_dsk_toConsumableArray(r.getSkillModifier(o.name,o.type)));var i,u=item_dsk_createForOfIteratorHelper(r.system.skillModifiers.global);try{for(u.s();!(i=u.n()).done;){var l=i.value;t.push({name:l.source,value:l.value})}}catch(t){u.e(t)}finally{u.f()}this.getSkZkModifier(a,o)}},{key:"setupDialog",value:function setupDialog(t,r,a,o,c){var l=this,p=a.name+" "+game.i18n.localize("dsk.probe")+(r.subtitle||""),d={opposable:!!a.system.effectFormula,source:a,extra:{actor:o.toObject(!1),options:r,speaker:j.buildSpeaker(o,c)},advancedModifiers:{chars:[0,0],fws:0,qls:0}},h={rollMode:r.rollMode,hasSKModifier:"sk"==a.system.resist,hasZKModifier:"zk"==a.system.resist,spellReach:a.system.range,hasSchips:this.hasSchips(o),characteristics:[1,2].map((function(t){return a.system["characteristic".concat(t)]}))},y=o?i.Z.getRollModifiers(o,a):[];this.getSituationalModifiers(y,o,h,a),h.situationalModifiers=y;var m,g={title:p,template:"/systems/dsk/templates/dialog/".concat("ahnen","-enhanced-dialog.html"),data:h,callback:(m=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee13(t){var r,a=arguments;return item_dsk_regeneratorRuntime().wrap((function _callee13$(i){for(;;)switch(i.prev=i.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},v.rollMode=t.find('[name="rollMode"]').val(),i.next=4,l.getCallbackData(d,t,o);case 4:return mergeObject(d.extra.options,r),i.abrupt("return",{testData:d,cardOptions:v});case 6:case"end":return i.stop()}}),_callee13)}))),function callback(t){return m.apply(this,arguments)})},v=o._setupCardOptions("systems/dsk/templates/chat/roll/spell-card.html",p,c);return u.Z.setupDialog({dialogOptions:g,testData:d,cardOptions:v})}}]),ItemAhnengabe}(j),te=function(t){item_dsk_inherits(ItemPoison,t);var r=item_dsk_createSuper(ItemPoison);function ItemPoison(){return item_dsk_classCallCheck(this,ItemPoison),r.apply(this,arguments)}return item_dsk_createClass(ItemPoison,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.stepValue",t.level),this._chatLineHelper("dsk.poisonType",t.category),this._chatLineHelper("dsk.start",t.start),this._chatLineHelper("dsk.duration",t.duration),this._chatLineHelper("dsk.resistanceModifier",t.resist),this._chatLineHelper("dsk.effect",l.Z.replaceConditions(l.Z.replaceDies(t.effect)))]}}]),ItemPoison}(j),re=function(t){item_dsk_inherits(ItemSkill,t);var r=item_dsk_createSuper(ItemSkill);function ItemSkill(){return item_dsk_classCallCheck(this,ItemSkill),r.apply(this,arguments)}return item_dsk_createClass(ItemSkill,null,[{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,a,o){t.push.apply(t,item_dsk_toConsumableArray(r.getSkillModifier(o.name,o.type)));var i,c=item_dsk_createForOfIteratorHelper(r.system.skillModifiers.global);try{for(c.s();!(i=c.n()).done;){var u=i.value;t.push({name:u.source,value:u.value})}}catch(t){c.e(t)}finally{c.f()}}},{key:"setupDialog",value:function setupDialog(t,r,a,c,l){var d,h=a.name+" "+game.i18n.localize("dsk.probe")+(r.subtitle||""),y={opposable:!0,source:a,extra:{actor:c.toObject(!1),options:r,speaker:j.buildSpeaker(c,l)}},m={rollMode:r.rollMode,modifier:r.modifier||0,difficultyLabels:p.Z.skillDifficultyLabels,hasSchips:this.hasSchips(c),characteristics:[1,2].map((function(t){return a.system["characteristic".concat(t)]})),situationalModifiers:c?i.Z.getRollModifiers(c,a):[]};r.situationalModifiers&&(d=m.situationalModifiers).push.apply(d,item_dsk_toConsumableArray(r.situationalModifiers)),this.getSituationalModifiers(m.situationalModifiers,c,m,a);var g={title:h,template:"/systems/dsk/templates/dialog/skill-dialog.html",data:m,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v.rollMode=t.find('[name="rollMode"]').val(),y.situationalModifiers=o.Z._parseModifiers(t),o.Z.schipsModifier(t,y.situationalModifiers),y.situationalModifiers.some((function(t){return t.name==game.i18n.localize("dsk.schips")}))&&c.reduceSchips(0),y.testDifficulty=p.Z.skillDifficultyModifiers[t.find('[name="testDifficulty"]').val()],y.advancedModifiers={chars:[0,1].map((function(r){return Number(t.find('[name="ch'.concat(r,'"]')).val())})),fws:Number(t.find('[name="fw"]').val()),qls:Number(t.find('[name="qs"]').val())},j.changeChars.apply(j,[y.source].concat(item_dsk_toConsumableArray([0,1].map((function(r){return t.find('[name="characteristics'.concat(r,'"]')).val()}))))),mergeObject(y.extra.options,r),{testData:y,cardOptions:v}}},v=c._setupCardOptions("systems/dsk/templates/chat/roll/skill-card.html",h,l);return u.Z.setupDialog({dialogOptions:g,testData:y,cardOptions:v})}}]),ItemSkill}(j),ne=function(t){item_dsk_inherits(ItemCombatskill,t);var r=item_dsk_createSuper(ItemCombatskill);function ItemCombatskill(){return item_dsk_classCallCheck(this,ItemCombatskill),r.apply(this,arguments)}return item_dsk_createClass(ItemCombatskill)}(j)},61:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>DSKActiveEffectConfig});var _system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(832),_system_config_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(930),_system_dicedsk_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(614);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=_isNativeReflectConstruct();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function automatedAnimation(t){_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.moduleEnabled("autoanimations")&&console.warn("Animations for on use effects not enabled yet")}function callMacro(t,r,a,o,i){return _callMacro.apply(this,arguments)}function _callMacro(){return _callMacro=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t,r,a,o,i){var c,u,l,p,d,h,y,m,g,v,_=arguments;return _regeneratorRuntime().wrap((function _callee11$(b){for(;;)switch(b.prev=b.next){case 0:if(c=_.length>5&&void 0!==_[5]?_[5]:{},u={},game.user.can("MACRO_SCRIPT")){b.next=6;break}ui.notifications.warn("You are not allowed to use JavaScript macros."),b.next=49;break;case 6:return l=game.packs.get(t),b.next=9,l.getDocuments({name:r});case 9:if((p=b.sent).length){b.next=31;break}d=_createForOfIteratorHelper(game.packs.filter((function(t){return"Macro"==t.documentName&&/\(internal\)/.test(t.metadata.label)}))),b.prev=12,d.s();case 14:if((h=d.n()).done){b.next=23;break}return y=h.value,b.next=18,y.getDocuments({name:r});case 18:if(!(p=b.sent).length){b.next=21;break}return b.abrupt("break",23);case 21:b.next=14;break;case 23:b.next=28;break;case 25:b.prev=25,b.t0=b.catch(12),d.e(b.t0);case 28:return b.prev=28,d.f(),b.finish(28);case 31:if(!p.length){b.next=48;break}return m="(async () => {".concat(p[0].command,"})()"),g=Function("actor","item","qs","automatedAnimation","args",m),b.prev=34,c.result=u,v=mergeObject({automatedAnimation},this),b.next=39,g.call(v,a,o,i,automatedAnimation,c);case 39:b.next=46;break;case 41:b.prev=41,b.t1=b.catch(34),ui.notifications.error("There was an error in your macro syntax. See the console (F12) for details"),console.error(b.t1),u.error=!0;case 46:b.next=49;break;case 48:ui.notifications.error(game.i18n.format("dsk.DSKError.macroNotFound",{name:r}));case 49:return b.abrupt("return",u);case 50:case"end":return b.stop()}}),_callee11,this,[[12,25,28,31],[34,41]])}))),_callMacro.apply(this,arguments)}var DSKActiveEffectConfig=function(_ActiveEffectConfig){_inherits(DSKActiveEffectConfig,_ActiveEffectConfig);var _super=_createSuper(DSKActiveEffectConfig),_parseEffectDuration2,_createResistRollMessage,_applyEffect,_resistEffect,_onSubmit2,_render2,_checkTimesUpInstalled;function DSKActiveEffectConfig(){return _classCallCheck(this,DSKActiveEffectConfig),_super.apply(this,arguments)}return _createClass(DSKActiveEffectConfig,[{key:"checkTimesUpInstalled",value:(_checkTimesUpInstalled=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return!(t=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.moduleEnabled("times-up"))&&game.user.isGM&&ui.notifications.warn(game.i18n.localize("dsk.DSKError.shouldTimesUp")),r.abrupt("return",t);case 3:case"end":return r.stop()}}),_callee)}))),function checkTimesUpInstalled(){return _checkTimesUpInstalled.apply(this,arguments)})},{key:"_render",value:(_render2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,a,o,i,c,u,l,p,d=this,h=arguments;return _regeneratorRuntime().wrap((function _callee2$(y){for(;;)switch(y.prev=y.next){case 0:return t=h.length>0&&void 0!==h[0]&&h[0],r=h.length>1&&void 0!==h[1]?h[1]:{},y.next=4,_get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"_render",this).call(this,t,r);case 4:if(a=-1,o=["none","systemEffect","macro","creature"].map((function(t){return{name:"dsk.ActiveEffects.advancedFunctions.".concat(t),index:a+=1}})),i=getProperty(this.object,"parent.type"),(c={hasSpellEffects:["ahnengabe","consumable","poison","ammunition","meleeweapon","rangeweapon"].includes(i)||["specialability"].includes(i)&&"Combat"==getProperty(this.object,"parent.system.category")||"trait"==i&&["meleeAttack","rangeAttack"].includes(getProperty(this.object,"parent.system.traitType")),hasDamageTransformation:["ammunition"].includes(i)}).hasDamageTransformation&&o.push({name:"ActiveEffects.advancedFunctions.armorPostprocess",index:4},{name:"ActiveEffects.advancedFunctions.damagePostprocess",index:5}),y.t0=this.getStatusEffects(),y.t1=game.user.isGM,y.t1){y.next=15;break}return y.next=14,game.settings.get("dsk","playerCanEditSpellMacro");case 14:y.t1=y.sent;case 15:return y.t2=y.t1,u={systemEffects:y.t0,canEditMacros:y.t2},(l=$(this._element)).find(".tabs").append('<a class="item" data-tab="advanced"><i class="fas fa-shield-alt"></i>'.concat(game.i18n.localize("dsk.advanced"),"</a>")),y.next=21,renderTemplate("systems/dsk/templates/status/advanced_effect.html",{effect:this.object,advancedFunctions:o,effectConfigs:c,config:u});case 21:p=y.sent,l.find('.tab[data-tab="effects"]').after($(p)),l.find(".advancedSelector").change((function(t){var r=d.object;r.flags.dsk.advancedFunction=$(t.currentTarget).val(),renderTemplate("systems/dsk/templates/status/advanced_functions.html",{effect:r,config:u}).then((function(t){l.find(".advancedFunctions").html(t)}))})),this.checkTimesUpInstalled();case 25:case"end":return y.stop()}}),_callee2,this)}))),function _render(){return _render2.apply(this,arguments)})},{key:"_onSubmit",value:(_onSubmit2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r,a,o,i,c,u,l,p=arguments;return _regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:{},a=r.updateData,o=void 0===a?null:a,i=r.preventClose,c=void 0!==i&&i,u=r.preventRender,l=void 0!==u&&u,"Actor"!=getProperty(this.object,"system.document.parent.documentName")&&getProperty(this.object,"system.document.parent.parent")&&ui.notifications.error(game.i18n.localize("dsk.DSKError.nestedEffectNotSupported")),d.next=5,_get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"_onSubmit",this).call(this,t,{updateData:o,preventClose:c,preventRender:l});case 5:return d.abrupt("return",d.sent);case 6:case"end":return d.stop()}}),_callee3,this)}))),function _onSubmit(t){return _onSubmit2.apply(this,arguments)})},{key:"getStatusEffects",value:function getStatusEffects(){return duplicate(CONFIG.statusEffects).map((function(t){return{id:t.id,label:game.i18n.localize(t.label)}})).sort((function(t,r){return t.label.localeCompare(r.label)}))}},{key:"getData",value:function getData(t){return _get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"getData",this).call(this,t)}},{key:"dropDownMenu",value:function dropDownMenu(){for(var t,r=game.i18n.localize("dsk.MODS.FW"),a=game.i18n.localize("ITEM.TypeSkill"),o=game.i18n.localize("dsk.regenerate"),i=game.i18n.localize("dsk.MODS.FP"),c=game.i18n.localize("dsk.stepValue"),u=game.i18n.localize("dsk.MODS.QS"),l=game.i18n.localize("dsk.MODS.partChecks"),p="".concat(game.i18n.localize("dsk.LocalizedIDs.perception")," 1"),d="".concat(game.i18n.localize("dsk.LocalizedIDs.wrestle")," 1"),h=game.i18n.localize("dsk.closeCombatAttacks"),y=game.i18n.localize("dsk.rangeCombatAttacks"),m="".concat(o," (").concat(game.i18n.localize("dsk.CHARAbbrev.CR"),")"),g=game.i18n.localize("dsk.AePCost"),v="".concat(game.i18n.localize("dsk.description")," 1"),_="".concat(game.i18n.localize("Healing")," 1"),b=[{name:game.i18n.localize("dsk.protection"),val:"system.totalArmor",mode:2,ph:"1"},{name:"".concat(game.i18n.localize("dsk.resistanceModifier")," (").concat(game.i18n.localize("dsk.condition"),")"),val:"system.resistances.effects",mode:0,ph:"inpain 1"},{name:game.i18n.localize("dsk.carrycapacity"),val:"system.carryModifier",mode:2,ph:"1"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.CHARAbbrev.AW")),val:"system.meleeStats.attack",mode:2,ph:"1"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.CHARAbbrev.VW")),val:"system.meleeStats.parry",mode:2,ph:"1"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")),val:"system.meleeStats.damage",mode:2,ph:"1d6"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),val:"system.meleeStats.defenseMalus",mode:2,ph:"1"},{name:game.i18n.localize("dsk.MODS.creatureBonus"),val:"system.creatureBonus",mode:0,ph:"Elementar 1"},{name:"".concat(y," - ").concat(game.i18n.localize("dsk.CHARAbbrev.AW")),val:"system.rangeStats.attack",mode:2,ph:"1"},{name:"".concat(y," - ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")),val:"system.rangeStats.damage",mode:2,ph:"1d6"},{name:"".concat(y," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),val:"system.rangeStats.defenseMalus",mode:2,ph:"1"},{name:"".concat(game.i18n.localize("ITEM.TypeAhnengabe")," - ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")),val:"system.spellStats.damage",mode:2,ph:"1"},{name:g,val:"system.aepModifier",mode:2,ph:"1"},{name:"".concat(a," - ").concat(r),val:"system.skillModifiers.FW",mode:0,ph:p},{name:"".concat(a," - ").concat(i),val:"system.skillModifiers.FP",mode:0,ph:p},{name:"".concat(a," - ").concat(c),val:"system.skillModifiers.step",mode:0,ph:p},{name:"".concat(a," - ").concat(u),val:"system.skillModifiers.QL",mode:0,ph:p},{name:"".concat(a," - ").concat(l),val:"system.skillModifiers.TPM",mode:0,ph:p},{name:"".concat(game.i18n.localize("dsk.vulnerability")," - ").concat(game.i18n.localize("ITEM.TypeCombatskill")),val:"system.vulnerabilities.combatskill",mode:0,ph:d},{name:"".concat(a," - ").concat(game.i18n.localize("dsk.MODS.global")),val:"system.skillModifiers.global",mode:0,ph:"1"},{name:"".concat(m," - ").concat(game.i18n.localize("dsk.LeP")),val:"system.repeatingEffects.startOfRound.LeP",mode:0,ph:"1d6"},{name:"".concat(m," - ").concat(game.i18n.localize("dsk.AeP")),val:"system.repeatingEffects.startOfRound.AeP",mode:0,ph:"1d6"},{name:"".concat(o," - ").concat(game.i18n.localize("dsk.LeP")),val:"system.stats.regeneration.LePgearmodifier",mode:2,ph:"1"},(t={name:"".concat(o," - ").concat(game.i18n.localize("dsk.AeP")),val:"system.stats.regeneration.AePgearmodifier",mode:2,ph:"1"},_defineProperty(t,"mode",0),_defineProperty(t,"ph",_),t),{name:"".concat(game.i18n.localize("dsk.advanced")," - ").concat(g),val:"system.skillModifiers.conditional.AePCost",mode:0,ph:v}],k=0,w=["ahnengabe","skill","feature"];k<w.length;k++){var x=w[k],O="skill"==x?"skillglobal":x,S=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.categoryLocalization(O);b.push({name:"".concat(S," - ").concat(r),val:"system.skillModifiers.".concat(x,".FW"),mode:0,ph:p},{name:"".concat(S," - ").concat(i),val:"system.skillModifiers.".concat(x,".FP"),mode:0,ph:p},{name:"".concat(S," - ").concat(c),val:"system.skillModifiers.".concat(x,".step"),mode:0,ph:p},{name:"".concat(S," - ").concat(u),val:"system.skillModifiers.".concat(x,".QL"),mode:0,ph:p},{name:"".concat(S," - ").concat(l),val:"system.skillModifiers.".concat(x,".TPM"),mode:0,ph:p})}for(var P=0,T=["inpain","selfconfidence","encumbered","stunned","feared"];P<T.length;P++){var I=T[P];b.push({name:game.i18n.localize("dsk.CONDITION.".concat(I)),val:"system.status.".concat(I),mode:2,ph:1})}for(var E=0,C=Object.keys(_system_config_js__WEBPACK_IMPORTED_MODULE_1__.Z.characteristics);E<C.length;E++){var A=C[E];b.push({name:game.i18n.localize("dsk.characteristics.".concat(A,".name")),val:"system.characteristics.".concat(A,".gearmodifier"),mode:2,ph:"1"})}var D,R=_createForOfIteratorHelper(_system_config_js__WEBPACK_IMPORTED_MODULE_1__.Z.gearModifyableCalculatedAttributes);try{for(R.s();!(D=R.n()).done;){var L=D.value;b.push({name:game.i18n.localize("dsk.".concat(L)),val:"system.stats.".concat(L,".gearmodifier"),mode:2,ph:"1"})}}catch(t){R.e(t)}finally{R.f()}var G,j=_createForOfIteratorHelper(b=b.sort((function(t,r){return t.name.localeCompare(r.name)})));try{for(j.s();!(G=j.n()).done;){var M=G.value;M.ph&&null!=M.mode||console.warn(M)}}catch(t){j.e(t)}finally{j.f()}return b=b.map((function(t){return'<option value="'.concat(t.val,'" data-mode="').concat(t.mode,'" data-ph="').concat(t.ph,'">').concat(t.name,"</option>")})).join("\n"),'<select class="selMenu">'.concat(b,"</select>")}},{key:"activateListeners",value:function activateListeners(t){_get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"activateListeners",this).call(this,t);var r=this.dropDownMenu();t.find(".changes-list .effect-change .key").append(r),t.find(".selMenu").change((function(t){var r=$(t.currentTarget);r.siblings("input").val(r.val());var a=r.closest(".effect-change"),o=r.find("option:selected");a.find(".mode select").val(o.attr("data-mode")),a.find(".value input").attr("placeholder",o.attr("data-ph")),r.blur()}))}}],[{key:"defaultOptions",get:function get(){return mergeObject(_get(_getPrototypeOf(DSKActiveEffectConfig),"defaultOptions",this),{resizable:!0})}},{key:"onEffectRemove",value:function(){var _onEffectRemove=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(actor,effect){var onRemoveMacro;return _regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(onRemoveMacro=getProperty(effect,"flags.dsk.onRemove"),!onRemoveMacro){_context4.next=8;break}if(game.user.can("MACRO_SCRIPT")){_context4.next=6;break}ui.notifications.warn("You are not allowed to use JavaScript macros."),_context4.next=8;break;case 6:return _context4.next=8,eval("(async () => {".concat(onRemoveMacro,"})()"));case 8:case"end":return _context4.stop()}}),_callee4)})));function onEffectRemove(t,r){return _onEffectRemove.apply(this,arguments)}return onEffectRemove}()},{key:"applyRollTransformation",value:function applyRollTransformation(actor,options,functionID){var msg="",source=options.origin,_iterator3=_createForOfIteratorHelper(source.effects),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var ef=_step3.value;try{Number(getProperty(ef,"flags.dsk.advancedFunction"))==functionID&&eval(getProperty(ef,"flags.dsk.args3"))}catch(t){console.warn("Unable to apply advanced effect",t,ef)}}}catch(t){_iterator3.e(t)}finally{_iterator3.f()}return options.origin=source,{msg,options}}},{key:"applyAdvancedFunction",value:function(){var _applyAdvancedFunction=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(actor,effects,source,testData,sourceActor){var skipResistRolls,msg,resistRolls,effectApplied,effectsWithChanges,effectNames,_iterator4,_step4,_loop,_args6=arguments;return _regeneratorRuntime().wrap((function _callee5$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:skipResistRolls=!(_args6.length>5&&void 0!==_args6[5])||_args6[5],msg="",resistRolls=[],effectApplied=!1,effectsWithChanges=[],effectNames=new Set,_iterator4=_createForOfIteratorHelper(effects),_context6.prev=7,_loop=_regeneratorRuntime().mark((function _loop(){var ef,specStep,customEf,qs,resistRoll,skills,mod,effect,value,creatures;return _regeneratorRuntime().wrap((function _loop$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(ef=_step4.value,ef.origin&&delete ef.origin,specStep=Number(getProperty(ef,"flags.dsk.specStep"))||0,_context5.prev=3,customEf=Number(getProperty(ef,"flags.dsk.advancedFunction")),qs=Math.min(testData.qualityStep||0,6),resistRoll=getProperty(ef,"flags.dsk.resistRoll"),!resistRoll||skipResistRolls){_context5.next=13;break}skills=resistRoll.split(" "),mod="".concat(skills.pop()),resistRolls.push({skill:skills.join(" "),mod:Math.round(Roll.safeEval("".concat(mod).replace(/q(l|s)/i,qs).replace("step",specStep)))||0,effect:ef,target:actor,token:actor.token?actor.token.id:void 0}),_context5.next=37;break;case 13:if(effectApplied=!0,effectNames.has(ef.label)||effectNames.add(ef.label),ef.changes&&ef.changes.length>0&&effectsWithChanges.push(ef),!customEf){_context5.next=37;break}_context5.t0=customEf,_context5.next=1===_context5.t0?20:2===_context5.t0?27:3===_context5.t0?34:37;break;case 20:return effect=duplicate(CONFIG.statusEffects.find((function(t){return t.id==getProperty(ef,"flags.dsk.args0")}))),value="".concat(getProperty(ef,"flags.dsk.args1"))||"1",effect.duration=ef.duration,value=/,/.test(value)?Number(value.split(",")[qs-1]):Number(value.replace(game.i18n.localize("dsk.CHARAbbrev.QS"),qs)),_context5.next=26,actor.addCondition(effect,value,!1,!1);case 26:return _context5.abrupt("break",37);case 27:if(game.user.can("MACRO_SCRIPT")){_context5.next=31;break}ui.notifications.warn("You are not allowed to use JavaScript macros."),_context5.next=33;break;case 31:return _context5.next=33,eval("(async () => {".concat(getProperty(ef,"flags.dsk.args3"),"})()"));case 33:return _context5.abrupt("break",37);case 34:return creatures=(getProperty(ef,"flags.dsk.args4")||"").split(",").map((function(t){return"@Compendium[".concat(t.trim().replace(/(@Compendium\[|\])/),"]")})).join(" "),msg+="<p><b>".concat(game.i18n.localize("dsk.ActiveEffects.advancedFunctions.creature"),"</b>:</p><p>").concat(creatures,"</p>"),_context5.abrupt("break",37);case 37:_context5.next=44;break;case 39:_context5.prev=39,_context5.t1=_context5.catch(3),console.warn("Unable to apply advanced effect"),console.warn(_context5.t1),console.warn(ef);case 44:case"end":return _context5.stop()}}),_loop,null,[[3,39]])})),_iterator4.s();case 10:if((_step4=_iterator4.n()).done){_context6.next=14;break}return _context6.delegateYield(_loop(),"t0",12);case 12:_context6.next=10;break;case 14:_context6.next=19;break;case 16:_context6.prev=16,_context6.t1=_context6.catch(7),_iterator4.e(_context6.t1);case 19:return _context6.prev=19,_iterator4.f(),_context6.finish(19);case 22:return _context6.next=24,actor.createEmbeddedDocuments("ActiveEffect",effectsWithChanges.map((function(t){return t.origin=actor.uuid,t})));case 24:return _context6.abrupt("return",{msg,resistRolls,effectApplied,effectNames:Array.from(effectNames)});case 25:case"end":return _context6.stop()}}),_callee5,null,[[7,16,19,22]])})));function applyAdvancedFunction(t,r,a,o,i){return _applyAdvancedFunction.apply(this,arguments)}return applyAdvancedFunction}()},{key:"resistEffect",value:(_resistEffect=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,a,o,i,c=this;return _regeneratorRuntime().wrap((function _callee7$(u){for(;;)switch(u.prev=u.next){case 0:r=t.currentTarget.dataset,a={token:r.token,actor:r.actor,scene:canvas.id},(o=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(a))?(i=o.items.find((function(t){return"skill"==t.type&&t.name==r.skill})),o.setupSkill(i,{modifier:r.mod},r.token).then(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){return _regeneratorRuntime().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:return t.testData.opposable=!1,i.next=3,o.basicTest(t);case 3:if(!((i.sent.result.qualityStep||0)<1)){i.next=8;break}return i.next=8,c.applyEffect(r.message,r.mode,[a],{effectIds:[r.effect],skipResistRolls:!0});case 8:case"end":return i.stop()}}),_callee6)})));return function(r){return t.apply(this,arguments)}}())):console.warn("Actor not found for resist roll.");case 4:case"end":return u.stop()}}),_callee7)}))),function resistEffect(t){return _resistEffect.apply(this,arguments)})},{key:"applyEffect",value:(_applyEffect=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r,a){var o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T=arguments;return _regeneratorRuntime().wrap((function _callee8$(I){for(;;)switch(I.prev=I.next){case 0:return o=T.length>3&&void 0!==T[3]?T[3]:{},i=game.messages.get(t),c=i.flags.data.preData.source,u=i.flags.data.postData,l=i.speaker,["poison","disease"].includes(c.type)&&(u.qualityStep=u.successLevel>0?2:1),p=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(l)||_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(getProperty(i.flags,"data.preData.extra.speaker"))||game.actors.get(getProperty(i.flags,"data.preData.extra.actor.id")),d=p,I.next=10,this._parseEffectDuration(c,u,i.flags.data.preData,p);case 10:if(h=I.sent,o.effectIds&&(h=h.filter((function(t){return o.effectIds.includes(t._id)}))),y=[],"self"==r?p&&y.push(p):a?y=a.map((function(t){return _system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(t)})):game.user.targets.size&&game.user.targets.forEach((function(t){t.actor&&y.push(t.actor)})),!game.user.isGM){I.next=47;break}m=_createForOfIteratorHelper(y),I.prev=16,m.s();case 18:if((g=m.n()).done){I.next=37;break}return v=g.value,I.next=22,DSKActiveEffectConfig.applyAdvancedFunction(v,h,c,u,d,o.skipResistRolls||!1);case 22:if(_=I.sent,b=_.msg,k=_.resistRolls,w=_.effectApplied,x=_.effectNames,!w){I.next=32;break}return S=game.i18n.format("dsk.ActiveEffects.appliedEffect",{target:(null===(O=v.token)||void 0===O?void 0:O.name)||v.name,source:x.join(", ")}),P="".concat(S).concat(b||""),I.next=32,ChatMessage.create(_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.chatDataSetup(P));case 32:if(!k.length){I.next=35;break}return I.next=35,this.createResistRollMessage(k,t,r);case 35:I.next=18;break;case 37:I.next=42;break;case 39:I.prev=39,I.t0=I.catch(16),m.e(I.t0);case 42:return I.prev=42,m.f(),I.finish(42);case 45:I.next=48;break;case 47:game.socket.emit("system.dsk",{type:"addEffect",payload:{mode:r,id:t,actors:y.map((function(t){return{token:t.token?t.token.id:void 0,actor:t.id,scene:canvas.scene.id}}))}});case 48:case"end":return I.stop()}}),_callee8,this,[[16,39,42,45]])}))),function applyEffect(t,r,a){return _applyEffect.apply(this,arguments)})},{key:"createResistRollMessage",value:(_createResistRollMessage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t,r,a){var o,i,c,u;return _regeneratorRuntime().wrap((function _callee9$(l){for(;;)switch(l.prev=l.next){case 0:o=_createForOfIteratorHelper(t),l.prev=1,o.s();case 3:if((i=o.n()).done){l.next=12;break}return c=i.value,l.next=7,renderTemplate("systems/dsk/templates/chat/roll/resist-roll.html",{resist:c,id:r,mode:a});case 7:return u=l.sent,l.next=10,ChatMessage.create(_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.chatDataSetup(u));case 10:l.next=3;break;case 12:l.next=17;break;case 14:l.prev=14,l.t0=l.catch(1),o.e(l.t0);case 17:return l.prev=17,o.f(),l.finish(17);case 20:case"end":return l.stop()}}),_callee9,null,[[1,14,17,20]])}))),function createResistRollMessage(t,r,a){return _createResistRollMessage.apply(this,arguments)})},{key:"_parseEffectDuration",value:(_parseEffectDuration2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(t,r,a,o){var i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,D,R,L;return _regeneratorRuntime().wrap((function _callee10$(G){for(;;)switch(G.prev=G.next){case 0:i={},c=_createForOfIteratorHelper(a.situationalModifiers.filter((function(t){return t.specAbId})));try{for(c.s();!(u=c.n()).done;)l=u.value,i[l.specAbId]=l.step}catch(t){c.e(t)}finally{c.f()}p=Object.keys(i),d=o?o.items.filter((function(t){return p.includes(t.id)})):[],h=t.effects?duplicate(t.effects):[],y=_createForOfIteratorHelper(d);try{for(y.s();!(m=y.n()).done;){g=m.value,v=duplicate(g).effects,_=_createForOfIteratorHelper(v);try{for(_.s();!(b=_.n()).done;)k=b.value,setProperty(k,"flags.dsk.specStep",i[g.id])}catch(t){_.e(t)}finally{_.f()}h.push.apply(h,_toConsumableArray(v))}}catch(t){y.e(t)}finally{y.f()}w=(w=getProperty(t,"system.duration")||"").replace(" x "," * ").replace(game.i18n.localize("dsk.CHARAbbrev.QS"),r.qualityStep),G.prev=10,x=[{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.combatRounds"),"gi"),seconds:5},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.minutes"),"gi"),seconds:60},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.hours"),"gi"),seconds:3600},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.days"),"gi"),seconds:86400},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEXmaintain.weeks"),"gi"),seconds:604800},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEXmaintain.months"),"gi"),seconds:2592e3},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEXmaintain.years"),"gi"),seconds:3024e4}],O=0,S=x;case 13:if(!(O<S.length)){G.next=25;break}if(!(P=S[O]).regEx.test(w)){G.next=22;break}return T=w.replace(P.regEx,"").trim(),G.next=19,_system_dicedsk_js__WEBPACK_IMPORTED_MODULE_2__.Z._stringToRoll(T);case 19:if(I=G.sent,!isNaN(I)){E=_createForOfIteratorHelper(h);try{for(E.s();!(C=E.n()).done;)A=C.value,D=I*P.seconds,(R=getProperty(A,"flags.dsk.customDuration"))&&(L=R.split(",")[r.qualityStep-1])&&"-"!=L&&(D=Number(L)),A.duration.seconds=D,A.duration.rounds=A.duration.seconds/5}catch(t){E.e(t)}finally{E.f()}}return G.abrupt("break",25);case 22:O++,G.next=13;break;case 25:G.next=30;break;case 27:G.prev=27,G.t0=G.catch(10),console.error("Could not parse duration '".concat(w,"' of '").concat(t.name,"'"));case 30:return G.abrupt("return",h);case 31:case"end":return G.stop()}}),_callee10,null,[[10,27]])}))),function _parseEffectDuration(t,r,a,o){return _parseEffectDuration2.apply(this,arguments)})}]),DSKActiveEffectConfig}(ActiveEffectConfig)},311:(t,r,a)=>{function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}a.d(r,{Z:()=>o});var o=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(DSKActiveEffect,ActiveEffect);var r,a,o=_createSuper(DSKActiveEffect);function DSKActiveEffect(){return _classCallCheck(this,DSKActiveEffect),o.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKActiveEffect,[{key:"apply",value:function apply(t,r){if(!DSKActiveEffect.itemChangeRegex.test(r.key))return _get(_getPrototypeOf(DSKActiveEffect.prototype),"apply",this).call(this,t,r);var a,o=this._getModifiedItems(t,r),i=_createForOfIteratorHelper(o.items);try{for(i.s();!(a=i.n()).done;){var c=a.value,u=foundry.utils.flattenObject(c.overrides||{});u[o.key]=Number.isNumeric(c.value)?Number(o.value):o.value;var l=_objectSpread(_objectSpread({},r),{},{key:o.key,value:o.value});_get(_getPrototypeOf(DSKActiveEffect.prototype),"apply",this).call(this,c,l),c.overrides=foundry.utils.expandObject(u)}}catch(t){i.e(t)}finally{i.f()}}},{key:"_getModifiedItems",value:function _getModifiedItems(t,r){var a,o=r.key.split("."),i=o.shift();i=i.replace("@","").toLowerCase();var c=o.shift(),u=o.join("."),l=r.value;return{items:(null==t||null===(a=t.items)||void 0===a?void 0:a.filter((function(t){return t.type==i&&(t.name==c||t.id==c)})))||[],key:u,value:l}}},{key:"_preUpdate",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r,a){return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:_get(_getPrototypeOf(DSKActiveEffect.prototype),"_preUpdate",this).call(this,t,r,a),this._clearModifiedItems();case 2:case"end":return o.stop()}}),_callee,this)}))),function _preUpdate(t,r,o){return a.apply(this,arguments)})},{key:"_clearModifiedItems",value:function _clearModifiedItems(){if(!(!this.parent instanceof CONFIG.Actor.documentClass)){var t,r=_createForOfIteratorHelper(this.changes);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(DSKActiveEffect.itemChangeRegex.test(a.key)){var o,i=this._getModifiedItems(this.parent,a),c=_createForOfIteratorHelper(i.items);try{for(c.s();!(o=c.n()).done;){var u,l=o.value,p=foundry.utils.flattenObject(l.overrides||{}),d=i.key;delete p[d];var h=getProperty(l._source,d);setProperty(l,d,h),l.overrides=foundry.utils.expandObject(p),null!==(u=l.sheet)&&void 0!==u&&u.rendered&&l.sheet.render(!0)}}catch(t){c.e(t)}finally{c.f()}}}}catch(t){r.e(t)}finally{r.f()}}}},{key:"_preDelete",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:_get(_getPrototypeOf(DSKActiveEffect.prototype),"_preDelete",this).call(this,t,r),this._clearModifiedItems();case 2:case"end":return a.stop()}}),_callee2,this)}))),function _preDelete(t,a){return r.apply(this,arguments)})}]),DSKActiveEffect}();_defineProperty(o,"itemChangeRegex",/^@/);Hooks.on("applyActiveEffect",(function(t,r){return function applyCustomEffect(t,r){var a=getProperty(t,r.key)||null;null==a&&/^system\.(vulnerabilities|resistances)/.test(r.key)&&(a=[],setProperty(t,r.key,a));var o=null;if("Array"===getType(a)){var i,c=[],u=r.effect.label,l=_createForOfIteratorHelper("".concat(r.value).split(/[;,]+/));try{for(l.s();!(i=l.n()).done;){var p=i.value.split(" "),d=p.pop(),h=p.join(" ");c.push({source:u,value:d,target:h})}}catch(t){l.e(t)}finally{l.f()}o=a.concat(c)}return null!==o&&setProperty(t,r.key,o),o}(t,r)}))},973:(t,r,a)=>{a.d(r,{Z:()=>c});var o=a(947),i=a(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}var c=function(){function DSKStatusEffects(){_classCallCheck(this,DSKStatusEffects)}var t,r,a,c,u;return _createClass(DSKStatusEffects,null,[{key:"bindButtons",value:function bindButtons(t){t.find(".chat-condition").each((function(t,r){r.setAttribute("draggable",!0),r.addEventListener("dragstart",(function(t){var r={data:{type:"condition",payload:{id:$(t.currentTarget).attr("data-id")}}};t.dataTransfer.setData("text/plain",JSON.stringify(r))}))})),t.on("click",".chat-condition",(function(t){return o.Z.postStatus($(t.currentTarget).attr("data-id"))}))}},{key:"createCustomEffect",value:function createCustomEffect(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2?arguments[2]:void 0;a=a||game.i18n.localize("dsk.CONDITION.custom"),""==r&&(r=a),t.addCondition({label:a,icon:"icons/svg/aura.svg",origin:t.uuid,flags:{dsk:{value:null,editable:!0,description:r,custom:!0}}})}},{key:"addCondition",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var a,o,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:1,o=u.length>3&&void 0!==u[3]&&u[3],i=!(u.length>4&&void 0!==u[4])||u[4],t.isOwner){l.next=5;break}return l.abrupt("return","Not owned");case 5:if(!t.compendium){l.next=7;break}return l.abrupt("return","Can not add in compendium");case 7:if(!(o&&a<1)){l.next=9;break}return l.abrupt("return",this.removeCondition(t,r,a,i,o));case 9:if("string"==typeof r&&(r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))),r){l.next=12;break}return l.abrupt("return","No Effect Found");case 12:if(!(c=this.hasCondition(t,r.id))||null!=c.flags.dsk.value){l.next=17;break}return l.abrupt("return",c);case 17:if(!c){l.next=21;break}return l.next=20,DSKStatusEffects.updateEffect(t,c,a,o,i,r);case 20:case 23:return l.abrupt("return",l.sent);case 21:return l.next=23,DSKStatusEffects.createEffect(t,r,a,i);case 24:case"end":return l.stop()}}),_callee,this)}))),function addCondition(t,r){return u.apply(this,arguments)})},{key:"createEffect",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r,a,o){var i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:if(!(i=this.immuneToEffect(t,r))){u.next=3;break}return u.abrupt("return",i);case 3:return r.label=game.i18n.localize(r.label),o?(r.flags.dsk.auto=Math.min(r.flags.dsk.max,a),r.flags.dsk.manual=0):(r.flags.dsk.manual=Math.min(r.flags.dsk.max,a),r.flags.dsk.auto=0),r.flags.dsk.value=Math.min(4,r.flags.dsk.manual+r.flags.dsk.auto),r["flags.core.statusId"]=r.id,"dead"==r.id&&(r["flags.core.overlay"]=!0),u.next=10,t.createEmbeddedDocuments("ActiveEffect",[duplicate(r)]);case 10:return c=u.sent,u.next=13,t._dependentEffects(r.id,r,1);case 13:return delete r.id,u.abrupt("return",c);case 15:case"end":return u.stop()}}),_callee2,this)}))),function createEffect(t,r,a,o){return c.apply(this,arguments)})},{key:"removeCondition",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r){var a,o,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee3$(p){for(;;)switch(p.prev=p.next){case 0:if(a=l.length>2&&void 0!==l[2]?l[2]:1,o=!(l.length>3&&void 0!==l[3])||l[3],i=l.length>4&&void 0!==l[4]&&l[4],t.isOwner){p.next=5;break}return p.abrupt("return","Not owned");case 5:if("string"==typeof r&&(r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))),r){p.next=8;break}return p.abrupt("return","No Effect Found");case 8:if(!(c=this.hasCondition(t,r.id))||null!=c.flags.dsk.value){p.next=17;break}return t.token&&(t=t.token.actor),p.next=13,t.deleteEmbeddedDocuments("ActiveEffect",[c.id]);case 13:return u=p.sent,p.abrupt("return",u);case 17:if(!c){p.next=21;break}return p.next=20,DSKStatusEffects.removeEffect(t,c,a,i,o);case 20:return p.abrupt("return",p.sent);case 21:case"end":return p.stop()}}),_callee3,this)}))),function removeCondition(t,r){return a.apply(this,arguments)})},{key:"removeEffect",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,a,o,i){var c,u,l;return _regeneratorRuntime().wrap((function _callee4$(p){for(;;)switch(p.prev=p.next){case 0:if(c=i?o?a:Math.max(0,r.flags.dsk.auto-a):r.flags.dsk.auto,u=i?r.flags.dsk.manual:o?a:r.flags.dsk.manual-a,!((l={flags:{dsk:{auto:c,manual:u,value:Math.max(0,Math.min(r.flags.dsk.max,u+c))}}}).flags.dsk.auto<1&&0==l.flags.dsk.manual)){p.next=9;break}return p.next=6,t.deleteEmbeddedDocuments("ActiveEffect",[r.id]);case 6:case 11:return p.abrupt("return",p.sent);case 9:return p.next=11,r.update(l);case 12:case"end":return p.stop()}}),_callee4)}))),function removeEffect(t,a,o,i,c){return r.apply(this,arguments)})},{key:"updateEffect",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t,r,a,o,i){var c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee5$(y){for(;;)switch(y.prev=y.next){case 0:if(c=h.length>5&&void 0!==h[5]?h[5]:void 0,!(u=this.immuneToEffect(t,r,!0))){y.next=4;break}return y.abrupt("return",u);case 4:if(i?(p=Math.min(r.flags.dsk.max,o?a:r.flags.dsk.auto+a),l=p-r.flags.dsk.auto,d={flags:{dsk:{auto:p,manual:r.flags.dsk.manual}}}):(p=o?a:r.flags.dsk.manual+a,l=p-r.flags.dsk.manual,d={flags:{dsk:{manual:p,auto:r.flags.dsk.auto}}}),0!=l){y.next=7;break}return y.abrupt("return",r);case 7:return d.flags.dsk.value=Math.max(0,Math.min(r.flags.dsk.max,d.flags.dsk.manual+d.flags.dsk.auto)),c.duration&&(d.duration=c.duration,d.duration.startTime=game.time.worldTime),y.next=11,r.update(d);case 11:return y.next=13,t._dependentEffects(r.flags.core.statusId,r,l);case 13:return y.abrupt("return",r);case 14:case"end":return y.stop()}}),_callee5,this)}))),function updateEffect(r,a,o,i,c){return t.apply(this,arguments)})},{key:"immuneToEffect",value:function immuneToEffect(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=getProperty(t,"system.immunities")||[];if(o.includes(r.id)){var i=game.i18n.format("dsk.DSKError.immuneTo",{name:t.name,condition:game.i18n.localize("dsk.CONDITION.".concat(r.id))});return ui.notifications&&!a&&ui.notifications.warn(i),i}return!1}},{key:"resistantToEffect",value:function resistantToEffect(t,r){var a=getProperty(r,"flags.core.statusId");return a?(getProperty(t,"system.resistances.effects")||[]).reduce((function(t,r){return r.target==a&&(t+=Number(r.value)),t}),0):0}},{key:"hasCondition",value:function hasCondition(t,r){return!(null==t||!r)&&(!!t.effects&&t.effects.find((function(t){return getProperty(t,"flags.core.statusId")==r})))}},{key:"prepareActiveEffects",value:function prepareActiveEffects(t,r){var a=duplicate(CONFIG.statusEffects),o=[];r.conditions=[],r.transferedConditions=[];var c,u=_createForOfIteratorHelper(t.effects.filter((function(r){return game.user.isGM||"Item"==t.documentName||!r.getFlag("dsk","hidePlayers")})));try{for(u.s();!(c=u.n()).done;){var l=c.value;l.disabled=l.disabled,l.boolean=null==l.getFlag("dsk","value"),l.label=l.label,l.icon=l.icon;var p=l.getFlag("core","statusId");p&&(l.value=l.getFlag("dsk","value"),l.editable=l.getFlag("dsk","editable"),l.descriptor=p,l.manual=l.getFlag("dsk","manual"),o.push(p)),l.origin!=t.uuid&&l.origin||l.notApplicable?l.notApplicable||r.transferedConditions.push(l):r.conditions.push(l)}}catch(t){u.e(t)}finally{u.f()}r.manualConditions=a.filter((function(t){return!o.includes(t.id)}));for(var d=[],h=function _loop(){var r=m[y];if(t.system.status[r]){var a=i.Z.statusEffects.find((function(t){return t.id==r}));d.push({icon:a.icon,id:r,label:game.i18n.localize(a.label),value:t.system.status[r]})}},y=0,m=Object.keys((null===(g=t.system)||void 0===g?void 0:g.status)||{});y<m.length;y++){var g;h()}r.cumulativeConditions=d}},{key:"calculateRollModifier",value:function calculateRollModifier(t,r,a){return"regenerate"==a.type?0:-1*(r.system.status[t]||0)}},{key:"ModifierIsSelected",value:function ModifierIsSelected(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"damage"!=r.mode}},{key:"getRollModifiers",value:function getRollModifiers(t,r){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=game.i18n.localize("dsk.status")+"/"+game.i18n.localize("dsk.condition"),i=[],c=0,u=Object.keys(t.system.status);c<u.length;c++){var l=u[c];if(t.system.status[l]){var p=game.dsk.config.statusEffectClasses[l]||DSKStatusEffects;i.push({name:game.i18n.localize("dsk.CONDITION.".concat(l)),value:p.calculateRollModifier(l,t,r,a),selected:p.ModifierIsSelected(r,a,t),source:o})}}return i}}]),DSKStatusEffects}(),u=function(t){_inherits(EncumberedEffect,t);var r=_createSuper(EncumberedEffect);function EncumberedEffect(){return _classCallCheck(this,EncumberedEffect),r.apply(this,arguments)}return _createClass(EncumberedEffect,null,[{key:"ModifierIsSelected",value:function ModifierIsSelected(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="skill"==t.type&&"yes"==t.system.encumbers,o=!["skill","ahnengabe","rangeweapon"].includes(t.type)&&"damage"!=r.mode;return a||o}},{key:"calculateRollModifier",value:function calculateRollModifier(t,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return"regenerate"==a.type||"skill"==a.type&&"no"==a.system.encumbers?0:_get(_getPrototypeOf(EncumberedEffect),"calculateRollModifier",this).call(this,t,r,a,o)}}]),EncumberedEffect}(c),l=function(t){_inherits(PainEffect,t);var r=_createSuper(PainEffect);function PainEffect(){return _classCallCheck(this,PainEffect),r.apply(this,arguments)}return _createClass(PainEffect,null,[{key:"ModifierIsSelected",value:function ModifierIsSelected(t){var r=arguments.length>2?arguments[2]:void 0;return null==r.effects.find((function(t){return"bloodrush"==getProperty(t,"flags.core.statusId")}))}}]),PainEffect}(c),p=function(t){_inherits(SelfconfidenceEffect,t);var r=_createSuper(SelfconfidenceEffect);function SelfconfidenceEffect(){return _classCallCheck(this,SelfconfidenceEffect),r.apply(this,arguments)}return _createClass(SelfconfidenceEffect,null,[{key:"calculateRollModifier",value:function calculateRollModifier(t,r,a){return"regenerate"==a.type?0:r.system.status.selfconfidence||0}}]),SelfconfidenceEffect}(c);i.Z.statusEffectClasses={encumbered:u,inpain:l,selfconfidence:p}},278:(t,r,a)=>{a.d(r,{Z:()=>c});var o=a(404),i=a(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var c=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(AdvantageRulesDSK,t);var r,a,o,c,u=_createSuper(AdvantageRulesDSK);function AdvantageRulesDSK(){return _classCallCheck(this,AdvantageRulesDSK),u.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(AdvantageRulesDSK,null,[{key:"setupFunctions",value:function setupFunctions(){}},{key:"vantageAdded",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:game.dsk.config.addvantageRules[r.name]&&game.dsk.config.addvantageRules[r.name](t,r);case 1:case"end":return a.stop()}}),_callee)}))),function vantageAdded(t,r){return c.apply(this,arguments)})},{key:"vantageRemoved",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:game.dsk.config.removevantageRules[r.name]&&game.dsk.config.removevantageRules[r.name](t,r);case 1:case"end":return a.stop()}}),_callee2)}))),function vantageRemoved(t,r){return o.apply(this,arguments)})},{key:"_vantageReturnFunction",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,a,o){var c,u,l,p;return _regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:if(null!=r){d.next=2;break}return d.abrupt("return");case 2:if(r=duplicate(r),/,/.test(r.system.ap)&&(c=r.name.replace(" ()",""),r.system.ap=r.system.ap.split(",")[t.items.filter((function(t){return t.type==r.type&&t.name.includes(c)})).length].trim()),null!=o&&(AdvantageRulesDSK.simpleAdoption(r,o,r.name,i.Z.vantagesNeedingAdaption),r.name="".concat(r.name.replace(" ()","")," (").concat(o.name,")"),o.data&&(r.system.ap=r.system.ap.split("/")[o.system.StF.charCodeAt(0)-65].trim())),!(u=t.items.find((function(t){return t.type==a&&t.name==r.name})))){d.next=24;break}if(l=duplicate(u),p=/;/.test(l.system.ap)?l.system.ap.split(";").map((function(t){return Number(t.trim())}))[l.system.level]:l.system.ap,d.t0=l.system.level+1<=l.system.max,!d.t0){d.next=14;break}return d.next=13,t.checkEnoughXP(p);case 13:d.t0=d.sent;case 14:if(!d.t0){d.next=22;break}return l.system.level+=1,d.next=18,t._updateAPs(p);case 18:return d.next=20,t.updateEmbeddedDocuments("Item",[l]);case 20:return d.next=22,AdvantageRulesDSK.vantageAdded(t,l);case 22:d.next=33;break;case 24:return d.next=26,t.checkEnoughXP(r.system.ap.split(";").map((function(t){return t.trim()}))[0]);case 26:if(!d.sent){d.next=33;break}return d.next=29,AdvantageRulesDSK.vantageAdded(t,r);case 29:return d.next=31,t._updateAPs(r.system.ap.split(";").map((function(t){return t.trim()}))[0]);case 31:return d.next=33,t.createEmbeddedDocuments("Item",[r]);case 33:case"end":return d.stop()}}),_callee3)}))),function _vantageReturnFunction(t,r,o,i){return a.apply(this,arguments)})},{key:"needsAdoption",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,a){var o,c,u;return _regeneratorRuntime().wrap((function _callee4$(l){for(;;)switch(l.prev=l.next){case 0:if(!i.Z.vantagesNeedingAdaption[r.name]){l.next=17;break}if("text"!=i.Z.vantagesNeedingAdaption[r.name].items){l.next=8;break}return l.next=4,renderTemplate("systems/dsk/templates/dialog/requires-adoption-string-dialog.html",{original:r});case 4:o=l.sent,c=function callback(o){var i={name:o.find('[name="entryselection"]').val()};AdvantageRulesDSK._vantageReturnFunction(t,r,a,i)},l.next=13;break;case 8:return u=t.items.filter((function(t){return i.Z.vantagesNeedingAdaption[r.name].items.includes(t.type)})),l.next=11,renderTemplate("systems/dsk/templates/dialog/requires-adoption-dialog.html",{items:u,original:r});case 11:o=l.sent,c=function callback(o){var i=u.find((function(t){return t.name==o.find('[name="entryselection"]').val()}));AdvantageRulesDSK._vantageReturnFunction(t,r,a,i)};case 13:return l.next=15,new Dialog({title:game.i18n.localize("dsk.DIALOG.ItemRequiresAdoption"),content:o,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:c},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 15:l.next=18;break;case 17:AdvantageRulesDSK._vantageReturnFunction(t,r,a,null);case 18:case"end":return l.stop()}}),_callee4)}))),function needsAdoption(t,a,o){return r.apply(this,arguments)})},{key:"hasVantage",value:function hasVantage(t,r){return _get(_getPrototypeOf(AdvantageRulesDSK),"hasItem",this).call(this,t,r,["advantage","disadvantage"])}},{key:"vantageStep",value:function vantageStep(t,r){return _get(_getPrototypeOf(AdvantageRulesDSK),"itemStep",this).call(this,t,r,["advantage","disadvantage"])}},{key:"getVantageAsModifier",value:function getVantageAsModifier(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return _get(_getPrototypeOf(AdvantageRulesDSK),"itemAsModifier",this).call(this,t,r,a,["advantage","disadvantage"],o,i)}}]),AdvantageRulesDSK}(o.Z);o.Z.children.AdvantageRulesDSK=c},530:(t,r,a)=>{a.d(r,{Z:()=>u});var o=a(947),i=a(832),c=a(903);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var u=function(){function DSKChatAutoCompletion(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKChatAutoCompletion),0==DSKChatAutoCompletion.skills.length&&i.Z.allSkills(["skill"]).then((function(t){DSKChatAutoCompletion.skills=t.map((function(t){return{name:t.name,type:"skill"}})).concat(Object.values(game.dsk.config.characteristics).map((function(t){return{name:game.i18n.localize(t),type:"attribute"}})).concat({name:game.i18n.localize("dsk.regenerate"),type:"regeneration"}))})),this.regex,this.filtering=!1}var t,r;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKChatAutoCompletion,[{key:"regex",get:function get(){return new RegExp("^/(".concat(DSKChatAutoCompletion.cmds.join(" |"),")"))}},{key:"chatListeners",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r;return _regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:r=this,this.anchor=$("#chat-message").parent(),$("#chat-message").off("keydown",ui.chat._onChatKeyDownBinding),t.on("keyup","#chat-message",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:r._parseInput(t);case 1:case"end":return a.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".quick-item",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:r._quickSelect($(t.currentTarget));case 1:case"end":return a.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}()),t.on("keydown","#chat-message",(function(t){r._navigateQuickFind(t)}));case 6:case"end":return a.stop()}}),_callee3,this)}))),function chatListeners(t){return r.apply(this,arguments)})},{key:"_parseInput",value:function _parseInput(t){var r=t.target.value;if(this.regex.test(r)){if([38,40,13,9].includes(t.which))return!1;if(27==t.which)return this._closeQuickfind(),!1;var a=this._getCmd(r),o=r.substring(1+a.length).toLowerCase().trim();this["_filter".concat(a)](o),this.filtering=!0}else this._closeQuickfind()}},{key:"_getCmd",value:function _getCmd(t){return t.substring(1,3).toUpperCase().trim()}},{key:"_completeCurrentEntry",value:function _completeCurrentEntry(t){$("#chat-message").val($("#chat-message").val().split(" ")[0]+" "+t.text())}},{key:"_closeQuickfind",value:function _closeQuickfind(){this.filtering=!1,this.anchor.find(".quickfind").remove()}},{key:"_filterW",value:function _filterW(t){var r=game.users.contents.filter((function(r){return r.active&&-1!=r.name.toLowerCase().trim().indexOf(t)})).map((function(t){return{name:t.name,type:"user"}}));this._checkEmpty(r),this._setList(r,"W")}},{key:"_filterAT",value:function _filterAT(t){var r=DSKChatAutoCompletion._getActor(),a=r.actor;r.tokenId;if(a){var o=["meleeweapon","rangeweapon"],i=["meleeAttack","rangeAttack"],c=a.items.filter((function(r){return(o.includes(r.type)&&1==r.system.worn.value||"trait"==r.type&&i.includes(r.system.traitType))&&-1!=r.name.toLowerCase().trim().indexOf(t)})).slice(0,5).map((function(t){return{name:t.name,type:"item"}}));this._checkEmpty(c),this._setList(c,"AT")}}},{key:"_filterAH",value:function _filterAH(t){var r=DSKChatAutoCompletion._getActor(),a=r.actor;r.tokenId;if(a){var o=["ahnengabe"],i=a.items.filter((function(r){return o.includes(r.type)&&-1!=r.name.toLowerCase().trim().indexOf(t)})).slice(0,5).map((function(t){return{name:t.name,type:"item"}}));this._checkEmpty(i),this._setList(i,"SP")}}},{key:"_checkEmpty",value:function _checkEmpty(t){t.length||t.push({name:game.i18n.localize("dsk.DSKError.noMatch"),type:"none"})}},{key:"_getSkills",value:function _getSkills(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t=t.replace(/(-|\+)?\d+/g,"").trim();var a=DSKChatAutoCompletion.skills.filter((function(a){return-1!=a.name.toLowerCase().trim().indexOf(t)&&(null==r||r==a.type)})).slice(0,5);return this._checkEmpty(a),a}},{key:"_filterCH",value:function _filterCH(t){this._setList(this._getSkills(t),"CH")}},{key:"_filterSK",value:function _filterSK(t){this._setList(this._getSkills(t),"SK")}},{key:"_filterRQ",value:function _filterRQ(t){this._setList(this._getSkills(t),"RQ")}},{key:"_setList",value:function _setList(t,r){var a=$('<div class="quickfind dsklist"><ul>'.concat(t.map((function(t){return'<li data-type="'.concat(t.type,'" data-category="').concat(r,'" class="quick-item">').concat(t.name,"</li>")})).join(""),"</ul></div>"));a.find(".quick-item:first").addClass("focus");var o=this.anchor.find(".quickfind");o.length?o.replaceWith(a):this.anchor.append(a)}},{key:"_navigateQuickFind",value:function _navigateQuickFind(t){if(this.filtering){var r=this.anchor.find(".focus");switch(t.which){case 38:return r.prev(".quick-item").length&&r.removeClass("focus").prev(".quick-item").addClass("focus"),!1;case 40:return r.next(".quick-item").length&&r.removeClass("focus").next(".quick-item").addClass("focus"),!1;case 13:if("W"==r.attr("data-category"))break;return t.stopPropagation(),t.preventDefault(),this._quickSelect(r),!1;case 9:return t.stopPropagation(),t.preventDefault(),this._completeCurrentEntry(r),!1}}ui.chat._onChatKeyDown(t)}},{key:"_quickSelect",value:function _quickSelect(t){var r=t.attr("data-category");switch(r){case"NM":case"RQ":case"CH":this["_quick".concat(r)](t);break;case"W":this._completeCurrentEntry(t);break;default:var a=DSKChatAutoCompletion._getActor(),o=a.actor,i=a.tokenId;o&&(this._resetChatAutoCompletion(),this["_quick".concat(r)](t,o,i))}}},{key:"_quickW",value:function _quickW(t,r,a){}},{key:"_quickCH",value:function _quickCH(t){o.Z.check3D20(t),this._resetChatAutoCompletion()}},{key:"_quickSK",value:function _quickSK(t,r,a){switch(t.attr("data-type")){case"skill":var o=r.items.find((function(r){return r.name==t.text()&&"skill"==r.type}));o&&r.setupSkill(o,{},a).then((function(t){r.basicTest(t)}));break;case"attribute":var i=Object.keys(game.dsk.config.characteristics).find((function(r){return game.i18n.localize(game.dsk.config.characteristics[r])==t.text()}));r.setupCharacteristic(i,{},a).then((function(t){r.basicTest(t)}));break;case"regeneration":r.setupRegeneration("regenerate",{},a).then((function(t){r.basicTest(t)}))}}},{key:"_resetChatAutoCompletion",value:function _resetChatAutoCompletion(){$("#chat-message").val(""),this.anchor.find(".quickfind").remove()}},{key:"_quickRQ",value:function _quickRQ(t){var r=Number($("#chat-message").val().match(/(-|\+)?\d+/g))||0;this._resetChatAutoCompletion(),c.Z.showRQMessage(t.text(),r)}},{key:"_quickAT",value:function _quickAT(t,r,a){var o=["meleeweapon","rangeweapon"],i=["meleeAttack","rangeAttack"],c=r.items.find((function(r){return o.includes(r.type)&&r.name==t.text()}));c||(c=r.items.find((function(r){return"trait"==r.type&&r.name==t.text()&&i.includes(r.system.traitType)}))),c&&r.setupWeapon(c,"attack",{},a).then((function(t){r.basicTest(t)}))}},{key:"_quickSP",value:function _quickSP(t,r,a){var o=["ahnengabe"],i=r.items.find((function(r){return o.includes(r.type)&&r.name==t.text()}));i&&r.setupSpell(i,{},a).then((function(t){r.basicTest(t)}))}}],[{key:"_getActor",value:function _getActor(){var t,r=ChatMessage.getSpeaker();return r.token&&(t=game.actors.tokens[r.token]),t||(t=game.actors.get(r.actor)),t?{actor:t,tokenId:r.token}:(ui.notifications.error(game.i18n.localize("dsk.DSKError.noProperActor")),{})}},{key:"infoItemAsync",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){return _regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fromUuid(t);case 2:r.sent.postItem();case 4:case"end":return r.stop()}}),_callee4)}))),function infoItemAsync(r){return t.apply(this,arguments)})},{key:"bindRollCommands",value:function bindRollCommands(t){var r=this;t.on("click",".request-roll",(function(t){return c.Z.showRQMessage(t.currentTarget.dataset.name,Number(t.currentTarget.dataset.modifier)||0),t.stopPropagation(),!1})),t.on("click",".postInfo",(function(t){var a=fromUuidSync(t.currentTarget.dataset.uuid);return a&&("function"==typeof a.postItem?a.postItem():r.infoItemAsync(t.currentTarget.dataset.uuid)),t.stopPropagation(),!1})),t.on("click",".request-CH",(function(t){return o.Z.check3D20(void 0,t.currentTarget.dataset.name,{modifier:Number(t.currentTarget.dataset.modifier)||0}),t.stopPropagation(),!1}))}}]),DSKChatAutoCompletion}();_defineProperty(u,"skills",[]),_defineProperty(u,"cmds",["sk","at","ah","rq","w","ch"])},947:(t,r,a)=>{a.d(r,{Z:()=>p});var o=a(147),i=a(930),c=a(832),u=a(586),l=a(122);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var p=function(){function DSKChatListeners(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKChatListeners)}var t,r,a;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKChatListeners,null,[{key:"chatListeners",value:function chatListeners(t){t.on("click",".openJournalBrowser",(function(){return game.dsk.apps.journalBrowser.render(!0)}));var r=$('<a class="button showHelp" data-tooltip="dsk.HELP.showHelp"><i class="fas fa-question"></i></a>');r.click((function(){DSKChatListeners.getHelp()})),$(t.find(".control-buttons")).prepend(r),t.on("click",".showPatchViewer",(function(){return(0,u.j)()})),t.on("click",".functionswitch",(function(t){return l.Z[t.currentTarget.dataset.function](t)})),t.on("click",".panToToken",(function(t){return DSKChatListeners.panToToken(t)})),t.on("click",".popoutImage",(function(t){return(0,o.d)(t)}))}},{key:"panToToken",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r;return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fromUuid(t.currentTarget.dataset.uuid);case 2:if(r=a.sent){a.next=5;break}return a.abrupt("return");case 5:if(canvas.animatePan({x:r.x,y:r.y}),r.isOwner){a.next=8;break}return a.abrupt("return");case 8:r.object.control({releaseOthers:!0});case 9:case"end":return a.stop()}}),_callee)}))),function panToToken(t){return a.apply(this,arguments)})},{key:"postStatus",value:function postStatus(t){var r=CONFIG.statusEffects.find((function(r){return r.id==t})),a='<h2><a class="chat-condition chatButton" data-id="'.concat(t,'"><img class="sender-image" style="background-color:black;margin-right: 8px;" src="').concat(r.icon,'"/>').concat(game.i18n.localize(r.label),"</h2></a><p>").concat(game.i18n.localize(r.description),"</p>");ChatMessage.create(c.Z.chatDataSetup(a,"roll"))}},{key:"getHelp",value:function getHelp(){var t=i.Z.helpContent.map((function(t){return"<h2>".concat(game.i18n.localize("dsk.HELP.".concat(t.name)),"</h2>\n            <p><b>").concat(game.i18n.localize("dsk.HELP.command"),"</b>: ").concat(t.command,"</p>\n            <p><b>").concat(game.i18n.localize("dsk.HELP.example"),"</b>: ").concat(t.example,"</p>\n            <p><b>").concat(game.i18n.localize("dsk.description"),"</b>: ").concat(game.i18n.localize("dsk.HELP.descr".concat(t.name)))})).join("")+"<br>\n            <p>".concat(game.i18n.localize("dsk.HELP.default"),"</p>");ChatMessage.create(c.Z.chatDataSetup(t,"roll"))}},{key:"showConditions",value:function showConditions(){var t=duplicate(CONFIG.statusEffects).map((function(t){return t.label=game.i18n.localize(t.label),t})).sort((function(t,r){return t.label.localeCompare(r.label)})).map((function(t){return'<a class="chat-condition chatButton" data-id="'.concat(t.id,'"><img src="').concat(t.icon,'"/>').concat(t.label,"</a>")})).join(" ");ChatMessage.create(c.Z.chatDataSetup(t,"roll"))}},{key:"check3D20",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){var a,o,i,u=arguments;return _regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:if(a=u.length>2&&void 0!==u[2]?u[2]:{},o=12,!t){l.next=10;break}return t=t.get(0),l.next=6,c.Z.skillByName(t.textContent);case 6:r=l.sent,t.dataset.attrs&&(o=t.dataset.attrs.split("|")),l.next=14;break;case 10:if(!r){l.next=14;break}return l.next=13,c.Z.skillByName(r);case 13:r=l.sent;case 14:return r&&(r=r.toObject()),r||(r={name:"2d20",type:"skill",system:{level:0,characteristic1:"mu",characteristic2:"kl",encumbers:"no"}}),l.next=18,c.Z.emptyActor(o);case 18:(i=l.sent).setupSkill(r,a,"emptyActor").then((function(t){i.basicTest(t)}));case 20:case"end":return l.stop()}}),_callee2)}))),function check3D20(t,a){return r.apply(this,arguments)})},{key:"showTables",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var t;return _regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,renderTemplate("systems/dsk/templates/tables/systemtables.html",{tables:i.Z.systemTables});case 2:t=r.sent,ChatMessage.create(c.Z.chatDataSetup(t,"roll"));case 4:case"end":return r.stop()}}),_callee3)}))),function showTables(){return t.apply(this,arguments)})}]),DSKChatListeners}()},930:(t,r,a)=>{a.d(r,{Z:()=>i});var o={statusEffects:[{icon:"icons/svg/skull.svg",id:"dead",label:"dsk.CONDITION.defeated",description:"dsk.CONDITIONDESCRIPTION.defeated",flags:{dsk:{value:null,editable:!0}}},{id:"inpain",label:"dsk.CONDITION.inpain",icon:"icons/svg/blood.svg",description:"dsk.CONDITIONDESCRIPTION.inpain",changes:[{key:"system.status.inpain",mode:2,value:1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"encumbered",label:"dsk.CONDITION.encumbered",icon:"icons/svg/anchor.svg",description:"dsk.CONDITIONDESCRIPTION.encumbered",changes:[{key:"system.status.encumbered",mode:2,value:1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"stunned",label:"dsk.CONDITION.stunned",icon:"icons/svg/daze.svg",description:"dsk.CONDITIONDESCRIPTION.stunned",changes:[{key:"system.status.stunned",mode:2,value:1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"feared",label:"dsk.CONDITION.feared",icon:"icons/svg/terror.svg",description:"dsk.CONDITIONDESCRIPTION.feared",changes:[{key:"system.status.feared",mode:2,value:1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"selfconfidence",label:"dsk.CONDITION.selfconfidence",icon:"icons/svg/up.svg",description:"dsk.CONDITIONDESCRIPTION.selfconfidence",changes:[{key:"system.status.selfconfidence",mode:2,value:1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"prone",label:"dsk.CONDITION.prone",icon:"icons/svg/falling.svg",description:"dsk.CONDITIONDESCRIPTION.prone",changes:[{key:"system.stats.gs.gearmodifier",mode:2,value:-500},{key:"system.meleeStats.attack",mode:2,value:-4},{key:"system.rangeStats.attack",mode:2,value:-4},{key:"system.meleeStats.parry",mode:2,value:-2}],flags:{dsk:{value:null,editable:!0}}},{id:"rooted",label:"dsk.CONDITION.rooted",icon:"icons/svg/net.svg",changes:[{key:"system.stats.gs.gearmodifier",mode:2,value:-500}],description:"dsk.CONDITIONDESCRIPTION.rooted",flags:{dsk:{value:null,editable:!0}}},{id:"unconscious",label:"dsk.CONDITION.unconscious",icon:"icons/svg/unconscious.svg",description:"dsk.CONDITIONDESCRIPTION.unconscious",flags:{dsk:{value:null,editable:!0}}},{id:"blind",label:"dsk.CONDITION.blind",icon:"icons/svg/blind.svg",description:"dsk.CONDITIONDESCRIPTION.blind",changes:[{key:"system.meleeStats.attack",mode:2,value:-8},{key:"system.rangeStats.attack",mode:2,value:-100},{key:"system.meleeStats.parry",mode:2,value:-100}],flags:{dsk:{value:null,editable:!0}}},{id:"constricted",label:"dsk.CONDITION.constricted",icon:"icons/svg/cave.svg",description:"dsk.CONDITIONDESCRIPTION.constricted",flags:{dsk:{value:null,editable:!0}}},{id:"fixated",label:"dsk.CONDITION.fixated",icon:"icons/svg/padlock.svg",description:"dsk.CONDITIONDESCRIPTION.fixated",changes:[{key:"system.stats.gs.gearmodifier",mode:2,value:-500},{key:"system.meleeStats.parry",mode:2,value:-2}],flags:{dsk:{value:null,editable:!0}}},{id:"hallucinating",label:"dsk.CONDITION.hallucinating",icon:"icons/svg/padlock.svg",description:"dsk.CONDITIONDESCRIPTION.hallucinating",flags:{dsk:{value:null,editable:!0}}},{id:"incapacitated",label:"dsk.CONDITION.incapacitated",icon:"icons/svg/sleep.svg",description:"dsk.CONDITIONDESCRIPTION.incapacitated",changes:[{key:"system.stats.gs.gearmodifier",mode:2,value:-500}],flags:{dsk:{value:null,editable:!0}}},{id:"panic",label:"dsk.CONDITION.panic",icon:"icons/svg/terror.svg",description:"dsk.CONDITIONDESCRIPTION.panic",flags:{dsk:{value:null,editable:!0}}},{id:"bloodrush",label:"dsk.CONDITION.rage",icon:"icons/svg/bones.svg",description:"dsk.CONDITIONDESCRIPTION.rage",changes:[{key:"system.meleeStats.attack",mode:2,value:4},{key:"system.meleeStats.parry",mode:2,value:-100},{key:"system.rangeStats.attack",mode:2,value:-100}],flags:{dsk:{value:null,editable:!0}}},{id:"mute",label:"dsk.CONDITION.mute",icon:"icons/svg/silenced.svg",description:"dsk.CONDITIONDESCRIPTION.mute",flags:{dsk:{value:null,editable:!0}}},{id:"deaf",label:"dsk.CONDITION.deaf",icon:"icons/svg/deaf.svg",description:"dsk.CONDITIONDESCRIPTION.deaf",changes:[{key:"system.skillModifiers.step",mode:0,value:"Sinnesschrfe -4;Perception -4"}],flags:{dsk:{value:null,editable:!0}}},{id:"surprised",label:"dsk.CONDITION.surprised",icon:"icons/svg/hazard.svg",description:"dsk.CONDITIONDESCRIPTION.surprised",changes:[{key:"system.meleeStats.parry",mode:2,value:-100}],flags:{dsk:{value:null,editable:!0}}},{id:"invisible",label:"dsk.CONDITION.invisible",icon:"icons/svg/circle.svg",description:"dsk.CONDITIONDESCRIPTION.invisible",flags:{dsk:{value:null,editable:!0}}},{id:"poisoned",label:"dsk.CONDITION.poisoned",icon:"icons/svg/poison.svg",description:"dsk.CONDITIONDESCRIPTION.poisoned",flags:{dsk:{value:null,editable:!0}}}],StFs:{A:"A",B:"B",C:"C",D:"D",E:"E"},helpContent:[{name:"pay",command:"/pay [0-9]+",example:"/pay 5.03"},{name:"getPaid",command:"/getPaid [0-9]+",example:"/getPaid 5.03"},{name:"quickAbility",command:"/sk [a-z]*, /ah [a-z]*, /at [a-z]*, /pa [a-z]*",example:"/sk sinnesschrfe"},{name:"conditions",command:"/conditions",example:"/conditions"},{name:"tables",command:"/tables",example:"/tables"},{name:"request",command:"/rq",example:"/rq betren"},{name:"twoD20Check",command:"/ch",example:"/ch"}],meleeRangeVision:function(){return{"+0":"dsk.meleeVisionDisruption.0","-1":"dsk.meleeVisionDisruption.1","-2":"dsk.meleeVisionDisruption.2","-3":"dsk.meleeVisionDisruption.3","-5000":"dsk.meleeVisionDisruption.4"}},addvantageRules:{},removevantageRules:{},vantagesNeedingAdaption:{},addAbilityRules:{},removeAbilityRules:{},AbilitiesNeedingAdaption:{},advancementCosts:{A:[1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,4,5,6,7,8,9,10,11,12,13,14],B:[2,2,2,2,2,2,2,2,2,2,2,2,2,4,6,8,10,12,14,16,18,20,22,24,26,28],C:[3,3,3,3,3,3,3,3,3,3,3,3,3,6,9,12,15,18,21,24,27,30,33,36,39,42],D:[4,4,4,4,4,4,4,4,4,4,4,4,4,8,12,16,20,24,28,32,36,40,44,48,52,56],E:[5,5,5,5,5,5,5,5,5,5,5,5,5,10,15,20,25,30,35,40,45,50,55,60,65,70],Eig:[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,40,60,80,100,120,140,160,180,200,220,240]},specialAbilityCategories:{general:"dsk.SPECIALABILITYCATEGORIES.general",Combat:"dsk.SPECIALABILITYCATEGORIES.combat",ahnen:"dsk.SPECIALABILITYCATEGORIES.ahnen",language:"dsk.SPECIALABILITYCATEGORIES.language"},shieldSizes:{short:"dsk.SIZE.small",medium:"dsk.SIZE.average",long:"dsk.SIZE.big"},combatSkillSubCategories:{0:"dsk.COMBATSKILLCATEGORY.0",1:"dsk.COMBATSKILLCATEGORY.1",2:"dsk.COMBATSKILLCATEGORY.2",3:"dsk.COMBATSKILLCATEGORY.3",4:"dsk.COMBATSKILLCATEGORY.4"},gearModifyableCalculatedAttributes:["schips","ini","gs","AeP","LeP","sk","zk"],rangeWeaponModifiers:{short:"dsk.RangeMod.short",medium:"dsk.RangeMod.medium",long:"dsk.RangeMod.long",rangesense:"dsk.RangeMod.rangesense",extreme:"dsk.RangeMod.extreme"},rangeMods:{short:{damage:1,attack:2},medium:{damage:0,attack:0},long:{damage:-1,attack:-2},rangesense:{damage:-1,attack:-1},extreme:{damage:-2,attack:-4}},regnerationCampLocations:{0:"dsk.regnerationCampLocations.normal","-1":"dsk.regnerationCampLocations.bad",1:"dsk.regnerationCampLocations.good"},regenerationInterruptOptions:{0:"dsk.regenerationInterruptOptions.none","-1":"dsk.regenerationInterruptOptions.small","-2":"dsk.regenerationInterruptOptions.big"},equipmentCategories:["meleeweapon","rangeweapon","equipment","ammunition","armor","poison"],rangeSizeModifier:{tiny:-8,small:-4,average:0,big:4,giant:8},aimOptions:{0:"dsk.aimOptions.0",2:"dsk.aimOptions.1",4:"dsk.aimOptions.2"},rangeVision:{0:"dsk.VisionDisruption.step0","-2":"dsk.VisionDisruption.step1","-4":"dsk.VisionDisruption.step2","-6":"dsk.VisionDisruption.step3","-5000":"dsk.VisionDisruption.step4"},targetMomevementOptions:{0:"dsk.rangeMovementOptions.SLOW","-2":"dsk.rangeMovementOptions.FAST",2:"dsk.rangeMovementOptions.STATIONARY"},shooterMovementOptions:{0:"dsk.rangeMovementOptions.SHOOTERSTATIONARY","-2":"dsk.rangeMovementOptions.SHOOTERMOVING","-4":"dsk.rangeMovementOptions.SHOOTERRUNNING"},mountedRangeOptions:{0:"dsk.mountedRangeOptions.STATIONARY","-4":"dsk.mountedRangeOptions.SCHRITT","-8":"dsk.mountedRangeOptions.GALOPP"},rangeSizeCategories:{tiny:"dsk.RANGESIZE.tiny",small:"dsk.RANGESIZE.small",average:"dsk.RANGESIZE.average",big:"dsk.RANGESIZE.big",giant:"dsk.RANGESIZE.giant"},meleeSizeCategories:{tiny:"dsk.MELEESIZE.tiny",small:"dsk.MELEESIZE.small",average:"dsk.MELEESIZE.average",big:"dsk.MELEESIZE.big",giant:"dsk.MELEESIZE.giant"},narrowSpaceModifiers:{weaponshort:{attack:2,parry:0,label:"dsk.NarrowSpaceModifiers.weapon.short"},weaponmedium:{attack:0,parry:0,label:"dsk.NarrowSpaceModifiers.weapon.medium"},weaponlong:{attack:-2,parry:0,label:"dsk.NarrowSpaceModifiers.weapon.long"},shieldshort:{attack:0,parry:2,label:"dsk.NarrowSpaceModifiers.shield.short"},shieldmedium:{attack:0,parry:0,label:"dsk.NarrowSpaceModifiers.shield.medium"},shieldlong:{attack:-2,parry:-2,label:"dsk.NarrowSpaceModifiers.shield.long"}},meleeSizeModifier:{tiny:-4,small:0,average:0,big:0,giant:0},sizeCategories:{tiny:"dsk.SIZE.tiny",small:"dsk.SIZE.small",average:"dsk.SIZE.average",big:"dsk.SIZE.big",giant:"dsk.SIZE.giant"},equipmentTypes:{misc:"dsk.Equipment.misc",clothes:"dsk.Equipment.clothes",tools:"dsk.Equipment.tools",light:"dsk.Equipment.light",healing:"dsk.Equipment.healing",bags:"dsk.Equipment.bags",wealth:"dsk.Equipment.wealth",writing:"dsk.Equipment.writing",alchemy:"dsk.Equipment.alchemy",service:"dsk.Equipment.service",luxus:"dsk.Equipment.luxus",blessed:"dsk.Equipment.blessed",food:"dsk.Equipment.food",animals:"dsk.Equipment.animals"},systemTables:[{name:"Melee",attrs:'data-weaponless="false"',roll:"botch-roll",pack:{de:"dsk.patzer",en:"dsk.botch"},setting:{module:"",key:""}},{name:"Range",attrs:'data-weaponless="false"',roll:"botch-roll",pack:{de:"dsk.patzer",en:"dsk.botch"},setting:{module:"",key:""}},{name:"Ahnen",attrs:"",roll:"botch-roll",pack:{de:"dsk.patzer",en:"dsk.botch"},setting:{module:"",key:""}}],tokenSizeCategories:{tiny:.5,small:.8,average:1,big:2,giant:4}};o.effectTextStyle=CONFIG.canvasTextStyle.clone(),o.effectTextStyle.fontSize="30",o.effectTextStyle.fontFamily="GentiumBasic",o.ammunitiongroups={"-":"-",arrow:"dsk.ammunition.arrow",bolt:"dsk.ammunition.bolt",bullet:"dsk.ammunition.bullet",stone:"dsk.ammunition.stone",dart:"dsk.ammunition.dart",mag:"dsk.ammunition.mag",infinite:"dsk.ammunition.infinite"},o.traitCategories={meleeAttack:"dsk.closeCombatAttacks",rangeAttack:"dsk.rangeCombatAttacks",armor:"ITEM.TypeArmor",force:"dsk.force",specialty:"dsk.specialty"},o.meleeRanges={short:"dsk.Range.short",medium:"dsk.Range.medium",long:"dsk.Range.long"},o.magicResistanceModifiers={"-":"-",sk:"dsk.soulpower",zk:"dsk.toughness"},o.weapontypes={melee:"ITEM.TypeMeleeweapon",range:"ITEM.TypeRangeweapon"},o.characteristics={mu:"dsk.characteristics.mu.name",kl:"dsk.characteristics.kl.name",in:"dsk.characteristics.in.name",ch:"dsk.characteristics.ch.name",ff:"dsk.characteristics.ff.name",ge:"dsk.characteristics.ge.name",ko:"dsk.characteristics.ko.name",kk:"dsk.characteristics.kk.name"},o.skillBurdens={yes:"dsk.yes",no:"dsk.no",maybe:"dsk.maybe"},o.skillDifficultyLabels={eeasy:"dsk.Skill-eeasy",veasy:"dsk.Skill-veasy",easy:"dsk.Skill-easy",challenging:"dsk.Skill-challenging",difficult:"dsk.Skill-difficult",hard:"dsk.Skill-hard",vhard:"dsk.Skill-vhard"},o.skillDifficultyModifiers={eeasy:16,veasy:8,easy:4,challenging:0,difficult:-4,hard:-8,vhard:-16},o.skillGroups={body:"dsk.SKILL.body",social:"dsk.SKILL.social",knowledge:"dsk.SKILL.knowledge",trade:"dsk.SKILL.trade"},CONFIG.time.roundTime=2,CONFIG.time.turnTime=0;const i=o},565:(t,r,a)=>{function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}a.d(r,{Z:()=>o});var o=function(){function DPS(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DPS)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DPS,null,[{key:"rangeFinder",value:function rangeFinder(t,r){var a=canvas.scene.grid.size,o=new Ray(t,r).distance/a,i=o*canvas.scene.grid.distance,c=Math.abs((getProperty(t,"system.elevation")||0)-(getProperty(r,"system.elevation")||0));return{elevation:c,distance:i,distanceSum:Math.hypot(i,c),tileDistance:o,unit:canvas.scene.grid.units}}},{key:"inDistance",value:function inDistance(t){var r,a=_createForOfIteratorHelper(canvas.scene.tokens);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.isOwner&&this.rangeFinder(t,o.object).tileDistance<=2)return!0}}catch(t){a.e(t)}finally{a.f()}return!1}},{key:"distanceModifier",value:function distanceModifier(t,r,a){if(!game.settings.get("dsk","enableDPS")||!t)return 1;var o,i={},c=_createForOfIteratorHelper(game.user.targets);try{for(c.s();!(o=c.n()).done;){var u=o.value,l=DPS.rangeFinder(t,u);(i.distanceSum||0)<l.distanceSum&&(i=l)}}catch(t){c.e(t)}finally{c.f()}if(i.unit==game.i18n.localize("dsk.gridUnits")){for(var p=Number(getProperty(a,"system.rangeMultiplier"))||1,d=r.system.rw.split("/").map((function(t){return Number(t)*p})),h=0;h<2&&d[h]<i.distanceSum;)h++;return h}return 1}},{key:"initDoorMinDistance",value:function initDoorMinDistance(){var t=DoorControl.prototype._onMouseDown;DoorControl.prototype._onMouseDown=function(r){return game.user.isGM||!game.settings.get("dsk","enableDPS")||DPS.inDistance(this)?t.apply(this,arguments):ui.notifications.warn(game.i18n.localize("dsk.DSKError.notInRangeToLoot"))}}}]),DPS}()},614:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>DiceDSK});var _actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(231),_dialog_dialog_dsk_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(96),_item_item_dsk_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(140),_status_active_effects_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(61),_status_status_effects_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(973),_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(139),_advantage_rules_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(278),_config_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(930),_dsk_soundeffect_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(608),_dsk_utility_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(832),_request_roll_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(903),_specialability_rules_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(514),_trait_rules_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(969);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _slicedToArray(t,r){return _arrayWithHoles(t)||_iterableToArrayLimit(t,r)||_unsupportedIterableToArray(t,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var o,i,c=[],u=!0,l=!1;try{for(a=a.call(t);!(u=(o=a.next()).done)&&(c.push(o.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==a.return||a.return()}finally{if(l)throw i}}return c}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}var DiceDSK=function(){function DiceDSK(){_classCallCheck(this,DiceDSK)}var _chatListeners,_rollEdit2,_rollDamage,_damageFormula,_rollDices,_rollRegeneration,_rollWeapon,_rollCombatTrait,_manualRolls,_showDiceSoNice,_roll2D,_evaluateDamage,_detailedWeaponResult,_stringToRoll2,_rollSpell,_addRollDiceSoNice2,_rollAttribute,_rollTest,_rollTalent,_getDefenseCount,_setupDialog;return _createClass(DiceDSK,null,[{key:"setupDialog",value:(_setupDialog=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,a,o,i,c,u,l;return _regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:return r=t.dialogOptions,a=t.testData,o=t.cardOptions,p.next=3,game.settings.get("core","rollMode");case 3:return i=p.sent,"function"==typeof a.source.toObject&&(a.source=a.source.toObject(!1)),mergeObject(a,{testDifficulty:0}),mergeObject(r.data,{testDifficulty:0,testModifier:r.data.modifier||0}),c=r.data.situationalModifiers||(a.extra.actor?_status_status_effects_js__WEBPACK_IMPORTED_MODULE_4__.Z.getRollModifiers(a.extra.actor,a.source):[]),null!=a.extra.options.moreModifiers&&c.push.apply(c,_toConsumableArray(a.extra.options.moreModifiers)),u=[],game.user.targets.forEach((function(t){t.actor&&u.push({name:t.actor.name,id:t.id,img:t.actor.img})})),p.t0=mergeObject,p.t1=r.data,p.t2=c.length>0,p.t3=c,p.t4=r.data.rollMode||i,p.t5=CONFIG.Dice.rollModes,p.next=20,this.getDefenseCount(a);case 20:if(p.t6=p.sent,p.t7=u,p.t8={hasSituationalModifiers:p.t2,situationalModifiers:p.t3,rollMode:p.t4,rollModes:p.t5,defenseCount:p.t6,targets:p.t7},(0,p.t0)(p.t1,p.t8),mergeObject(o,{user:game.user.id}),a.extra.options.bypass){p.next=32;break}return p.next=28,renderTemplate(r.template,r.data);case 28:return l=p.sent,p.abrupt("return",new Promise((function(t,o){var i=_dialog_dialog_dsk_js__WEBPACK_IMPORTED_MODULE_1__.Z.getDialogForItem(a.source.type);new i({title:r.title,content:l,buttons:i.getRollButtons(a,r,t,o),default:"rollButton"}).recallSettings(a.extra.speaker,a.source,a.mode).render(!0)})));case 32:return o.rollMode=a.extra.options.rollMode||i,a.situationalModifiers||(a.situationalModifiers=[]),p.abrupt("return",{testData:a,cardOptions:o});case 35:case"end":return p.stop()}}),_callee,this)}))),function setupDialog(t){return _setupDialog.apply(this,arguments)})},{key:"_appendSituationalModifiers",value:function _appendSituationalModifiers(t,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=t.situationalModifiers.find((function(t){return t.name==r}));i?i.value=a:t.situationalModifiers.push({name:r,value:a,type:o})}},{key:"_situationalPartCheckModifiers",value:function _situationalPartCheckModifiers(t){return t.situationalModifiers.reduce((function(t,r){if("TPM"==r.type){var a=r.value.split("|");return 2!=a.length||(t[0]=t[0]+Number(a[0]),t[1]=t[1]+Number(a[1])),t}return t}),[0,0])}},{key:"_situationalModifiers",value:function _situationalModifiers(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.situationalModifiers.reduce((function(t,a){return t+((a.type==r||""==r&&null==a.type)&&Number(a.value)||0)}),0)}},{key:"getDefenseCount",value:(_getDefenseCount=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(!game.combat){r.next=4;break}return r.next=3,game.combat.getDefenseCount(t.extra.speaker);case 3:return r.abrupt("return",r.sent);case 4:return r.abrupt("return",0);case 5:case"end":return r.stop()}}),_callee2)}))),function getDefenseCount(t){return _getDefenseCount.apply(this,arguments)})},{key:"rollTalent",value:(_rollTalent=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r;return _regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._roll2D20(t);case 2:return(r=a.sent).rollType="talent",a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee3,this)}))),function rollTalent(t){return _rollTalent.apply(this,arguments)})},{key:"rollTest",value:(_rollTest=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r;return _regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:a.t0=t.source.type,a.next="ahnengabe"===a.t0?3:"skill"===a.t0?7:"combatskill"===a.t0?11:"regenerate"===a.t0?15:"trait"===a.t0?19:"meleeweapon"===a.t0||"rangeweapon"===a.t0?30:"poison"===a.t0?41:45;break;case 3:return a.next=5,this.rollSpell(t);case 5:return r=a.sent,a.abrupt("break",48);case 7:return a.next=9,this.rollTalent(t);case 9:return r=a.sent,a.abrupt("break",48);case 11:return a.next=13,this.rollCombatskill(t);case 13:return r=a.sent,a.abrupt("break",48);case 15:return a.next=17,this.rollRegeneration(t);case 17:return r=a.sent,a.abrupt("break",48);case 19:if("damage"!=t.mode){a.next=25;break}return a.next=22,this.rollDamage(t);case 22:a.t1=a.sent,a.next=28;break;case 25:return a.next=27,this.rollCombatTrait(t);case 27:a.t1=a.sent;case 28:return r=a.t1,a.abrupt("break",48);case 30:if("damage"!=t.mode){a.next=36;break}return a.next=33,this.rollDamage(t);case 33:a.t2=a.sent,a.next=39;break;case 36:return a.next=38,this.rollWeapon(t);case 38:a.t2=a.sent;case 39:return r=a.t2,a.abrupt("break",48);case 41:return a.next=43,this.rollItem(t);case 43:return r=a.sent,a.abrupt("break",48);case 45:return a.next=47,this.rollAttribute(t);case 47:r=a.sent;case 48:return mergeObject(r,deepClone(t.extra)),a.abrupt("return",r);case 50:case"end":return a.stop()}}),_callee4,this)}))),function rollTest(t){return _rollTest.apply(this,arguments)})},{key:"rollAttribute",value:(_rollAttribute=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r;return _regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this._roll2D20(t);case 2:return(r=a.sent).rollType="attribute",a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee5,this)}))),function rollAttribute(t){return _rollAttribute.apply(this,arguments)})},{key:"get2D20SuccessLevel",value:function get2D20SuccessLevel(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=t.terms.filter((function(t){return t.results&&t.results[0].result<=o})).length,c=t.terms.filter((function(t){return t.results&&t.results[0].result>=a})).length;return i>=2?i:c>=2?-1*c:r>=0?1:-1}},{key:"_addRollDiceSoNice",value:(_addRollDiceSoNice2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r,a){var o;return _regeneratorRuntime().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:if(!t.rollMode){i.next=4;break}for(o=0;o<r.dice.length;o++)mergeObject(r.dice[o].options,a);return i.next=4,this.showDiceSoNice(r,t.rollMode);case 4:case"end":return i.stop()}}),_callee6,this)}))),function _addRollDiceSoNice(t,r,a){return _addRollDiceSoNice2.apply(this,arguments)})},{key:"rollSpell",value:(_rollSpell=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,a,o,i,c,u,l,p,d,h,y,m,g,v,_;return _regeneratorRuntime().wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._roll2D20(t);case 2:if((r=b.sent).rollType=t.source.types,r.preData.calculatedSpellModifiers.finalcost=Number(r.preData.calculatedSpellModifiers.cost),r.successLevel>=2?(r.description=r.description+", "+game.i18n.localize("dsk.additionalQLs")+" 10",r.qualityStep=Math.min(6,Math.ceil(r.result/5)+2),r.preData.calculatedSpellModifiers.finalcost=Math.round(r.preData.calculatedSpellModifiers.cost/2)):r.successLevel<=-2&&(r.description+=_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_5__.Z.rollCritBotchButton("Ahnen",!1,t)),!(r.successLevel>0)){b.next=39;break}if(""==t.source.system.effectFormula){b.next=39;break}a=t.source.system.effectFormula.replace(game.i18n.localize("dsk.CHARAbbrev.QS"),r.qualityStep).replace(/[Ww]/g,"d"),o=[],i=_createForOfIteratorHelper(t.situationalModifiers);try{for(i.s();!(c=i.n()).done;)(u=c.value).armorPen&&o.push(u.armorPen)}catch(t){i.e(t)}finally{i.f()}if(/(,|;)/.test(a)&&(a=a.split(/[,;]/)[r.qualityStep-1]),!t.damageRoll){b.next=17;break}b.t0=Roll.fromData(t.damageRoll),b.next=25;break;case 17:return b.t1=DiceDSK,b.next=20,new Roll(a).evaluate({async:!0});case 20:return b.t2=b.sent,b.t3=t.extra.options,b.next=24,b.t1.manualRolls.call(b.t1,b.t2,"dsk.CHAR.DAMAGE",b.t3);case 24:b.t0=b.sent;case 25:l=b.t0,this._addRollDiceSoNice(t,l,game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration("damage")),r.calculatedEffectFormula=a,p=_createForOfIteratorHelper(l.terms);try{for(p.s();!(d=p.n()).done;)if((h=d.value)instanceof Die||"Die"==h.class){y=_createForOfIteratorHelper(h.results);try{for(y.s();!(m=y.n()).done;)g=m.value,r.characteristics.push({char:"effect",res:g.result,die:"d"+h.faces})}catch(t){y.e(t)}finally{y.f()}}}catch(t){p.e(t)}finally{p.f()}return v=[],b.next=33,DiceDSK._stringToRoll(t.extra.actor.system.spellStats.damage,t);case 33:0!=(_=b.sent)&&v.push(game.i18n.localize("dsk.statuseffects")+" "+_),r.armorPen=o,r.damageRoll=damageRoll.toJSON(),r.damage=l.total+_,r.damagedescription=v.join("\n");case 39:return this.calculateEnergyCost(r,t),b.abrupt("return",r);case 41:case"end":return b.stop()}}),_callee7,this)}))),function rollSpell(t){return _rollSpell.apply(this,arguments)})},{key:"calculateEnergyCost",value:function calculateEnergyCost(t,r){var a=[];if(t.successLevel<0){var o=["traditionWitch","traditionFjarning","braniborian"].map((function(t){return game.i18n.localize("dsk.LocalizedIDs.".concat(t))})),i=r.extra.actor.items.some((function(t){return"specialability"==t.type&&o.includes(t.name)}))?3:2;t.preData.calculatedSpellModifiers.finalcost=Math.round(t.preData.calculatedSpellModifiers.finalcost/i)}var c=game.i18n.localize("dsk.LocalizedIDs.weakAstralBody"),u=game.i18n.localize("dsk.LocalizedIDs.".concat(t.successLevel>0?"energyControl":"smallEnergyControl")),l="aepModifier",p="AeP";a.push({name:c,value:_advantage_rules_js__WEBPACK_IMPORTED_MODULE_6__.Z.vantageStep(r.extra.actor,c)},{name:u,value:-1*_specialability_rules_js__WEBPACK_IMPORTED_MODULE_11__.Z.abilityStep(r.extra.actor,u)},{name:"".concat(game.i18n.localize("dsk.statuseffects")," (").concat(game.i18n.localize("dsk.CHARAbbrev."+p),")"),value:r.extra.actor.system[l]+this._situationalModifiers(r,"AePCost")}),a=a.filter((function(t){return 0!=t.value})),t.preData.calculatedSpellModifiers.description=a.map((function(t){return"".concat(t.name," ").concat(t.value)})).join("\n"),t.preData.calculatedSpellModifiers.finalcost=Math.max(1,Number(t.preData.calculatedSpellModifiers.finalcost)+a.reduce((function(t,r){return t+r.value}),0))}},{key:"_stringToRoll",value:(_stringToRoll2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r){var a,o,i,c,u;return _regeneratorRuntime().wrap((function _callee8$(l){for(;;)switch(l.prev=l.next){case 0:return a=[],o=/\d{1}[dDwW]\d/g,(i="".concat(t)).replace(o,(function(t){a.push(new Roll(t.replace(/[Ww]/,"d")).evaluate({async:!0}))})),l.next=6,Promise.all(a);case 6:return c=l.sent,u=i.replace(o,(function(){var t=c.shift();return r&&DiceDSK._addRollDiceSoNice(r,t,game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration("ch")),t.total})),l.next=10,Roll.safeEval(u);case 10:return l.abrupt("return",l.sent);case 11:case"end":return l.stop()}}),_callee8)}))),function _stringToRoll(t,r){return _stringToRoll2.apply(this,arguments)})},{key:"detailedWeaponResult",value:(_detailedWeaponResult=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t,r,a){var o,i;return _regeneratorRuntime().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if("attack"==r.mode){c.next=2;break}return c.abrupt("return");case 2:c.t0=t.successLevel,c.next=2===c.t0?5:-2===c.t0?8:12;break;case 5:return t.description+=_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_5__.Z.defaultAttackCrit(!0),t.doubleDamage=!0,c.abrupt("break",12);case 8:return o="meleeweapon"==a.type||"meleeAttack"==getProperty(a,"system.traitType"),i=getProperty(a,"system.combatskill")==game.i18n.localize("dsk.LocalizedIDs.wrestle")||"trait"==a.type,t.description+=o?_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_5__.Z.rollCritBotchButton("Melee",i,r):_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_5__.Z.rollCritBotchButton("Range",!1,r),c.abrupt("break",12);case 12:case"end":return c.stop()}}),_callee9)}))),function detailedWeaponResult(t,r,a){return _detailedWeaponResult.apply(this,arguments)})},{key:"evaluateDamage",value:(_evaluateDamage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(t,r,a,o,i){var c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,D,R,L,G,j,M,z;return _regeneratorRuntime().wrap((function _callee10$(N){for(;;)switch(N.prev=N.next){case 0:c=a.system.tp.replace(/[Ww]/g,"d"),u=[],l=a.dmgMultipliers||[],p=l.map((function(t){return"".concat(t.name," *").concat(t.val)})),d=[],h=0,y=_createForOfIteratorHelper(t.situationalModifiers),N.prev=7,y.s();case 9:if((m=y.n()).done){N.next=33;break}if(g=m.value,v=0,g.armorPen&&d.push(g.armorPen),!g.damageBonus){N.next=31;break}if(!/^\*/.test(g.damageBonus)){N.next=17;break}return l.push({name:g.name,val:Number(g.damageBonus.replace("*",""))}),N.abrupt("continue",31);case 17:return _=/^=/.test(g.damageBonus),b="".concat(g.damageBonus).replace(/^=/,""),N.next=21,DiceDSK._stringToRoll(b,t);case 21:if(k=N.sent,v=k*(g.step||1),!_){N.next=29;break}return c=b.replace(/[Ww]/,"d"),u.push({name:g.name,roll:k}),N.abrupt("continue",31);case 29:g.damageBonus=k,h+=v;case 31:N.next=9;break;case 33:N.next=38;break;case 35:N.prev=35,N.t0=N.catch(7),y.e(N.t0);case 38:return N.prev=38,y.f(),N.finish(38);case 41:if(!t.damageRoll){N.next=45;break}N.t1=Roll.fromData(t.damageRoll),N.next=53;break;case 45:return N.t2=DiceDSK,N.next=48,new Roll(c).evaluate({async:!0});case 48:return N.t3=N.sent,N.t4=t.extra.options,N.next=52,N.t2.manualRolls.call(N.t2,N.t3,"dsk.damage",N.t4);case 52:N.t1=N.sent;case 53:w=N.t1,x=w.total,O=0,S=_createForOfIteratorHelper(w.terms);try{for(S.s();!(P=S.n()).done;)if((T=P.value)instanceof Die||"Die"==T.class){I=_createForOfIteratorHelper(T.results);try{for(I.s();!(E=I.n()).done;)C=E.value,O+=Number(C.result),r.characteristics.push({char:"damage",res:C.result,die:"d"+T.faces})}catch(t){I.e(t)}finally{I.f()}}}catch(t){S.e(t)}finally{S.f()}if(A=x-O,!(u.length>0)){N.next=63;break}p.push(u[0].name+" "+x),N.next=74;break;case 63:return x+=h,p.push(game.i18n.localize("dsk.Roll")+" "+O),0!=A&&p.push(game.i18n.localize("dsk.weaponModifier")+" "+A),t.situationalModifiers.reduce((function(t,r){if(r.damageBonus){var a=/^\*/.test(r.damageBonus)?r.damageBonus:Number(r.damageBonus)*(r.step||1);p.push("".concat(r.name," ").concat(a))}}),p),t.situationalModifiers.find((function(t){return t.name.indexOf(game.i18n.localize("dsk.CONDITION.bloodrush"))>-1}))&&(x+=2,p.push(game.i18n.localize("dsk.CONDITION.bloodrush")+" 2")),a.extraDamage&&(x=Number(a.extraDamage)+Number(x),p.push(game.i18n.localize("dsk.damageThreshold")+" "+a.extraDamage)),o?(R=_config_js__WEBPACK_IMPORTED_MODULE_7__.Z.rangeMods[t.rangeModifier||"medium"].damage,x+=R,0!=R&&p.push(game.i18n.localize("dsk.distance")+" "+R),D=t.extra.actor.system.rangeStats.damage):D=t.extra.actor.system.meleeStats.damage,N.next=72,DiceDSK._stringToRoll(D,t);case 72:0!=(L=N.sent)&&(x+=L,p.push(game.i18n.localize("dsk.statuseffects")+" "+L));case 74:G=game.i18n.localize("dsk.LocalizedIDs.feint"),r.qualityStep>0&&!t.situationalModifiers.find((function(t){return t.name==G}))&&(x+=r.qualityStep,p.push(game.i18n.localize("dsk.qualityStep")+" "+r.qualityStep)),i&&(x*=3,p.push(game.i18n.localize("dsk.doubleDamage"))),j=_createForOfIteratorHelper(l);try{for(j.s();!(M=j.n()).done;)z=M.value,x*=z.val}catch(t){j.e(t)}finally{j.f()}r.armorPen=d,r.damagedescription=p.join(", "),r.damage=Math.round(x),r.damageRoll=w.toJSON();case 83:case"end":return N.stop()}}),_callee10,null,[[7,35,38,41]])}))),function evaluateDamage(t,r,a,o,i){return _evaluateDamage.apply(this,arguments)})},{key:"parseEffect",value:function parseEffect(t){var r=t.system.effect?t.system.effect:void 0,a=[];if(r){var o,i=/^[a-z]+\|[a-zA-z ]+$/,c=_createForOfIteratorHelper(r.split(";"));try{for(c.s();!(o=c.n()).done;){var u=o.value;i.test(u.trim())&&function(){var t=u.split("|").map((function(t){return t.trim()}));if("condition"==t[0]){var r=CONFIG.statusEffects.find((function(r){return r.id==t[1]}));a.push('<a class="chat-condition chatButton" data-id="'.concat(r.id,'">\n                            <img src="').concat(r.icon,'"/>').concat(game.i18n.localize(r.label),"\n                            </a>"))}else a.push('<a class="roll-button roll-item" data-name="'.concat(t[1],'" data-type="').concat(t[0],'"><i class="fas fa-dice"></i>').concat(game.i18n.localize(t[0]),": ").concat(t[1],"</a>"))}()}}catch(t){c.e(t)}finally{c.f()}}var l=getProperty(t,"flags.dsk.poison");return l&&a.push('<a class="roll-button roll-item" data-removecharge="'.concat(!l.permanent,'" data-name="').concat(l.name,'" data-type="poison"><i class="fas fa-dice"></i>').concat(game.i18n.localize("ITEM.TypePoison"),": ").concat(l.name,"</a>")),a.join(", ")}},{key:"_roll2D20",value:(_roll2D=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t){var r,a,o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w;return _regeneratorRuntime().wrap((function _callee11$(x){for(;;)switch(x.prev=x.next){case 0:if(!t.roll){x.next=4;break}x.t0=Roll.fromData(t.roll),x.next=7;break;case 4:return x.next=6,new Roll("1d20+1d20").evaluate({async:!0});case 6:x.t0=x.sent;case 7:if(r=x.t0,a=[],o=0,t.testDifficulty&&this._appendSituationalModifiers(t,game.i18n.localize("dsk.Difficulty"),t.testDifficulty),t.vw&&(i=t.situationalModifiers.reduce((function(t,r){return t+(Number(r.dmmalus)||0)}),0),c=Math.max(0,Number(t.vw)-i),this._appendSituationalModifiers(t,game.i18n.localize("dsk.ABBR.VW"),-1*c)),u=this._situationalModifiers(t),l=this._situationalPartCheckModifiers(t,"TPM"),(p=t.source.attack||Number(t.source.system.at))||(p=null==t.source.system.level?-5+t.extra.actor.system.characteristics[t.source.system.characteristic1].value+t.extra.actor.system.characteristics[t.source.system.characteristic2].value:t.source.system.level+5+Math.round((t.extra.actor.system.characteristics[t.source.system.characteristic1].value+t.extra.actor.system.characteristics[t.source.system.characteristic2].value)/2)),d=p+this._situationalModifiers(t,"FW")+l[0]+l[1]+u,t.advancedModifiers&&(d+=t.advancedModifiers.fws+t.advancedModifiers.chars[0]+t.advancedModifiers.chars[1]),h=d-r.terms[0].results[0].result-r.terms[2].results[0].result,y=1,m=20,"skill"!=t.source.type||!_advantage_rules_js__WEBPACK_IMPORTED_MODULE_6__.Z.hasVantage(t.extra.actor,"".concat(game.i18n.localize("dsk.LocalizedIDs.incompetent")," (").concat(t.source.name,")"))){x.next=32;break}return x.next=24,new Roll("1d20").evaluate({async:!0});case 24:g=x.sent,v=res.reduce((function(t,r,a,o){return r<o[t]?a:t}),0),_=r.terms[2*v].total,h+=Math.max(res[v],0),h-=Math.max(0,g.total-tar[v]),r.editRollAtIndex([{index:v,val:g.total}]),this._addRollDiceSoNice(t,g,r.terms[2*v].options),a.push(game.i18n.format("dsk.CHATNOTIFICATION.unableReroll",{die:v+1,oldVal:_,newVal:g.total}));case 32:return b=0,"skill"==t.source.type&&_trait_rules_js__WEBPACK_IMPORTED_MODULE_12__.Z.hasTrait(t.extra.actor,"".concat(game.i18n.localize("dsk.LocalizedIDs.automaticSuccess")," (").concat(t.source.name,")"))?(a.push(game.i18n.localize("dsk.LocalizedIDs.automaticSuccess")),o=1,b=1):"skill"==t.source.type&&_trait_rules_js__WEBPACK_IMPORTED_MODULE_12__.Z.hasTrait(t.extra.actor,"".concat(game.i18n.localize("dsk.LocalizedIDs.automaticFail")," (").concat(t.source.name,")"))?(a.push(game.i18n.localize("dsk.LocalizedIDs.automaticFail")),o=-1):(o=DiceDSK.get2D20SuccessLevel(r,h,m,y),t.routine&&(o=1),a.push(DiceDSK.getSuccessDescription(o))),a=a.join(", "),k=0,o>0&&(h+=this._situationalModifiers(t,"FP"),k=Math.max(1,(0==h?1:h>0?Math.ceil(h/5):0)+(null!=t.qualityStep?Number(t.qualityStep):0))+((null===(w=t.advancedModifiers)||void 0===w?void 0:w.qls)||0)+this._situationalModifiers(t,"QL")),k<b&&(k=b),x.abrupt("return",{result:h,characteristics:[0,1].map((function(a){var o;return{char:t.source.system["characteristic".concat(a+1)],res:r.terms[2*a].results[0].result,tar:null===(o=t.extra.actor.system.characteristics[t.source.system["characteristic".concat(a+1)]])||void 0===o?void 0:o.value}})),qualityStep:k,pw:d,roll:r,description:a,preData:t,successLevel:o,modifiers:u,extra:{}});case 39:case"end":return x.stop()}}),_callee11,this)}))),function _roll2D20(t){return _roll2D.apply(this,arguments)})},{key:"renderRollCard",value:function(){var _renderRollCard=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(chatOptions,testData,rerenderMessage){var applyEffect,preData,hideDamage,hasAreaTemplate,chatData,html,actor,rollData,enriched,postFunction,newMsg;return _regeneratorRuntime().wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return applyEffect=this.addApplyEffectData(testData),preData=deepClone(testData.preData),hideDamage=rerenderMessage?rerenderMessage.flags.data.hideDamage:"attack"==preData.mode,_context12.next=5,Hooks.call("postProcessDSKRoll",chatOptions,testData,rerenderMessage,hideDamage);case 5:if(delete preData.extra.actor,delete testData.actor,delete testData.preData,hasAreaTemplate=testData.successLevel>0&&preData.source.system.target&&preData.source.system.target.type in game.dsk.config.areaTargetTypes,chatData={title:chatOptions.title,testData,hideData:game.user.isGM,preData,hideDamage,modifierList:preData.situationalModifiers.filter((function(t){return 0!=t.value})),applyEffect,hasAreaTemplate},preData.advancedModifiers&&(preData.advancedModifiers.chars.some((function(t){return 0!=t}))&&chatData.modifierList.push({name:game.i18n.localize("dsk.MODS.partChecks"),value:preData.advancedModifiers.chars}),0!=preData.advancedModifiers.fws&&chatData.modifierList.push({name:game.i18n.localize("dsk.MODS.FW"),value:preData.advancedModifiers.fws}),0!=preData.advancedModifiers.qls&&chatData.modifierList.push({name:game.i18n.localize("dsk.MODS.QS"),value:preData.advancedModifiers.qls})),["gmroll","blindroll"].includes(chatOptions.rollMode)&&(chatOptions.whisper=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))),"blindroll"===chatOptions.rollMode?chatOptions.blind=!0:"selfroll"===chatOptions.rollMode&&(chatOptions.whisper=[game.user.id]),_dsk_soundeffect_js__WEBPACK_IMPORTED_MODULE_8__.Z.playEffect(preData.mode,preData.source,testData.successLevel,chatOptions.whisper,chatOptions.blind),chatOptions["flags.data"]={preData,postData:testData,template:chatOptions.template,rollMode:chatOptions.rollMode,isOpposedTest:chatOptions.isOpposedTest,title:chatOptions.title,hideData:chatData.hideData,hideDamage:chatData.hideDamage,isDSKRoll:!0},rerenderMessage){_context12.next=24;break}return _context12.next=18,renderTemplate(chatOptions.template,chatData);case 18:return chatOptions.content=_context12.sent,_context12.next=21,ChatMessage.create(chatOptions,!1);case 21:return _context12.abrupt("return",_context12.sent);case 24:return _context12.next=26,renderTemplate(chatOptions.template,chatData);case 26:return html=_context12.sent,actor=ChatMessage.getSpeakerActor(rerenderMessage.speaker)||game.users.get(rerenderMessage.user).character,rollData=actor?actor.getRollData():{},_context12.next=31,TextEditor.enrichHTML(html,{rollData,async:!0});case 31:return enriched=_context12.sent,chatOptions.content=enriched,postFunction=getProperty(rerenderMessage,"flags.data.preData.extra.options.postFunction"),postFunction&&(testData.messageId=rerenderMessage.id,eval(postFunction.functionName)(postFunction,{result:testData},preData.source)),_context12.next=37,rerenderMessage.update(_defineProperty({content:chatOptions.content},"flags.data",chatOptions["flags.data"]));case 37:return newMsg=_context12.sent,ui.chat.updateMessage(newMsg),_context12.abrupt("return",newMsg);case 40:case"end":return _context12.stop()}}),_callee12,this)})));function renderRollCard(t,r,a){return _renderRollCard.apply(this,arguments)}return renderRollCard}()},{key:"addApplyEffectData",value:function addApplyEffectData(t){var r=t.preData.source;if(["ahnengabe","meleeweapon","rangeweapon"].includes(r.type)){if(t.successLevel>0&&r.effects.length>0)return!0}else{if(["poison"].includes(r.type))return r.effects.length>0;if("trait"==r.type&&r.effects.length>0&&t.successLevel>0)return!0}var a=t.preData.situationalModifiers.filter((function(t){return t.specAbId})).map((function(t){return t.specAbId}));if(a.length>0){var o,i=_createForOfIteratorHelper(t.preData.extra.actor.items.filter((function(t){return a.includes(t._id)})));try{for(i.s();!(o=i.n()).done;){if(o.value.effects.length>0)return!0}}catch(t){i.e(t)}finally{i.f()}}return!1}},{key:"getSuccessDescription",value:function getSuccessDescription(t){return game.i18n.localize(["dsk.CriticalFailure","dsk.Failure","","dsk.Success","dsk.CriticalSuccess"][t+2])}},{key:"showDiceSoNice",value:(_showDiceSoNice=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(t,r){var a,o,i;return _regeneratorRuntime().wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:if(!_dsk_utility_js__WEBPACK_IMPORTED_MODULE_9__.Z.moduleEnabled("dice-so-nice")){c.next=17;break}a=null,o=!1,c.t0=r,c.next="blindroll"===c.t0?6:"gmroll"===c.t0?9:"selfroll"===c.t0?11:13;break;case 6:return o=!0,a=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id})),c.abrupt("break",13);case 9:return a=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id})),c.abrupt("break",13);case 11:return a=[],c.abrupt("break",13);case 13:if(i=game.dice3d.showForRoll(t,game.user,!0,a,o),game.settings.get("dice-so-nice","immediatelyDisplayChatMessages")){c.next=17;break}return c.next=17,i;case 17:case"end":return c.stop()}}),_callee13)}))),function showDiceSoNice(t,r){return _showDiceSoNice.apply(this,arguments)})},{key:"manualRolls",value:(_manualRolls=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(t){var r,a,o,i,c,u,l,p,d,h,y,m,g,v,_,b=arguments;return _regeneratorRuntime().wrap((function _callee14$(k){for(;;)switch(k.prev=k.next){case 0:if(r=b.length>1&&void 0!==b[1]?b[1]:"",!(a=b.length>2&&void 0!==b[2]?b[2]:{}).cheat&&!game.settings.get("dsk","allowPhysicalDice")){k.next=21;break}if(a.predefinedResult){k.next=20;break}o=!1,c=[],u=_createForOfIteratorHelper(t.terms);try{for(u.s();!(l=u.n()).done;)if((p=l.value)instanceof Die||"Die"==p.class){d=_createForOfIteratorHelper(p.results);try{for(d.s();!(h=d.n()).done;)y=h.value,c.push({faces:p.faces,val:y.result})}catch(t){d.e(t)}finally{d.f()}}}catch(t){u.e(t)}finally{u.f()}return k.next=10,renderTemplate("systems/dsk/templates/dialog/manualroll-dialog.html",{dice:c,description:r});case 10:return m=k.sent,k.next=13,new Promise((function(t,r){new _dialog_dialog_dsk_js__WEBPACK_IMPORTED_MODULE_1__.Z({title:game.i18n.localize(a.cheat?"dsk.DIALOG.cheat":"dsk.SETTINGS.allowPhysicalDice"),content:m,default:"ok",buttons:{ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(r){t([!0,r])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){t([!1,0])}}}}).render(!0)}));case 13:g=k.sent,v=_slicedToArray(g,2),o=v[0],i=v[1],o&&(_=[],i.find(".dieInput").each((function(t){var r=Number($(this).val());r>0&&_.push({val:r,index:t}),t++})),t.editRollAtIndex(_)),k.next=21;break;case 20:t.editRollAtIndex(a.predefinedResult);case 21:return k.abrupt("return",t);case 22:case"end":return k.stop()}}),_callee14)}))),function manualRolls(t){return _manualRolls.apply(this,arguments)})},{key:"_getNarrowSpaceModifier",value:function _getNarrowSpaceModifier(t,r){return r.narrowSpace?game.i18n.localize("dsk.LocalizedIDs.Shields")==t.system.combatskill?_config_js__WEBPACK_IMPORTED_MODULE_7__.Z.narrowSpaceModifiers["shield"+t.system.shieldsize][r.mode]:_config_js__WEBPACK_IMPORTED_MODULE_7__.Z.narrowSpaceModifiers["weapon"+t.system.rw][r.mode]:0}},{key:"rollCombatTrait",value:(_rollCombatTrait=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(t){var r,a,o,i,c;return _regeneratorRuntime().wrap((function _callee15$(u){for(;;)switch(u.prev=u.next){case 0:return r=t.source,a="meleeAttack"==r.system.traitType,o=r,a?this._appendSituationalModifiers(t,game.i18n.localize("dsk.narrowSpace"),this._getNarrowSpaceModifier(o,t)):this._appendSituationalModifiers(t,game.i18n.localize("dsk.distance"),_config_js__WEBPACK_IMPORTED_MODULE_7__.Z.rangeMods[t.rangeModifier||"medium"].attack),u.next=6,this._roll2D20(t);case 6:return i=u.sent,u.next=9,this.detailedWeaponResult(i,t,r);case 9:if(!("attack"==t.mode&&i.successLevel>0)){u.next=12;break}return u.next=12,DiceDSK.evaluateDamage(t,i,o,!a,i.doubleDamage);case 12:return i.rollType="weapon",(c=DiceDSK.parseEffect(o))&&(i.parsedEffect=c),u.abrupt("return",i);case 16:case"end":return u.stop()}}),_callee15,this)}))),function rollCombatTrait(t){return _rollCombatTrait.apply(this,arguments)})},{key:"rollWeapon",value:(_rollWeapon=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(t){var r,a,o,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee16$(d){for(;;)switch(d.prev=d.next){case 0:return a=t.source,o=t.extra.actor,i=a.system.combatskill,c=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._calculateCombatSkillValues(o.items.find((function(t){return"combatskill"==t.type&&t.name==i})),o.system),(u="meleeweapon"==a.type)?(r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareMeleeWeapon(a,[c],t.extra.actor),this._appendSituationalModifiers(t,game.i18n.localize("dsk.narrowSpace"),this._getNarrowSpaceModifier(r,t))):(r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareRangeWeapon(a,[],[c],t.extra.actor),this._appendSituationalModifiers(t,game.i18n.localize("dsk.distance"),_config_js__WEBPACK_IMPORTED_MODULE_7__.Z.rangeMods[t.rangeModifier||"medium"].attack)),d.next=8,this._roll2D20(t);case 8:return l=d.sent,d.next=11,this.detailedWeaponResult(l,t,a);case 11:if(!("attack"==t.mode&&l.successLevel>0)){d.next=14;break}return d.next=14,DiceDSK.evaluateDamage(t,l,r,!u,l.doubleDamage);case 14:return l.rollType="weapon",(p=DiceDSK.parseEffect(r))&&(l.parsedEffect=p),d.abrupt("return",l);case 18:case"end":return d.stop()}}),_callee16,this)}))),function rollWeapon(t){return _rollWeapon.apply(this,arguments)})},{key:"rollRegeneration",value:(_rollRegeneration=_asyncToGenerator(_regeneratorRuntime().mark((function _callee17(t){var r,a,o,i,c,u,l,p,d,h,y,m;return _regeneratorRuntime().wrap((function _callee17$(g){for(;;)switch(g.prev=g.next){case 0:if(r=this._situationalModifiers(t),a=t.roll,o=[],i={rollType:"regenerate",preData:t,modifiers:r,extra:{}},c=[],t.regenerateLeP&&c.push("LeP"),t.extra.actor.system.isMage&&t.regenerateAeP&&c.push("AeP"),u=0,t.extra.actor.effects.some((function(t){return"sick"==getProperty(t,"flags.core.statusId")}))){this._appendSituationalModifiers(t,game.i18n.localize("dsk.CONDITION.sick"),"*0"),l=_createForOfIteratorHelper(c);try{for(l.s();!(p=l.n()).done;)d=p.value,o.push({char:d,res:0,die:"d6"}),i[d]=0,u+=2}catch(t){l.e(t)}finally{l.f()}}else{h=_createForOfIteratorHelper(c);try{for(h.s();!(y=h.n()).done;)m=y.value,this._appendSituationalModifiers(t,game.i18n.localize("dsk.LocalizedIDs.regeneration".concat(m)),_advantage_rules_js__WEBPACK_IMPORTED_MODULE_6__.Z.vantageStep(t.extra.actor,game.i18n.localize("dsk.LocalizedIDs.regeneration".concat(m))),m),this._appendSituationalModifiers(t,game.i18n.localize("dsk.LocalizedIDs.weakRegeneration".concat(m)),-1*_advantage_rules_js__WEBPACK_IMPORTED_MODULE_6__.Z.vantageStep(t.extra.actor,game.i18n.localize("dsk.LocalizedIDs.weakRegeneration".concat(m))),m),this._appendSituationalModifiers(t,game.i18n.localize("dsk.LocalizedIDs.advancedRegeneration".concat(m)),_specialability_rules_js__WEBPACK_IMPORTED_MODULE_11__.Z.abilityStep(t.extra.actor,game.i18n.localize("dsk.LocalizedIDs.advancedRegeneration".concat(m))),m),this._appendSituationalModifiers(t,"".concat(game.i18n.localize("CHARAbbrev.".concat(m))," ").concat(game.i18n.localize("dsk.Modifier")),t["".concat(m,"Modifier")],m),this._appendSituationalModifiers(t,"".concat(game.i18n.localize("CHARAbbrev.".concat(m))," ").concat(game.i18n.localize("dsk.regenerate")),t["regeneration".concat(m)],m),o.push({char:m,res:a.terms[u].results[0].result,die:"d6"}),i[m]=Math.round(Math.max(0,Number(a.terms[u].results[0].result)+Number(r)+this._situationalModifiers(t,m))*Number(t.regenerationFactor)),u+=2}catch(t){h.e(t)}finally{h.f()}}return i.characteristics=o,g.abrupt("return",i);case 12:case"end":return g.stop()}}),_callee17,this)}))),function rollRegeneration(t){return _rollRegeneration.apply(this,arguments)})},{key:"rollDices",value:(_rollDices=_asyncToGenerator(_regeneratorRuntime().mark((function _callee18(t,r){var a,o,i,c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee18$(h){for(;;)switch(h.prev=h.next){case 0:if(t.roll){h.next=68;break}a=game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration,h.t0=t.source.type,h.next="char"===h.t0||"ahnengabe"===h.t0||"skill"===h.t0?5:"regenerate"===h.t0?11:"meleeweapon"===h.t0||"rangeweapon"===h.t0||"combatskill"===h.t0?20:"trait"===h.t0?36:"poison"===h.t0||"disease"===h.t0?52:60;break;case 5:return h.next=7,new Roll("1d20+1d20").evaluate({async:!0});case 7:return o=h.sent,mergeObject(o.dice[0].options,a(t.source.system.characteristic1)),mergeObject(o.dice[1].options,a(t.source.system.characteristic2)),h.abrupt("break",61);case 11:return i=[],t.regenerateLeP&&i.push("1d6"),t.extra.actor.isMage&&t.regenerateAeP&&i.push("1d6"),h.next=16,new Roll(i.join("+")).evaluate({async:!0});case 16:return o=h.sent,t.regenerateLeP&&mergeObject(o.dice[0].options,a("mu")),t.extra.actor.isMage&&t.regenerateAeP&&mergeObject(o.dice[i.length-1].options,a("ge")),h.abrupt("break",61);case 20:if("damage"!=t.mode){h.next=30;break}return h.next=23,this.damageFormula(t);case 23:return c=h.sent,h.next=26,new Roll(c).evaluate({async:!0});case 26:for(o=h.sent,u=0;u<o.dice.length;u++)mergeObject(o.dice[u].options,a("damage"));h.next=35;break;case 30:return h.next=32,new Roll("1d20+1d20").evaluate({async:!0});case 32:o=h.sent,mergeObject(o.dice[0].options,a("attack")),mergeObject(o.dice[1].options,a("attack"));case 35:return h.abrupt("break",61);case 36:if("damage"!=t.mode){h.next=46;break}return h.next=39,this.damageFormula(t);case 39:return l=h.sent,h.next=42,new Roll(l).evaluate({async:!0});case 42:for(o=h.sent,p=0;p<o.dice.length;p++)mergeObject(o.dice[p].options,a("damage"));h.next=51;break;case 46:return h.next=48,new Roll("1d20+1d20").evaluate({async:!0});case 48:o=h.sent,mergeObject(o.dice[0].options,a("attack")),mergeObject(o.dice[1].options,a("attack"));case 51:return h.abrupt("break",61);case 52:return d=a("in"),h.next=55,new Roll("1d20+1d20+1d20").evaluate({async:!0});case 55:return o=h.sent,mergeObject(o.dice[0].options,d),mergeObject(o.dice[1].options,d),mergeObject(o.dice[2].options,d),h.abrupt("break",61);case 60:console.error("Unexpected roll mode");case 61:return h.next=63,DiceDSK.manualRolls(o,t.source.type,t.extra.options);case 63:return o=h.sent,h.next=66,this.showDiceSoNice(o,r.rollMode);case 66:t.roll=duplicate(o),t.rollMode=r.rollMode;case 68:return h.abrupt("return",t);case 69:case"end":return h.stop()}}),_callee18,this)}))),function rollDices(t,r){return _rollDices.apply(this,arguments)})},{key:"damageFormula",value:(_damageFormula=_asyncToGenerator(_regeneratorRuntime().mark((function _callee19(t){var r,a,o;return _regeneratorRuntime().wrap((function _callee19$(i){for(;;)switch(i.prev=i.next){case 0:return"meleeweapon"==t.source.type?(a=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._calculateCombatSkillValues(t.extra.actor.items.find((function(r){return"combatskill"==r.type&&r.name==t.source.system.combatskill})),t.extra.actor.system),r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareMeleeWeapon(t.source,[a],t.extra.actor)):"rangeweapon"==t.source.type?(o=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._calculateCombatSkillValues(t.extra.actor.items.find((function(r){return"combatskill"==r.type&&r.name==t.source.system.combatskill})),t.extra.actor.system),r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareRangeWeapon(t.source,[],[o],t.extra.actor)):r=t.source.system,i.abrupt("return",t.source.system.tp.replace(/[Ww]/g,"d")+"+".concat(r.extraDamage||0));case 2:case"end":return i.stop()}}),_callee19)}))),function damageFormula(t){return _damageFormula.apply(this,arguments)})},{key:"rollDamage",value:(_rollDamage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee20(t){var r,a,o,i,c,u,l,p,d,h;return _regeneratorRuntime().wrap((function _callee20$(y){for(;;)switch(y.prev=y.next){case 0:r=this._situationalModifiers(t),a=[],o=t.roll,i=o.total+r,c=_createForOfIteratorHelper(o.terms);try{for(c.s();!(u=c.n()).done;)if((l=u.value)instanceof Die||"Die"==l.class){p=_createForOfIteratorHelper(l.results);try{for(p.s();!(d=p.n()).done;)h=d.value,a.push({char:t.mode,res:h.result,die:"d"+l.faces})}catch(t){p.e(t)}finally{p.f()}}}catch(t){c.e(t)}finally{c.f()}return y.abrupt("return",{rollType:"damage",damage:i,characteristics:a,preData:t,modifiers:r,extra:{}});case 7:case"end":return y.stop()}}),_callee20,this)}))),function rollDamage(t){return _rollDamage.apply(this,arguments)})},{key:"_rollEdit",value:(_rollEdit2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee21(t){var r,a,o,i,c,u,l,p,d,h,y;return _regeneratorRuntime().wrap((function _callee21$(m){for(;;)switch(m.prev=m.next){case 0:r=$(t.currentTarget),a=r.parents(".message").attr("data-message-id"),o=game.messages.get(a),i=o.flags.data,(c=i.preData).extra.actor=_dsk_utility_js__WEBPACK_IMPORTED_MODULE_9__.Z.getSpeaker(c.extra.speaker).toObject(!1),c.extra.options.cheat&&delete c.extra.options.cheat,m.t0=r.attr("data-edit-type"),m.next="roll"===m.t0?8:"mod"===m.t0?12:17;break;case 8:return u=r.attr("data-edit-id"),l=Number(r.val()),c.roll.terms.length>2*u?((p=Roll.fromData(c.roll)).editRollAtIndex([{index:u,val:l}]),c.roll=p):(d=Roll.fromData(i.postData.damageRoll),u-=c.roll.terms.filter((function(t){return t.results})).length,d.editRollAtIndex([{index:u,val:l}]),c.damageRoll=d),m.abrupt("break",17);case 12:return(u=c.situationalModifiers.findIndex((function(t){return t.name==game.i18n.localize("dsk.chatEdit")})))>0&&c.situationalModifiers.splice(u,1),h={name:game.i18n.localize("dsk.chatEdit"),value:Number(r.val())-this._situationalModifiers(c)},c.situationalModifiers.push(h),m.abrupt("break",17);case 17:y={template:i.template,rollMode:i.rollMode,title:i.title,speaker:o.speaker,user:o.user.id},["gmroll","blindroll"].includes(y.rollMode)&&(y.whisper=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))),"blindroll"===y.rollMode&&(y.blind=!0),["poison","disease"].includes(c.source.type)?new _item_item_dsk_js__WEBPACK_IMPORTED_MODULE_2__.Z(c.source,{temporary:!0})["".concat(i.postData.postFunction)]({testData:c,cardOptions:y},{rerenderMessage:o}):_dsk_utility_js__WEBPACK_IMPORTED_MODULE_9__.Z.getSpeaker(o.speaker)["".concat(i.postData.postFunction)]({testData:c,cardOptions:y},{rerenderMessage:o});case 21:case"end":return m.stop()}}),_callee21,this)}))),function _rollEdit(t){return _rollEdit2.apply(this,arguments)})},{key:"chatListeners",value:(_chatListeners=_asyncToGenerator(_regeneratorRuntime().mark((function _callee27(t){return _regeneratorRuntime().wrap((function _callee27$(r){for(;;)switch(r.prev=r.next){case 0:t.on("click",".expand-mods",(function(t){t.preventDefault();var r=$(t.currentTarget);r.find("i").toggleClass("fa-minus fa-plus"),r.siblings("ul,div").fadeToggle()})),t.on("click",".edit-toggle",(function(t){t.preventDefault(),$(t.currentTarget).parents(".chat-card").find(".display-toggle").toggle()})),t.on("click",".botch-roll",(function(t){return _tables_dsktables_js__WEBPACK_IMPORTED_MODULE_5__.Z.showBotchCard(t.currentTarget.dataset)})),t.on("click",".roll-item",(function(t){return DiceDSK._itemRoll(t)})),t.on("change",".roll-edit",(function(t){return DiceDSK._rollEdit(t)})),t.on("click",".applyEffect",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee23(t){return _regeneratorRuntime().wrap((function _callee23$(r){for(;;)switch(r.prev=r.next){case 0:DiceDSK.wrapLock(t,function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee22(t,r){var a,o;return _regeneratorRuntime().wrap((function _callee22$(i){for(;;)switch(i.prev=i.next){case 0:return a=r.parents(".message").attr("data-message-id"),o=t.currentTarget.dataset.target,i.next=4,_status_active_effects_js__WEBPACK_IMPORTED_MODULE_3__.Z.applyEffect(a,o);case 4:case"end":return i.stop()}}),_callee22)})));return function(r,a){return t.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),_callee23)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".applyTableEffect",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee25(t){return _regeneratorRuntime().wrap((function _callee25$(r){for(;;)switch(r.prev=r.next){case 0:DiceDSK.wrapLock(t,function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee24(t,r){var a,o;return _regeneratorRuntime().wrap((function _callee24$(i){for(;;)switch(i.prev=i.next){case 0:return a=r.parents(".message").attr("data-message-id"),o=t.currentTarget.dataset.target,i.next=4,TableEffects.applyEffect(a,o);case 4:case"end":return i.stop()}}),_callee24)})));return function(r,a){return t.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),_callee25)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".placeTemplate",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee26(t){return _regeneratorRuntime().wrap((function _callee26$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",MeasuredTemplateDSK.placeTemplateFromChat(t));case 1:case"end":return r.stop()}}),_callee26)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".resistEffect",(function(t){return _status_active_effects_js__WEBPACK_IMPORTED_MODULE_3__.Z.resistEffect(t)})),t.on("click",".resistPain",(function(t){return DiceDSK.rollResistPain(t)})),_request_roll_js__WEBPACK_IMPORTED_MODULE_10__.Z.chatListeners(t);case 11:case"end":return r.stop()}}),_callee27)}))),function chatListeners(t){return _chatListeners.apply(this,arguments)})}]),DiceDSK}()},608:(t,r,a)=>{function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}a.d(r,{Z:()=>o});var o=function(){function DSKSoundEffect(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKSoundEffect)}var t,r,a,o,i,c;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKSoundEffect,null,[{key:"playEffect",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r,a){var o,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:void 0,i=u.length>4&&void 0!==u[4]&&u[4],l.next=4,this.getSound(t,r,a);case 4:if(c=l.sent)try{o?(game.socket.emit("system.dsk",{type:"playWhisperSound",payload:{whisper:o,soundPath:c}}),i||AudioHelper.play({src:c,volume:.8,loop:!1},!1)):AudioHelper.play({src:c,volume:.8,loop:!1},!0)}catch(t){console.warn("Could not play item sound effect ".concat(c))}case 6:case"end":return l.stop()}}),_callee,this)}))),function playEffect(t,r,a){return c.apply(this,arguments)})},{key:"loadSoundConfig",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,a;return _regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,game.settings.get("dsk","soundConfig");case 2:if(!(t=o.sent)){o.next=18;break}return o.prev=4,o.next=7,fetch(t);case 7:return r=o.sent,o.next=10,r.json();case 10:a=o.sent,this.sounds=a,console.log("DSK | Sound Config Loaded"),o.next=18;break;case 15:o.prev=15,o.t0=o.catch(4),console.warn(o.t0);case 18:case"end":return o.stop()}}),_callee2,this,[[4,15]])}))),function loadSoundConfig(){return i.apply(this,arguments)})},{key:"successLevelToString",value:function successLevelToString(t){switch(t){case-1:return["fail"];case-2:return["botch","fail"];case 1:return["success"];case 2:return["crit","success"];default:return[]}}},{key:"getSound",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,a){var o,i,c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(this.sounds||this.triedInit){h.next=4;break}return h.next=3,this.loadSoundConfig();case 3:this.triedInit=!0;case 4:if(this.sounds){h.next=6;break}return h.abrupt("return",void 0);case 6:i=this.successLevelToString(a),c=[],h.t0=r.type,h.next="meleeweapon"===h.t0||"rangeweapon"===h.t0?11:"skill"===h.t0?13:"ahnengabe"===h.t0?15:17;break;case 11:return c=[].concat(_toConsumableArray(i.map((function(a){return"".concat(r.type,".manual.").concat(r.name,".").concat(t,"_").concat(a)}))),["".concat(r.type,".manual.").concat(r.name,".").concat(t),"".concat(r.type,".manual.").concat(r.name,".default.").concat(t),"".concat(r.type,".manual.").concat(r.name,".default")],_toConsumableArray(i.map((function(a){return"".concat(r.type,".").concat(r.system.combatskill,".").concat(t,"_").concat(a)}))),["".concat(r.type,".").concat(r.system.combatskill,".").concat(t)],_toConsumableArray(i.map((function(t){return"".concat(r.type,".").concat(r.system.combatskill,".default_").concat(t)}))),["".concat(r.type,".").concat(r.system.combatskill,".default")]),h.abrupt("break",17);case 13:case 15:return c=[].concat(_toConsumableArray(i.map((function(a){return"".concat(r.type,".").concat(r.name,".").concat(t,"_").concat(a)}))),["".concat(r.type,".").concat(r.name,".").concat(t)],_toConsumableArray(i.map((function(t){return"".concat(r.type,".").concat(r.name,".default_").concat(t)}))),["".concat(r.type,".").concat(r.name,".default")]),h.abrupt("break",17);case 17:(o=c).push.apply(o,_toConsumableArray(i.map((function(t){return"".concat(r.type,".default_").concat(t)}))).concat(["".concat(r.type,".default")])),l=_createForOfIteratorHelper(c),h.prev=19,l.s();case 21:if((p=l.n()).done){h.next=30;break}if(d=p.value,hasProperty(this.sounds,d)){h.next=25;break}return h.abrupt("continue",28);case 25:if(!(u=getProperty(this.sounds,d))||!("string"==typeof u||u instanceof String)){h.next=28;break}return h.abrupt("break",30);case 28:h.next=21;break;case 30:h.next=35;break;case 32:h.prev=32,h.t1=h.catch(19),l.e(h.t1);case 35:return h.prev=35,l.f(),h.finish(35);case 38:return h.abrupt("return",u);case 39:case"end":return h.stop()}}),_callee3,this,[[19,32,35,38]])}))),function getSound(t,r,a){return o.apply(this,arguments)})},{key:"playMoneySound",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){var t,r,a,o=arguments;return _regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:if(t=o.length>0&&void 0!==o[0]&&o[0],game.modules.get("gAudioBundle-3")){i.next=3;break}return i.abrupt("return");case 3:return a=(r=["modules/gAudioBundle-3/src/Mint Coins And Money/Coin_Slide_Carpet.ogg","modules/gAudioBundle-3/src/Mint Coins And Money/Coins_Drop_Carpet_06.ogg","modules/gAudioBundle-3/src/Mint Coins And Money/Coins_Bottlecaps_Drop.ogg","modules/gAudioBundle-3/src/Mint Coins And Money/Coins_In_Sack_Held_By_Drawstring_06.ogg","modules/gAudioBundle-3/src/Money/Money_Coins_Handle.ogg"])[Math.floor(Math.random()*r.length)],i.next=7,this.playSoundPath(a,t);case 7:case"end":return i.stop()}}),_callee4,this)}))),function playMoneySound(){return a.apply(this,arguments)})},{key:"playEquipmentWearStatusChange",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r,a,o,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee5$(p){for(;;)switch(p.prev=p.next){case 0:r=l.length>1&&void 0!==l[1]&&l[1],a=[],o=game.modules.get("gAudioBundle-2"),i=game.modules.get("gAudioBundle-3"),c=game.modules.get("gAudioBundle-4"),p.t0=t.type,p.next="armor"===p.t0?8:"meleeweapon"===p.t0?10:"rangeweapon"===p.t0?13:15;break;case 8:return o&&a.push("modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Foley_Soldier_Gear_Equipment_Metal_Cloth_Heavy_Movement_Light_08.ogg"),p.abrupt("break",15);case 10:return o&&a.push("modules/gAudioBundle-2/src/Gore/Melee_Sword_Attack_04.ogg"),i&&a.push("modules/gAudioBundle-3/src/Medieval Armor And Impacts/Weapon_Impact_Parry_01.ogg"),p.abrupt("break",15);case 13:return c&&a.push("modules/gAudioBundle-4/src/Super Heroes Sound Design/Hawk's_Arrow_Flies_Bow_And_Arrow_Shoot_2.ogg"),p.abrupt("break",15);case 15:if(0==a.length&&o&&a.push("modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Foley_Sports_Bag_Grab_Pickup_Catch_04.ogg","modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Footstep_Ice_Crunchy_Run_01.ogg","modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Footstep_Ice_Crunchy_Run_02.ogg"),!(a.length>0)){p.next=20;break}return u=a[Math.floor(Math.random()*a.length)],p.next=20,this.playSoundPath(u,r,.5);case 20:case"end":return p.stop()}}),_callee5,this)}))),function playEquipmentWearStatusChange(t){return r.apply(this,arguments)})},{key:"playSoundPath",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){var r,a,o=arguments;return _regeneratorRuntime().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],a=o.length>2&&void 0!==o[2]?o[2]:.8,game.settings.get("dsk","inventorySound")){i.next=4;break}return i.abrupt("return");case 4:try{AudioHelper.play({src:t,volume:a,loop:!1},r)}catch(r){console.warn("Could not play item sound effect ".concat(t))}case 5:case"end":return i.stop()}}),_callee6)}))),function playSoundPath(r){return t.apply(this,arguments)})}]),DSKSoundEffect}();_defineProperty(o,"sounds",void 0),_defineProperty(o,"triedInit",!1)},832:(t,r,a)=>{a.d(r,{Z:()=>u});var o=a(231),i=a(846),c=a(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var u=function(){function DSKUtility(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKUtility)}var t,r,a,u,l,p,d;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKUtility,null,[{key:"chatDataSetup",value:function chatDataSetup(t,r,a){var o={user:game.user.id,rollMode:r||game.settings.get("core","rollMode"),content:t};return["gmroll","blindroll"].includes(o.rollMode)&&(o.whisper=ChatMessage.getWhisperRecipients("GM").map((function(t){return t.id}))),"blindroll"===o.rollMode?o.blind=!0:"selfroll"===o.rollMode&&(o.whisper=[game.user]),a&&(o.speaker=ChatMessage.getSpeaker(),o.whisper=ChatMessage.getWhisperRecipients(a)),o}},{key:"categoryLocalization",value:function categoryLocalization(t){return game.i18n.localize("ITEM.Type".concat(t.slice(0,1).toUpperCase()).concat(t.slice(1).toLowerCase()))}},{key:"fateAvailable",value:function fateAvailable(t,r){return t.system.stats.schips.value>0}},{key:"isActiveGM",value:function isActiveGM(){var t=game.users.find((function(t){return t.active&&t.isGM}));return t&&game.user.id==t.id}},{key:"parseAbilityString",value:function parseAbilityString(t){return{original:t.replace(/ (FP|SR|FW|SP)?[+-]?\d{1,2}$/,"").trim(),name:t.replace(/\((.+?)\)/g,"()").replace(/ (FP|SR|FW|SP)?[+-]?\d{1,2}$/,"").trim(),step:Number((t.match(/[+-]?\d{1,2}$/)||[1])[0]),special:(t.match(/\(([^()]+)\)/)||["",""])[1],type:t.match(/ (FP|SP)[+-]?\d{1,2}/)?"FP":t.match(/ (FW|SR)[+-]?\d{1,2}/)?"FW":"",bonus:null!=t.match(/[-+]\d{1,2}$/)}}},{key:"allSkills",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t,r,a=arguments;return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:["skill","combatskill","specialability"],r="de"==game.i18n.lang?"dsk.default":"dsk.defaulten",o.next=4,this.getCompendiumEntries(r,t);case 4:return o.abrupt("return",o.sent);case 5:case"end":return o.stop()}}),_callee,this)}))),function allSkills(){return d.apply(this,arguments)})},{key:"escapeRegex",value:function escapeRegex(t){return("string"==typeof t||t instanceof String?t:"").replace(/[-[/\]{}()*+?.,\\^$|#\s]/g,"\\$&")}},{key:"replaceDies",value:function replaceDies(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=/( |^)(\d{1,2})?[wWdD][0-9]+((\+|-)[0-9]+)?/g,o=r?"":"/roll ";return t.replace(a,(function(t){return" [[".concat(o).concat(t.replace(/[DwW]/,"d"),"]]")}))}},{key:"toObjectIfPossible",value:function toObjectIfPossible(t){return"function"==typeof t.toObject?t.toObject(!1):duplicate(t)}},{key:"allSkillsList",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,a,o,i,c,u,l,p=arguments;return _regeneratorRuntime().wrap((function _callee2$(d){for(;;)switch(d.prev=d.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:["skill","combatskill","specialability"],d.next=3,this.allSkills(t);case 3:r=d.sent,a=[],o=[],i=[],c=_createForOfIteratorHelper(r);try{for(c.s();!(u=c.n()).done;)"skill"==(l=u.value).type?a.push(l.name):"combatskill"==l.type&&("melee"==l.system.weapontype?i.push(l.name):o.push(l.name))}catch(t){c.e(t)}finally{c.f()}return d.abrupt("return",{skills:a.sort((function(t,r){return t.localeCompare(r)})),rangeSkills:o.sort((function(t,r){return t.localeCompare(r)})),meleeSkills:i.sort((function(t,r){return t.localeCompare(r)}))});case 10:case"end":return d.stop()}}),_callee2,this)}))),function allSkillsList(){return p.apply(this,arguments)})},{key:"replaceConditions",value:function replaceConditions(t){return t?t.replace(c.Z.statusRegex.regex,(function(t){return(0,i.q)([t])})):t}},{key:"moduleEnabled",value:function moduleEnabled(t){return game.modules.get(t)&&game.modules.get(t).active}},{key:"getSpeaker",value:function getSpeaker(t){var r=ChatMessage.getSpeakerActor(t);if(!r&&canvas.tokens){var a=canvas.tokens.get(t.token);a&&(r=a.actor)}if(!r){var o=game.scenes.get(t.scene);try{var i;o&&(r=null===(i=new Token(o.getEmbeddedDocument("Token",t.token)))||void 0===i?void 0:i.actor)}catch(t){}}return r}},{key:"showArtwork",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r,a,o,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:r=t.img,a=t.name,o=t.uuid,i=t.isOwner,c=u.length>1&&void 0!==u[1]&&u[1],new ImagePopout(r,{title:c?i?a:"-":a,shareable:!0,uuid:o}).render(!0);case 3:case"end":return l.stop()}}),_callee3)}))),function showArtwork(t){return l.apply(this,arguments)})},{key:"renderToggle",value:function renderToggle(t){t.rendered?t._minimized?t.maximize():t.close():t.render(!0)}},{key:"skillByName",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r,a;return _regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return r=game.packs.get("de"==game.i18n.lang?"dsk.default":"dsk.defaulten"),o.next=3,r.getIndex();case 3:return a=r.index.find((function(r){return r.name===t})),o.next=6,r.getDocument(a._id);case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}}),_callee4)}))),function skillByName(t){return u.apply(this,arguments)})},{key:"emptyActor",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var t,r,a=arguments;return _regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:12,Array.isArray(t)||(t=[t,t,t,t,t,t,t,t]),i.next=4,o.Z.create({name:"Alricat",type:"npc",items:[],system:{stats:{LeP:{value:50},schips:{}},characteristics:{mu:{initial:t[0]},kl:{initial:t[1]},in:{initial:t[2]},ch:{initial:t[3]},ff:{initial:t[4]},ge:{initial:t[5]},ko:{initial:t[6]},kk:{initial:t[7]}}}},{temporary:!0,noHook:!0});case 4:return(r=i.sent).prepareData(),i.abrupt("return",r);case 7:case"end":return i.stop()}}),_callee5)}))),function emptyActor(){return a.apply(this,arguments)})},{key:"calcTokenSize",value:function calcTokenSize(t,r){var a=game.dsk.config.tokenSizeCategories[t.system.details.size];if(a)if(a<1)mergeObject(r,{texture:{scaleX:a,scaleY:a},width:1,height:1});else{var o=Math.floor(a),i=Math.max(a/o,.25);mergeObject(r,{width:o,height:o,texture:{scaleX:i,scaleY:i}})}}},{key:"_calculateAdvCost",value:function _calculateAdvCost(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return c.Z.advancementCosts[r][Number(t)+a]}},{key:"getCompendiumEntries",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){var a,o,i;return _regeneratorRuntime().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,game.packs.get(t);case 2:if(a=c.sent){c.next=6;break}return ui.notifications.error("No content found"),c.abrupt("return",[]);case 6:return o=Array.isArray(r)?r:[r],c.next=9,a.getDocuments({type:{$in:o}});case 9:return i=c.sent,c.abrupt("return",i.map((function(t){return t.toObject()})));case 11:case"end":return c.stop()}}),_callee6)}))),function getCompendiumEntries(t,a){return r.apply(this,arguments)})},{key:"getFolderForType",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,a,o,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee7$(p){for(;;)switch(p.prev=p.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:null,a=l.length>2&&void 0!==l[2]?l[2]:null,o=l.length>3&&void 0!==l[3]?l[3]:0,i=l.length>4&&void 0!==l[4]?l[4]:"",c=l.length>5&&void 0!==l[5]?l[5]:void 0,p.next=7,game.folders.contents.find((function(o){var i;return o.name==a&&o.type==t&&(null===(i=o.folder)||void 0===i?void 0:i.id)==r}));case 7:if(u=p.sent){p.next=12;break}return p.next=11,Folder.create({name:a,type:t,sorting:c||("JournalEntry"==t?"a":"m"),color:i,sort:o,parent:r});case 11:u=p.sent;case 12:return p.abrupt("return",u);case 13:case"end":return p.stop()}}),_callee7)}))),function getFolderForType(r){return t.apply(this,arguments)})}]),DSKUtility}()},404:(t,r,a)=>{a.d(r,{Z:()=>c});var o=a(930),i=a(832);function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var c=function(){function ItemRulesDSK(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ItemRulesDSK)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(ItemRulesDSK,null,[{key:"simpleAdoption",value:function simpleAdoption(t,r,a,o){if(o[a].activeEffect){var i=duplicate(o[a].activeEffect);i.value="".concat(r.name," ").concat(i.value);var c={changes:[i],duration:{},icon:"icons/svg/aura.svg",label:"".concat(a," (").concat(r.name,")"),transfer:!0,flags:{dsk:{value:null,editable:!0,description:"".concat(a," (").concat(r.name,")"),custom:!0,auto:null,manual:0,hideOnToken:!0,hidePlayers:!1}},tint:""};t.effects.push(c)}}},{key:"reverseAdoptionCalculation",value:function reverseAdoptionCalculation(t,r,a){for(var i=[o.Z.vantagesNeedingAdaption,o.Z.AbilitiesNeedingAdaption],c=function _loop(){var o=l[u];if(o[r.name]){var i=t.items.find((function(t){return o[r.name].items.includes(t.type)&&t.name==r.special}));return i&&(a.system.ap=a.system.ap.split("/")[i.system.StF.charCodeAt(0)-65],ItemRulesDSK.simpleAdoption(a,i,r.name,o)),"break"}},u=0,l=i;u<l.length;u++){if("break"===c())break}return a}},{key:"hasItem",value:function hasItem(t,r,a){return null!=t.items.find((function(t){return a.includes(t.type)&&t.name==r}))}},{key:"itemStep",value:function itemStep(t,r,a){var o=t.items.find((function(t){return a.includes(t.type)&&t.name==r}));return o?Number(o.system.level):0}},{key:"itemAsModifier",value:function itemAsModifier(t,r,a,o){var c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=[],p=c?new RegExp("^".concat(i.Z.escapeRegex("".concat(r," (")))):new RegExp("^".concat(i.Z.escapeRegex(r),"$")),d=t.items.find((function(t){return o.includes(t.type)&&p.test(t.name)}));return d&&l.push({name:d.name,value:Number(d.system.level)*a,selected:u,source:d.name}),l}}]),ItemRulesDSK}();!function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}(c,"children",{})},586:(t,r,a)=>{a.d(r,{Z:()=>migrateWorld,j:()=>showPatchViewer});var o=a(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function setupDefaulTokenConfig(){return _setupDefaulTokenConfig.apply(this,arguments)}function _setupDefaulTokenConfig(){return(_setupDefaulTokenConfig=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var t;return _regeneratorRuntime().wrap((function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:if(game.settings.get("dsk","defaultConfigFinished")){r.next=13;break}return console.log("Configuring default token settings"),(t=game.settings.get("core","defaultToken")).displayName=CONST.TOKEN_DISPLAY_MODES.OWNER_HOVER,t.displayBars=CONST.TOKEN_DISPLAY_MODES.OWNER_HOVER,t.disposition=CONST.TOKEN_DISPOSITIONS.NEUTRAL,t.bar1={attribute:"status.wounds"},r.next=9,game.settings.set("core","defaultToken",t);case 9:return r.next=11,game.settings.set("core","leftClickRelease",!0);case 11:return r.next=13,game.settings.set("dsk","defaultConfigFinished",!0);case 13:case"end":return r.stop()}}),_callee5)})))).apply(this,arguments)}function migrateDSK(t,r){return _migrateDSK.apply(this,arguments)}function _migrateDSK(){return(_migrateDSK=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){return _regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,showPatchViewer();case 2:return t.next=4,game.settings.set("dsk","migrationVersion",r);case 4:case"end":return t.stop()}}),_callee6)})))).apply(this,arguments)}function showPatchViewer(){return _showPatchViewer.apply(this,arguments)}function _showPatchViewer(){return(_showPatchViewer=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){var t,r;return _regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("systems/dsk/lazy/updatenotes.json");case 2:return t=a.sent,a.next=5,t.json();case 5:r=a.sent,new i(r).render(!0);case 8:case"end":return a.stop()}}),_callee7)})))).apply(this,arguments)}function migrateWorld(){Hooks.once("ready",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t,r;return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(game.user.isGM){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,setupDefaulTokenConfig();case 4:return a.next=6,game.settings.get("dsk","migrationVersion");case 6:if(t=a.sent,t<(r=23)){a.next=11;break}return a.abrupt("return");case 11:migrateDSK(t,r);case 12:case"end":return a.stop()}}),_callee)}))))}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(PatchViewer,Application);var r,a=_createSuper(PatchViewer);function PatchViewer(t,r){var o;return function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,PatchViewer),(o=a.call(this,r)).json=t,o}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(PatchViewer,[{key:"getData",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){var t,r,a,i,c,u,l,p,d,h,y;return _regeneratorRuntime().wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return t=this.json.notes[this.json.notes.length-1],r=this.json.default.replace(/VERSION/g,t.version),a="<h1>CHANGELOG</h1><p>".concat(r,". </br><b>Important updates</b>: ").concat(t.text,'</p><p>For details or proposals visit our github page at <a href="https://github.com/Plushtoast/dsk-foundryVT" target="_blank">Github</a> or show the <a style="text-decoration: underline;color:#ff6400;" class="showPatchViewer">Full Changelog in Foundry</a>. Have fun.</p>'),m.next=5,ChatMessage.create(o.Z.chatDataSetup(a,"roll"));case 5:return i=game.i18n.lang,m.next=8,renderTemplate("systems/dsk/lazy/patchhtml/changelog_".concat(i,"_").concat(t.version,".html"));case 8:return c=m.sent,m.next=11,renderTemplate("systems/dsk/lazy/patchhtml/news_".concat(i,"_").concat(t.version,".html"));case 11:if(u=m.sent,l=[this.json.notes[this.json.notes.length-2]].filter((function(t){return null!=t})),!(p=l.length>0)){m.next=20;break}return m.next=17,Promise.all(l.map(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,renderTemplate("systems/dsk/lazy/patchhtml/changelog_".concat(i,"_").concat(t.version,".html"));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}()));case 17:m.t0=m.sent,m.next=21;break;case 20:m.t0=[];case 21:if(d=m.t0,!p){m.next=28;break}return m.next=25,Promise.all(l.map(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){return _regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,renderTemplate("systems/dsk/lazy/patchhtml/news_".concat(i,"_").concat(t.version,".html"));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()));case 25:m.t1=m.sent,m.next=29;break;case 28:m.t1=[];case 29:return h=m.t1,m.next=32,renderTemplate("systems/dsk/lazy/patchhtml/modules_".concat(i,".html"));case 32:return y=m.sent,m.abrupt("return",{patchName:r,changelog:c,news:u,prevVersions:l,prevChangeLogs:d,prevNews:h,modules:y});case 34:case"end":return m.stop()}}),_callee4,this)}))),function getData(){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=_get(_getPrototypeOf(PatchViewer),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"newcontent"}],mergeObject(t,{classes:t.classes.concat(["dsk","largeDialog","patches"]),width:740,height:740,title:"Changelog"}),t.template="systems/dsk/templates/system/patchviewer.html",t.resizable=!0,t}}]),PatchViewer}()},604:(t,r,a)=>{a.d(r,{Z:()=>i});a(122),a(608);var o=a(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function OnUseEffect(t){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OnUseEffect),this.item=t}var t,r,a,i,c,u,l,p;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(OnUseEffect,[{key:"callMacro",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var a,o,i,c,u,l,p,d,h,y=arguments;return _regeneratorRuntime().wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return a=y.length>2&&void 0!==y[2]?y[2]:{},o=game.packs.get(t),m.next=4,o.getDocuments({name:r});case 4:if((i=m.sent).length){m.next=26;break}c=_createForOfIteratorHelper(game.packs.filter((function(t){return"Macro"==t.documentName&&/\(internal\)/.test(t.metadata.label)}))),m.prev=7,c.s();case 9:if((u=c.n()).done){m.next=18;break}return l=u.value,m.next=13,l.getDocuments({name:r});case 13:if(!(i=m.sent).length){m.next=16;break}return m.abrupt("break",18);case 16:m.next=9;break;case 18:m.next=23;break;case 20:m.prev=20,m.t0=m.catch(7),c.e(m.t0);case 23:return m.prev=23,c.f(),m.finish(23);case 26:if(p={},!i.length){m.next=43;break}return d="(async () => {".concat(i[0].command,"})()"),h=Function("args","actor","item",d),m.prev=30,a.result=p,m.next=34,h.call(this,a,this.item.actor,this.item);case 34:m.next=41;break;case 36:m.prev=36,m.t1=m.catch(30),ui.notifications.error("There was an error in your macro syntax. See the console (F12) for details"),console.error(m.t1),p.error=!0;case 41:m.next=44;break;case 43:ui.notifications.error(game.i18n.format("dsk.DSKError.macroNotFound",{name:r}));case 44:return m.abrupt("return",p);case 45:case"end":return m.stop()}}),_callee,this,[[7,20,23,26],[30,36]])}))),function callMacro(t,r){return p.apply(this,arguments)})},{key:"executeOnUseEffect",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,a;return _regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:if(game.user.can("MACRO_SCRIPT")){o.next=2;break}return o.abrupt("return",ui.notifications.warn("You are not allowed to use JavaScript macros."));case 2:if(this.item.actor){o.next=4;break}return o.abrupt("return");case 4:return t=OnUseEffect.getOnUseEffect(this.item),r="(async () => {".concat(t,"})()"),a=Function("item","actor",r),o.prev=7,o.next=10,a.call(this,this.item,this.item.actor);case 10:o.next=17;break;case 12:o.prev=12,o.t0=o.catch(7),ui.notifications.error("There was an error in your macro syntax. See the console (F12) for details"),console.error(o.t0),console.warn(o.t0.stack);case 17:case"end":return o.stop()}}),_callee2,this,[[7,12]])}))),function executeOnUseEffect(){return l.apply(this,arguments)})},{key:"automatedAnimation",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r=arguments;return _regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:r.length>1&&void 0!==r[1]&&r[1],o.Z.moduleEnabled("autoanimations")&&console.warn("Animations for on use effects not enabled yet");case 2:case"end":return t.stop()}}),_callee3)}))),function automatedAnimation(t){return u.apply(this,arguments)})},{key:"effectDummy",value:function effectDummy(t,r,a){return{label:t,icon:"icons/svg/aura.svg",changes:r,duration:a,flags:{dsk:{value:null,editable:!0,customizable:!0,description:t,custom:!0}}}}},{key:"socketedConditionAddActor",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r){var a,o,i,c,u,l;return _regeneratorRuntime().wrap((function _callee4$(p){for(;;)switch(p.prev=p.next){case 0:if(!game.user.isGM){p.next=31;break}(a="string"==typeof r)&&((r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))).label=game.i18n.localize(r.label)),o=[],i=_createForOfIteratorHelper(t),p.prev=5,i.s();case 7:if((c=i.n()).done){p.next=19;break}if(u=c.value,!a){p.next=14;break}return p.next=12,u.addCondition(r,1,!1,!1);case 12:p.next=16;break;case 14:return p.next=16,u.addCondition(r);case 16:o.push(u.name);case 17:p.next=7;break;case 19:p.next=24;break;case 21:p.prev=21,p.t0=p.catch(5),i.e(p.t0);case 24:return p.prev=24,i.f(),p.finish(24);case 27:return p.next=29,this.createInfoMessage(r,o);case 29:p.next=33;break;case 31:l={id:this.item.uuid,data:r,actors:t.map((function(t){return t.id}))},game.socket.emit("system.dsk",{type:"socketedConditionAddActor",payload:l});case 33:case"end":return p.stop()}}),_callee4,this,[[5,21,24,27]])}))),function socketedConditionAddActor(t,r){return c.apply(this,arguments)})},{key:"createInfoMessage",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t,r){var a,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee5$(l){for(;;)switch(l.prev=l.next){case 0:if(a=!(u.length>2&&void 0!==u[2])||u[2],!r.length){l.next=6;break}return i=a?"ActiveEffects.appliedEffect":"ActiveEffects.removedEffect",c=game.i18n.format(i,{source:t.label,target:r.join(", ")}),l.next=6,ChatMessage.create(o.Z.chatDataSetup(c));case 6:case"end":return l.stop()}}),_callee5)}))),function createInfoMessage(t,r){return i.apply(this,arguments)})},{key:"socketedRemoveCondition",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){var a,o,i,c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee6$(y){for(;;)switch(y.prev=y.next){case 0:if(a=h.length>2&&void 0!==h[2]?h[2]:1,!game.user.isGM){y.next=29;break}o=[],i=_createForOfIteratorHelper(t),y.prev=4,i.s();case 6:if((c=i.n()).done){y.next=15;break}if(u=c.value,!(l=canvas.tokens.get(u)).actor){y.next=13;break}return y.next=12,l.actor.removeCondition(r,a,!1);case 12:o.push(l.name);case 13:y.next=6;break;case 15:y.next=20;break;case 17:y.prev=17,y.t0=y.catch(4),i.e(y.t0);case 20:return y.prev=20,i.f(),y.finish(20);case 23:return(p=CONFIG.statusEffects.find((function(t){return t.id==r}))).label=game.i18n.localize(p.label),y.next=27,this.createInfoMessage(p,o,!1);case 27:y.next=31;break;case 29:d={id:this.item.uuid,coreId:r,targets:t},game.socket.emit("system.dsk",{type:"socketedRemoveCondition",payload:d});case 31:case"end":return y.stop()}}),_callee6,this,[[4,17,20,23]])}))),function socketedRemoveCondition(t,r){return a.apply(this,arguments)})},{key:"socketedActorTransformation",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t,r){var a,o,i,c,u;return _regeneratorRuntime().wrap((function _callee7$(l){for(;;)switch(l.prev=l.next){case 0:if(!game.user.isGM){l.next=22;break}a=_createForOfIteratorHelper(t),l.prev=2,a.s();case 4:if((o=a.n()).done){l.next=12;break}if(i=o.value,!(c=canvas.tokens.get(i)).actor){l.next=10;break}return l.next=10,c.actor.update(r);case 10:l.next=4;break;case 12:l.next=17;break;case 14:l.prev=14,l.t0=l.catch(2),a.e(l.t0);case 17:return l.prev=17,a.f(),l.finish(17);case 20:l.next=24;break;case 22:u={id:this.item.uuid,targets:t,update:r},game.socket.emit("system.dsk",{type:"socketedActorTransformation",payload:u});case 24:case"end":return l.stop()}}),_callee7,this,[[2,14,17,20]])}))),function socketedActorTransformation(t,a){return r.apply(this,arguments)})},{key:"socketedConditionAdd",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r){var a,o,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:if(!game.user.isGM){d.next=33;break}(a="string"==typeof r)&&((r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))).label=game.i18n.localize(r.label)),o=[],i=_createForOfIteratorHelper(t),d.prev=5,i.s();case 7:if((c=i.n()).done){d.next=21;break}if(u=c.value,!(l=canvas.tokens.get(u)).actor){d.next=19;break}if(!a){d.next=16;break}return d.next=14,l.actor.addCondition(r,1,!1,!1);case 14:d.next=18;break;case 16:return d.next=18,l.actor.addCondition(r);case 18:o.push(l.name);case 19:d.next=7;break;case 21:d.next=26;break;case 23:d.prev=23,d.t0=d.catch(5),i.e(d.t0);case 26:return d.prev=26,i.f(),d.finish(26);case 29:return d.next=31,this.createInfoMessage(r,o);case 31:d.next=35;break;case 33:p={id:this.item.uuid,data:r,targets:t},game.socket.emit("system.dsk",{type:"socketedConditionAdd",payload:p});case 35:case"end":return d.stop()}}),_callee8,this,[[5,23,26,29]])}))),function socketedConditionAdd(r,a){return t.apply(this,arguments)})}],[{key:"getOnUseEffect",value:function getOnUseEffect(t){return t.getFlag("dsk","onUseEffect")}}]),OnUseEffect}()},448:(t,r,a)=>{a.d(r,{Z:()=>p});var o=a(231),i=a(140),c=a(61),u=a(614),l=a(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var p=function(){function OpposedDSK(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OpposedDSK)}var t,r,a,p,d,h,y;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(OpposedDSK,null,[{key:"handleOpposedTarget",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,a,o;return _regeneratorRuntime().wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:if(t){i.next=2;break}return i.abrupt("return");case 2:if(r=l.Z.getSpeaker(t.speaker)){i.next=5;break}return i.abrupt("return");case 5:return a=t.flags.data.postData,o=t.flags.data.preData,game.user.targets.size&&t.flags.data.isOpposedTest&&!t.flags.data.defenderMessage&&!t.flags.data.attackerMessage&&(console.log("start opposed"),OpposedDSK.createOpposedTest(r,t,a,o)),i.next=10,this.showDamage(t);case 10:return i.next=12,this.showSpellWithoutTarget(t);case 12:case"end":return i.stop()}}),_callee,this)}))),function handleOpposedTarget(t){return y.apply(this,arguments)})},{key:"createOpposedTest",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,a,o){var i;return _regeneratorRuntime().wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:i=r.speaker.token?canvas.tokens.get(r.speaker.token).document:t.prototypeToken,a.successLevel>0?game.user.targets.forEach(function(){var c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(c){var u;return _regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:if(!c.actor){l.next=10;break}l.t0=a.rollType,l.next="weapon"===l.t0?4:7;break;case 4:return l.next=6,OpposedDSK.evaluateAttack(t,r,a,o,i,c);case 6:return l.abrupt("break",10);case 7:return u=OpposedDSK.opposeMessage(i,c,!1),l.next=10,ChatMessage.create((p={user:game.user.id,content:u,speaker:r.speaker},d="flags.unopposeData",h={attackMessageId:r.id,targetSpeaker:{scene:c.scene.id,token:c.id,alias:c.document.name}},d in p?Object.defineProperty(p,d,{value:h,enumerable:!0,configurable:!0,writable:!0}):p[d]=h,p));case 10:case"end":return l.stop()}var p,d,h}),_callee2)})));return function(t){return c.apply(this,arguments)}}()):game.user.targets.forEach(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){return _regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(!t.actor){a.next=3;break}return a.next=3,ChatMessage.create({user:game.user.id,content:OpposedDSK.opposeMessage(i,t,!0),speaker:r.speaker});case 3:case"end":return a.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}());case 2:case"end":return c.stop()}}),_callee4)}))),function createOpposedTest(t,r,a,o){return h.apply(this,arguments)})},{key:"evaluateAttack",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t,r,a,o,i,c){var u,l,p,d;return _regeneratorRuntime().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:if(!(a.qualityStep>0)){t.next=11;break}return a.source=o.source,u=OpposedDSK._calculateOpposedDamage(a,c),l=[0!=u.armorMod?"".concat(u.armorMod+" "+game.i18n.localize("dsk.Modifier")):"",1!=u.armorMultiplier?"*"+u.armorMultiplier+" "+game.i18n.localize("dsk.Modifier"):"",0!=u.spellArmor?"".concat(u.spellArmor," ").concat(game.i18n.localize("dsk.spellArmor")):""].join(""),p="<b>".concat(game.i18n.localize("dsk.damage"),"</b>: ").concat(u.damage,'<i class="lighticon fa attackWeaponless" data-tooltip="Roll"></i> - <span data-tooltip="').concat(l,'">').concat(u.armor,'</span><i class="lighticon fa fa-shield-alt" data-tooltip="protection"></i> = ').concat(u.sum),d={winner:"attacker",damage:{description:p,value:u.sum,sp:u.damage}},d=OpposedDSK.formatOpposedResult(d,i,c,a),t.next=9,OpposedDSK.renderOpposedResult(d,{});case 9:return t.next=11,OpposedDSK.playAutomatedJBA2(d.speakerAttack,d.speakerDefend,d);case 11:case"end":return t.stop()}}),_callee5)}))),function evaluateAttack(t,r,a,o,i,c){return d.apply(this,arguments)})},{key:"_calculateOpposedDamage",value:function _calculateOpposedDamage(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.actor;a.origin=t.source,a.damage=t.damage;var u,l=c.Z.applyRollTransformation(i,a,5).options.damage,p=o.Z.armorValue(i,a),d=(p.wornArmor,p.armor),h=[],y=0,m=t.armorPen||[],g=_createForOfIteratorHelper(m);try{for(g.s();!(u=g.n()).done;){var v=u.value;/^\*/.test(v)?h.push(Number(v.replace("*",""))):y+=Number(v)}}catch(t){g.e(t)}finally{g.f()}var _=0;["ahnengabe"].includes(t.source.type)&&(_+=i.system.spellArmor||0),d+=y;var b=h.reduce((function(t,r){return t*r}),1);return d=Math.max(Math.round(d*b),0),{damage:l,armor:d+=_,armorMod:y,spellArmor:_,armorMultiplier:b,sum:l-d}}},{key:"formatOpposedResult",value:function formatOpposedResult(t,r,a,o){var i=t.differenceSL?"winsFP":"wins";return"attacker"==t.winner?(t.result=game.i18n.format("dsk.OPPOSED."+i,{winner:r.name,loser:a.name,SL:t.differenceSL}),t.img=r.img):"defender"==t.winner&&(t.result=game.i18n.format("dsk.OPPOSED."+i,{winner:a.name,loser:r.name,SL:t.differenceSL}),t.img=a.img),t.speakerAttack=OpposedDSK.tokenDude(r,o),t.speakerDefend=OpposedDSK.tokenDude(a,{}),t}},{key:"tokenDude",value:function tokenDude(t,r){var a,o,i;return{speaker:{token:t.id,actor:null===(a=t.actor)||void 0===a?void 0:a.id,scene:null===(o=canvas.scene)||void 0===o?void 0:o.id},img:OpposedDSK.videoOrImgTag((null===(i=t.document)||void 0===i?void 0:i.texture.src)||t.texture.src),testResult:r}}},{key:"renderOpposedResult",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){var r,a,o,i=arguments;return _regeneratorRuntime().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},c.next=3,game.settings.get("dsk","hideOpposedDamage");case 3:return t.hideData=c.sent,c.next=6,renderTemplate("systems/dsk/templates/chat/roll/opposed-result.html",t);case 6:return a=c.sent,o={user:game.user.id,content:a,"flags.opposeData":t,"flags.hideData":t.hideData,whisper:r.whisper,blind:r.blind},c.next=10,ChatMessage.create(o);case 10:case"end":return c.stop()}}),_callee6)}))),function renderOpposedResult(t){return p.apply(this,arguments)})},{key:"opposeMessage",value:function opposeMessage(t,r,a){return'<div class="opposed-message">\n            <b>'.concat(t.name,"</b> ").concat(game.i18n.localize("dsk.ROLL.Targeting")," <b>").concat(r.document.name,"</b> ").concat(a?game.i18n.localize("dsk.ROLL.failed"):"",'\n            </div>\n            <div class="opposed-tokens row-section">\n                <div class="col two attacker">').concat(OpposedDSK.videoOrImgTag(t.texture.src),'</div>\n                <div class="col two defender">').concat(OpposedDSK.videoOrImgTag(r.document.texture.src),"</div>\n            </div>\n             ")}},{key:"playAutomatedJBA2",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t,r,a){var o,c,u,p,d;return _regeneratorRuntime().wrap((function _callee7$(h){for(;;)switch(h.prev=h.next){case 0:if(!l.Z.moduleEnabled("autoanimations")){h.next=12;break}if(o=l.Z.getSpeaker(t.speaker).getActiveTokens()[0],c=l.Z.getSpeaker(r.speaker).getActiveTokens()[0],o&&o.actor&&c&&c.actor){h.next=5;break}return h.abrupt("return");case 5:if((u=o.actor.items.get(t.testResult.source._id))||(u=new i.Z(t.testResult.source,{temporary:!0})),u){h.next=9;break}return h.abrupt("return");case 9:p=[c],d="attacker"==a.winner?p:[],AutomatedAnimations.playAnimation(o,u,{targets:p,hitTargets:d,playOnMiss:!0});case 12:case"end":return h.stop()}}),_callee7)}))),function playAutomatedJBA2(t,r,o){return a.apply(this,arguments)})},{key:"videoOrImgTag",value:function videoOrImgTag(t){return/\.webm$/.test(t)?'<video loop autoplay src="'.concat(t,'" width="50" height="50"></video>'):'<img src="'.concat(t,'" width="50" height="50"/>')}},{key:"showDamage",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t){var r,a=arguments;return _regeneratorRuntime().wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:if(r=a.length>1&&void 0!==a[1]&&a[1],!game.user.isGM){o.next=8;break}if(r&&t.flags.data.hideDamage||!t.flags.data.postData.damageRoll){o.next=6;break}return o.next=5,t.update({content:t.content.replace('data-hide-damage="'.concat(!r,'"'),'data-hide-damage="'.concat(r,'"')),"flags.data.hideDamage":r});case 5:r||u.Z._addRollDiceSoNice(t.flags.data.preData,Roll.fromData(t.flags.data.postData.damageRoll),game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration("damage"));case 6:o.next=9;break;case 8:game.socket.emit("system.dsk",{type:"showDamage",payload:{id:t.id,hide:r}});case 9:case"end":return o.stop()}}),_callee8)}))),function showDamage(t){return r.apply(this,arguments)})},{key:"showSpellWithoutTarget",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t){var r,a,o,i;return _regeneratorRuntime().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if(!l.Z.moduleEnabled("autoanimations")){c.next=13;break}if((r=getProperty(t,"flags.data"))&&!r.isOpposedTest){c.next=4;break}return c.abrupt("return");case 4:if(!((getProperty(r,"postData.result")||-1)>0)){c.next=13;break}if((a=l.Z.getSpeaker(r.postData.speaker).getActiveTokens()[0])&&a.actor){c.next=9;break}return c.abrupt("return");case 9:o=Array.from(game.user.targets),i=a.actor.items.get(r.preData.source._id),o.length||(o=[a]),AutomatedAnimations.playAnimation(a,i,{targets:o});case 13:case"end":return c.stop()}}),_callee9)}))),function showSpellWithoutTarget(r){return t.apply(this,arguments)})}]),OpposedDSK}()},903:(t,r,a)=>{a.d(r,{Z:()=>c});var o=a(530),i=a(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var c=function(){function RequestRoll(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RequestRoll)}var t,r,a;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(RequestRoll,null,[{key:"requestRoll",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var a,i,c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee$(y){for(;;)switch(y.prev=y.next){case 0:if(a=h.length>2&&void 0!==h[2]?h[2]:0,i=o.Z._getActor(),c=i.actor,u=i.tokenId,!c){y.next=15;break}game.user.updateTokenTargets([]),l={modifier:a},y.t0=t,y.next="attribute"===y.t0?8:"regeneration"===y.t0?11:13;break;case 8:return p=Object.keys(game.dsk.config.characteristics).find((function(t){return game.i18n.localize(game.dsk.config.characteristics[t])==r})),c.setupCharacteristic(p,l,u).then((function(t){c.basicTest(t)})),y.abrupt("break",15);case 11:return c.setupRegeneration("regenerate",l,u).then((function(t){c.basicTest(t)})),y.abrupt("break",15);case 13:d=c.items.find((function(a){return a.name==r&&a.type==t})),c.setupSkill(d,l,u).then((function(t){c.basicTest(t)}));case 15:case"end":return y.stop()}}),_callee)}))),function requestRoll(t,r){return a.apply(this,arguments)})},{key:"showRQMessage",value:function showRQMessage(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=r<0?" ".concat(r):r>0?" +".concat(r):"",c=o.Z.skills.find((function(r){return r.name==t})).type,u=game.i18n.format("dsk.CHATNOTIFICATION.requestRoll",{user:game.user.name,item:'<a class="roll-button request-roll" data-type="'.concat(c,'" data-modifier="').concat(r,'" data-name="').concat(t,'"><i class="fas fa-dice"></i> ').concat(t).concat(a,"</a>")});ChatMessage.create(i.Z.chatDataSetup(u))}},{key:"updateInformationRoll",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r,a){var o,c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(!((o=r.result.qualityStep||0)>0)){a.next=10;break}return a.next=4,fromUuid(t.uuid);case 4:for(c=a.sent,u=["<p><b>".concat(c.name,"</b></p>")],l=1;l<=o;l++)p="qs".concat(l),c.system[p]&&u.push("<p>".concat(c.system[p],"</p>"));d=i.Z.chatDataSetup(u.join("")),t.recipients.length&&(d.whisper=t.recipients),ChatMessage.create(d);case 10:case"end":return a.stop()}}),_callee2)}))),function updateInformationRoll(t,a,o){return r.apply(this,arguments)})},{key:"informationRequestRoll",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r,a,i,c,u,l,p,d,h,y=this;return _regeneratorRuntime().wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:if(r=t.currentTarget.dataset.mod,a=t.currentTarget.dataset.uuid,i=o.Z._getActor(),c=i.actor,u=i.tokenId,c){m.next=5;break}return m.abrupt("return");case 5:l=game.settings.get("dsk","informationDistribution"),p=[],1==l?(p=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))).push(game.user.id):2==l&&(p=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))),d={modifier:r,postFunction:{functionName:"game.dsk.apps.RequestRoll.updateInformationRoll",uuid:a,recipients:p}},h=c.items.find((function(r){return r.name==t.currentTarget.dataset.skill&&"skill"==r.type})),c.setupSkill(h,d,u).then(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r;return _regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return t.testData.opposable=!1,a.next=3,c.basicTest(t);case 3:r=a.sent,y.updateInformationRoll(d.postFunction,r);case 5:case"end":return a.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}());case 11:case"end":return m.stop()}}),_callee4)}))),function informationRequestRoll(r){return t.apply(this,arguments)})},{key:"chatListeners",value:function chatListeners(t){t.on("click",".request-roll",(function(t){var r=t.currentTarget.dataset;RequestRoll.requestRoll(r.type,r.name,Number(r.modifier)||0)})),t.on("click",".informationRequestRoll",(function(t){return RequestRoll.informationRequestRoll(t)}))}}]),RequestRoll}()},122:(t,r,a)=>{a.d(r,{Z:()=>c});var o=a(832),i=a(514);function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var c=function(){function RuleChaos(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RuleChaos)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(RuleChaos,null,[{key:"_getFunctionData",value:function _getFunctionData(t){return{data:t.currentTarget.dataset,actor:o.Z.getSpeaker({token:t.currentTarget.dataset.token,actor:t.currentTarget.dataset.actor,scene:canvas.scene?canvas.scene.id:null})}}},{key:"multipleDefenseValue",value:function multipleDefenseValue(t,r){var a=-2;return getProperty(r,"system.combatskill")==game.i18n.localize("dsk.dsk.LocalizedIDs.wrestle")&&i.Z.hasAbility(t,game.i18n.localize("dsk.LocalizedIDs.masterfulDodge"))?a=-2:i.Z.hasAbility(t,game.i18n.localize("dsk.LocalizedIDs.mightyMasterfulParry"))?a=-1:i.Z.hasAbility(t,game.i18n.localize("dsk.LocalizedIDs.masterfulParry"))&&(a=-2),Math.min(0,a)}},{key:"isYieldedTwohanded",value:function isYieldedTwohanded(t){var r=this.regex2h.test(t.name),a=t.system.worn.wrongGrip;return r&&!a||!r&&a}},{key:"obfuscateDropData",value:function obfuscateDropData(t,r){if(r){var a,o=_createForOfIteratorHelper(r);try{for(o.s();!(a=o.n()).done;){var i=a.value;mergeObject(t,{system:{obfuscation:_defineProperty({},i,!0)}})}}catch(t){o.e(t)}finally{o.f()}}}},{key:"_buildDuration",value:function _buildDuration(t){var r={duration:{startTime:game.time.worldTime,rounds:t,seconds:5*t}};return game.combat&&mergeObject(r,{duration:{combat:game.combat.id,startRound:game.combat.round,startTurn:game.combat.turn}}),r}},{key:"increment",value:function increment(t,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=t.ctrlKey?10:1,c=2==t.button?-1:1,u=getProperty(r,a)+i*c;null!=o&&(u=Math.max(o,u)),setProperty(r,a,u)}}]),RuleChaos}();_defineProperty(c,"regex2h",/\(2H/)},514:(t,r,a)=>{a.d(r,{Z:()=>c});var o=a(930),i=a(404);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var c=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(SpecialabilityRulesDSK,t);var r,a,i,c,u=_createSuper(SpecialabilityRulesDSK);function SpecialabilityRulesDSK(){return _classCallCheck(this,SpecialabilityRulesDSK),u.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(SpecialabilityRulesDSK,null,[{key:"setupFunctions",value:function setupFunctions(){}},{key:"abilityAdded",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:o.Z.addAbilityRules[r.name]&&o.Z.addAbilityRules[r.name](t,r);case 1:case"end":return a.stop()}}),_callee)}))),function abilityAdded(t,r){return c.apply(this,arguments)})},{key:"abilityRemoved",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){var a,i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:if(o.Z.removeAbilityRules[r.name]&&o.Z.removeAbilityRules[r.name](t,r),a=r.system.ap*r.system.level,/;/.test(r.system.ap))for(i=r.system.ap.split(";").map((function(t){return Number(t.trim())})),a=0,c=0;c<r.system.level;c++)a+=i[c];return u.next=5,t._updateAPs(-1*a);case 5:case"end":return u.stop()}}),_callee2)}))),function abilityRemoved(t,r){return i.apply(this,arguments)})},{key:"_specialabilityReturnFunction",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,a,i){var c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(null!=r){h.next=2;break}return h.abrupt("return");case 2:if(r=duplicate(r),null!=i&&(/,/.test(r.system.ap)&&(c="".concat(r.name.replace(" ()","")," (").concat(i.name),r.system.ap=r.system.ap.split(",")[t.items.filter((function(t){return t.type==r.type&&t.name.includes(c)})).length].trim()),SpecialabilityRulesDSK.simpleAdoption(r,i,r.name,o.Z.AbilitiesNeedingAdaption),r.name="".concat(r.name.replace(" ()","")," (").concat(i.name).concat(i.customEntry?", "+i.customEntry:"",")"),i.data&&i.system.StF&&/\//.test(r.system.ap)&&(r.system.ap=r.system.ap.split("/")[i.system.StF.charCodeAt(0)-65].trim())),!(u=t.items.find((function(t){return t.type==a&&t.name==r.name})))){h.next=23;break}if(l=duplicate(u),p=/;/.test(l.system.ap)?l.system.ap.split(";").map((function(t){return Number(t.trim())}))[l.system.level]:l.system.ap,h.t0=l.system.level+1<=l.system.max,!h.t0){h.next=13;break}return h.next=12,t.checkEnoughXP(p);case 12:h.t0=h.sent;case 13:if(!h.t0){h.next=21;break}return l.system.level+=1,h.next=17,t._updateAPs(p);case 17:return h.next=19,t.updateEmbeddedDocuments("Item",[l]);case 19:return h.next=21,SpecialabilityRulesDSK.abilityAdded(t,l);case 21:h.next=33;break;case 23:return d=r.system.ap.split(";").map((function(t){return t.trim()}))[0],h.next=26,t.checkEnoughXP(d);case 26:if(!h.sent){h.next=33;break}return h.next=29,SpecialabilityRulesDSK.abilityAdded(t,r);case 29:return h.next=31,t._updateAPs(d);case 31:return h.next=33,t.createEmbeddedDocuments("Item",[r]);case 33:case"end":return h.stop()}}),_callee3)}))),function _specialabilityReturnFunction(t,r,o,i){return a.apply(this,arguments)})},{key:"needsAdoption",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,a){var i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee4$(d){for(;;)switch(d.prev=d.next){case 0:if(!(i=o.Z.AbilitiesNeedingAdaption[r.name])){d.next=26;break}if("text"!=i.items){d.next=9;break}return d.next=5,renderTemplate("systems/dsk/templates/dialog/requires-adoption-string-dialog.html",{original:r});case 5:c=d.sent,u=function callback(o){var i={name:o.find('[name="entryselection"]').val()};SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,a,i)},d.next=22;break;case 9:if("array"!=i.items){d.next=17;break}return l=i.elems.map((function(t){return{name:t}})),d.next=13,renderTemplate("systems/dsk/templates/dialog/requires-adoption-dialog.html",{items:l,original:r,area:i.area});case 13:c=d.sent,u=function callback(o){var i=l.find((function(t){return t.name==o.find('[name="entryselection"]').val()}));SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,a,i)},d.next=22;break;case 17:return p=t.items.filter((function(t){return i.items.includes(t.type)})).sort((function(t,r){return t.name.localeCompare(r.name)})),d.next=20,renderTemplate("systems/dsk/templates/dialog/requires-adoption-dialog.html",{items:p,original:r,area:i.area});case 20:c=d.sent,u=function callback(o){var i=p.find((function(t){return t.name==o.find('[name="entryselection"]').val()}));i.customEntry=o.find('[name="custom"]').val(),SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,a,i)};case 22:return d.next=24,new Dialog({title:game.i18n.localize("dsk.DIALOG.ItemRequiresAdoption"),content:c,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:u},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 24:d.next=27;break;case 26:SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,a,null);case 27:case"end":return d.stop()}}),_callee4)}))),function needsAdoption(t,a,o){return r.apply(this,arguments)})},{key:"hasAbility",value:function hasAbility(t,r){return _get(_getPrototypeOf(SpecialabilityRulesDSK),"hasItem",this).call(this,t,r,["specialability"])}},{key:"abilityStep",value:function abilityStep(t,r){return _get(_getPrototypeOf(SpecialabilityRulesDSK),"itemStep",this).call(this,t,r,["specialability"])}},{key:"abilityAsModifier",value:function abilityAsModifier(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return _get(_getPrototypeOf(SpecialabilityRulesDSK),"itemAsModifier",this).call(this,t,r,a,["specialability"],o)}}]),SpecialabilityRulesDSK}(i.Z);i.Z.children.SpecialabilityRulesDSK=c},969:(t,r,a)=>{a.d(r,{Z:()=>i});var o=a(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(TraitRulesDSK,t);var r,a=_createSuper(TraitRulesDSK);function TraitRulesDSK(){return _classCallCheck(this,TraitRulesDSK),a.apply(this,arguments)}return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(TraitRulesDSK,null,[{key:"traitAdded",value:(r=function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(t,r){return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:if(!o.Z.addTraitRules[r.name]){a.next=3;break}return a.next=3,o.Z.addTraitRules[r.name](t,r);case 3:case"end":return a.stop()}}),_callee)}))),function traitAdded(t,a){return r.apply(this,arguments)})},{key:"hasTrait",value:function hasTrait(t,r){return _get(_getPrototypeOf(TraitRulesDSK),"hasItem",this).call(this,t,r,["trait"])}}]),TraitRulesDSK}(a(404).Z)},707:(t,r,a)=>{function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function svgAutoFit(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40;t.attr({width:.8*r,viewBox:"0 0 ".concat(r," ").concat(a)});var o=t.find("text"),i=o.get(0).getBBox(),c=r/i.width,u=a/i.height,l=c<u,p=l?c:u;isFinite(p)&&o.attr({transform:"matrix("+p+", 0, 0, "+p+", 0,0)",x:Math.max(0,(r-i.width)/2),y:.75*a/(l?1:p)})}function slist(t,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"div";if(r=t.find(r)[0]){r.classList.add("slist");var i,c=r.querySelectorAll(o),u=null,l=_createForOfIteratorHelper(c);try{for(l.s();!(i=l.n()).done;){var p=i.value;p.draggable=!0,p.addEventListener("dragstart",(function(t){u=this})),p.addEventListener("dragover",(function(t){t.preventDefault()})),p.addEventListener("drop",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var o,i,l;return _regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(t.preventDefault(),this==u){p.next=7;break}for(o=0,i=0,l=0;l<c.length;l++)u==c[l]&&(o=l),this==c[l]&&(i=l);return o<i?this.parentNode.insertBefore(u,this.nextSibling):this.parentNode.insertBefore(u,this),p.next=7,a(r);case 7:case"end":return p.stop()}}),_callee,this)})));return function(r){return t.apply(this,arguments)}}())}}catch(t){l.e(t)}finally{l.f()}}}function tinyNotification(t){var r=$(".tinyNotifications");r.length||($("body").append('<ul class="tinyNotifications"></ul>'),r=$(".tinyNotifications"));var a=$("<li>".concat(t,"</li>"));r.prepend(a),setTimeout((function(){a.remove()}),1500)}function itemFromDrop(t,r){return _itemFromDrop.apply(this,arguments)}function _itemFromDrop(){return _itemFromDrop=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){var a,o,i,c,u,l,p=arguments;return _regeneratorRuntime().wrap((function _callee2$(d){for(;;)switch(d.prev=d.next){case 0:if(o=!(p.length>2&&void 0!==p[2])||p[2],"Actor"!=t.type){d.next=8;break}return d.next=4,Actor.implementation.fromDropData(t);case 4:i=d.sent,c=r===i.id,d.next=12;break;case 8:return d.next=10,Item.implementation.fromDropData(t);case 10:i=d.sent,c=r===(null===(u=i.parent)||void 0===u?void 0:u.uuid);case 12:return l=null===(a=i)||void 0===a?void 0:a.type,o&&(i=i.toObject()),t.amount&&(i.system.quantity.value=Number(t.amount)),d.abrupt("return",{item:i,typeClass:l,selfTarget:c});case 16:case"end":return d.stop()}}),_callee2)}))),_itemFromDrop.apply(this,arguments)}a.d(r,{Jp:()=>slist,p0:()=>tinyNotification,x8:()=>itemFromDrop,zJ:()=>svgAutoFit})},139:(t,r,a)=>{a.d(r,{Z:()=>u});var o=a(930),i=a(832),c=a(604);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var u=function(){function DSKTables(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKTables)}var t,r,a,u,l,p;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKTables,null,[{key:"showBotchCard",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,a,c,u,l,p,d,h,y=arguments;return _regeneratorRuntime().wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return(r=y.length>1&&void 0!==y[1]?y[1]:{}).speaker={token:t.token,actor:t.actor,scene:t.scene},r.source=t.source,a=o.Z.systemTables.find((function(r){return r.name==t.table})),m.next=6,DSKTables.getRollTable(a.pack[game.i18n.lang],game.i18n.localize("dsk.TABLENAMES.".concat(t.table)),t);case 6:if(c=m.sent,!r.speaker){m.next=13;break}return m.next=10,DSKTables.hasEffect(c);case 10:m.t0=m.sent,m.next=14;break;case 13:m.t0=!1;case 14:return u=m.t0,l=i.Z.replaceDies(i.Z.replaceConditions(c.results[0].text)),p="".concat(game.i18n.localize("dsk.TABLENAMES."+t.table)),m.next=19,renderTemplate("systems/dsk/templates/tables/tableCard.html",{result:l,title:p,hasEffect:u});case 19:return d=m.sent,m.next=22,this.buildEffects(c,u);case 22:h=m.sent,ChatMessage.create({user:game.user.id,content:d,whisper:r.whisper,blind:r.blind,flags:{data:{preData:{source:{effects:h},extra:{actor:{id:r.speaker.actor},speaker:r.speaker},situationalModifiers:[]},postData:{}},dsk:{hasEffect:u,options:r}}});case 24:case"end":return m.stop()}}),_callee,this)}))),function showBotchCard(t){return p.apply(this,arguments)})},{key:"hasEffect",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",getProperty(t.results[0],"flags.dsk")||!1);case 1:case"end":return r.stop()}}),_callee2)}))),function hasEffect(t){return l.apply(this,arguments)})},{key:"buildEffects",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r){var a,o;return _regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return a=[],r&&r.resistEffect&&(o=(new c.Z).effectDummy(r.resistEffect.fail.description,r.resistEffect.changes||[],r.resistEffect.duration||{}),r.resistEffect.fail.systemEffect&&mergeObject(o,{_id:"botchEffect",flags:{dsk:{hideOnToken:!1,hidePlayers:!1,advancedFunction:2,args3:'await actor.addCondition("prone");'}}}),a.push(o)),t.abrupt("return",a);case 3:case"end":return t.stop()}}),_callee3)}))),function buildEffects(t,r){return u.apply(this,arguments)})},{key:"getRollTable",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r){var a,o,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee4$(l){for(;;)switch(l.prev=l.next){case 0:return a=u.length>2&&void 0!==u[2]?u[2]:{},o=game.packs.get(t),l.next=4,o.getDocuments({name:{$in:[r]}});case 4:return i=l.sent[0],l.next=7,i.draw({displayChat:!1});case 7:if(c=l.sent,!("true"==a.weaponless&&c.roll.total<7)){l.next=13;break}return c.roll.editRollAtIndex([{index:0,val:c.roll.total+5}]),l.next=12,i.draw({displayChat:!1,roll:c.roll});case 12:c=l.sent;case 13:return l.abrupt("return",c);case 14:case"end":return l.stop()}}),_callee4)}))),function getRollTable(t,r){return a.apply(this,arguments)})},{key:"tableEnabledFor",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r;return _regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return r=o.Z.systemTables.find((function(r){return r.name==t})),a.abrupt("return",!!r&&game.settings.get(r.setting.module,r.setting.key));case 2:case"end":return a.stop()}}),_callee5)}))),function tableEnabledFor(t){return r.apply(this,arguments)})},{key:"rollCritBotchButton",value:function rollCritBotchButton(t,r,a){var o=game.i18n.localize("dsk.TABLENAMES.".concat(t)),i=a.extra.speaker,c=a.source._id;return', <a class="roll-button botch-roll" data-table="'.concat(t,'" data-weaponless="').concat(r,'" data-source="').concat(c,'" data-token="').concat(i.token,'" data-actor="').concat(i.actor,'" data-scene="').concat(i.scene,'"><i class="fas fa-dice"></i>').concat(o,"</a>")}},{key:"defaultBotch",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){return _regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=", "+game.i18n.localize("dsk.selfDamage"),t.next=3,new Roll("1d6+2").evaluate({async:!0});case 3:return t.t1=t.sent.total,t.abrupt("return",t.t0+t.t1);case 5:case"end":return t.stop()}}),_callee6)}))),function defaultBotch(){return t.apply(this,arguments)})},{key:"defaultAttackCrit",value:function defaultAttackCrit(t){var r=", "+game.i18n.localize("dsk.halfDefense");return t&&(r+=", "+game.i18n.localize("dsk.doubleDamage")),r}},{key:"defaultParryCrit",value:function defaultParryCrit(){return", "+game.i18n.localize("dsk.attackOfOpportunity")}}]),DSKTables}()}},__webpack_module_cache__={};function __webpack_require__(t){var r=__webpack_module_cache__[t];if(void 0!==r)return r.exports;var a=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(t,r)=>{for(var a in r)__webpack_require__.o(r,a)&&!__webpack_require__.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},__webpack_require__.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var __webpack_exports__={};(()=>{var t=__webpack_require__(832),r=__webpack_require__(231),a=__webpack_require__(140);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var o,i,c=[],u=!0,l=!1;try{for(a=a.call(t);!(u=(o=a.next()).done)&&(c.push(o.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==a.return||a.return()}finally{if(l)throw i}}return c}(t,r)||_unsupportedIterableToArray(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function _asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function Migrakel(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Migrakel)}var t,r,a,o,i,c,u,l;return function _createClass(t,r,a){return r&&_defineProperties(t.prototype,r),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(Migrakel,null,[{key:"showDialog",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,a,o;return _regeneratorRuntime().wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,new Promise((function(r,a){new Dialog({title:game.i18n.localize("dsk.Migrakel.Migration"),content:t,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){r([!0])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){r([!1])}}},close:function close(){r([!1])}}).render(!0)}));case 2:return r=i.sent,a=_slicedToArray(r,1),o=a[0],i.abrupt("return",o);case 6:case"end":return i.stop()}}),_callee)}))),function showDialog(t){return l.apply(this,arguments)})},{key:"refreshStatusEffects",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var r,a,o,i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:r=[],a=_createForOfIteratorHelper(t.effects),u.prev=2,a.s();case 4:if((o=a.n()).done){u.next=19;break}if(!(i=o.value).origin){u.next=17;break}return c=void 0,u.prev=8,u.next=11,fromUuid(i.origin);case 11:c=u.sent,u.next=16;break;case 14:u.prev=14,u.t0=u.catch(8);case 16:c||r.push(i.id);case 17:u.next=4;break;case 19:u.next=24;break;case 21:u.prev=21,u.t1=u.catch(2),a.e(u.t1);case 24:return u.prev=24,a.f(),u.finish(24);case 27:return u.next=29,t.deleteEmbeddedDocuments("ActiveEffect",r);case 29:case"end":return u.stop()}}),_callee2,null,[[2,21,24,27],[8,14]])}))),function refreshStatusEffects(t){return u.apply(this,arguments)})},{key:"updateVals",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,a){var o,i,c,u,l,p,d,h,y,m,g,v,_,b;return _regeneratorRuntime().wrap((function _callee3$(k){for(;;)switch(k.prev=k.next){case 0:return o=game.dsk.itemLibrary,i=[],c=[],u=new Map,k.next=6,this.refreshStatusEffects(t);case 6:if(!r({type:"equipment"})){k.next=34;break}l=[],p=[],d=_createForOfIteratorHelper(t.items.filter((function(t){return"equipment"==t.type&&"bags"==t.system.category}))),k.prev=10,y=_regeneratorRuntime().mark((function _loop(){var t,r,i;return _regeneratorRuntime().wrap((function _loop$(c){for(;;)switch(c.prev=c.next){case 0:return t=h.value,c.next=3,o.findCompendiumItem(t.name,t.type);case 3:if(!((r=c.sent).length>0)){c.next=12;break}if(r=r.find((function(r){return r.name==t.name&&r.type==t.type}))){c.next=8;break}return c.abrupt("return","continue");case 8:console.log("MIGRATION - Updated ".concat(t.name)),i=mergeObject(t.toObject(),a(r)),p.push(i),l.push(t.id);case 12:case"end":return c.stop()}}),_loop)})),d.s();case 13:if((h=d.n()).done){k.next=20;break}return k.delegateYield(y(),"t0",15);case 15:if("continue"!==k.t0){k.next=18;break}return k.abrupt("continue",18);case 18:k.next=13;break;case 20:k.next=25;break;case 22:k.prev=22,k.t1=k.catch(10),d.e(k.t1);case 25:return k.prev=25,d.f(),k.finish(25);case 28:return k.next=30,t.createEmbeddedDocuments("Item",p);case 30:for(m=k.sent,g=0;g<m.length;g++)u.set(l[g],m[g].id);return k.next=34,t.deleteEmbeddedDocuments("Item",l);case 34:v=_createForOfIteratorHelper(t.items.filter((function(t){return r(t)&&!("equipment"==t.type&&"bags"==t.system.category)}))),k.prev=35,b=_regeneratorRuntime().mark((function _loop2(){var t,r,l;return _regeneratorRuntime().wrap((function _loop2$(p){for(;;)switch(p.prev=p.next){case 0:return t=_.value,p.next=3,o.findCompendiumItem(t.name,t.type);case 3:if(!((r=p.sent).length>0)){p.next=13;break}if(r=r.find((function(r){return r.name==t.name&&r.type==t.type}))){p.next=8;break}return p.abrupt("return","continue");case 8:console.log("MIGRATION - Updated ".concat(t.name)),(l=mergeObject(t.toObject(),a(r))).system.parent_id&&u.has(l.system.parent_id)&&(l.system.parent_id=u.get(l.system.parent_id)),c.push(l),i.push(t.id);case 13:case"end":return p.stop()}}),_loop2)})),v.s();case 38:if((_=v.n()).done){k.next=45;break}return k.delegateYield(b(),"t2",40);case 40:if("continue"!==k.t2){k.next=43;break}return k.abrupt("continue",43);case 43:k.next=38;break;case 45:k.next=50;break;case 47:k.prev=47,k.t3=k.catch(35),v.e(k.t3);case 50:return k.prev=50,v.f(),k.finish(50);case 53:return k.next=55,t.createEmbeddedDocuments("Item",c);case 55:return k.next=57,t.deleteEmbeddedDocuments("Item",i);case 57:ui.notifications.notify(game.i18n.localize("dsk.Migrakel.migrationDone"));case 58:case"end":return k.stop()}}),_callee3,this,[[10,22,25,28],[35,47,50,53]])}))),function updateVals(t,r,a){return c.apply(this,arguments)})},{key:"updateSpellsAndLiturgies",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r,a;return _regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.spells"));case 2:if(!o.sent){o.next=7;break}return r=function condition(t){return["spell","liturgy","ritual","ceremony","spellextension"].includes(t.type)},a=function updator(t){var r={effects:t.effects.toObject()};return"spellextension"!=t.type&&(r.system={effectFormula:t.system.effectFormula}),r},o.next=7,this.updateVals(t,r,a);case 7:case"end":return o.stop()}}),_callee4,this)}))),function updateSpellsAndLiturgies(t){return i.apply(this,arguments)})},{key:"updateSpecialAbilities",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r,a,o=this;return _regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.abilities"));case 2:if(!i.sent){i.next=7;break}return r=function updator(t){var r={system:{effect:{value:t.system.effect}},effects:t.effects.toObject()};return"specialability"==t.type&&(mergeObject(r,{system:{category:{sub:t.system.category.sub||0},list:{value:t.system.list.value}}}),"staff"==t.system.category&&mergeObject(r,{system:{feature:getProperty(t,"system.feature")||"",AsPCost:getProperty(t,"system.AsPCost")||"",volume:Number(getProperty(t,"system.volume"))||0,artifact:getProperty(t,"system.artifact")||""}})),o.updateMacro(r,t),r},a=function condition(t){return["specialability","advantage","disadvantage","trait"].includes(t.type)},i.next=7,this.updateVals(t,a,r);case 7:case"end":return i.stop()}}),_callee5,this)}))),function updateSpecialAbilities(t){return o.apply(this,arguments)})},{key:"updateCombatskills",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){var r,a;return _regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.cskills"));case 2:if(!o.sent){o.next=7;break}return r=function updator(t){return{effects:t.effects.toObject()}},a=function condition(t){return["combatskill"].includes(t.type)},o.next=7,this.updateVals(t,a,r);case 7:case"end":return o.stop()}}),_callee6,this)}))),function updateCombatskills(t){return a.apply(this,arguments)})},{key:"updateSkills",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,a;return _regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.skills"));case 2:if(!o.sent){o.next=7;break}return r=function condition(t){return["skill"].includes(t.type)},a=function updator(t){return{img:t.img}},o.next=7,this.updateVals(t,r,a);case 7:case"end":return o.stop()}}),_callee7,this)}))),function updateSkills(t){return r.apply(this,arguments)})},{key:"updateMacro",value:function updateMacro(t,r){var a=r.getFlag("dsk","onUseEffect");a&&mergeObject(t,{flags:{dsk:{onUseEffect:a}}})}},{key:"updateGear",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t){var r,a,o=this;return _regeneratorRuntime().wrap((function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.gear"));case 2:if(!i.sent){i.next=7;break}return r=function condition(t){return["meleeweapon","armor","rangeweapon","equipment","poison","consumable","ammunition"].includes(t.type)},a=function updator(t){var r={img:t.img,effects:t.effects.toObject()};return["poison","consumable"].includes(t.type)||mergeObject(r,{system:{effect:{value:t.system.effect}}}),["armor"].includes(t.type)&&mergeObject(r,{system:{subcategory:t.system.subcategory}}),o.updateMacro(r,t),r},i.next=7,this.updateVals(t,r,a);case 7:case"end":return i.stop()}}),_callee8,this)}))),function updateGear(r){return t.apply(this,arguments)})}]),Migrakel}();function dialog_actorConfig_typeof(t){return dialog_actorConfig_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_actorConfig_typeof(t)}function dialog_actorConfig_regeneratorRuntime(){dialog_actorConfig_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_actorConfig_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function dialog_actorConfig_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function dialog_actorConfig_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){dialog_actorConfig_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){dialog_actorConfig_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_actorConfig_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return _possibleConstructorReturn(this,a)}}function _possibleConstructorReturn(t,r){if(r&&("object"===dialog_actorConfig_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(DialogActorConfig,Dialog);var r,a,i=_createSuper(DialogActorConfig);function DialogActorConfig(t,r){var a;return function dialog_actorConfig_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DialogActorConfig),(a=i.call(this,r)).actor=t,a.lock=!1,a}return function dialog_actorConfig_createClass(t,r,a){return r&&dialog_actorConfig_defineProperties(t.prototype,r),a&&dialog_actorConfig_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DialogActorConfig,[{key:"updateWrapper",value:(a=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee2(t,r){var a,i=this;return dialog_actorConfig_regeneratorRuntime().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",ui.notifications.warn("There is nothing to migrate yet."));case 3:a=function(){var a=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee(){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return i.lock=!0,$(r.currentTarget).prepend('<i class="fas fa-spinner fa-spin"></i>'),a.next=4,o[t](i.actor);case 4:$(r.currentTarget).find("i").remove(),i.lock=!1;case 6:case"end":return a.stop()}}),_callee)})));return function upd(){return a.apply(this,arguments)}}(),a();case 5:case"end":return c.stop()}}),_callee2,this)}))),function updateWrapper(t,r){return a.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(DialogActorConfig.prototype),"activateListeners",this).call(this,t),t.find(".updateSpells").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee3(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.updateWrapper("updateSpellsAndLiturgies",t));case 1:case"end":return a.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updateAbilities").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee4(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.updateWrapper("updateSpecialAbilities",t));case 1:case"end":return a.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updatecSkills").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee5(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.updateWrapper("updateCombatskills",t));case 1:case"end":return a.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updateSkills").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee6(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.updateWrapper("updateSkills",t));case 1:case"end":return a.stop()}}),_callee6)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updateGear").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee7(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.updateWrapper("updateGear",t));case 1:case"end":return a.stop()}}),_callee7)})));return function(r){return t.apply(this,arguments)}}())}}],[{key:"buildDialog",value:(r=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee8(t){var r;return dialog_actorConfig_regeneratorRuntime().wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,renderTemplate("systems/dsk/templates/actors/parts/actorConfig.html",{actor:t});case 2:r=a.sent,new DialogActorConfig(t,{title:game.i18n.localize("dsk.SHEET.actorConfig"),content:r,default:"Save",buttons:{Save:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.save"),callback:function callback(r){t.update({"system.config.autoBar":r.find('[name="autoBar"]').is(":checked"),"system.config.autoSize":r.find('[name="autoSize"]').is(":checked")})}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 4:case"end":return a.stop()}}),_callee8)}))),function buildDialog(t){return r.apply(this,arguments)})}]),DialogActorConfig}();function bindImgToCanvasDragStart(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img";game.user.isGM&&t.find(r).each((function(t,r){r.setAttribute("draggable",!0),r.addEventListener("dragstart",(function(t){return c(t)}))}))}var c=function dragTileImg(t){canvas.tiles.activate();var r=t.currentTarget.src,a=t.currentTarget,o=canvas.dimensions.sceneHeight/a.naturalHeight,i=canvas.dimensions.sceneWidth/a.naturalWidth,c=Math.min(1,i,o),u={type:"Tile",texture:{src:r},tileSize:Math.round(canvas.dimensions.size/c)};t.dataTransfer.setData("text/plain",JSON.stringify(u));var l=a.naturalWidth*c*canvas.stage.scale.x,p=a.naturalHeight*c*canvas.stage.scale.y,d=DragDrop.createDragImage(a,l,p);t.dataTransfer.setDragImage(d,l/2,p/2)},u=__webpack_require__(973),l=__webpack_require__(530),p=__webpack_require__(947),d=__webpack_require__(930),h=__webpack_require__(608),y=__webpack_require__(122),m=__webpack_require__(278),g=__webpack_require__(514),v=__webpack_require__(707);function actor_sheet_dsk_typeof(t){return actor_sheet_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_dsk_typeof(t)}function _defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function actor_sheet_dsk_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function actor_sheet_dsk_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return actor_sheet_dsk_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return actor_sheet_dsk_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function actor_sheet_dsk_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function actor_sheet_dsk_regeneratorRuntime(){actor_sheet_dsk_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_sheet_dsk_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function actor_sheet_dsk_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function actor_sheet_dsk_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){actor_sheet_dsk_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){actor_sheet_dsk_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function actor_sheet_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_dsk_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function actor_sheet_dsk_get(){return actor_sheet_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=actor_sheet_dsk_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},actor_sheet_dsk_get.apply(this,arguments)}function actor_sheet_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_dsk_getPrototypeOf(t)););return t}function actor_sheet_dsk_setPrototypeOf(t,r){return actor_sheet_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_dsk_setPrototypeOf(t,r)}function actor_sheet_dsk_createSuper(t){var r=function actor_sheet_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=actor_sheet_dsk_getPrototypeOf(t);if(r){var i=actor_sheet_dsk_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return actor_sheet_dsk_possibleConstructorReturn(this,a)}}function actor_sheet_dsk_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_dsk_getPrototypeOf(t){return actor_sheet_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_dsk_getPrototypeOf(t)}var _=function(o){!function actor_sheet_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_dsk_setPrototypeOf(t,r)}(ActorSheetDSK,ActorSheet);var c,_,b,k,w,x,O,S,P,T,I,E,C,A,D,R,L,G,j,M,z,N,H,K,W,B,Z,q,Y,U=actor_sheet_dsk_createSuper(ActorSheetDSK);function ActorSheetDSK(){return actor_sheet_dsk_classCallCheck(this,ActorSheetDSK),U.apply(this,arguments)}return function actor_sheet_dsk_createClass(t,r,a){return r&&actor_sheet_dsk_defineProperties(t.prototype,r),a&&actor_sheet_dsk_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetDSK,[{key:"_render",value:(Y=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee(){var t,r,a,o,i,c,u,l=arguments;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:return t=l.length>0&&void 0!==l[0]&&l[0],r=l.length>1&&void 0!==l[1]?l[1]:{},this._saveSearchFields(),this._saveCollapsed(),p.next=6,actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"_render",this).call(this,t,r);case 6:for(this._setCollapsed(),this._restoreSeachFields(),a=$(this._element),o={".close":"dsk.SHEET.Close",".configure-sheet":"dsk.SHEET.Configure",".configure-token":"dsk.SHEET.Token",".import":"dsk.SHEET.Import",".locksheet":"dsk.SHEET.Lock",".library":"dsk.SHEET.Library",".playerview":"dsk.SHEET.switchLimited",".actorConfig":"dsk.SHEET.actorConfig"},i=0,c=Object.keys(o);i<c.length;i++)u=c[i],a.find(u).attr("data-tooltip",game.i18n.localize(o[u]));this.currentFocus&&(a.find('[data-item-id="'+this.currentFocus+'"] input').focus().select(),this.currentFocus=null);case 12:case"end":return p.stop()}}),_callee,this)}))),function _render(){return Y.apply(this,arguments)})},{key:"swapWeaponHand",value:(q=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee2(t){var r,a;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return r=this._getItemId(t),a=this.actor.items.get(r),o.next=4,this.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.worn.wrongGrip":!a.system.worn.wrongGrip}]);case 4:case"end":return o.stop()}}),_callee2,this)}))),function swapWeaponHand(t){return q.apply(this,arguments)})},{key:"_saveSearchFields",value:function _saveSearchFields(){if(null!==this.form){var t=$(this.form).parent();this.searchFields={talentFiltered:$(t.find(".filterTalents")).hasClass("filtered"),searchText:$(t.find(".talentSearch")).val(),gearSearch:$(t.find(".gearSearch")).val()}}}},{key:"_restoreSeachFields",value:function _restoreSeachFields(){if(null!=this.searchFields){var t=$(this.form).parent();this.searchFields.talentFiltered&&($(t.find(".filterTalents")).addClass("filtered"),$(t.find(".allTalents")).removeClass("showAll"));var r=$(t.find(".talentSearch"));r.val(this.searchFields.searchText),""!=this.searchFields.searchText&&this._filterTalents(r);var a=$(t.find(".gearSearch"));a.val(this.searchFields.gearSearch),""!=this.searchFields.searchText&&this._filterGear(a)}}},{key:"_saveCollapsed",value:function _saveCollapsed(){if(null!==this.form){var t=$(this.form).parent();this.collapsedBoxes=[],this.openDetails=[];var r,a=actor_sheet_dsk_createForOfIteratorHelper(t.find(".ch-collapse i"));try{for(a.s();!(r=a.n()).done;){var o=r.value;this.collapsedBoxes.push($(o).attr("class"))}}catch(t){a.e(t)}finally{a.f()}var i,c=actor_sheet_dsk_createForOfIteratorHelper($(t.find(".expandDetails.shown")));try{for(c.s();!(i=c.n()).done;){var u=i.value;this.openDetails.push($(u).closest(".item").attr("data-item-id"))}}catch(t){c.e(t)}finally{c.f()}}}},{key:"_setCollapsed",value:function _setCollapsed(){var t=$(this.form).parent();if(this.collapsedBoxes)for(var r=t.find(".ch-collapse i"),a=0;a<r.length;a++)$(r[a]).attr("class",this.collapsedBoxes[a]),this.collapsedBoxes[a]&&-1!=this.collapsedBoxes[a].indexOf("fa-angle-down")&&$(r[a]).closest(".groupbox").find(".row-section:nth-child(2)").hide()}},{key:"getData",value:(Z=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee3(t){var r,a;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"getData",this).call(this,t);case 2:return r=o.sent,(a={actor:r.actor,editable:r.editable,limited:r.limited,owner:r.owner}).prepare=this.actor.prepareSheet({details:this.openDetails}),a.sizeCategories=d.Z.sizeCategories,a.isGM=game.user.isGM,a.initDies={"":"-","1d6":"1d6","2d6":"2d6","3d6":"3d6","4d6":"4d6"},u.Z.prepareActiveEffects(this.actor,a),o.next=11,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.owner"),{secrets:!0,async:!0});case 11:return a.enrichedOwnerdescription=o.sent,o.next=14,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.gm"),{secrets:!0,async:!0});case 14:return a.enrichedGmdescription=o.sent,o.next=17,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.description"),{secrets:!0,async:!0});case 17:return a.enrichedNotes=o.sent,o.next=20,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.biography"),{secrets:!0,async:!0});case 20:return a.enrichedBiography=o.sent,o.abrupt("return",a);case 22:case"end":return o.stop()}}),_callee3,this)}))),function getData(t){return Z.apply(this,arguments)})},{key:"_openLibrary",value:(B=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee4(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:game.dsk.itemLibrary.render(!0);case 1:case"end":return t.stop()}}),_callee4)}))),function _openLibrary(){return B.apply(this,arguments)})},{key:"_configActor",value:(W=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee5(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:i.buildDialog(this.actor);case 1:case"end":return t.stop()}}),_callee5,this)}))),function _configActor(){return W.apply(this,arguments)})},{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r,a,o=this,i=actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"_getHeaderButtons",this).call(this);return i.unshift({class:"library",icon:"fas fa-university",onclick:(t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee6(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",o._openLibrary());case 1:case"end":return t.stop()}}),_callee6)}))),function onclick(){return t.apply(this,arguments)})}),this.actor.isOwner&&i.unshift({class:"actorConfig",icon:"fas fa-link",onclick:(r=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee7(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",o._configActor());case 1:case"end":return t.stop()}}),_callee7)}))),function onclick(){return r.apply(this,arguments)})}),this.actor.system.canAdvance&&i.unshift({class:"locksheet",icon:"fas fa-".concat(this.actor.system.sheetLocked?"":"un","lock"),onclick:(a=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee8(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",o._changeAdvanceLock(t));case 1:case"end":return r.stop()}}),_callee8)}))),function onclick(t){return a.apply(this,arguments)})}),i}},{key:"_changeAdvanceLock",value:(K=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee9(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.actor.update({"system.sheetLocked":!this.actor.system.sheetLocked});case 2:$(t.currentTarget).find("i").toggleClass("fa-unlock fa-lock");case 3:case"end":return r.stop()}}),_callee9,this)}))),function _changeAdvanceLock(t){return K.apply(this,arguments)})},{key:"showLimited",value:function showLimited(){return!game.user.isGM&&this.actor.limited}},{key:"getTokenId",value:function getTokenId(){return this.token?this.token.id:void 0}},{key:"activateListeners",value:function activateListeners(a){var o=this;actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"activateListeners",this).call(this,a);var i=function posthand(t){o.actor.items.get(o._getItemId(t)).postItem()};a.find(".schip").click((function(t){t.preventDefault();var r=Number(t.currentTarget.getAttribute("data-val"));1==r&&1==$(o.form).find(".fullSchip").length&&(r=0),o.actor.update({"system.stats.schips.value":r})})),a.find(".swapWeaponHand").click((function(t){return o.swapWeaponHand(t)})),a.find(".loadWeapon").mousedown(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee10(t){var a,i,c,u;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee10$(l){for(;;)switch(l.prev=l.next){case 0:if(a=o._getItemId(t),i=o.actor.items.get(a).toObject(),""!==getProperty(i,"system.currentAmmo")){l.next=4;break}return l.abrupt("return");case 4:return c={_id:a},0==t.button?(u="trait"==i.type?i.system.lz:r.Z.calcLZ(i,o.actor),c["system.reloadTimeprogress"]=Math.min(i.system.reloadTimeprogress+1,u)):2==t.button&&(c["system.reloadTimeprogress"]=0),l.next=8,o.actor.updateEmbeddedDocuments("Item",[c]);case 8:case"end":return l.stop()}}),_callee10)})));return function(r){return t.apply(this,arguments)}}()),a.find(".item-swapMag").click(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee11(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o.actor.swapMag(o._getItemId(t));case 2:case"end":return r.stop()}}),_callee11)})));return function(r){return t.apply(this,arguments)}}()),a.find(".ammo-selector").change(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee12(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),r=o._getItemId(t),a.next=4,o.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.currentAmmo":$(t.currentTarget).val()}]);case 4:case"end":return a.stop()}}),_callee12)})));return function(r){return t.apply(this,arguments)}}()),a.find(".condition-edit").click((function(t){o.actor.effects.get($(t.currentTarget).attr("data-id")).sheet.render(!0)})),a.find(".ch-collapse").click((function(t){$(t.currentTarget).find("i").toggleClass("fa-angle-up fa-angle-down"),$(t.currentTarget).closest(".groupbox").find(".row-section:nth-child(2)").fadeToggle()})),a.find(".item-toggle").click((function(t){var r=o._getItemId(t),a=o.actor.items.get(r).toObject();switch(a.type){case"armor":case"rangeweapon":case"meleeweapon":case"equipment":o.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.worn.value":!a.system.worn.value}]),h.Z.playEquipmentWearStatusChange(a)}})),a.find(".status-create").click((function(t){var r=$(t.currentTarget).closest(".statusEffectMenu").find("ul");r.fadeIn("fast",(function(){r.find("input").focus()}))})),a.find(".statusEffectMenu ul").mouseleave((function(t){return $(t.currentTarget).fadeOut()})),a.find(".status-add").click(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee13(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:if("custom"!=(r=$(t.currentTarget).attr("data-id"))){a.next=5;break}u.Z.createCustomEffect(o.actor),a.next=7;break;case 5:return a.next=7,o.actor.addCondition(r,1,!1,!1);case 7:case"end":return a.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}()),a.find(".skill-select").mousedown((function(t){var r=o._getItemId(t),a=o.actor.items.get(r);0==t.button?o.actor.setupSkill(a,{},o.getTokenId()).then((function(t){o.actor.basicTest(t)})):2==t.button&&a.sheet.render(!0)})),a.find(".advance-attribute").mousedown((function(t){return o.advanceWrapper(t,"_advanceAttribute",$(t.currentTarget).attr("data-attr"))})),a.find(".refund-attribute").mousedown((function(t){return o.advanceWrapper(t,"_refundAttributeAdvance",$(t.currentTarget).attr("data-attr"))})),a.find(".advance-item").mousedown((function(t){return o.advanceWrapper(t,"_advanceItem",o._getItemId(t))})),a.find(".refund-item").mousedown((function(t){return o.advanceWrapper(t,"_refundItemAdvance",o._getItemId(t))})),a.find(".advance-points").mousedown((function(t){return o.advanceWrapper(t,"_advancePoints",$(t.currentTarget).attr("data-attr"))})),a.find(".refund-points").mousedown((function(t){return o.advanceWrapper(t,"_refundPointsAdvance",$(t.currentTarget).attr("data-attr"))})),a.find(".spell-select").mousedown((function(t){var r=o._getItemId(t),a=o.actor.items.get(r);0==t.button?o.actor.setupSpell(a,{},o.getTokenId()).then((function(t){return o.actor.basicTest(t)})):2==t.button&&a.sheet.render(!0)})),a.find(".quantity-click").mousedown((function(t){var r=o._getItemId(t),a=o.actor.items.get(r).toObject();y.Z.increment(t,a,"system.quantity",0),o.actor.updateEmbeddedDocuments("Item",[a])})),a.find(".item-post").click((function(t){return i(t)})),a.find(".item-dropdown").click((function(t){t.preventDefault(),$(t.currentTarget).closest(".item").find(".expandDetails:first").toggleClass("shown")})),a.find(".condition-show").mousedown((function(t){t.preventDefault();var r=t.currentTarget.dataset.id,a=$(t.currentTarget).parents(".statusEffect").attr("data-descriptor");if(0==t.button){var i=$(t.currentTarget).parents(".statusEffect").attr("data-origin");if(i)fromUuid(i).then((function(t){return t.sheet.render(!0)}));else{var c,u;a?(c=CONFIG.statusEffects.find((function(t){return t.id==a})),u=$('<div style="padding:5px;"><b><a class="chat-condition chatButton" data-id="'.concat(c.id,'"><img src="').concat(c.icon,'"/>').concat(game.i18n.localize(c.label),"</a></b>: ").concat(game.i18n.localize(c.description),"</div>"))):(c=o.actor.effects.find((function(t){return t.id==r})))&&(u=$('<div style="padding:5px;"><b><a class="chat-condition chatButton" data-id="'.concat(c.id,'"><img src="').concat(c.icon,'"/>').concat(game.i18n.localize(c.label),"</a></b>: ").concat(game.i18n.localize(c.flags.dsk.description),"</div>")));var l=$(t.currentTarget).closest(".groupbox").find(".effectDescription");l.fadeOut("fast",(function(){l.html(u).fadeIn("fast")}))}}else 2!=t.button||t.currentTarget.dataset.locked||o._deleteActiveEffect(r)})),a.on("click",".chat-condition",(function(t){return p.Z.postStatus($(t.currentTarget).attr("data-id"))})),a.find(".skill-advances").change(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee14(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return r=o._getItemId(t),a.next=3,o.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.level":Number(t.target.value)}]);case 3:case"end":return a.stop()}}),_callee14)})));return function(r){return t.apply(this,arguments)}}()),a.find(".item-edit").click((function(t){t.preventDefault();var r=o._getItemId(t);o.actor.items.get(r).sheet.render(!0)})),a.find(".disableRegeneration").click((function(t){var r=t.currentTarget.dataset.type,a="system.repeatingEffects.disabled.".concat(r);o.actor.update(_defineProperty({},a,!getProperty(o.actor,a)))})),a.find(".consume-item").mousedown((function(t){if(2==t.button){var r=o._getItemId(t),a=o.actor.items.get(r);o.consumeItem(a)}})),a.find(".ch-value").click((function(t){t.preventDefault();var r=t.currentTarget.attributes["data-char"].value;o.actor.setupCharacteristic(r,{},o.getTokenId()).then((function(t){return o.actor.basicTest(t)}))})),a.find(".ch-regenerate").click((function(t){t.preventDefault(),o.actor.setupRegeneration("regenerate",{},o.getTokenId()).then((function(t){return o.actor.basicTest(t)}))})),a.find(".item-create").click((function(t){return o._onItemCreate(t)})),a.find(".ch-rollCombat").click((function(t){t.preventDefault();var r=o._getItemId(t),a=$(t.currentTarget).attr("data-mode"),i=o.actor.items.get(r);o.actor.setupWeapon(i,a,{},o.getTokenId()).then((function(t){return o.actor.basicTest(t)}))}));var c=function deletehand(t){return o._deleteItem(t)};a.find(".onUseItem").click((function(t){return o._onMacroUseItem(t)})),a.find(".cards .item").mouseenter((function(t){if(0==t.currentTarget.getElementsByClassName("hovermenu").length){var r=document.createElement("div");r.classList.add("hovermenu");var a=document.createElement("i");a.classList.add("fas","fa-times"),a.title=game.i18n.localize("dsk.SHEET.DeleteItem"),a.addEventListener("click",c,!1);var o=document.createElement("i");o.classList.add("fas","fa-comment"),o.title=game.i18n.localize("dsk.SHEET.PostItem"),o.addEventListener("click",i,!1),r.appendChild(o),r.appendChild(a),t.currentTarget.appendChild(r)}})),a.find(".cards .item").mouseleave((function(t){var r=t.toElement||t.relatedTarget;r&&r.parentNode!=o&&r!=o&&t.currentTarget.querySelectorAll(".hovermenu").forEach((function(t){return t.remove()}))}));var d=this.actor.uuid;a.find(".actorDrag").each((function(t,r){r.setAttribute("draggable",!0),r.addEventListener("dragstart",(function(t){var r={type:"Actor",uuid:d};t.dataTransfer.setData("text/plain",JSON.stringify(r))}))})),a.find(".item-delete").click((function(t){return o._deleteItem(t)})),a.find(".filterTalents").click((function(t){$(t.currentTarget).closest(".content").find(".allTalents").toggleClass("showAll"),$(t.currentTarget).toggleClass("filtered")})),a.find(".condition-value").mousedown(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee15(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:if(r=$(t.currentTarget).parents(".statusEffect").attr("data-descriptor"),0!=t.button){a.next=6;break}return a.next=4,o.actor.addCondition(r,1,!1,!1);case 4:a.next=9;break;case 6:if(2!=t.button){a.next=9;break}return a.next=9,o.actor.removeCondition(r,1,!1);case 9:case"end":return a.stop()}}),_callee15)})));return function(r){return t.apply(this,arguments)}}()),a.find(".condition-toggle").mousedown(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee16(t){var r,a;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee16$(i){for(;;)switch(i.prev=i.next){case 0:if(o.isEditable){i.next=2;break}return i.abrupt("return");case 2:return r=$(t.currentTarget).parents(".statusEffect").attr("data-id"),a=o.actor.effects.get(r),i.next=6,a.update({disabled:!a.disabled});case 6:case"end":return i.stop()}}),_callee16)})));return function(r){return t.apply(this,arguments)}}()),a.find(".charimg").mousedown((function(r){2==r.button&&t.Z.showArtwork(o.actor,!0)})),l.Z.bindRollCommands(a);var m=a.find(".talentSearch");m.keyup((function(t){return o._filterTalents($(t.currentTarget))})),m[0]&&m[0].addEventListener("search",(function filterTalents(t){return o._filterTalents($(t.currentTarget))}),!1);var g=a.find(".conditionSearch");g.keyup((function(t){return o._filterConditions($(t.currentTarget))})),g[0]&&g[0].addEventListener("search",(function filterConditions(t){return o._filterConditions($(t.currentTarget))}),!1);var v=a.find(".gearSearch");v.keyup((function(t){return o._filterGear($(t.currentTarget))})),v[0]&&v[0].addEventListener("search",(function filterGear(t){return o._filterGear($(t.currentTarget))}),!1),bindImgToCanvasDragStart(a,"img.charimg")}},{key:"advanceWrapper",value:(H=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee17(t,r,a){var o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee17$(i){for(;;)switch(i.prev=i.next){case 0:if((o=$(t.currentTarget).find("i")).hasClass("fa-spin")){i.next=6;break}return o.addClass("fa-spin fa-spinner"),i.next=5,this[r](a);case 5:o.removeClass("fa-spin fa-spinner");case 6:case"end":return i.stop()}}),_callee17,this)}))),function advanceWrapper(t,r,a){return H.apply(this,arguments)})},{key:"_advanceAttribute",value:(N=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee18(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee18$(i){for(;;)switch(i.prev=i.next){case 0:return a=Number(this.actor.system.characteristics[r].advances)+Number(this.actor.system.characteristics[r].initial),o=t.Z._calculateAdvCost(a,"Eig"),i.next=4,this._checkEnoughXP(o);case 4:if(!i.sent){i.next=7;break}return i.next=7,this._updateAPs(o,_defineProperty({},"system.characteristics.".concat(r,".advances"),Number(this.actor.system.characteristics[r].advances)+1));case 7:case"end":return i.stop()}}),_callee18,this)}))),function _advanceAttribute(t){return N.apply(this,arguments)})},{key:"_refundAttributeAdvance",value:(z=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee19(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee19$(i){for(;;)switch(i.prev=i.next){case 0:if(a=Number(this.actor.system.characteristics[r].advances)+Number(this.actor.system.characteristics[r].initial),!(Number(this.actor.system.characteristics[r].advances)>0)){i.next=5;break}return o=-1*t.Z._calculateAdvCost(a,"Eig",0),i.next=5,this._updateAPs(o,_defineProperty({},"system.characteristics.".concat(r,".advances"),Number(this.actor.system.characteristics[r].advances)-1));case 5:case"end":return i.stop()}}),_callee19,this)}))),function _refundAttributeAdvance(t){return z.apply(this,arguments)})},{key:"_advancePoints",value:(M=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee20(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee20$(i){for(;;)switch(i.prev=i.next){case 0:return a=Number(this.actor.system.stats[r].advances),o=t.Z._calculateAdvCost(a,"D"),i.next=4,this._checkEnoughXP(o);case 4:if(i.t0=i.sent,!i.t0){i.next=7;break}i.t0=this._checkMaximumPointAdvancement(r,a+1);case 7:if(!i.t0){i.next=10;break}return i.next=10,this._updateAPs(o,_defineProperty({},"system.stats.".concat(r,".advances"),Number(this.actor.system.stats[r].advances)+1));case 10:case"end":return i.stop()}}),_callee20,this)}))),function _advancePoints(t){return M.apply(this,arguments)})},{key:"_refundPointsAdvance",value:(j=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee21(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee21$(i){for(;;)switch(i.prev=i.next){case 0:if(!((a=Number(this.actor.system.stats[r].advances))>0)){i.next=5;break}return o=-1*t.Z._calculateAdvCost(a,"D",0),i.next=5,this._updateAPs(o,_defineProperty({},"system.stats.".concat(r,".advances"),Number(this.actor.system.stats[r].advances)-1));case 5:case"end":return i.stop()}}),_callee21,this)}))),function _refundPointsAdvance(t){return j.apply(this,arguments)})},{key:"_advanceItem",value:(G=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee22(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee22$(i){for(;;)switch(i.prev=i.next){case 0:return a=this.actor.items.get(r).toObject(),o=t.Z._calculateAdvCost(Number(a.system.level),a.system.StF),i.next=4,this._checkEnoughXP(o);case 4:if(i.t0=i.sent,!i.t0){i.next=7;break}i.t0=this._checkMaximumItemAdvancement(a,Number(a.system.level)+1);case 7:if(!i.t0){i.next=12;break}return i.next=10,this.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.level":a.system.level+1}]);case 10:return i.next=12,this._updateAPs(o);case 12:case"end":return i.stop()}}),_callee22,this)}))),function _advanceItem(t){return G.apply(this,arguments)})},{key:"_refundItemAdvance",value:(L=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee23(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee23$(i){for(;;)switch(i.prev=i.next){case 0:if(!((a=this.actor.items.get(r).toObject()).system.level>0)){i.next=7;break}return o=-1*t.Z._calculateAdvCost(Number(a.system.level),a.system.StF,0),i.next=5,this.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.level":a.system.level-1}]);case 5:return i.next=7,this._updateAPs(o);case 7:case"end":return i.stop()}}),_callee23,this)}))),function _refundItemAdvance(t){return L.apply(this,arguments)})},{key:"_checkMaximumItemAdvancement",value:function _checkMaximumItemAdvancement(t,r){var a=!1;switch(t.type){case"combatskill":a=r<=this.maxByAttr(t,"dsk.LocalizedIDs.exceptionalCombatTechnique");break;case"ahnengabe":case"skill":a=r<=this.maxByAttr(t,"dsk.LocalizedIDs.exceptionalSkill")}return a||ui.notifications.error(game.i18n.localize("dsk.DSKError.AdvanceMaximumReached")),a}},{key:"maxByAttr",value:function maxByAttr(t,r){return Math.max.apply(Math,[this.actor.system.characteristics[t.system.characteristic1].value,this.actor.system.characteristics[t.system.characteristic2].value])+2+m.Z.vantageStep(this.actor,"".concat(game.i18n.localize(r)," (").concat(t.name,")"))}},{key:"_checkEnoughXP",value:(R=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee24(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee24$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.actor.checkEnoughXP(t);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),_callee24,this)}))),function _checkEnoughXP(t){return R.apply(this,arguments)})},{key:"_checkMaximumPointAdvancement",value:function _checkMaximumPointAdvancement(t,r){var a=!1;switch(t){case"LeP":a=r<=this.actor.system.characteristics.ko.value;break;case"AeP":a=r<=(null==this.actor.system.characteristics[this.actor.system.guidevalue]?0:this.actor.system.characteristics[this.actor.system.guidevalue].value)}return a||ui.notifications.error(game.i18n.localize("dsk.DSKError.AdvanceMaximumReached")),a}},{key:"_onItemCreate",value:function _onItemCreate(r){r.preventDefault();var o=r.currentTarget,i=duplicate(o.dataset);d.Z.equipmentTypes[i.type]&&(i.type="equipment",i=mergeObject(i,{"system.category":r.currentTarget.attributes["item-section"].value,"system.effect":""})),["aggregatedTest","ahnengabe"].includes(i.type)||(i["system.weight"]=0,i["system.quantity"]=0),a.Z.defaultIcon(i),i.name=t.Z.categoryLocalization(i.type),this.actor.createEmbeddedDocuments("Item",[i])}},{key:"_onMacroUseItem",value:function _onMacroUseItem(t){var r=this.actor.items.get(this._getItemId(t));new OnUseEffect(r).executeOnUseEffect()}},{key:"_filterGear",value:function _filterGear(t){if(null!=t.val()){var r=t.val().toLowerCase().trim(),a=$(this.element).find(".inventory .item");a.removeClass("filterHide"),a.filter((function(){return-1==$(this).find("a.item-edit").text().toLowerCase().trim().indexOf(r)})).addClass("filterHide")}}},{key:"_filterTalents",value:function _filterTalents(t){if(null!=t.val()){var r=t.val().toLowerCase().trim(),a=$(this.form).parent().find(".allTalents");a.find(".item, .table-header, .table-title").removeClass("filterHide"),a.addClass("showAll").find(".item").filter((function(){return-1==$(this).find(".talentName").text().toLowerCase().trim().indexOf(r)})).addClass("filterHide"),r.length>0?(a.find(".table-header, .table-title:not(:eq(0))").addClass("filterHide"),a.addClass("filterfull")):a.removeClass("filterfull")}}},{key:"_filterConditions",value:function _filterConditions(t){if(null!=t.val()){var r=t.val().toLowerCase().trim(),a=$(this.form).find(".statusEffectMenu li:not(.search)");a.removeClass("filterHide"),a.filter((function(){return-1==game.i18n.localize($(this).find("a").attr("data-tooltip")).toLowerCase().trim().indexOf(r)})).addClass("filterHide")}}},{key:"_deleteActiveEffect",value:(D=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee25(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:if(this.isEditable){a.next=2;break}return a.abrupt("return");case 2:if(!(r=this.actor.effects.find((function(r){return r.id==t})))){a.next=8;break}if(!(this.token?this.token.actor:this.actor)){a.next=8;break}return a.next=8,this.actor.deleteEmbeddedDocuments("ActiveEffect",[r.id]);case 8:case"end":return a.stop()}}),_callee25,this)}))),function _deleteActiveEffect(t){return D.apply(this,arguments)})},{key:"_deleteItem",value:function _deleteItem(t){var r=this;if(this.isEditable){var a=this._getItemId(t),o=this.actor.items.get(a),i=game.i18n.format("dsk.DIALOG.DeleteItemDetail",{item:o.name});renderTemplate("systems/dsk/templates/dialog/delete-item-dialog.html",{message:i}).then((function(t){new Dialog({title:game.i18n.localize("dsk.DIALOG.deleteConfirmation"),content:t,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){return r._cleverDeleteItem(a)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0)}))}}},{key:"_addVantage",value:(A=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee26(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:m.Z.needsAdoption(this.actor,t,r);case 1:case"end":return a.stop()}}),_callee26,this)}))),function _addVantage(t,r){return A.apply(this,arguments)})},{key:"_addSpecialAbility",value:(C=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee27(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:g.Z.needsAdoption(this.actor,t,r);case 1:case"end":return a.stop()}}),_callee27,this)}))),function _addSpecialAbility(t,r){return C.apply(this,arguments)})},{key:"_cleverDeleteItem",value:(E=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee28(r){var a,o,i,c,u,l,p;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee28$(d){for(;;)switch(d.prev=d.next){case 0:a=this.actor.items.get(r),o=[r],d.t0=a.type,d.next="advantage"===d.t0||"disadvantage"===d.t0?5:"specialability"===d.t0?12:"ahnengeschenk"===d.t0?15:"ahnengabe"===d.t0?18:23;break;case 5:return d.next=7,m.Z.vantageRemoved(this.actor,a);case 7:if(i=a.system.ap*(a.system.level||1),/;/.test(a.system.ap))for(c=a.system.ap.split(";").map((function(t){return Number(t.trim())})),i=0,u=0;u<a.system.level;u++)i+=c[u];return d.next=11,this._updateAPs(-1*i);case 11:case 14:case 17:case 22:return d.abrupt("break",23);case 12:return d.next=14,g.Z.abilityRemoved(this.actor,a);case 15:return d.next=17,this._updateAPs(-1);case 18:for(l=0,p=0;p<=a.system.level;p++)l+=t.Z._calculateAdvCost(p,a.system.StF,0);return d.next=22,this._updateAPs(-1*l);case 23:return d.next=25,this.actor.deleteEmbeddedDocuments("Item",o);case 25:case"end":return d.stop()}}),_callee28,this)}))),function _cleverDeleteItem(t){return E.apply(this,arguments)})},{key:"_getItemId",value:function _getItemId(t){return $(t.currentTarget).parents(".item").attr("data-item-id")}},{key:"_onDragStart",value:function _onDragStart(t){var r=t.currentTarget;if(!t.target.classList.contains("content-link")){var a;if(r.dataset.itemId)a=this.actor.items.get(r.dataset.itemId).toDragData(),r.dataset.mod&&(a.mod=r.dataset.mod);if(r.dataset.id)a=this.actor.effects.get(r.dataset.id).toDragData();a&&t.dataTransfer.setData("text/plain",JSON.stringify(a))}}},{key:"_addUniqueItem",value:(I=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee29(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee29$(r){for(;;)switch(r.prev=r.next){case 0:if(t=duplicate(t),this.actor.items.some((function(r){return a.Z.areEquals(t,r)}))){r.next=5;break}return r.next=4,this.actor.createEmbeddedDocuments("Item",[t]);case 4:return r.abrupt("return",r.sent[0]);case 5:case"end":return r.stop()}}),_callee29,this)}))),function _addUniqueItem(t){return I.apply(this,arguments)})},{key:"handleItemCopy",value:(T=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee30(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:if(!d.Z.equipmentCategories.includes(r)){a.next=5;break}return t.name+=" (Copy)",a.next=4,this._addLoot(t);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}}),_callee30,this)}))),function handleItemCopy(t,r){return T.apply(this,arguments)})},{key:"_addLoot",value:(P=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee31(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee31$(o){for(;;)switch(o.prev=o.next){case 0:if(t=duplicate(t),r=this.actor.items.find((function(r){return a.Z.areEquals(t,r)}))){o.next=9;break}return"combat"==this._tabs[0].active&&t.system.worn&&(t.system.worn.value=!0),o.next=6,this.actor.createEmbeddedDocuments("Item",[t]);case 6:case 11:return o.abrupt("return",o.sent[0]);case 9:return o.next=11,a.Z.stackItems(r,t,this.actor);case 12:case"end":return o.stop()}}),_callee31,this)}))),function _addLoot(t){return P.apply(this,arguments)})},{key:"_manageDragItems",value:(S=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee32(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee32$(a){for(;;)switch(a.prev=a.next){case 0:a.t0=r,a.next="meleeweapon"===a.t0||"rangeweapon"===a.t0||"equipment"===a.t0||"ammunition"===a.t0||"armor"===a.t0||"poison"===a.t0?3:"disadvantage"===a.t0||"advantage"===a.t0?7:"specialability"===a.t0?10:"information"===a.t0||"skill"===a.t0?13:"ahnengabe"===a.t0||"ahnengeschenk"===a.t0?16:"effectwrapper"===a.t0?19:22;break;case 3:return a.next=5,this._addLoot(t);case 5:return a.abrupt("return",a.sent);case 7:return a.next=9,this._addVantage(t,r);case 9:return a.abrupt("break",23);case 10:return a.next=12,this._addSpecialAbility(t,r);case 12:return a.abrupt("break",23);case 13:return a.next=15,this._addUniqueItem(t);case 15:return a.abrupt("break",23);case 16:return a.next=18,this._addSpellOrLiturgy(t);case 18:return a.abrupt("break",23);case 19:return a.next=21,this._handleEffectWrapper(t);case 21:return a.abrupt("break",23);case 22:ui.notifications.error(game.i18n.format("dsk.DSKError.canNotBeAdded",{item:t.name,category:game.i18n.localize(t.type)}));case 23:case"end":return a.stop()}}),_callee32,this)}))),function _manageDragItems(t,r){return S.apply(this,arguments)})},{key:"_updateAPs",value:(O=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee33(t){var r,a=arguments;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee33$(o){for(;;)switch(o.prev=o.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},o.next=3,this.actor._updateAPs(t,r);case 3:case"end":return o.stop()}}),_callee33,this)}))),function _updateAPs(t){return O.apply(this,arguments)})},{key:"_addSpellOrLiturgy",value:(x=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee34(r){var a,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee34$(i){for(;;)switch(i.prev=i.next){case 0:if(a=this.actor.items.find((function(t){return t.type==r.type&&t.name==r.name})),r=duplicate(r),a){i.next=18;break}i.t0=r.type,i.next="ahnengabe"===i.t0?6:"ahnengeschenk"===i.t0?8:10;break;case 6:return o=t.Z._calculateAdvCost(0,r.system.StF,0),i.abrupt("break",11);case 8:return o=1,i.abrupt("break",11);case 10:return i.abrupt("return");case 11:return i.next=13,this.actor.checkEnoughXP(o);case 13:if(!i.sent){i.next=18;break}return i.next=16,this._updateAPs(o);case 16:return i.next=18,this.actor.createEmbeddedDocuments("Item",[r]);case 18:case"end":return i.stop()}}),_callee34,this)}))),function _addSpellOrLiturgy(t){return x.apply(this,arguments)})},{key:"_handleEffectWrapper",value:(w=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee35(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee35$(r){for(;;)switch(r.prev=r.next){case 0:this.actor.createEmbeddedDocuments("ActiveEffect",t.effects.map((function(t){return t.origin=null,t})));case 1:case"end":return r.stop()}}),_callee35,this)}))),function _handleEffectWrapper(t){return w.apply(this,arguments)})},{key:"_onDropItemCreate",value:(k=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee36(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee36$(r){for(;;)switch(r.prev=r.next){case 0:if(!(t instanceof Array)){r.next=2;break}return r.abrupt("return",this.actor.createEmbeddedDocuments("Item",t));case 2:return r.next=4,this._manageDragItems(t,t.type);case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}),_callee36,this)}))),function _onDropItemCreate(t){return k.apply(this,arguments)})},{key:"_onDropActor",value:(b=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee37(t,r){var a,o,i;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee37$(t){for(;;)switch(t.prev=t.next){case 0:if(this.actor.isOwner){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,(0,v.x8)(r,this.id,!1);case 4:if(a=t.sent,o=a.item,i=a.typeClass,!a.selfTarget){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,this._manageDragItems(o,i);case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),_callee37,this)}))),function _onDropActor(t,r){return b.apply(this,arguments)})},{key:"_onDropActiveEffect",value:(_=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee38(t,r){var a,o,i;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee38$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ActiveEffect.implementation.fromDropData(r);case 2:if(o=t.sent,this.actor.isOwner&&o){t.next=5;break}return t.abrupt("return",!1);case 5:if(this.actor.uuid!==(null===(a=o.parent)||void 0===a?void 0:a.uuid)){t.next=7;break}return t.abrupt("return",!1);case 7:return(i=o.toObject()).origin=this.actor.uuid,t.abrupt("return",ActiveEffect.create(i,{parent:this.actor}));case 10:case"end":return t.stop()}}),_callee38,this)}))),function _onDropActiveEffect(t,r){return _.apply(this,arguments)})},{key:"_onDropItem",value:(c=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee39(t,r){var a,o,i,c,u,l,p;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee39$(h){for(;;)switch(h.prev=h.next){case 0:if(this.actor.isOwner){h.next=2;break}return h.abrupt("return",!1);case 2:return h.next=4,Item.implementation.fromDropData(r);case 4:if(o=h.sent,i=o.toObject(),y.Z.obfuscateDropData(i,r.tabsinvisible),(u=$(t.target).parents(".item"))&&"bags"==u.attr("data-category")&&d.Z.equipmentCategories.includes(o.type)&&u.attr("data-item-id")!=o.id&&(c=u.attr("data-item-id")),!(l=this.actor.uuid===(null===(a=o.parent)||void 0===a?void 0:a.uuid))){h.next=28;break}if(!t.ctrlKey){h.next=16;break}return h.next=14,this.handleItemCopy(i,o.type);case 14:case 21:h.next=26;break;case 16:if(!c){h.next=23;break}return p={_id:o.id,"system.parent_id":c},o.system.worn&&o.system.worn.value&&(p["system.worn.value"]=!1),h.next=21,this.actor.updateEmbeddedDocuments("Item",[p]);case 23:if(!d.Z.equipmentCategories.includes(o.type)){h.next=26;break}return h.next=26,this.actor.updateEmbeddedDocuments("Item",[{_id:o.id,system:{parent_id:0}}]);case 26:h.next=30;break;case 28:return h.next=30,this._onDropItemCreate(i);case 30:if(!t.altKey||l||!d.Z.equipmentCategories.includes(o.type)){h.next=33;break}return h.next=33,this._handleRemoveSourceOnDrop(o);case 33:case"end":return h.stop()}}),_callee39,this)}))),function _onDropItem(t,r){return c.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"skills"}],mergeObject(t,{width:770,height:740,scrollY:[".save-scroll"],dragDrop:[{dragSelector:".content .item",dropSelector:null},{dragSelector:".mainEffects .statusEffect",dropSelector:null}]}),t}}]),ActorSheetDSK}();function obfuscatemixin_typeof(t){return obfuscatemixin_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},obfuscatemixin_typeof(t)}function obfuscatemixin_regeneratorRuntime(){obfuscatemixin_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==obfuscatemixin_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function obfuscatemixin_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function obfuscatemixin_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){obfuscatemixin_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){obfuscatemixin_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function obfuscatemixin_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function obfuscatemixin_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function obfuscatemixin_get(){return obfuscatemixin_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=obfuscatemixin_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},obfuscatemixin_get.apply(this,arguments)}function obfuscatemixin_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=obfuscatemixin_getPrototypeOf(t)););return t}function obfuscatemixin_setPrototypeOf(t,r){return obfuscatemixin_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},obfuscatemixin_setPrototypeOf(t,r)}function obfuscatemixin_createSuper(t){var r=function obfuscatemixin_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=obfuscatemixin_getPrototypeOf(t);if(r){var i=obfuscatemixin_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return obfuscatemixin_possibleConstructorReturn(this,a)}}function obfuscatemixin_possibleConstructorReturn(t,r){if(r&&("object"===obfuscatemixin_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function obfuscatemixin_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function obfuscatemixin_getPrototypeOf(t){return obfuscatemixin_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},obfuscatemixin_getPrototypeOf(t)}var b=function ItemSheetObfuscation(t){return function(t){!function obfuscatemixin_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&obfuscatemixin_setPrototypeOf(t,r)}(_class,t);var r,a,o=obfuscatemixin_createSuper(_class);function _class(){return obfuscatemixin_classCallCheck(this,_class),o.apply(this,arguments)}return function obfuscatemixin_createClass(t,r,a){return r&&obfuscatemixin_defineProperties(t.prototype,r),a&&obfuscatemixin_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(_class,[{key:"obfuscateItem",value:(a=obfuscatemixin_asyncToGenerator(obfuscatemixin_regeneratorRuntime().mark((function _callee(t){var r;return obfuscatemixin_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t.stopPropagation(),t.preventDefault(),r=t.currentTarget.dataset.obfuscate,a.next=5,this.item.update((o={},i="system.obfuscation.".concat(r),c=!this.isObfuscated(r),i in o?Object.defineProperty(o,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):o[i]=c,o));case 5:case"end":return a.stop()}var o,i,c}),_callee,this)}))),function obfuscateItem(t){return a.apply(this,arguments)})},{key:"isObfuscated",value:function isObfuscated(t){return getProperty(this.item,"system.obfuscation.".concat(t))}},{key:"activateListeners",value:function activateListeners(t){var r=this;obfuscatemixin_get(obfuscatemixin_getPrototypeOf(_class.prototype),"activateListeners",this).call(this,t),t.on("click",".obfuscateSection",(function(t){return r.obfuscateItem(t)}))}},{key:"obfuscationCss",value:function obfuscationCss(t){return this.isObfuscated(t)?"":" pale"}},{key:"_render",value:(r=obfuscatemixin_asyncToGenerator(obfuscatemixin_regeneratorRuntime().mark((function _callee2(){var t,r,a,o,i,c,u,l,p,d,h,y,m,g,v=arguments;return obfuscatemixin_regeneratorRuntime().wrap((function _callee2$(_){for(;;)switch(_.prev=_.next){case 0:return t=v.length>0&&void 0!==v[0]&&v[0],r=v.length>1&&void 0!==v[1]?v[1]:{},_.next=4,obfuscatemixin_get(obfuscatemixin_getPrototypeOf(_class.prototype),"_render",this).call(this,t,r);case 4:a=!1,o=0,i=["details","effects","description","enchantment"];case 7:if(!(o<i.length)){_.next=18;break}if(c=i[o],(u=$(this._element).find('nav [data-tab="'.concat(c,'"]'))).length){_.next=12;break}return _.abrupt("continue",15);case 12:l=r.tabsinvisible||this.isObfuscated(c),p=game.i18n.localize("dsk.SHEET.".concat(l?"deobfuscateItem":"obfuscateItem")),game.user.isGM?(d="obfuscateSection".concat(this.obfuscationCss(c)),h=u.find(".".concat(d)),y='<a data-tooltip="'.concat(p,'" class="obfuscationBtn ').concat(d,'" data-obfuscate="').concat(c,'"><i class="fas fa-mask"></i></a>'),h.length?h.replaceWith(y):u.append(" ".concat(y))):l&&(u.hasClass("active")&&(a=!0),u.remove(),"details"==c&&$(this._element).find('[name="system.price"]').replaceWith("<label>?</label>"));case 15:o++,_.next=7;break;case 18:if(!a){_.next=28;break}if(!(m=$(this._element).find("nav .item:first-child")).length){_.next=24;break}this.activateTab(m.attr("data-tab")),_.next=28;break;case 24:return _.next=26,renderTemplate("systems/dsk/templates/items/obfuscatedItem.html",{item:this.item});case 26:g=_.sent,$(this._element).find(".content").html(g);case 28:case"end":return _.stop()}}),_callee2,this)}))),function _render(){return r.apply(this,arguments)})}]),_class}(t)};function item_sheet_dsk_typeof(t){return item_sheet_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},item_sheet_dsk_typeof(t)}function item_sheet_dsk_regeneratorRuntime(){item_sheet_dsk_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==item_sheet_dsk_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function item_sheet_dsk_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function item_sheet_dsk_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){item_sheet_dsk_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){item_sheet_dsk_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function item_sheet_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function item_sheet_dsk_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function item_sheet_dsk_createClass(t,r,a){return r&&item_sheet_dsk_defineProperties(t.prototype,r),a&&item_sheet_dsk_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function item_sheet_dsk_get(){return item_sheet_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=item_sheet_dsk_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},item_sheet_dsk_get.apply(this,arguments)}function item_sheet_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=item_sheet_dsk_getPrototypeOf(t)););return t}function item_sheet_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&item_sheet_dsk_setPrototypeOf(t,r)}function item_sheet_dsk_setPrototypeOf(t,r){return item_sheet_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},item_sheet_dsk_setPrototypeOf(t,r)}function item_sheet_dsk_createSuper(t){var r=function item_sheet_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=item_sheet_dsk_getPrototypeOf(t);if(r){var i=item_sheet_dsk_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return item_sheet_dsk_possibleConstructorReturn(this,a)}}function item_sheet_dsk_possibleConstructorReturn(t,r){if(r&&("object"===item_sheet_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function item_sheet_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function item_sheet_dsk_getPrototypeOf(t){return item_sheet_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},item_sheet_dsk_getPrototypeOf(t)}var k=function(r){item_sheet_dsk_inherits(ItemSheetDSK,ItemSheet);var a,o,i=item_sheet_dsk_createSuper(ItemSheetDSK);function ItemSheetDSK(){return item_sheet_dsk_classCallCheck(this,ItemSheetDSK),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetDSK,[{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,a=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK.prototype),"_getHeaderButtons",this).call(this);return a.unshift({class:"showItemHead",icon:"fas fa-comment",onclick:(t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee(){return item_sheet_dsk_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.item.postItem());case 1:case"end":return t.stop()}}),_callee)}))),function onclick(){return t.apply(this,arguments)})}),a}},{key:"template",get:function get(){return"systems/dsk/templates/items/item-".concat(this.item.type,"-sheet.html")}},{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee2(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return r=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK.prototype),"getData",this).call(this,t).data,a.t0=mergeObject,a.t1=r,a.t2=this.item.actor,a.t3=this.isEditable,a.t4=this.item,a.t5=game.user.isGM,a.next=9,TextEditor.enrichHTML(getProperty(this.item.system,"description.value"),{secrets:!0,async:!0});case 9:return a.t6=a.sent,a.next=12,TextEditor.enrichHTML(getProperty(this.item.system,"description.gminfo"),{secrets:!0,async:!0});case 12:return a.t7=a.sent,a.t8={isOwned:a.t2,editable:a.t3,item:a.t4,isGM:a.t5,enrichedDescription:a.t6,enrichedGmdescription:a.t7},(0,a.t0)(a.t1,a.t8),u.Z.prepareActiveEffects(this.item,r),a.abrupt("return",r);case 17:case"end":return a.stop()}}),_callee2,this)}))),function getData(t){return o.apply(this,arguments)})},{key:"advanceWrapper",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee3(t,r){var a,o;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:if(a=$(t.currentTarget),(o=a.find("i")).hasClass("fa-spin")){i.next=7;break}return o.addClass("fa-spin fa-spinner"),i.next=6,this[r]();case 6:o.removeClass("fa-spin fa-spinner");case 7:case"end":return i.stop()}}),_callee3,this)}))),function advanceWrapper(t,r){return a.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(r){var a=this;item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK.prototype),"activateListeners",this).call(this,r),r.find(".advance-step").mousedown((function(t){return a.advanceWrapper(t,"_advanceStep")})),r.find(".refund-step").mousedown((function(t){return a.advanceWrapper(t,"_refundStep")})),r.find('[data-edit="img"]').mousedown((function(r){2==r.button&&t.Z.showArtwork(a.item)})),r.find(".status-add").click((function(){a.item.actor?ui.notifications.error(game.i18n.localize("dsk.DSKError.nestedEffectNotSupported")):u.Z.createCustomEffect(a.item,"",a.item.name)})),r.find(".condition-show").mousedown((function(t){t.preventDefault();var r=$(t.currentTarget).attr("data-id");0==t.button?a.item.effects.get(r).sheet.render(!0):2==t.button&&a.item.deleteEmbeddedDocuments("ActiveEffect",[r])})),r.find(".condition-toggle").mousedown((function(t){var r=$(t.currentTarget).parents(".statusEffect").attr("data-id"),o=a.item.effects.get(r);o.update({disabled:!o.system.disabled})})),r.find(".condition-edit").click((function(t){a.item.effects.get($(t.currentTarget).attr("data-id")).sheet.render(!0)})),l.Z.bindRollCommands(r),u.Z.bindButtons(r);var o=r.find(".item-header");if(o.length){var i=o.find("svg");if(i){new ResizeObserver((function(t){var r=t[0];(0,v.zJ)(i,r.contentRect.width)})).observe(o.get(0));var c=o.find("input");c.get(0).disabled||(i.click((function(){i.hide(),c.show(),c.focus()})),c.blur((function(){i.show(),c.hide()})))}}}}],[{key:"setupSheets",value:function setupSheets(){Items.unregisterSheet("core",ItemSheet),Items.registerSheet("dsk",S,{makeDefault:!0,types:["meleeweapon"]}),Items.registerSheet("dsk",P,{makeDefault:!0,types:["rangeweapon"]}),Items.registerSheet("dsk",T,{makeDefault:!0,types:["armor"]}),Items.registerSheet("dsk",I,{makeDefault:!0,types:["ammunition"]}),Items.registerSheet("dsk",E,{makeDefault:!0,types:["equipment"]}),Items.registerSheet("dsk",C,{makeDefault:!0,types:["species"]}),Items.registerSheet("dsk",A,{makeDefault:!0,types:["culture"]}),Items.registerSheet("dsk",D,{makeDefault:!0,types:["profession"]}),Items.registerSheet("dsk",R,{makeDefault:!0,types:["advantage"]}),Items.registerSheet("dsk",L,{makeDefault:!0,types:["disadvantage"]}),Items.registerSheet("dsk",G,{makeDefault:!0,types:["specialability"]}),Items.registerSheet("dsk",j,{makeDefault:!0,types:["ahnengeschenk"]}),Items.registerSheet("dsk",M,{makeDefault:!0,types:["ahnengabe"]}),Items.registerSheet("dsk",z,{makeDefault:!0,types:["poison"]}),Items.registerSheet("dsk",N,{makeDefault:!0,types:["skill"]}),Items.registerSheet("dsk",H,{makeDefault:!0,types:["combatskill"]}),Items.registerSheet("dsk",O,{makeDefault:!0,types:["information"]}),Items.registerSheet("dsk",w,{makeDefault:!0,types:["effectwrapper"]}),Items.registerSheet("dsk",x,{makeDefault:!0,types:["trait"]})}},{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content"}],mergeObject(t,{classes:t.classes.concat(["dsk","item"]),width:450,height:500}),t}}]),ItemSheetDSK}(),w=function(t){item_sheet_dsk_inherits(ItemSheetEffectwrapper,t);var r=item_sheet_dsk_createSuper(ItemSheetEffectwrapper);function ItemSheetEffectwrapper(){return item_sheet_dsk_classCallCheck(this,ItemSheetEffectwrapper),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetEffectwrapper)}(k),x=function(t){item_sheet_dsk_inherits(ItemSheetTrait,t);var r,a=item_sheet_dsk_createSuper(ItemSheetTrait);function ItemSheetTrait(){return item_sheet_dsk_classCallCheck(this,ItemSheetTrait),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetTrait,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee4(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetTrait.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{traitCategories:d.Z.traitCategories,ranges:d.Z.meleeRanges}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee4,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetTrait}(k),O=function(r){item_sheet_dsk_inherits(ItemSheetInformation,r);var a,o=item_sheet_dsk_createSuper(ItemSheetInformation);function ItemSheetInformation(){return item_sheet_dsk_classCallCheck(this,ItemSheetInformation),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetInformation,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee5(r){var a;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetInformation.prototype),"getData",this).call(this,r);case 2:return a=o.sent,o.t0=mergeObject,o.t1=a,o.next=7,t.Z.allSkillsList(["skill"]);case 7:return o.t2=o.sent.skills,o.t3={allSkills:o.t2},(0,o.t0)(o.t1,o.t3),o.abrupt("return",a);case 11:case"end":return o.stop()}}),_callee5,this)}))),function getData(t){return a.apply(this,arguments)})}]),ItemSheetInformation}(k),S=function(r){item_sheet_dsk_inherits(ItemSheetMeleeweapon,r);var a,o=item_sheet_dsk_createSuper(ItemSheetMeleeweapon);function ItemSheetMeleeweapon(){return item_sheet_dsk_classCallCheck(this,ItemSheetMeleeweapon),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetMeleeweapon,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee6(r){var a,o,i,c,u,l,p=this;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetMeleeweapon.prototype),"getData",this).call(this,r);case 2:if(a=h.sent,i="",o=!1){h.next=9;break}i="wrongGrip.yieldTwo",h.next=17;break;case 9:c=game.i18n.localize("dsk.LocalizedCTs.".concat(this.item.system.combatskill)),h.t0=c,h.next="Two-Handed Impact Weapons"===h.t0||"Two-Handed Swords"===h.t0?13:16;break;case 13:return u=new RegExp(game.i18n.localize("dsk.wrongGrip.wrongGripBastardRegex")),i=u.test(this.item.name)?"wrongGrip.yieldOneBastard":"wrongGrip.yieldOneSwordBlunt",h.abrupt("break",17);case 16:i="wrongGrip.yieldOnePolearms";case 17:return h.t1=mergeObject,h.t2=a,h.t3=o,h.t4=o?"wrongGrip.oneHanded":"wrongGrip.twoHanded",h.t5=i,h.t6=this.item.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Shields"),h.next=25,t.Z.allSkillsList(["combatskill"]);case 25:if(h.t7=h.sent.meleeSkills,h.t8=d.Z.meleeRanges,h.t9=d.Z.shieldSizes,h.t10={twoHanded:h.t3,wrongGripLabel:h.t4,wrongGripHint:h.t5,isShield:h.t6,combatskills:h.t7,ranges:h.t8,shieldSizes:h.t9},(0,h.t1)(h.t2,h.t10),this.item.actor&&(l=this.item.actor.items.find((function(t){return"combatskill"==t.type&&t.name==p.item.system.combatskill})),a.canBeOffHand=l&&!l.system.weapontype.twoHanded&&this.item.system.worn.value,a.canBeWrongGrip=!["Daggers","Fencing Weapons"].includes(game.i18n.localize("dsk.LocalizedCTs.".concat(this.item.system.combatskill)))),h.t11=game.user.isGM,h.t11){h.next=36;break}return h.next=35,game.settings.get("dsk","playerCanEditSpellMacro");case 35:h.t11=h.sent;case 36:return a.canOnUseEffect=h.t11,h.abrupt("return",a);case 38:case"end":return h.stop()}}),_callee6,this)}))),function getData(t){return a.apply(this,arguments)})}]),ItemSheetMeleeweapon}(b(k)),P=function(r){item_sheet_dsk_inherits(ItemSheetRangeweapon,r);var a,o=item_sheet_dsk_createSuper(ItemSheetRangeweapon);function ItemSheetRangeweapon(){return item_sheet_dsk_classCallCheck(this,ItemSheetRangeweapon),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetRangeweapon,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee7(r){var a;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetRangeweapon.prototype),"getData",this).call(this,r);case 2:if(a=o.sent,o.t0=mergeObject,o.t1=a,o.t2=game.user.isGM,o.t2){o.next=10;break}return o.next=9,game.settings.get("dsk","playerCanEditSpellMacro");case 9:o.t2=o.sent;case 10:return o.t3=o.t2,o.t4=d.Z.ammunitiongroups,o.next=14,t.Z.allSkillsList(["combatskill"]);case 14:return o.t5=o.sent.rangeSkills,o.t6={canOnUseEffect:o.t3,ammunitiongroups:o.t4,combatskills:o.t5},(0,o.t0)(o.t1,o.t6),o.abrupt("return",a);case 18:case"end":return o.stop()}}),_callee7,this)}))),function getData(t){return a.apply(this,arguments)})}]),ItemSheetRangeweapon}(b(k)),T=function(t){item_sheet_dsk_inherits(ItemSheetArmor,t);var r=item_sheet_dsk_createSuper(ItemSheetArmor);function ItemSheetArmor(){return item_sheet_dsk_classCallCheck(this,ItemSheetArmor),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetArmor)}(b(k)),I=function(t){item_sheet_dsk_inherits(ItemSheetAmmunition,t);var r,a=item_sheet_dsk_createSuper(ItemSheetAmmunition);function ItemSheetAmmunition(){return item_sheet_dsk_classCallCheck(this,ItemSheetAmmunition),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAmmunition,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee8(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAmmunition.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{ammunitiongroups:d.Z.ammunitiongroups}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee8,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetAmmunition}(b(k)),E=function(t){item_sheet_dsk_inherits(ItemSheetEquipment,t);var r,a,o,i=item_sheet_dsk_createSuper(ItemSheetEquipment);function ItemSheetEquipment(){return item_sheet_dsk_classCallCheck(this,ItemSheetEquipment),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetEquipment,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee9(t){var r,a,o=this;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee9$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetEquipment.prototype),"getData",this).call(this,t);case 2:if(r=i.sent,i.t0=mergeObject,i.t1=r,i.t2=d.Z.equipmentTypes,i.t3=game.user.isGM,i.t3){i.next=11;break}return i.next=10,game.settings.get("dsk","playerCanEditSpellMacro");case 10:i.t3=i.sent;case 11:return i.t4=i.t3,i.t5={equipmentTypes:i.t2,canOnUseEffect:i.t4},(0,i.t0)(i.t1,i.t5),this.isBagWithContents()&&(a=0,mergeObject(r,{containerContent:this.item.actor.items.filter((function(t){return d.Z.equipmentCategories.includes(t.type)&&t.system.parent_id==o.item.id})).map((function(t){return t.weight=parseFloat((t.system.weight*t.system.quantity).toFixed(3)),a+=Number(t.weight),t})),weightSum:parseFloat(a.toFixed(3)),weightWidth:'style="width: '.concat(Math.min(this.item.system.capacity?a/this.item.system.capacity*100:0,100),'%"'),weightExceeded:a>Number(this.item.system.capacity)?"exceeded":""})),i.abrupt("return",r);case 16:case"end":return i.stop()}}),_callee9,this)}))),function getData(t){return o.apply(this,arguments)})},{key:"breakOverflow",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee10(t,r){var a,o,i;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return c.t0=$,c.next=3,renderTemplate("systems/dsk/templates/items/baghover.html",t);case 3:return c.t1=c.sent,a=(0,c.t0)(c.t1),o=r.offset().top+52,i=r.offset().left-75,a.appendTo($("body")),a.css({position:"absolute",left:i+"px",top:o+"px",bottom:"auto",right:"auto","z-index":1e4}),c.abrupt("return",a);case 10:case"end":return c.stop()}}),_callee10)}))),function breakOverflow(t,r){return a.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetEquipment.prototype),"activateListeners",this).call(this,t);var a=t.find(".slot");a.mouseenter(function(){var t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee11(t){var a,o;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee11$(i){for(;;)switch(i.prev=i.next){case 0:return a=$(t.currentTarget),i.next=3,r.breakOverflow({name:a.attr("data-name"),weight:a.attr("data-weight"),quantity:a.attr("data-quantity")},a);case 3:(o=i.sent).fadeIn(),a.mouseleave((function(){o.remove(),a.off("mouseleave")}));case 6:case"end":return i.stop()}}),_callee11)})));return function(r){return t.apply(this,arguments)}}()),a.mousedown(function(){var t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee12(t){var a,o;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee12$(i){for(;;)switch(i.prev=i.next){case 0:if(a=$(t.currentTarget).attr("data-item-id"),o=r.actor.items.get(a),0!=t.button){i.next=6;break}o.sheet.render(!0),i.next=11;break;case 6:if(2!=t.button){i.next=11;break}return $(".itemInfo").remove(),i.next=10,o.update({"system.parent_id":0});case 10:r.render(!0);case 11:case"end":return i.stop()}}),_callee12)})));return function(r){return t.apply(this,arguments)}}())}},{key:"isBagWithContents",value:function isBagWithContents(){return this.item.actor&&"bags"==getProperty(this.item,"system.category")}},{key:"_onDrop",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee13(t){var r,a,o,i,c,u;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee13$(l){for(;;)switch(l.prev=l.next){case 0:if(!this.isBagWithContents()){l.next=22;break}return r=JSON.parse(t.dataTransfer.getData("text/plain")),l.next=4,(0,v.x8)(r,void 0);case 4:if(a=l.sent,o=a.item,i=a.typeClass,a.selfTarget,c=this.item.id==o.id,u=this.item.parent.id==r.actorId,!d.Z.equipmentCategories.includes(i)||c){l.next=22;break}if(o.system.parent_id=this.item.id,o.system.worn&&o.system.worn.value&&(o.system.worn.value=!1),!u){l.next=18;break}return l.next=16,this.item.actor.updateEmbeddedDocuments("Item",[o]);case 16:l.next=20;break;case 18:return l.next=20,this.item.actor.sheet._addLoot(o);case 20:return this.render(!0),l.abrupt("return");case 22:return l.next=24,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetEquipment.prototype),"_onDrop",this).call(this,t);case 24:case"end":return l.stop()}}),_callee13,this)}))),function _onDrop(t){return r.apply(this,arguments)})}]),ItemSheetEquipment}(b(k)),C=function(t){item_sheet_dsk_inherits(ItemSheetSpecies,t);var r,a=item_sheet_dsk_createSuper(ItemSheetSpecies);function ItemSheetSpecies(){return item_sheet_dsk_classCallCheck(this,ItemSheetSpecies),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetSpecies,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee14(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSpecies.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{hasLocalization:game.i18n.has("dsk.Racedescr.".concat(this.item.name))}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee14,this)}))),function getData(t){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSpecies),"defaultOptions",this);return mergeObject(t,{width:530,height:570}),t}}]),ItemSheetSpecies}(k),A=function(t){item_sheet_dsk_inherits(ItemSheetCulture,t);var r=item_sheet_dsk_createSuper(ItemSheetCulture);function ItemSheetCulture(){return item_sheet_dsk_classCallCheck(this,ItemSheetCulture),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetCulture,null,[{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetCulture),"defaultOptions",this);return mergeObject(t,{width:700,height:700}),t}}]),ItemSheetCulture}(k),D=function(t){item_sheet_dsk_inherits(ItemSheetProfession,t);var r,a=item_sheet_dsk_createSuper(ItemSheetProfession);function ItemSheetProfession(){return item_sheet_dsk_classCallCheck(this,ItemSheetProfession),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetProfession,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee15(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetProfession.prototype),"getData",this).call(this,t);case 2:return r=a.sent,a.t0=mergeObject,a.t1=r,a.next=7,TextEditor.enrichHTML(getProperty(this.item.system,"description.gear"),{secrets:!0,async:!0});case 7:return a.t2=a.sent,a.t3={enrichedClothing:a.t2},(0,a.t0)(a.t1,a.t3),a.abrupt("return",r);case 11:case"end":return a.stop()}}),_callee15,this)}))),function getData(t){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetProfession),"defaultOptions",this);return mergeObject(t,{width:700,height:700}),t}}]),ItemSheetProfession}(k),R=function(t){item_sheet_dsk_inherits(ItemSheetAdvantage,t);var r,a,o,i=item_sheet_dsk_createSuper(ItemSheetAdvantage);function ItemSheetAdvantage(){return item_sheet_dsk_classCallCheck(this,ItemSheetAdvantage),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAdvantage,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee16(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAdvantage.prototype),"getData",this).call(this,t);case 2:return r=a.sent,a.next=5,TextEditor.enrichHTML(getProperty(this.item.system,"rule"),{secrets:!0,async:!0});case 5:return r.enrichedRule=a.sent,a.abrupt("return",r);case 7:case"end":return a.stop()}}),_callee16,this)}))),function getData(t){return o.apply(this,arguments)})},{key:"_advancable",value:function _advancable(){return this.item.system.max>0}},{key:"_refundStep",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee17(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:if(!(this.item.system.level>1)){a.next=7;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level-1]),a.next=5,this.item.actor._updateAPs(-1*t);case 5:return a.next=7,this.item.update({"system.level":this.item.system.level-1});case 7:case"end":return a.stop()}}),_callee17,this)}))),function _refundStep(){return a.apply(this,arguments)})},{key:"_advanceStep",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee18(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:if(!(this.item.system.level<this.item.system.max)){a.next=10;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level]),a.next=5,this.item.actor.checkEnoughXP(t);case 5:if(!a.sent){a.next=10;break}return a.next=8,this.item.actor._updateAPs(t);case 8:return a.next=10,this.item.update({"system.level":this.item.system.level+1});case 10:case"end":return a.stop()}}),_callee18,this)}))),function _advanceStep(){return r.apply(this,arguments)})}]),ItemSheetAdvantage}(k),L=function(t){item_sheet_dsk_inherits(ItemSheetDisadvantage,t);var r=item_sheet_dsk_createSuper(ItemSheetDisadvantage);function ItemSheetDisadvantage(){return item_sheet_dsk_classCallCheck(this,ItemSheetDisadvantage),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetDisadvantage)}(R),G=function(t){item_sheet_dsk_inherits(ItemSheetSpecialability,t);var r,a,o,i=item_sheet_dsk_createSuper(ItemSheetSpecialability);function ItemSheetSpecialability(){return item_sheet_dsk_classCallCheck(this,ItemSheetSpecialability),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetSpecialability,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee19(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSpecialability.prototype),"getData",this).call(this,t);case 2:return r=a.sent,a.t0=mergeObject,a.t1=r,a.t2=d.Z.specialAbilityCategories,a.t3=d.Z.combatSkillSubCategories,a.next=9,TextEditor.enrichHTML(getProperty(this.item.system,"rule"),{secrets:!0,async:!0});case 9:if(a.t4=a.sent,a.t5=game.user.isGM,a.t5){a.next=15;break}return a.next=14,game.settings.get("dsk","playerCanEditSpellMacro");case 14:a.t5=a.sent;case 15:return a.t6=a.t5,a.t7={categories:a.t2,subCategories:a.t3,enrichedRule:a.t4,canOnUseEffect:a.t6},(0,a.t0)(a.t1,a.t7),a.abrupt("return",r);case 19:case"end":return a.stop()}}),_callee19,this)}))),function getData(t){return o.apply(this,arguments)})},{key:"_refundStep",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee20(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:if(!(this.item.system.level>1)){a.next=7;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level-1]),a.next=5,this.item.actor._updateAPs(-1*t);case 5:return a.next=7,this.item.update({"system.level":this.item.system.level-1});case 7:case"end":return a.stop()}}),_callee20,this)}))),function _refundStep(){return a.apply(this,arguments)})},{key:"_advanceStep",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee21(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:if(!(this.item.system.level<this.item.system.max)){a.next=10;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level]),a.next=5,this.item.actor.checkEnoughXP(t);case 5:if(!a.sent){a.next=10;break}return a.next=8,this.item.actor._updateAPs(t);case 8:return a.next=10,this.item.update({"system.level":this.item.system.level+1});case 10:case"end":return a.stop()}}),_callee21,this)}))),function _advanceStep(){return r.apply(this,arguments)})},{key:"_advancable",value:function _advancable(){return this.item.system.max>0}}]),ItemSheetSpecialability}(k),j=function(r){item_sheet_dsk_inherits(ItemSheetAhnengeschenk,r);var a,o,i=item_sheet_dsk_createSuper(ItemSheetAhnengeschenk);function ItemSheetAhnengeschenk(){return item_sheet_dsk_classCallCheck(this,ItemSheetAhnengeschenk),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAhnengeschenk,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee22(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAhnengeschenk.prototype),"getData",this).call(this,t);case 2:if(r=a.sent,a.t0=game.user.isGM,a.t0){a.next=8;break}return a.next=7,game.settings.get("dsk","playerCanEditSpellMacro");case 7:a.t0=a.sent;case 8:return r.canOnUseEffect=a.t0,a.abrupt("return",r);case 10:case"end":return a.stop()}}),_callee22,this)}))),function getData(t){return o.apply(this,arguments)})},{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,a=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAhnengeschenk.prototype),"_getHeaderButtons",this).call(this);return this.item.isOwned&&a.unshift({class:"rolleffect",icon:"fas fa-dice-d20",onclick:(t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee23(t){return item_sheet_dsk_regeneratorRuntime().wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.setupEffect(t));case 1:case"end":return a.stop()}}),_callee23)}))),function onclick(r){return t.apply(this,arguments)})}),a}},{key:"setupEffect",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee24(r){var a,o;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee24$(r){for(;;)switch(r.prev=r.next){case 0:if(!(this.item.actor.system.stats.AeP.value<1)){r.next=2;break}return r.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.NotEnoughAeP")));case 2:return a=game.dsk.config.ItemSubClasses.ahnengeschenk,r.next=5,this.item.actor.update({"system.stats.AeP.value":this.item.actor.system.stats.AeP.value-=1});case 5:return o="<p><b>".concat(this.item.name," - ").concat(game.i18n.localize("ITEM.TypeAhnengeschenk")," ").concat(game.i18n.localize("dsk.probe"),"</b></p><p>").concat(this.item.system.description.value,"</p><p>").concat(a.chatData(this.item.system,"").join("</br>"),"</p>"),r.next=8,ChatMessage.create(t.Z.chatDataSetup(o));case 8:case"end":return r.stop()}}),_callee24,this)}))),function setupEffect(t){return a.apply(this,arguments)})}]),ItemSheetAhnengeschenk}(k),M=function(t){item_sheet_dsk_inherits(ItemSheetAhnengabe,t);var r,a=item_sheet_dsk_createSuper(ItemSheetAhnengabe);function ItemSheetAhnengabe(){return item_sheet_dsk_classCallCheck(this,ItemSheetAhnengabe),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAhnengabe,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee25(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAhnengabe.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{characteristics:d.Z.characteristics,StFs:d.Z.StFs,resistances:d.Z.magicResistanceModifiers}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee25,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetAhnengabe}(k),z=function(t){item_sheet_dsk_inherits(ItemSheetPoison,t);var r,a=item_sheet_dsk_createSuper(ItemSheetPoison);function ItemSheetPoison(){return item_sheet_dsk_classCallCheck(this,ItemSheetPoison),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetPoison,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee26(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetPoison.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{resistances:d.Z.magicResistanceModifiers}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee26,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetPoison}(b(k)),N=function(t){item_sheet_dsk_inherits(ItemSheetSkill,t);var r,a=item_sheet_dsk_createSuper(ItemSheetSkill);function ItemSheetSkill(){return item_sheet_dsk_classCallCheck(this,ItemSheetSkill),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetSkill,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee27(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSkill.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{characteristics:d.Z.characteristics,skillGroups:d.Z.skillGroups,skillBurdens:d.Z.skillBurdens,hasLocalization:game.i18n.has("dsk.SKILLdescr.".concat(this.item.name)),StFs:d.Z.StFs}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee27,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetSkill}(k),H=function(t){item_sheet_dsk_inherits(ItemSheetCombatskill,t);var r,a=item_sheet_dsk_createSuper(ItemSheetCombatskill);function ItemSheetCombatskill(){return item_sheet_dsk_classCallCheck(this,ItemSheetCombatskill),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetCombatskill,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee28(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetCombatskill.prototype),"getData",this).call(this,t);case 2:return r=a.sent,mergeObject(r,{weapontypes:d.Z.weapontypes,hasLocalization:game.i18n.has("dsk.Combatskilldescr.".concat(this.item.name))}),a.abrupt("return",r);case 5:case"end":return a.stop()}}),_callee28,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetCombatskill}(N),K=__webpack_require__(404);function dsk_wizard_typeof(t){return dsk_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dsk_wizard_typeof(t)}function dsk_wizard_regeneratorRuntime(){dsk_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dsk_wizard_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function dsk_wizard_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function dsk_wizard_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dsk_wizard_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dsk_wizard_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function dsk_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function dsk_wizard_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function dsk_wizard_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){dsk_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){dsk_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dsk_wizard_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dsk_wizard_get(){return dsk_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dsk_wizard_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dsk_wizard_get.apply(this,arguments)}function dsk_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dsk_wizard_getPrototypeOf(t)););return t}function dsk_wizard_setPrototypeOf(t,r){return dsk_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dsk_wizard_setPrototypeOf(t,r)}function dsk_wizard_createSuper(t){var r=function dsk_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dsk_wizard_getPrototypeOf(t);if(r){var i=dsk_wizard_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dsk_wizard_possibleConstructorReturn(this,a)}}function dsk_wizard_possibleConstructorReturn(t,r){if(r&&("object"===dsk_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dsk_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dsk_wizard_getPrototypeOf(t){return dsk_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dsk_wizard_getPrototypeOf(t)}var W=function(r){!function dsk_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dsk_wizard_setPrototypeOf(t,r)}(WizardDSK,Application);var a,o,i,c,u,l=dsk_wizard_createSuper(WizardDSK);function WizardDSK(t){var r;return function dsk_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,WizardDSK),(r=l.call(this,t)).items=[],r.errors=[],r.attributes=[],r.updating=!1,r}return function dsk_wizard_createClass(t,r,a){return r&&dsk_wizard_defineProperties(t.prototype,r),a&&dsk_wizard_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(WizardDSK,[{key:"updateSkill",value:(u=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee(r,a){var o,i,c,u,l,p,d=this,h=arguments;return dsk_wizard_regeneratorRuntime().wrap((function _callee$(y){for(;;)switch(y.prev=y.next){case 0:o=h.length>2&&void 0!==h[2]?h[2]:1,i=!(h.length>3&&void 0!==h[3])||h[3],c=[],u=dsk_wizard_createForOfIteratorHelper(r),y.prev=4,p=function _loop(){var r=l.value;if(["","-"].includes(r.trim()))return"continue";var u=t.Z.parseAbilityString(r.trim()),p=d.actor.items.find((function(t){return t.type==a&&t.name==u.name}));if(p){var h=duplicate(p);h.system.level=Math.max(0,o*u.step+(i?Number(h.system.level):0)),c.push(h)}else console.warn("Could not find ".concat(a," ").concat(r)),d.errors.push("".concat(t.Z.categoryLocalization(a),": ").concat(r))},u.s();case 7:if((l=u.n()).done){y.next=13;break}if("continue"!==p()){y.next=11;break}return y.abrupt("continue",11);case 11:y.next=7;break;case 13:y.next=18;break;case 15:y.prev=15,y.t0=y.catch(4),u.e(y.t0);case 18:return y.prev=18,u.f(),y.finish(18);case 21:return y.next=23,this.actor.updateEmbeddedDocuments("Item",c);case 23:case"end":return y.stop()}}),_callee,this,[[4,15,18,21]])}))),function updateSkill(t,r){return u.apply(this,arguments)})},{key:"findCompendiumItem",value:(c=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee2(t,r){var a,o,i,c;return dsk_wizard_regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:a=dsk_wizard_createForOfIteratorHelper(r),u.prev=1,i=dsk_wizard_regeneratorRuntime().mark((function _loop2(){var r,a;return dsk_wizard_regeneratorRuntime().wrap((function _loop2$(i){for(;;)switch(i.prev=i.next){case 0:return r=o.value,i.next=3,game.dsk.itemLibrary.findCompendiumItem(t,r);case 3:if(!(a=i.sent).length){i.next=6;break}return i.abrupt("return",{v:a.find((function(a){return a.name==t&&a.type==r&&a.system}))});case 6:case"end":return i.stop()}}),_loop2)})),a.s();case 4:if((o=a.n()).done){u.next=11;break}return u.delegateYield(i(),"t0",6);case 6:if("object"!==dsk_wizard_typeof(c=u.t0)){u.next=9;break}return u.abrupt("return",c.v);case 9:u.next=4;break;case 11:u.next=16;break;case 13:u.prev=13,u.t1=u.catch(1),a.e(u.t1);case 16:return u.prev=16,a.f(),u.finish(16);case 19:return u.abrupt("return",void 0);case 20:case"end":return u.stop()}}),_callee2,null,[[1,13,16,19]])}))),function findCompendiumItem(t,r){return c.apply(this,arguments)})},{key:"parseToItem",value:(i=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee4(r,a){var o=this;return dsk_wizard_regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:if(""!=r.trim()){i.next=2;break}return i.abrupt("return",[]);case 2:return i.next=4,Promise.all(r.split(", ").map(function(){var r=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee3(r){var i,c,u,l,p;return dsk_wizard_regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:return i=t.Z.parseAbilityString(r.trim()),d.next=3,o.findCompendiumItem(i.original,a);case 3:if(c=d.sent){d.next=8;break}return d.next=7,o.findCompendiumItem(i.name,a);case 7:c=d.sent;case 8:return c?(l=c.uuid,(c=duplicate(c)).uuid=l,c.tooltip=game.i18n.localize("dsk.details"),(c=K.Z.reverseAdoptionCalculation(o.actor,i,c)).system.ap&&(c.APunparseable=isNaN(c.system.ap),c.apCost=c.APunparseable?c.system.ap:i.step*Number(c.system.ap))):(console.warn("Not found <".concat(r,">")),u=a.map((function(r){return t.Z.categoryLocalization(r)})).join("/"),o.errors.push("".concat(u,": ").concat(r)),c={name:r.trim(),notFound:!0,tooltip:game.i18n.localize("dsk.DSKError.itemNotFound"),apCost:"?"}),c.replaceName=i.original,c.step=i.step,p=null!=o.actor.items.find((function(t){return a.includes(t.type)&&t.name==i.original})),c.disabled=p||c.notFound||c.APunparseable,p&&(c.tooltip=game.i18n.localize("dsk.YouAlreadyHaveit")),d.abrupt("return",c);case 15:case"end":return d.stop()}}),_callee3)})));return function(t){return r.apply(this,arguments)}}()));case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}}),_callee4)}))),function parseToItem(t,r){return i.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;dsk_wizard_get(dsk_wizard_getPrototypeOf(WizardDSK.prototype),"activateListeners",this).call(this,t),t.find("button.ok").click((function(){r.updating||(r.updating=!0,r.updateCharacter().then((function(){return r.updating=!1})))})),t.find("button.cancel").click((function(){r.close()})),t.find(".show-item").click((function(t){var a=$(t.currentTarget).attr("data-id");r.items.find((function(t){return t.id==a})).sheet.render(!0)})),t.find(".optional").change((function(t){var r=$(t.currentTarget).closest(".content"),a=Number(r.attr("data-cost"));r.find(".optional:checked").each((function(){a+=Number($(this).attr("data-cost"))}));var o=r.find(".apCost");o.text(a),WizardDSK.flashElem(o,"emphasize2")})),t.find(".exclusive").change((function(t){var r=$(t.currentTarget).closest(".content"),a=$(t.currentTarget).attr("data-sel"),o=r.find(".allowedCount_".concat(a)),i=Number(o.attr("data-count"));if(r.find(".exclusive_".concat(a,":checked")).length>i)return t.currentTarget.checked=!1,void WizardDSK.flashElem(o)}))}},{key:"_validateInput",value:function _validateInput(t){var r,a=new Set,o=/^exclusive_/,i=dsk_wizard_createForOfIteratorHelper(t.find(".exclusive"));try{for(i.s();!(r=i.n()).done;){var c=r.value;a.add(c.className.split(/\s+/).filter((function(t){return o.test(t)}))[0])}}catch(t){i.e(t)}finally{i.f()}var u,l=dsk_wizard_createForOfIteratorHelper(a);try{for(l.s();!(u=l.n()).done;){var p=u.value,d=t.find(".allowedCount_"+p.split("_")[1]),h=Number(d.attr("data-count"));if(t.find(".".concat(p,":checked")).length!=h){ui.notifications.error(game.i18n.localize("dsk.DSKError.MissingChoices")),WizardDSK.flashElem(d);var y=d.closest(".tab").attr("data-tab");return WizardDSK.flashElem(t.find(".tabs a[data-tab='".concat(y,"']"))),!1}}}catch(t){l.e(t)}finally{l.f()}return!0}},{key:"alreadyAdded",value:(o=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee5(r,a){var o;return dsk_wizard_regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:if(""!=r){i.next=2;break}return i.abrupt("return",!1);case 2:return o=!1,i.next=5,new Promise((function(r,o){new Dialog({title:game.i18n.localize("dsk.DIALOG.warning"),content:game.i18n.format("dsk.DIALOG.alreadyAddedCharacterpart",{category:t.Z.categoryLocalization(a)}),default:"ok",buttons:{ok:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("dsk.ok"),default:!0,callback:function callback(){r(!1)}},cancel:{icon:'<i class="fas fa-close"></i>',label:game.i18n.localize("dsk.cancel"),default:!0,callback:function callback(){r(!0)}}}}).render(!0)}));case 5:return o=i.sent,i.abrupt("return",o);case 7:case"end":return i.stop()}}),_callee5)}))),function alreadyAdded(t,r){return o.apply(this,arguments)})},{key:"addSelections",value:(a=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee6(r){var a,o,i,c,u,l;return dsk_wizard_regeneratorRuntime().wrap((function _callee6$(p){for(;;)switch(p.prev=p.next){case 0:a=[],o=dsk_wizard_createForOfIteratorHelper(r),p.prev=2,o.s();case 4:if((i=o.n()).done){p.next=28;break}if(c=i.value,""!=$(c).val()){p.next=9;break}return p.abrupt("continue",26);case 9:return p.next=11,fromUuid($(c).val());case 11:u=p.sent,l=t.Z.parseAbilityString(u.name),u.name=$(c).attr("name"),p.t0=u.type,p.next="advantage"===p.t0||"disadvantage"===p.t0?17:"specialability"===p.t0?21:26;break;case 17:return u.system.level=Number($(c).attr("data-step")),u=K.Z.reverseAdoptionCalculation(this.actor,l,u),this.mergeLevels(a,u)||m.Z.vantageAdded(this.actor,u),p.abrupt("break",26);case 21:return u.system.level=Number($(c).attr("data-step")),$(c).attr("data-free")&&(u.system.ap=0),u=K.Z.reverseAdoptionCalculation(this.actor,l,u),this.mergeLevels(a,u)||g.Z.abilityAdded(this.actor,u),p.abrupt("break",26);case 26:p.next=4;break;case 28:p.next=33;break;case 30:p.prev=30,p.t1=p.catch(2),o.e(p.t1);case 33:return p.prev=33,o.f(),p.finish(33);case 36:return p.next=38,this.actor.createEmbeddedDocuments("Item",a);case 38:case"end":return p.stop()}}),_callee6,this,[[2,30,33,36]])}))),function addSelections(t){return a.apply(this,arguments)})},{key:"mergeLevels",value:function mergeLevels(t,r){var a=!1,o=t.find((function(t){return t.name==r.name&&t.type==r.type}));if(o){a=!0;var i=Number(getProperty(r,"system.level"));i&&(o.system.level+=i)}else t.push(r);return a}},{key:"finalizeUpdate",value:function finalizeUpdate(){0==this.errors.length?this.close():$(this._element).find(".dialog-buttons").html('<div class="error"><p>'.concat(game.i18n.localize("dsk.DSKError.notUnderstood"),"</p><ul><li>").concat(this.errors.join("</li><li>"),"</li></ul></div>"))}}],[{key:"defaultOptions",get:function get(){var t=dsk_wizard_get(dsk_wizard_getPrototypeOf(WizardDSK),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"description"}],mergeObject(t,{classes:t.classes.concat(["dsk","largeDialog"]),width:750,height:640}),t.resizable=!0,t}},{key:"flashElem",value:function flashElem(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emphasize";t.addClass(r),setTimeout((function(){t.removeClass(r)}),600)}}]),WizardDSK}();function species_wizard_typeof(t){return species_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},species_wizard_typeof(t)}function species_wizard_regeneratorRuntime(){species_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==species_wizard_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function species_wizard_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function species_wizard_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return species_wizard_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return species_wizard_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function species_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function species_wizard_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function species_wizard_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){species_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){species_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function species_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function species_wizard_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function species_wizard_get(){return species_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=species_wizard_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},species_wizard_get.apply(this,arguments)}function species_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=species_wizard_getPrototypeOf(t)););return t}function species_wizard_setPrototypeOf(t,r){return species_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},species_wizard_setPrototypeOf(t,r)}function species_wizard_createSuper(t){var r=function species_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=species_wizard_getPrototypeOf(t);if(r){var i=species_wizard_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return species_wizard_possibleConstructorReturn(this,a)}}function species_wizard_possibleConstructorReturn(t,r){if(r&&("object"===species_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function species_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function species_wizard_getPrototypeOf(t){return species_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},species_wizard_getPrototypeOf(t)}var B=function(t){!function species_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&species_wizard_setPrototypeOf(t,r)}(SpeciesWizard,t);var r,a,o,i,c=species_wizard_createSuper(SpeciesWizard);function SpeciesWizard(){return species_wizard_classCallCheck(this,SpeciesWizard),c.apply(this,arguments)}return function species_wizard_createClass(t,r,a){return r&&species_wizard_defineProperties(t.prototype,r),a&&species_wizard_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(SpeciesWizard,[{key:"_parseBonus",value:(i=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee(t){var r,a,o,i,c,u,l,p;return species_wizard_regeneratorRuntime().wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:r=[],a=[],o=!1,i=Object.keys(d.Z.characteristics),c=new RegExp(game.i18n.localize("dsk.WIZARDPARSER.speciesAdvantage"),"i"),u=species_wizard_createForOfIteratorHelper(t.split(",")),h.prev=6,p=function _loop(){var t=l.value;if(c.test(t)){o=!0;var u=i.filter((function(r){return t.includes(r.toUpperCase())}));return r.push({choices:u,allowedCount:1}),"break"}a.push(t.trim())},u.s();case 9:if((l=u.n()).done){h.next=15;break}if("break"!==p()){h.next=13;break}return h.abrupt("break",15);case 13:h.next=9;break;case 15:h.next=20;break;case 17:h.prev=17,h.t0=h.catch(6),u.e(h.t0);case 20:return h.prev=20,u.f(),h.finish(20);case 23:return h.next=25,this.parseToItem(a.join(", "),["advantage","disadvantage"]);case 25:return a=h.sent,h.abrupt("return",{anyAttributeRequirements:o,attributeRequirements:r,optionals:a});case 27:case"end":return h.stop()}}),_callee,this,[[6,17,20,23]])}))),function _parseBonus(t){return i.apply(this,arguments)})},{key:"getData",value:(o=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee2(t){var r,a,o,i,c,u;return species_wizard_regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,species_wizard_get(species_wizard_getPrototypeOf(SpeciesWizard.prototype),"getData",this).call(this,t);case 2:return r=l.sent,l.next=5,this._parseBonus(this.species.system.advantages);case 5:return a=l.sent,o=a.anyAttributeRequirements,i=a.attributeRequirements,c=a.optionals,u=o,mergeObject(r,{speciesDescription:game.i18n.has("dsk.Racedescr.".concat(this.species.name))?game.i18n.localize("dsk.Racedescr.".concat(this.species.name)):this.species.system.description.value,species:this.species,description:game.i18n.format("dsk.WIZARD.speciesdescr",{species:this.species.name}),title:game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeSpecies")," ").concat(this.species.name)}),generalToChose:u,anyAttributeRequirements:o,optionals:c,attributeRequirements:i}),l.abrupt("return",r);case 12:case"end":return l.stop()}}),_callee2,this)}))),function getData(t){return o.apply(this,arguments)})},{key:"addSpecies",value:(a=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee3(t,r){return species_wizard_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:this.actor=t,this.species=duplicate(r);case 2:case"end":return a.stop()}}),_callee3,this)}))),function addSpecies(t,r){return a.apply(this,arguments)})},{key:"updateCharacter",value:(r=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee4(){var t,r,a,o,i,c;return species_wizard_regeneratorRuntime().wrap((function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:if((t=$(this._element)).find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),r=Number(t.find(".apCost").text()),u.t1=!this._validateInput($(this._element)),u.t1){u.next=8;break}return u.next=7,this.actor.checkEnoughXP(r);case 7:u.t1=!u.sent;case 8:if(u.t0=u.t1,u.t0){u.next=13;break}return u.next=12,this.alreadyAdded(this.actor.system.details.species,"species");case 12:u.t0=u.sent;case 13:if(!u.t0){u.next=16;break}return t.find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),u.abrupt("return");case 16:a={"system.details.species":this.species.name,"system.stats.gs.initial":this.species.system.gs,"system.stats.sk.initial":this.species.system.sk,"system.stats.zk.initial":this.species.system.zk,"system.stats.LeP.initial":this.species.system.LeP,"system.stats.LeP.value":this.species.system.LeP+2*this.actor.system.characteristics.ko.value},o=species_wizard_createForOfIteratorHelper(t.find(".exclusive:checked"));try{for(o.s();!(i=o.n()).done;)c=i.value,a["system.characteristics.".concat($(c).val(),".species")]=1}catch(t){o.e(t)}finally{o.f()}return u.next=21,this.actor.update(a);case 21:return u.next=23,this.actor._updateAPs(r);case 23:return u.next=25,this.addSelections(t.find(".optional:checked"));case 25:return u.next=27,this.actor.removeCondition("incapacitated");case 27:this.finalizeUpdate();case 28:case"end":return u.stop()}}),_callee4,this)}))),function updateCharacter(){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=species_wizard_get(species_wizard_getPrototypeOf(SpeciesWizard),"defaultOptions",this);return t.title=game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeSpecies"))}),t.template="systems/dsk/templates/wizard/add-species-wizard.html",t}}]),SpeciesWizard}(W);function culture_wizard_typeof(t){return culture_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},culture_wizard_typeof(t)}function culture_wizard_regeneratorRuntime(){culture_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==culture_wizard_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function culture_wizard_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function culture_wizard_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){culture_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){culture_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function culture_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function culture_wizard_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function culture_wizard_get(){return culture_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=culture_wizard_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},culture_wizard_get.apply(this,arguments)}function culture_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=culture_wizard_getPrototypeOf(t)););return t}function culture_wizard_setPrototypeOf(t,r){return culture_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},culture_wizard_setPrototypeOf(t,r)}function culture_wizard_createSuper(t){var r=function culture_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=culture_wizard_getPrototypeOf(t);if(r){var i=culture_wizard_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return culture_wizard_possibleConstructorReturn(this,a)}}function culture_wizard_possibleConstructorReturn(t,r){if(r&&("object"===culture_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function culture_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function culture_wizard_getPrototypeOf(t){return culture_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},culture_wizard_getPrototypeOf(t)}var Z=function(r){!function culture_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&culture_wizard_setPrototypeOf(t,r)}(CultureWizard,r);var a,o,i,c=culture_wizard_createSuper(CultureWizard);function CultureWizard(){return culture_wizard_classCallCheck(this,CultureWizard),c.apply(this,arguments)}return function culture_wizard_createClass(t,r,a){return r&&culture_wizard_defineProperties(t.prototype,r),a&&culture_wizard_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(CultureWizard,[{key:"getData",value:(i=culture_wizard_asyncToGenerator(culture_wizard_regeneratorRuntime().mark((function _callee(r){var a;return culture_wizard_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,culture_wizard_get(culture_wizard_getPrototypeOf(CultureWizard.prototype),"getData",this).call(this,r);case 2:return a=o.sent,mergeObject(a,{title:game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(t.Z.categoryLocalization("culture")," ").concat(this.culture.name)}),culture:this.culture,description:game.i18n.format("dsk.WIZARD.culturedescr",{culture:this.culture.name,cost:0})}),o.abrupt("return",a);case 6:case"end":return o.stop()}}),_callee,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"addCulture",value:(o=culture_wizard_asyncToGenerator(culture_wizard_regeneratorRuntime().mark((function _callee2(t,r){return culture_wizard_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:this.actor=t,this.culture=duplicate(r);case 2:case"end":return a.stop()}}),_callee2,this)}))),function addCulture(t,r){return o.apply(this,arguments)})},{key:"updateCharacter",value:(a=culture_wizard_asyncToGenerator(culture_wizard_regeneratorRuntime().mark((function _callee3(){var t,r,a;return culture_wizard_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if((t=$(this._element)).find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),r=Number(t.find(".apCost").text()),o.t1=!this._validateInput($(this._element)),o.t1){o.next=8;break}return o.next=7,this.actor.checkEnoughXP(r);case 7:o.t1=!o.sent;case 8:if(o.t0=o.t1,o.t0){o.next=13;break}return o.next=12,this.alreadyAdded(this.actor.system.details.culture,"culture");case 12:o.t0=o.sent;case 13:if(!o.t0){o.next=16;break}return t.find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),o.abrupt("return");case 16:return a={"system.details.culture":this.culture.name},o.next=19,this.actor.update(a);case 19:return o.next=21,this.actor._updateAPs(r);case 21:return o.next=23,this.updateSkill(this.culture.system.skills.split(","),"skill");case 23:this.finalizeUpdate();case 24:case"end":return o.stop()}}),_callee3,this)}))),function updateCharacter(){return a.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=culture_wizard_get(culture_wizard_getPrototypeOf(CultureWizard),"defaultOptions",this);return t.title=game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeCulture"))}),t.template="systems/dsk/templates/wizard/add-culture-wizard.html",t}}]),CultureWizard}(W);function career_wizard_typeof(t){return career_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},career_wizard_typeof(t)}function career_wizard_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=career_wizard_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function career_wizard_regeneratorRuntime(){career_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==career_wizard_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return career_wizard_arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||career_wizard_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function career_wizard_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return career_wizard_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?career_wizard_arrayLikeToArray(t,r):void 0}}function career_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function career_wizard_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function career_wizard_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){career_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){career_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function career_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function career_wizard_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function career_wizard_get(){return career_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=career_wizard_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},career_wizard_get.apply(this,arguments)}function career_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=career_wizard_getPrototypeOf(t)););return t}function career_wizard_setPrototypeOf(t,r){return career_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},career_wizard_setPrototypeOf(t,r)}function career_wizard_createSuper(t){var r=function career_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=career_wizard_getPrototypeOf(t);if(r){var i=career_wizard_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return career_wizard_possibleConstructorReturn(this,a)}}function career_wizard_possibleConstructorReturn(t,r){if(r&&("object"===career_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function career_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function career_wizard_getPrototypeOf(t){return career_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},career_wizard_getPrototypeOf(t)}var q=function(r){!function career_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&career_wizard_setPrototypeOf(t,r)}(CareerWizard,r);var a,o,i,c,u=career_wizard_createSuper(CareerWizard);function CareerWizard(){return career_wizard_classCallCheck(this,CareerWizard),u.apply(this,arguments)}return function career_wizard_createClass(t,r,a){return r&&career_wizard_defineProperties(t.prototype,r),a&&career_wizard_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(CareerWizard,[{key:"getData",value:(c=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee(r){var a,o,i,c,u;return career_wizard_regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,career_wizard_get(career_wizard_getPrototypeOf(CareerWizard.prototype),"getData",this).call(this,r);case 2:return a=l.sent,l.t0=[],l.t1=_toConsumableArray,l.next=7,this.parseToItem(this.career.system.requirements.advantage,["disadvantage","advantage"]);case 7:return l.t2=l.sent,l.t3=(0,l.t1)(l.t2),l.t4=_toConsumableArray,l.next=12,this.parseToItem(this.career.system.requirements.specialability,["specialability"]);case 12:return l.t5=l.sent,l.t6=(0,l.t4)(l.t5),o=l.t0.concat.call(l.t0,l.t3,l.t6),i=o.filter((function(t){return["advantage","disadvantage"].includes(t.type)&&!t.disabled})),c=o.reduce((function(t,r){return t+(r.disabled?0:Number(r.system.ap)||0)}),0),u=o.filter((function(t){return"specialability"==t.type&&!t.disabled})),mergeObject(a,{title:game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(t.Z.categoryLocalization("profession")," ").concat(this.career.name)}),career:this.career,description:game.i18n.format("dsk.WIZARD.careerdescr",{career:this.career.name,cost:0+c}),baseCost:0,missingVantagesToChose:i.length>0,missingSpecialabiltiesToChose:u.length>0}),l.abrupt("return",a);case 21:case"end":return l.stop()}}),_callee,this)}))),function getData(t){return c.apply(this,arguments)})},{key:"addCareer",value:(i=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee2(t,r){return career_wizard_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:this.actor=t,this.career=duplicate(r);case 2:case"end":return a.stop()}}),_callee2,this)}))),function addCareer(t,r){return i.apply(this,arguments)})},{key:"setAbility",value:(o=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee3(r,a){var o,i,c,u,l,p=this;return career_wizard_regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:if(""!=r.trim()){d.next=2;break}return d.abrupt("return");case 2:o=[],i=[],c=career_wizard_createForOfIteratorHelper(r.split(",")),d.prev=5,l=career_wizard_regeneratorRuntime().mark((function _loop(){var r,c,l,d;return career_wizard_regeneratorRuntime().wrap((function _loop$(h){for(;;)switch(h.prev=h.next){case 0:if(r=u.value,!["","-"].includes(r.trim())){h.next=3;break}return h.abrupt("return","continue");case 3:if(c=t.Z.parseAbilityString(r.trim()),!(l=p.actor.items.find((function(t){return a.includes(t.type)&&t.name==c.original})))){h.next=12;break}null!=(l=duplicate(l)).system.level&&(l.system.level=c.step),l=K.Z.reverseAdoptionCalculation(p.actor,c,l),i.push(l),h.next=20;break;case 12:return h.next=14,p.findCompendiumItem(c.original,a);case 14:if(l=h.sent){h.next=19;break}return h.next=18,p.findCompendiumItem(c.name,a);case 18:l=h.sent;case 19:l?((l=duplicate(l)).name=c.original,null!=l.system.level&&(l.system.level=c.step),l=K.Z.reverseAdoptionCalculation(p.actor,c,l),o.push(l)):(d=a.map((function(r){return t.Z.categoryLocalization(r)})).join("/"),p.errors.push("".concat(d,": ").concat(r)),ui.notifications.error(game.i18n.format("dsk.DSKError.notFound",{category:d,name:r})));case 20:case"end":return h.stop()}}),_loop)})),c.s();case 8:if((u=c.n()).done){d.next=15;break}return d.delegateYield(l(),"t0",10);case 10:if("continue"!==d.t0){d.next=13;break}return d.abrupt("continue",13);case 13:d.next=8;break;case 15:d.next=20;break;case 17:d.prev=17,d.t1=d.catch(5),c.e(d.t1);case 20:return d.prev=20,c.f(),d.finish(20);case 23:return d.next=25,this.actor.updateEmbeddedDocuments("Item",i);case 25:return d.next=27,this.actor.createEmbeddedDocuments("Item",o);case 27:case"end":return d.stop()}}),_callee3,this,[[5,17,20,23]])}))),function setAbility(t,r){return o.apply(this,arguments)})},{key:"updateCharacter",value:(a=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee4(){var t,r,a,o;return career_wizard_regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:if((t=$(this._element)).find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),r=Number(t.find(".apCost").text()),i.t1=!this._validateInput($(this._element)),i.t1){i.next=8;break}return i.next=7,this.actor.checkEnoughXP(r);case 7:i.t1=!i.sent;case 8:if(i.t0=i.t1,i.t0){i.next=13;break}return i.next=12,this.alreadyAdded(this.actor.system.details.profession,"profession");case 12:i.t0=i.sent;case 13:if(!i.t0){i.next=16;break}return t.find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),i.abrupt("return");case 16:if(a={"system.details.profession":this.career.name},!this.career.system.isAncestor){i.next=22;break}return i.next=20,this.setAbility(this.career.system.ahnengabe,["ahnengabe"]);case 20:return i.next=22,this.setAbility(this.career.system.ahnengeschenk,["ahnengeschenk"]);case 22:return i.next=24,this.setAbility(this.career.system.requirements.specialability,["specialability"]);case 24:return i.next=26,this.setAbility(this.career.system.requirements.advantage,["advantage","disadvantage"]);case 26:return i.next=28,this.actor.update(a);case 28:return i.next=30,this.actor._updateAPs(r);case 30:return o=[].concat(_toConsumableArray(this.career.system.skills.body.split(",")),_toConsumableArray(this.career.system.skills.social.split(",")),_toConsumableArray(this.career.system.skills.mental.split(",")),_toConsumableArray(this.career.system.skills.trade.split(","))),i.next=33,this.updateSkill(o,"skill");case 33:return i.next=35,this.updateSkill(this.career.system.skills.combat.split(","),"combatskill");case 35:this.finalizeUpdate();case 36:case"end":return i.stop()}}),_callee4,this)}))),function updateCharacter(){return a.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=career_wizard_get(career_wizard_getPrototypeOf(CareerWizard),"defaultOptions",this);return t.title=game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeProfession"))}),t.template="systems/dsk/templates/wizard/add-career-wizard.html",t}}]),CareerWizard}(W);function actor_sheet_character_typeof(t){return actor_sheet_character_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_character_typeof(t)}function actor_sheet_character_regeneratorRuntime(){actor_sheet_character_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_sheet_character_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function actor_sheet_character_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function actor_sheet_character_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_character_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function actor_sheet_character_get(){return actor_sheet_character_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=actor_sheet_character_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},actor_sheet_character_get.apply(this,arguments)}function actor_sheet_character_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_character_getPrototypeOf(t)););return t}function actor_sheet_character_setPrototypeOf(t,r){return actor_sheet_character_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_character_setPrototypeOf(t,r)}function actor_sheet_character_createSuper(t){var r=function actor_sheet_character_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=actor_sheet_character_getPrototypeOf(t);if(r){var i=actor_sheet_character_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return actor_sheet_character_possibleConstructorReturn(this,a)}}function actor_sheet_character_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_character_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_character_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_character_getPrototypeOf(t){return actor_sheet_character_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_character_getPrototypeOf(t)}var Y=function(t){!function actor_sheet_character_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_character_setPrototypeOf(t,r)}(ActorSheetCharacter,t);var r,a=actor_sheet_character_createSuper(ActorSheetCharacter);function ActorSheetCharacter(){return actor_sheet_character_classCallCheck(this,ActorSheetCharacter),a.apply(this,arguments)}return function actor_sheet_character_createClass(t,r,a){return r&&actor_sheet_character_defineProperties(t.prototype,r),a&&actor_sheet_character_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetCharacter,[{key:"template",get:function get(){return this.showLimited()?"systems/dsk/templates/actors/npc-limited.html":"systems/dsk/templates/actors/actor-sheet.html"}},{key:"_manageDragItems",value:(r=function actor_sheet_character_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){actor_sheet_character_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){actor_sheet_character_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}(actor_sheet_character_regeneratorRuntime().mark((function _callee(t,r){var a,o,i;return actor_sheet_character_regeneratorRuntime().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:c.t0=r,c.next="aggregatedTest"===c.t0?3:"species"===c.t0?6:"culture"===c.t0?11:"profession"===c.t0?16:21;break;case 3:return c.next=5,this.actor.createEmbeddedDocuments("Item",[t]);case 5:return c.abrupt("break",22);case 6:return a=new B,c.next=9,a.addSpecies(this.actor,t);case 9:return a.render(!0),c.abrupt("break",22);case 11:return o=new Z,c.next=14,o.addCulture(this.actor,t);case 14:return o.render(!0),c.abrupt("break",22);case 16:return i=new q,c.next=19,i.addCareer(this.actor,t);case 19:return i.render(!0),c.abrupt("break",22);case 21:return c.abrupt("return",actor_sheet_character_get(actor_sheet_character_getPrototypeOf(ActorSheetCharacter.prototype),"_manageDragItems",this).call(this,t,r));case 22:case"end":return c.stop()}}),_callee,this)}))),function _manageDragItems(t,a){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_character_get(actor_sheet_character_getPrototypeOf(ActorSheetCharacter),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","actor","character-sheet"]),width:795}),t}}]),ActorSheetCharacter}(_);function actor_sheet_creature_typeof(t){return actor_sheet_creature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_creature_typeof(t)}function actor_sheet_creature_regeneratorRuntime(){actor_sheet_creature_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_sheet_creature_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function actor_sheet_creature_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function actor_sheet_creature_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){actor_sheet_creature_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){actor_sheet_creature_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function actor_sheet_creature_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_creature_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function actor_sheet_creature_get(){return actor_sheet_creature_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=actor_sheet_creature_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},actor_sheet_creature_get.apply(this,arguments)}function actor_sheet_creature_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_creature_getPrototypeOf(t)););return t}function actor_sheet_creature_setPrototypeOf(t,r){return actor_sheet_creature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_creature_setPrototypeOf(t,r)}function actor_sheet_creature_createSuper(t){var r=function actor_sheet_creature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=actor_sheet_creature_getPrototypeOf(t);if(r){var i=actor_sheet_creature_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return actor_sheet_creature_possibleConstructorReturn(this,a)}}function actor_sheet_creature_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_creature_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_creature_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_creature_getPrototypeOf(t){return actor_sheet_creature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_creature_getPrototypeOf(t)}var U=function(t){!function actor_sheet_creature_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_creature_setPrototypeOf(t,r)}(ActorSheetCreature,t);var r,a,o,i,c=actor_sheet_creature_createSuper(ActorSheetCreature);function ActorSheetCreature(){return actor_sheet_creature_classCallCheck(this,ActorSheetCreature),c.apply(this,arguments)}return function actor_sheet_creature_createClass(t,r,a){return r&&actor_sheet_creature_defineProperties(t.prototype,r),a&&actor_sheet_creature_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetCreature,[{key:"template",get:function get(){return this.showLimited()?"systems/dsk/templates/actors/creature-limited.html":"systems/dsk/templates/actors/creature-sheet.html"}},{key:"getData",value:(i=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee(t){var r;return actor_sheet_creature_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature.prototype),"getData",this).call(this,t);case 2:return r=a.sent,a.next=5,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.fight"),{secrets:!0,async:!0});case 5:return r.enrichedBehaviour=a.sent,a.next=8,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.specialRules"),{secrets:!0,async:!0});case 8:return r.enrichedSpecialrules=a.sent,a.abrupt("return",r);case 10:case"end":return a.stop()}}),_callee,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"_cleverDeleteItem",value:(o=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee2(t){var r;return actor_sheet_creature_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:r=this.actor.items.find((function(r){return r.id==t})),a.t0=r.type,a.next="trait"===a.t0?4:7;break;case 4:return a.next=6,this._updateAPs(-1*r.system.ap);case 6:return a.abrupt("break",7);case 7:return a.next=9,actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature.prototype),"_cleverDeleteItem",this).call(this,t);case 9:case"end":return a.stop()}}),_callee2,this)}))),function _cleverDeleteItem(t){return o.apply(this,arguments)})},{key:"_addTrait",value:(a=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee3(t){return actor_sheet_creature_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:if(this.actor.items.find((function(r){return"trait"==r.type&&r.name==t.name}))){r.next=6;break}return r.next=4,this._updateAPs(t.system.ap);case 4:return r.next=6,this.actor.createEmbeddedDocuments("Item",[t]);case 6:case"end":return r.stop()}}),_callee3,this)}))),function _addTrait(t){return a.apply(this,arguments)})},{key:"_onDropItemCreate",value:(r=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee4(t){return actor_sheet_creature_regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:if("trait"!=t.type){r.next=2;break}return r.abrupt("return",this._addTrait(t));case 2:return r.abrupt("return",actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature.prototype),"_onDropItemCreate",this).call(this,t));case 3:case"end":return r.stop()}}),_callee4,this)}))),function _onDropItemCreate(t){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","actor","creature-sheet","character-sheet"])}),t}}]),ActorSheetCreature}(_);function actor_sheet_npc_typeof(t){return actor_sheet_npc_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_npc_typeof(t)}function actor_sheet_npc_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_npc_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function actor_sheet_npc_get(){return actor_sheet_npc_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=actor_sheet_npc_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},actor_sheet_npc_get.apply(this,arguments)}function actor_sheet_npc_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_npc_getPrototypeOf(t)););return t}function actor_sheet_npc_setPrototypeOf(t,r){return actor_sheet_npc_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_npc_setPrototypeOf(t,r)}function actor_sheet_npc_createSuper(t){var r=function actor_sheet_npc_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=actor_sheet_npc_getPrototypeOf(t);if(r){var i=actor_sheet_npc_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return actor_sheet_npc_possibleConstructorReturn(this,a)}}function actor_sheet_npc_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_npc_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_npc_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_npc_getPrototypeOf(t){return actor_sheet_npc_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_npc_getPrototypeOf(t)}var V=function(t){!function actor_sheet_npc_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_npc_setPrototypeOf(t,r)}(ActorSheetNPC,t);var r=actor_sheet_npc_createSuper(ActorSheetNPC);function ActorSheetNPC(){return actor_sheet_npc_classCallCheck(this,ActorSheetNPC),r.apply(this,arguments)}return function actor_sheet_npc_createClass(t,r,a){return r&&actor_sheet_npc_defineProperties(t.prototype,r),a&&actor_sheet_npc_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetNPC,[{key:"template",get:function get(){return this.showLimited()?"systems/dsk/templates/actors/npc-limited.html":"systems/dsk/templates/actors/npc-sheet.html"}}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_npc_get(actor_sheet_npc_getPrototypeOf(ActorSheetNPC),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","actor","npc-sheet"])}),t}}]),ActorSheetNPC}(Y);function journal_sheet_typeof(t){return journal_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},journal_sheet_typeof(t)}function journal_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function journal_sheet_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function journal_sheet_get(){return journal_sheet_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=journal_sheet_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},journal_sheet_get.apply(this,arguments)}function journal_sheet_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=journal_sheet_getPrototypeOf(t)););return t}function journal_sheet_setPrototypeOf(t,r){return journal_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},journal_sheet_setPrototypeOf(t,r)}function journal_sheet_createSuper(t){var r=function journal_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=journal_sheet_getPrototypeOf(t);if(r){var i=journal_sheet_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return journal_sheet_possibleConstructorReturn(this,a)}}function journal_sheet_possibleConstructorReturn(t,r){if(r&&("object"===journal_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function journal_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function journal_sheet_getPrototypeOf(t){return journal_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},journal_sheet_getPrototypeOf(t)}var J=function(t){!function journal_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&journal_sheet_setPrototypeOf(t,r)}(DSKJournalSheet,JournalSheet);var r=journal_sheet_createSuper(DSKJournalSheet);function DSKJournalSheet(){return journal_sheet_classCallCheck(this,DSKJournalSheet),r.apply(this,arguments)}return function journal_sheet_createClass(t,r,a){return r&&journal_sheet_defineProperties(t.prototype,r),a&&journal_sheet_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKJournalSheet,null,[{key:"defaultOptions",get:function get(){var t=journal_sheet_get(journal_sheet_getPrototypeOf(DSKJournalSheet),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","dskjournal"])}),t}}]),DSKJournalSheet}(),X=__webpack_require__(565),Q={"":"dsk.Modifier",defenseMalus:"dsk.MODS.defenseMalus",FW:"dsk.MODS.FW",AeP:"dsk.AeP",FP:"dsk.MODS.FP",QL:"dsk.MODS.QS",dmg:"dsk.MODS.damage",damageBonus:"dsk.MODS.damage",armorPen:"dsk.MODS.armorPen",TPM:"dsk.MODS.partChecks"};function journal_typeof(t){return journal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},journal_typeof(t)}function journal_regeneratorRuntime(){journal_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==journal_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function journal_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function setupJournal(){Hooks.on("getJournalSheetHeaderButtons",(function(t,r){var a;t.document.sceneNote&&r.unshift({class:"panMapNote",icon:"fas fa-map-pin",onclick:(a=function journal_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){journal_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){journal_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}(journal_regeneratorRuntime().mark((function _callee(){return journal_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.document.panToNote());case 1:case"end":return r.stop()}}),_callee)}))),function onclick(){return a.apply(this,arguments)})})})),Hooks.on("renderJournalSheet",(function(t,r,a){r.find(".close").attr("data-tooltip",game.i18n.localize("dsk.SHEET.Close")),r.find(".entry-image").attr("data-tooltip",game.i18n.localize("dsk.SHEET.imageView")),r.find(".entry-text").attr("data-tooltip",game.i18n.localize("dsk.SHEET.textView")),r.find(".share-image").attr("data-tooltip",game.i18n.localize("dsk.SHEET.showToPlayers")),r.find(".import").attr("data-tooltip",game.i18n.localize("dsk.SHEET.import")),r.find(".panMapNote").attr("data-tooltip",game.i18n.localize("dsk.SHEET.panMapNote"))})),Hooks.on("renderJournalPageSheet",(function(t,r,a){l.Z.bindRollCommands(r),u.Z.bindButtons(r),r.find("img").mousedown((function(r){2==r.button&&game.dsk.apps.DSKUtility.showArtwork({name:t.name,uuid:"",img:$(r.currentTarget).attr("src")})})),bindImgToCanvasDragStart(r)}))}function createHotBarMacro(t,r,a,o){var i=game.macros.contents.find((function(a){return a.name===r&&a.command===t}));return i?game.user.assignHotbarMacro(i,o):Macro.create({name:r,type:"script",img:a,command:t},{displaySheet:!1}).then((function(t){return game.user.assignHotbarMacro(t,o)})),!1}function didyouknow_typeof(t){return didyouknow_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},didyouknow_typeof(t)}function didyouknow_regeneratorRuntime(){didyouknow_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==didyouknow_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function didyouknow_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function didyouknow_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){didyouknow_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){didyouknow_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function didyouknow_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var ee=function(){function DidYouKnow(){!function didyouknow_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DidYouKnow)}var t,r;return function didyouknow_createClass(t,r,a){return r&&didyouknow_defineProperties(t.prototype,r),a&&didyouknow_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DidYouKnow,null,[{key:"stopFade",value:(r=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee3(t){return didyouknow_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:t.stopPropagation(),t.preventDefault(),this.fadeOut?(this.fadeOut=!1,$(t.currentTarget).find("i").removeClass("fa-stop").addClass("fa-angle-right"),$(".didYouKnow").off("click"),$(".didYouKnow .closeDidYou").click((function(){return $(".didYouKnow").remove()}))):fetch("systems/dsk/lazy/didyouknow/".concat(game.i18n.lang,".json")).then(function(){var t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee(t){return didyouknow_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee2(t){var r,a;return didyouknow_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return r=t.data[Math.floor(Math.random()*t.data.length)],o.next=3,renderTemplate("systems/dsk/templates/system/didyouknow.html",{msg:r,fadeOut:DidYouKnow.fadeOut});case 3:a=o.sent,$("body").find(".didYouKnow").replaceWith(a),DidYouKnow.activateListeners();case 6:case"end":return o.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}());case 3:case"end":return r.stop()}}),_callee3,this)}))),function stopFade(t){return r.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(){var t=this;$(".didYouKnow .stopFade").click(function(){var r=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee4(r){return didyouknow_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.stopFade(r);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee4)})));return function(t){return r.apply(this,arguments)}}()),$(".didYouKnow").click((function(){return $(".didYouKnow").remove()})),$(".didYouKnow").fadeIn()}},{key:"showOneMessage",value:(t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee7(){var t,r=this,a=arguments;return didyouknow_regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:8e3,!game.settings.get("dsk","disableDidYouKnow")){o.next=3;break}return o.abrupt("return");case 3:fetch("systems/dsk/lazy/didyouknow/".concat(game.i18n.lang,".json")).then(function(){var t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee5(t){return didyouknow_regeneratorRuntime().wrap((function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var a=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee6(a){var o,i;return didyouknow_regeneratorRuntime().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return o=a.data[Math.floor(Math.random()*a.data.length)],c.next=3,renderTemplate("systems/dsk/templates/system/didyouknow.html",{msg:o,fadeOut:DidYouKnow.fadeOut});case 3:i=c.sent,$("body").append(i),r.activateListeners(),setTimeout((function(){DidYouKnow.fadeOut&&$(".didYouKnow").fadeOut(1e3,(function(){return $(".didYouKnow").remove()}))}),t);case 7:case"end":return c.stop()}}),_callee6)})));return function(t){return a.apply(this,arguments)}}());case 4:case"end":return o.stop()}}),_callee7)}))),function showOneMessage(){return t.apply(this,arguments)})}]),DidYouKnow}();function tutorial_typeof(t){return tutorial_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tutorial_typeof(t)}function tutorial_regeneratorRuntime(){tutorial_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==tutorial_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function tutorial_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function tutorial_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){tutorial_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){tutorial_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function tutorial_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}!function didyouknow_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}(ee,"fadeOut",!0);var te=function(){function DSKTutorial(){!function tutorial_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKTutorial)}var r,a,o;return function tutorial_createClass(t,r,a){return r&&tutorial_defineProperties(t.prototype,r),a&&tutorial_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKTutorial,null,[{key:"firstTimeMessage",value:(o=tutorial_asyncToGenerator(tutorial_regeneratorRuntime().mark((function _callee(){var r;return tutorial_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,game.settings.get("dsk","firstTimeStart");case 2:if(a.sent){a.next=10;break}return a.next=5,DSKTutorial.setupDefaultOptions();case 5:return r=game.i18n.localize("dsk.WELCOME"),ChatMessage.create(t.Z.chatDataSetup(r)),DSKTutorial.firstTimeLanguage(),a.next=10,game.settings.set("dsk","firstTimeStart",!0);case 10:case"end":return a.stop()}}),_callee)}))),function firstTimeMessage(){return o.apply(this,arguments)})},{key:"firstTimeLanguage",value:function firstTimeLanguage(){for(var t={title:game.i18n.localize("dsk.DIALOG.firstTime"),content:game.i18n.localize("dsk.DIALOG.firstTimeWarning"),default:"de",buttons:{}},r=function _loop(){var r=o[a];t.buttons[r]={label:game.i18n.localize(r),callback:function callback(){return DSKTutorial.setLanguage(r)}}},a=0,o=["de"];a<o.length;a++)r();new Dialog(t).render(!0)}},{key:"setLanguage",value:(a=tutorial_asyncToGenerator(tutorial_regeneratorRuntime().mark((function _callee2(t){return tutorial_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("dsk","firstTimeStart",!0);case 2:return r.next=4,game.settings.set("dsk","forceLanguage",t);case 4:return r.next=6,game.settings.set("core","language",t);case 6:foundry.utils.debouncedReload();case 7:case"end":return r.stop()}}),_callee2)}))),function setLanguage(t){return a.apply(this,arguments)})},{key:"setupDefaultOptions",value:(r=tutorial_asyncToGenerator(tutorial_regeneratorRuntime().mark((function _callee3(){var t;return tutorial_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return(t=game.settings.get("core",Combat.CONFIG_SETTING)).skipDefeated=!0,r.next=4,game.settings.set("core",Combat.CONFIG_SETTING,t);case 4:return r.next=6,game.settings.set("core","leftClickRelease",!0);case 6:case"end":return r.stop()}}),_callee3)}))),function setupDefaultOptions(){return r.apply(this,arguments)})}]),DSKTutorial}();function itemDrop_typeof(t){return itemDrop_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},itemDrop_typeof(t)}function itemDrop_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function itemDrop_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function itemDrop_get(){return itemDrop_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=itemDrop_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},itemDrop_get.apply(this,arguments)}function itemDrop_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=itemDrop_getPrototypeOf(t)););return t}function itemDrop_setPrototypeOf(t,r){return itemDrop_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},itemDrop_setPrototypeOf(t,r)}function itemDrop_createSuper(t){var r=function itemDrop_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=itemDrop_getPrototypeOf(t);if(r){var i=itemDrop_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return itemDrop_possibleConstructorReturn(this,a)}}function itemDrop_possibleConstructorReturn(t,r){if(r&&("object"===itemDrop_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function itemDrop_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function itemDrop_getPrototypeOf(t){return itemDrop_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},itemDrop_getPrototypeOf(t)}function itemDrop_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function itemDrop_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return itemDrop_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return itemDrop_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function itemDrop_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function itemDrop_regeneratorRuntime(){itemDrop_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==itemDrop_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function itemDrop_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function itemDrop_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){itemDrop_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){itemDrop_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}var re=function(){var r=itemDrop_asyncToGenerator(itemDrop_regeneratorRuntime().mark((function _callee(r,a,o,i){var c,u,l,p,d,h,m,g,v;return itemDrop_regeneratorRuntime().wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:if(!game.user.isGM){_.next=36;break}return _.next=3,t.Z.getFolderForType("Actor",null,"Dropped Items");case 3:return c=_.sent,u=game.users.filter((function(t){return!t.isGM})).map((function(t){return t.id})),l=u.reduce((function(t,r){return t[r]=1,t}),{default:0}),(p=a.toObject()).system.quantity=i,y.Z.obfuscateDropData(p,o.tabsinvisible),getProperty(p,"system.worn.value")&&(p.system.worn.value=!1),d={type:"npc",name:a.name,img:a.img,prototypeToken:{img:a.img,width:.4,height:.4},ownership:l,items:[p],flags:{core:{sheetClass:"dsk.MerchantSheetDSK"}},folder:c,system:{merchant:{merchantType:"loot",temporary:!0,hidePlayer:1},stats:{LeP:{value:16}}}},_.next=13,game.dsk.documents.ActorDSK.create(d);case 13:return h=_.sent,_.next=16,h.getTokenDocument({x:o.x,y:o.y,hidden:!1});case 16:if(m=_.sent,canvas.dimensions.rect.contains(m.x,m.y)){_.next=19;break}return _.abrupt("return",!1);case 19:if(!r){_.next=32;break}return _.next=22,canvas.scene.createEmbeddedDocuments("Token",[m],{noHook:!0});case 22:if(!((g=a.system.quantity-i)<1)){_.next=28;break}return _.next=26,r.deleteEmbeddedDocuments("Item",[a.id]);case 26:_.next=30;break;case 28:return _.next=30,r.updateEmbeddedDocuments("Item",[{_id:a.id,"system.quantity":g}]);case 30:_.next=34;break;case 32:return _.next=34,canvas.scene.createEmbeddedDocuments("Token",[m]);case 34:_.next=38;break;case 36:v={itemId:a.uuid,sourceActorId:null==r?void 0:r.id,data:o,amount:i},game.socket.emit("system.dsk",{type:"itemDrop",payload:v});case 38:case"end":return _.stop()}}),_callee)})));return function dropToGround(t,a,o,i){return r.apply(this,arguments)}}(),ne=function(){var t=itemDrop_asyncToGenerator(itemDrop_regeneratorRuntime().mark((function _callee3(t,r){var a,o,i;return itemDrop_regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Item.implementation.fromDropData(r);case 2:if(a=t.sent,o=a.parent,d.Z.equipmentCategories.includes(a.type)){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,renderTemplate("systems/dsk/templates/dialog/dropToGround.html",{name:a.name,count:a.system.quantity});case 8:i=t.sent,new ie({title:r.name,content:i,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function(){var t=itemDrop_asyncToGenerator(itemDrop_regeneratorRuntime().mark((function _callee2(t){return itemDrop_regeneratorRuntime().wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",re(o,a,r,Number(t.find('[name="count"]').val())));case 1:case"end":return i.stop()}}),_callee2)})));return function callback(r){return t.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 10:case"end":return t.stop()}}),_callee3)})));return function handleItemDrop(r,a){return t.apply(this,arguments)}}(),ae=function(){var t=itemDrop_asyncToGenerator(itemDrop_regeneratorRuntime().mark((function _callee4(t,r){var a,o,i,c,u,l,p,d,h,y;return itemDrop_regeneratorRuntime().wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:a=r.x,o=r.y,i=0,c=t.grid.size,u=Math.ceil(Math.sqrt(r.ids.length)),l=itemDrop_createForOfIteratorHelper(r.ids),m.prev=6,l.s();case 8:if((p=l.n()).done){m.next=21;break}if(d=p.value,h=game.actors.get(d)){m.next=13;break}return m.abrupt("continue",19);case 13:return m.next=15,h.getTokenDocument({x:a,y:o,hidden:!1});case 15:(y=m.sent).constructor.create(y,{parent:t.scene}),u%i==0&&i>0?(o+=c,a=r.x):a+=c,i++;case 19:m.next=8;break;case 21:m.next=26;break;case 23:m.prev=23,m.t0=m.catch(6),l.e(m.t0);case 26:return m.prev=26,l.f(),m.finish(26);case 29:case"end":return m.stop()}}),_callee4,null,[[6,23,26,29]])})));return function handleGroupDrop(r,a){return t.apply(this,arguments)}}(),oe=function connectHook(){Hooks.on("dropCanvasData",function(){var t=itemDrop_asyncToGenerator(itemDrop_regeneratorRuntime().mark((function _callee5(t,r){return itemDrop_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:if(game.settings.get("dsk","enableItemDropToCanvas")||game.user.isGM||r.tokenId){a.next=2;break}return a.abrupt("return");case 2:if("Item"!=r.type){a.next=7;break}return ne(t,r),a.abrupt("return",!1);case 7:if("GroupDrop"!=r.type){a.next=10;break}return ae(t,r),a.abrupt("return",!1);case 10:case"end":return a.stop()}}),_callee5)})));return function(r,a){return t.apply(this,arguments)}}())},ie=function(t){!function itemDrop_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&itemDrop_setPrototypeOf(t,r)}(DropToGroundDialog,Dialog);var r=itemDrop_createSuper(DropToGroundDialog);function DropToGroundDialog(){return itemDrop_classCallCheck(this,DropToGroundDialog),r.apply(this,arguments)}return function itemDrop_createClass(t,r,a){return r&&itemDrop_defineProperties(t.prototype,r),a&&itemDrop_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DropToGroundDialog,[{key:"activateListeners",value:function activateListeners(t){itemDrop_get(itemDrop_getPrototypeOf(DropToGroundDialog.prototype),"activateListeners",this).call(this,t),t.find('input[type="range"]').change((function(t){$(t.currentTarget).closest(".row-section").find(".range-value").html($(t.currentTarget).val())}))}}]),DropToGroundDialog}(),ce=__webpack_require__(846),se=__webpack_require__(448);function dialog_react_typeof(t){return dialog_react_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_react_typeof(t)}function dialog_react_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function dialog_react_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dialog_react_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dialog_react_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function dialog_react_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function dialog_react_regeneratorRuntime(){dialog_react_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_react_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function dialog_react_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function dialog_react_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){dialog_react_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){dialog_react_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_react_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_react_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dialog_react_createClass(t,r,a){return r&&dialog_react_defineProperties(t.prototype,r),a&&dialog_react_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function dialog_react_get(){return dialog_react_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dialog_react_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dialog_react_get.apply(this,arguments)}function dialog_react_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_react_getPrototypeOf(t)););return t}function dialog_react_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_react_setPrototypeOf(t,r)}function dialog_react_setPrototypeOf(t,r){return dialog_react_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_react_setPrototypeOf(t,r)}function dialog_react_createSuper(t){var r=function dialog_react_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dialog_react_getPrototypeOf(t);if(r){var i=dialog_react_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dialog_react_possibleConstructorReturn(this,a)}}function dialog_react_possibleConstructorReturn(t,r){if(r&&("object"===dialog_react_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_react_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_react_getPrototypeOf(t){return dialog_react_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_react_getPrototypeOf(t)}var ue=function(t){dialog_react_inherits(DialogReactDSK,Dialog);var r,a,o=dialog_react_createSuper(DialogReactDSK);function DialogReactDSK(){return dialog_react_classCallCheck(this,DialogReactDSK),o.apply(this,arguments)}return dialog_react_createClass(DialogReactDSK,null,[{key:"showDialog",value:(a=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee(t){var r;return dialog_react_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return r=this.callbackResult,a.t0=DialogReactDSK,a.t1=game.i18n.localize("dsk.Unopposed"),a.next=5,this.getTemplate(t);case 5:a.t2=a.sent,a.t3={ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:function callback(a){r(a.find('[name="entryselection"]').val(),t)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},a.t4={title:a.t1,content:a.t2,default:"ok",buttons:a.t3},new a.t0(a.t4).render(!0);case 9:case"end":return a.stop()}}),_callee,this)}))),function showDialog(t){return a.apply(this,arguments)})},{key:"getTargetActor",value:function getTargetActor(t){if(!canvas.tokens)return{};var r=t.flags.unopposeData.targetSpeaker,a=canvas.tokens.get(r.token).actor;return a?{actor:a,tokenId:r.token}:(ui.notifications.error(game.i18n.localize("dsk.DSKError.noProperActor")),{})}},{key:"getTemplate",value:(r=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee2(t){return dialog_react_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return","");case 1:case"end":return t.stop()}}),_callee2)}))),function getTemplate(t){return r.apply(this,arguments)})},{key:"callbackResult",value:function callbackResult(t,r,a){}},{key:"defaultOptions",get:function get(){var t=dialog_react_get(dialog_react_getPrototypeOf(DialogReactDSK),"defaultOptions",this);return mergeObject(t,{resizable:!0}),t}}]),DialogReactDSK}(),le=function(t){dialog_react_inherits(ActAttackDialog,Dialog);var a,o,i=dialog_react_createSuper(ActAttackDialog);function ActAttackDialog(){return dialog_react_classCallCheck(this,ActAttackDialog),i.apply(this,arguments)}return dialog_react_createClass(ActAttackDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;dialog_react_get(dialog_react_getPrototypeOf(ActAttackDialog.prototype),"activateListeners",this).call(this,t),t.find(".reactClick").click((function(t){r.callbackResult(t.currentTarget.dataset.value,r.actor,r.tokenId),r.close()}))}},{key:"callbackResult",value:function callbackResult(t,r,a){var o=["meleeweapon","trait","rangeweapon"],i=r.items.find((function(r){return o.includes(r.type)&&r.name==t}));i&&r.setupWeapon(i,"attack",{},a).then((function(t){r.basicTest(t)}))}}],[{key:"showDialog",value:(o=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee4(t,r){var a;return dialog_react_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.t0=ActAttackDialog,o.t1=game.i18n.localize("dsk.attacktest"),o.next=4,this.getTemplate(t);case 4:o.t2=o.sent,o.t3={},o.t4={title:o.t1,content:o.t2,buttons:o.t3},(a=new o.t0(o.t4)).actor=t,a.tokenId=r,a.render(!0);case 11:case"end":return o.stop()}}),_callee4,this)}))),function showDialog(t,r){return o.apply(this,arguments)})},{key:"getTemplate",value:(a=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee5(t){var a,o,i,c,u,l,p,d;return dialog_react_regeneratorRuntime().wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:a=t.items.filter((function(t){return"combatskill"==t.type})).map((function(a){return r.Z._calculateCombatSkillValues(a.toObject(),t.system)})),o=[],i=["meleeweapon","rangeweapon"],c=["meleeAttack","rangeAttack"],u=dialog_react_createForOfIteratorHelper(t.items);try{for(u.s();!(l=u.n()).done;)p=l.value,i.includes(p.type)&&1==p.system.worn.value?(d="meleeweapon"==p.type?r.Z._prepareMeleeWeapon(p.toObject(),a,t):r.Z._prepareRangeWeapon(p.toObject(),[],a,t),o.push({name:p.name,id:p.name,img:p.img,value:d.attack})):"trait"==p.type&&c.includes(p.system.traitType)&&o.push({name:p.name,id:p.name,img:p.img,value:p.system.at})}catch(t){u.e(t)}finally{u.f()}return h.next=8,renderTemplate("systems/dsk/templates/dialog/dialog-reaction-attack.html",{dieClass:"die-mu",items:o,title:"dsk.DIALOG.selectAction"});case 8:return h.abrupt("return",h.sent);case 9:case"end":return h.stop()}}),_callee5)}))),function getTemplate(t){return a.apply(this,arguments)})},{key:"defaultOptions",get:function get(){var t=dialog_react_get(dialog_react_getPrototypeOf(ActAttackDialog),"defaultOptions",this);return mergeObject(t,{width:550}),t}}]),ActAttackDialog}();function combat_tracker_typeof(t){return combat_tracker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},combat_tracker_typeof(t)}function combat_tracker_regeneratorRuntime(){combat_tracker_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==combat_tracker_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function combat_tracker_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function combat_tracker_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return combat_tracker_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return combat_tracker_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function combat_tracker_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function combat_tracker_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function combat_tracker_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){combat_tracker_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){combat_tracker_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function combat_tracker_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function combat_tracker_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function combat_tracker_createClass(t,r,a){return r&&combat_tracker_defineProperties(t.prototype,r),a&&combat_tracker_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function combat_tracker_get(){return combat_tracker_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=combat_tracker_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},combat_tracker_get.apply(this,arguments)}function combat_tracker_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=combat_tracker_getPrototypeOf(t)););return t}function combat_tracker_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&combat_tracker_setPrototypeOf(t,r)}function combat_tracker_setPrototypeOf(t,r){return combat_tracker_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},combat_tracker_setPrototypeOf(t,r)}function combat_tracker_createSuper(t){var r=function combat_tracker_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=combat_tracker_getPrototypeOf(t);if(r){var i=combat_tracker_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return combat_tracker_possibleConstructorReturn(this,a)}}function combat_tracker_possibleConstructorReturn(t,r){if(r&&("object"===combat_tracker_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function combat_tracker_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function combat_tracker_getPrototypeOf(t){return combat_tracker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},combat_tracker_getPrototypeOf(t)}var fe=function(t){combat_tracker_inherits(DSKCombatTracker,CombatTracker);var a,o=combat_tracker_createSuper(DSKCombatTracker);function DSKCombatTracker(){return combat_tracker_classCallCheck(this,DSKCombatTracker),o.apply(this,arguments)}return combat_tracker_createClass(DSKCombatTracker,[{key:"activateListeners",value:function activateListeners(t){combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombatTracker.prototype),"activateListeners",this).call(this,t),t.find(".combatant.actor .aggroButton").click((function(t){t.preventDefault(),t.stopPropagation(),DSKCombatTracker.runActAttackDialog()}))}},{key:"getData",value:(a=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee(t){var a,o,i,c;return combat_tracker_regeneratorRuntime().wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombatTracker.prototype),"getData",this).call(this,t);case 2:a=u.sent,o=combat_tracker_createForOfIteratorHelper(a.turns);try{for(c=function _loop(){var t=i.value,o=a.combat.turns.find((function(r){return r.id==t.id})),c=game.user.isGM||o.actor&&o.actor.testUserPermission(game.user,"OBSERVER")||!game.settings.get("dsk","hideEffects");t.defenseCount=o.getFlag("dsk","defenseCount")||0;var u=[];if(o.actor){var l,p=combat_tracker_createForOfIteratorHelper(o.actor.items);try{for(p.s();!(l=p.n()).done;){var d=l.value;if("rangeweapon"==d.type&&d.system.worn.value&&d.system.reloadTimeprogress>0){var h={name:d.name,remaining:r.Z.calcLZ(d,o.actor)-d.system.reloadTimeprogress};h.remaining>0&&u.push(h)}else if(["spell","liturgy"].includes(d.type)&&d.system.castingTime.modified>0){var y={name:d.name,remaining:d.system.castingTime.modified-d.system.castingTime.progress};y.remaining>0&&u.push(y)}}}catch(t){p.e(t)}finally{p.f()}}(u=u.sort((function(t,r){return t.remaining-r.remaining}))).length>0&&(t.ongoings="".concat(game.i18n.localize("dsk.COMBATTRACKER.ongoing"),"\n").concat(u.map((function(t){return"".concat(t.name," - ").concat(t.remaining)})).join("\n")),t.ongoing=u[0].remaining),t.effects=new Set,o.token&&(o.token.effects.forEach((function(r){return t.effects.add(r)})),o.token.overlayEffect&&t.effects.add(o.token.overlayEffect)),o.actor&&o.actor.temporaryEffects.forEach((function(r){r.getFlag("core","statusId")===CONFIG.Combat.defeatedStatusId?t.defeated=!0:!r.icon||!c||r.notApplicable||!game.user.isGM&&r.getFlag("dsk","hidePlayers")||r.getFlag("dsk","hideOnToken")||t.effects.add(r.icon)}))},o.s();!(i=o.n()).done;)c()}catch(t){o.e(t)}finally{o.f()}return u.abrupt("return",a);case 6:case"end":return u.stop()}}),_callee,this)}))),function getData(t){return a.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){return foundry.utils.mergeObject(combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombatTracker),"defaultOptions",this),{template:"/systems/dsk/templates/system/combattracker.html"})}},{key:"runActAttackDialog",value:function runActAttackDialog(){if(game.combat){var t=game.combat.combatant;(game.user.isGM||t.isOwner)&&le.showDialog(t.actor,t.tokenId)}}}]),DSKCombatTracker}(),pe=function(t){combat_tracker_inherits(DSKCombat,Combat);var r,a,o,i,c=combat_tracker_createSuper(DSKCombat);function DSKCombat(t,r){return combat_tracker_classCallCheck(this,DSKCombat),c.call(this,t,r)}return combat_tracker_createClass(DSKCombat,[{key:"refreshTokenbars",value:(i=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee2(){return combat_tracker_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:game.dsk.apps.tokenHotbar&&game.dsk.apps.tokenHotbar.updateDSKHotbar();case 1:case"end":return t.stop()}}),_callee2)}))),function refreshTokenbars(){return i.apply(this,arguments)})},{key:"_onCreate",value:function _onCreate(t,r,a){combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombat.prototype),"_onCreate",this).call(this,t,r,a),this.refreshTokenbars()}},{key:"_onDelete",value:function _onDelete(t,r){combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombat.prototype),"_onDelete",this).call(this,t,r),this.refreshTokenbars()}},{key:"nextRound",value:(o=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee3(){var t,r,a;return combat_tracker_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(!game.user.isGM){o.next=20;break}t=combat_tracker_createForOfIteratorHelper(this.turns),o.prev=2,t.s();case 4:if((r=t.n()).done){o.next=10;break}return a=r.value,o.next=8,a.setFlag("dsk","defenseCount",0);case 8:o.next=4;break;case 10:o.next=15;break;case 12:o.prev=12,o.t0=o.catch(2),t.e(o.t0);case 15:return o.prev=15,t.f(),o.finish(15);case 18:o.next=22;break;case 20:return o.next=22,game.socket.emit("system.dsk",{type:"clearCombat",payload:{}});case 22:return o.next=24,combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombat.prototype),"nextRound",this).call(this);case 24:return o.abrupt("return",o.sent);case 25:case"end":return o.stop()}}),_callee3,this,[[2,12,15,18]])}))),function nextRound(){return o.apply(this,arguments)})},{key:"getDefenseCount",value:(a=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee4(t){var r;return combat_tracker_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return r=this.getCombatantFromActor(t),a.abrupt("return",r&&r.getFlag("dsk","defenseCount")||0);case 2:case"end":return a.stop()}}),_callee4,this)}))),function getDefenseCount(t){return a.apply(this,arguments)})},{key:"getCombatantFromActor",value:function getCombatantFromActor(t){var r;return(r=t.token?Array.from(this.combatants).find((function(r){return r.tokenId==t.token})):Array.from(this.combatants).find((function(r){return r.actorId==t.actor})))?this.combatants.get(r.id):void 0}},{key:"updateDefenseCount",value:(r=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee5(t){var r;return combat_tracker_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:if(!game.user.isGM){a.next=7;break}if(!(r=this.getCombatantFromActor(t))||getProperty(r.actor,"system.config.defense")){a.next=5;break}return a.next=5,r.setFlag("dsk","defenseCount",(r.getFlag("dsk","defenseCount")||0)+1);case 5:a.next=9;break;case 7:return a.next=9,game.socket.emit("system.dsk",{type:"updateDefenseCount",payload:{speaker:t}});case 9:case"end":return a.stop()}}),_callee5,this)}))),function updateDefenseCount(t){return r.apply(this,arguments)})}]),DSKCombat}(),de=function(t){combat_tracker_inherits(DSKCombatant,Combatant);var r,a=combat_tracker_createSuper(DSKCombatant);function DSKCombatant(t,r){return combat_tracker_classCallCheck(this,DSKCombatant),null==t.flags&&(t.flags={}),mergeObject(t.flags,{dsk:{defenseCount:0}}),a.call(this,t,r)}return combat_tracker_createClass(DSKCombatant,[{key:"recalcInitiative",value:(r=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee6(){var t,r;return combat_tracker_regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:if(!this.initiative){a.next=10;break}return a.next=3,this.getFlag("dsk","baseRoll");case 3:if(a.t0=a.sent,a.t0){a.next=6;break}a.t0=0;case 6:return t=a.t0,r={initiative:t+this.actor.system.stats.ini.value},a.next=10,this.update(r);case 10:case"end":return a.stop()}}),_callee6,this)}))),function recalcInitiative(){return r.apply(this,arguments)})}]),DSKCombatant}();Hooks.on("preCreateCombatant",(function(r,a,o){var i=t.Z.getSpeaker({actor:r.actorId,scene:r.sceneId,token:r.token_id});if("loot"==getProperty(i.system,"merchant.merchantType"))return!1})),Hooks.on("updateCombatant",(function(t,r,a){if(game.user.isGM)if(r.initiative){if(!t.getFlag("dsk","baseRoll")){var o="".concat(r.initiative).split("."),i=Number(o[0])-Math.round(t.actor.system.stats.ini.value);t.setFlag("dsk","baseRoll",i)}}else"initiative"in r&&null==r.initiative&&t.update(function combat_tracker_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}({},"flags.dsk.-=baseRoll",null))}));var he=function(){function RepeatingEffectsHelper(){combat_tracker_classCallCheck(this,RepeatingEffectsHelper)}var r,a,o,i,c;return combat_tracker_createClass(RepeatingEffectsHelper,null,[{key:"updateCombatHook",value:(c=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee7(t,r,a,o){return combat_tracker_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:if(r.round||r.turn){a.next=2;break}return a.abrupt("return");case 2:if(0==t.round||!t.turns||!t.active){a.next=6;break}if(!(t.previous.round<t.current.round)){a.next=6;break}return a.next=6,RepeatingEffectsHelper.startOfRound(t);case 6:case"end":return a.stop()}}),_callee7)}))),function updateCombatHook(t,r,a,o){return c.apply(this,arguments)})},{key:"startOfRound",value:(i=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee8(t){var r,a,o,i,c,u,l,p;return combat_tracker_regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:if((r=game.users.find((function(t){return t.active&&t.isGM})))&&game.user.id==r.id){d.next=3;break}return d.abrupt("return");case 3:a=combat_tracker_createForOfIteratorHelper(t.turns),d.prev=4,a.s();case 6:if((o=a.n()).done){d.next=37;break}if((i=o.value).defeated){d.next=35;break}c=combat_tracker_createForOfIteratorHelper(i.actor.effects),d.prev=10,c.s();case 12:if((u=c.n()).done){d.next=25;break}if(l=u.value,"bleeding"!=(p=l.getFlag("core","statusId"))){d.next=20;break}return d.next=18,this.applyBleeding(i);case 18:d.next=23;break;case 20:if("burning"!=p){d.next=23;break}return d.next=23,this.applyBurning(i,l);case 23:d.next=12;break;case 25:d.next=30;break;case 27:d.prev=27,d.t0=d.catch(10),c.e(d.t0);case 30:return d.prev=30,c.f(),d.finish(30);case 33:return d.next=35,this.startOfRoundEffects(i);case 35:d.next=6;break;case 37:d.next=42;break;case 39:d.prev=39,d.t1=d.catch(4),a.e(d.t1);case 42:return d.prev=42,a.f(),d.finish(42);case 45:case"end":return d.stop()}}),_callee8,this,[[4,39,42,45],[10,27,30,33]])}))),function startOfRound(t){return i.apply(this,arguments)})},{key:"startOfRoundEffects",value:(o=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee9(r){var a,o,i,c,u,l,p,d,h,y;return combat_tracker_regeneratorRuntime().wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:a=0,o=["LeP","AeP"];case 2:if(!(a<o.length)){m.next=41;break}i=o[a],c=combat_tracker_createForOfIteratorHelper(r.actor.system.repeatingEffects.startOfRound[i]),m.prev=5,c.s();case 7:if((u=c.n()).done){m.next=30;break}if(l=u.value,!getProperty(r.actor.system.repeatingEffects,"disabled.".concat(i))){m.next=11;break}return m.abrupt("continue",28);case 11:return m.next=13,new Roll(l.value).evaluate({async:!0});case 13:return p=m.sent,m.next=16,p.render();case 16:return d=m.sent,h=game.i18n.localize(p.total>0?"dsk.CHATNOTIFICATION.regenerates":"dsk.CHATNOTIFICATION.getsHurt"),y="".concat(r.actor.name," ").concat(h," ").concat(game.i18n.localize(i)," ").concat(d),m.next=21,ChatMessage.create(t.Z.chatDataSetup(y));case 21:if("LeP"!=i){m.next=26;break}return m.next=24,r.actor.applyDamage(-1*p.total);case 24:m.next=28;break;case 26:return m.next=28,r.actor.applyMana(-1*p.total);case 28:m.next=7;break;case 30:m.next=35;break;case 32:m.prev=32,m.t0=m.catch(5),c.e(m.t0);case 35:return m.prev=35,c.f(),m.finish(35);case 38:a++,m.next=2;break;case 41:case"end":return m.stop()}}),_callee9,null,[[5,32,35,38]])}))),function startOfRoundEffects(t){return o.apply(this,arguments)})},{key:"applyBleeding",value:(a=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee10(r){return combat_tracker_regeneratorRuntime().wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:if(!(r.actor.system.stats.LeP.value<=0)){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,ChatMessage.create(t.Z.chatDataSetup(game.i18n.format("dsk.CHATNOTIFICATION.bleeding",{actor:r.actor.name})));case 4:return a.next=6,r.actor.applyDamage(1);case 6:case"end":return a.stop()}}),_callee10)}))),function applyBleeding(t){return a.apply(this,arguments)})},{key:"applyBurning",value:(r=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee11(r,a){var o,i,c,u,l;return combat_tracker_regeneratorRuntime().wrap((function _callee11$(p){for(;;)switch(p.prev=p.next){case 0:if(!(r.actor.system.stats.LeP.value<=0)){p.next=2;break}return p.abrupt("return");case 2:return o=Number(a.getFlag("dsk","value")),i=DSKStatusEffects.resistantToEffect(r.actor,a),c={0:"1",1:"1d3",2:"1d6",3:"2d6"}[o-i]||"1",p.next=7,new Roll(c).evaluate({async:!0});case 7:return u=p.sent,p.next=10,u.render();case 10:return l=p.sent,p.next=13,ChatMessage.create(t.Z.chatDataSetup(game.i18n.format("dsk.CHATNOTIFICATION.burning.".concat(o),{actor:r.actor.name,damage:l})));case 13:return p.next=15,r.actor.applyDamage(u.total);case 15:case"end":return p.stop()}}),_callee11)}))),function applyBurning(t,a){return r.apply(this,arguments)})}]),RepeatingEffectsHelper}();function dsk_ini_tracker_typeof(t){return dsk_ini_tracker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dsk_ini_tracker_typeof(t)}function dsk_ini_tracker_regeneratorRuntime(){dsk_ini_tracker_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dsk_ini_tracker_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function dsk_ini_tracker_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function dsk_ini_tracker_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){dsk_ini_tracker_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){dsk_ini_tracker_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dsk_ini_tracker_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dsk_ini_tracker_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dsk_ini_tracker_get(){return dsk_ini_tracker_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dsk_ini_tracker_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dsk_ini_tracker_get.apply(this,arguments)}function dsk_ini_tracker_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dsk_ini_tracker_getPrototypeOf(t)););return t}function dsk_ini_tracker_setPrototypeOf(t,r){return dsk_ini_tracker_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dsk_ini_tracker_setPrototypeOf(t,r)}function dsk_ini_tracker_createSuper(t){var r=function dsk_ini_tracker_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dsk_ini_tracker_getPrototypeOf(t);if(r){var i=dsk_ini_tracker_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dsk_ini_tracker_possibleConstructorReturn(this,a)}}function dsk_ini_tracker_possibleConstructorReturn(t,r){if(r&&("object"===dsk_ini_tracker_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dsk_ini_tracker_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dsk_ini_tracker_getPrototypeOf(t){return dsk_ini_tracker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dsk_ini_tracker_getPrototypeOf(t)}Hooks.on("updateCombat",he.updateCombatHook);var ye=function(t){!function dsk_ini_tracker_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dsk_ini_tracker_setPrototypeOf(t,r)}(DSKIniTracker,Application);var r,a,o,i,c=dsk_ini_tracker_createSuper(DSKIniTracker);function DSKIniTracker(){return dsk_ini_tracker_classCallCheck(this,DSKIniTracker),c.apply(this,arguments)}return function dsk_ini_tracker_createClass(t,r,a){return r&&dsk_ini_tracker_defineProperties(t.prototype,r),a&&dsk_ini_tracker_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKIniTracker,[{key:"setPosition",value:function setPosition(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.left,a=t.top,o=t.width,i=t.height,c=t.scale,u=dsk_ini_tracker_get(dsk_ini_tracker_getPrototypeOf(DSKIniTracker.prototype),"setPosition",this).call(this,{left:r,top:a,width:o,height:i,scale:c}),l=this.element[0];if(!l.style.width||o){var p=o||l.offsetWidth,d=l.style.maxWidth||window.innerWidth;u.width=o=Math.clamped(p,0,d),l.style.width=o+"px",o+u.left>window.innerWidth&&(r=u.left)}return game.settings.set("dsk","iniTrackerPosition",{left:u.left,top:u.top}),u}},{key:"updateTracker",value:function updateTracker(t){this.combatData=t,this.render(!0)}},{key:"getData",value:(i=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee(t){var r,a,o,i,c,u,l,p,d,h,y,m,g,v,_,b,k;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.combatData,a=game.settings.get("dsk","iniTrackerSize"),o=r.round,i=r.turns,c=[],u=game.settings.get("core",Combat.CONFIG_SETTING).skipDefeated,l=r.turns.some((function(t){return t.owner&&!t.hasRolled&&(!game.user.isGM||r.combat.combatants.get(t.id).isNPC)})),i.length){for(p=[],d=5,h=!1,y=-1,m=0,g=0;0!=d&&5!=g;)_=duplicate(i[m]),b=r.combat.combatants.get(_.id),h&&m==y&&(_.css=_.css.replace("active","")),!o||_.active&&!h?(h=!0,y=m):b.getFlag("dsk","waitInit")!=r.round+g||b.defeated||!game.user.isGM&&b.hidden||c.push(_),!h||u&&b.defeated||!game.user.isGM&&b.hidden||(_.round=r.round+g,_.owner&&null!==(k=b.token)&&void 0!==k&&k.actor&&(_.maxLP=b.token.actor.system.stats.LeP.max,_.currentLP=b.token.actor.system.stats.LeP.value),v&&v!=_.round&&(_.newRound="newRound"),v=_.round,p.push(_),d--),++m>=i.length&&(m=0,g++);r.turns=p}return this.position.width=5*a+95,this.position.height=a+10,mergeObject(r,{itemWidth:a,unRolled:l,waitingTurns:c}),this.conditionalPanToCurrentCombatant(r),t.abrupt("return",r);case 13:case"end":return t.stop()}}),_callee,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"hasChangedTurn",value:function hasChangedTurn(t){var r=t.turn!=this.lastTurnUpdate||t.round!=this.lastRoundUpdate;return this.lastTurnUpdate=t.turn,this.lastRoundUpdate=t.round,r}},{key:"conditionalPanToCurrentCombatant",value:(o=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee2(t){var r,a;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:if(game.settings.get("dsk","enableCombatPan")){o.next=2;break}return o.abrupt("return");case 2:if(r=t.turns[0]){o.next=5;break}return o.abrupt("return");case 5:if((a=t.combat.combatants.get(r.id))&&this.hasChangedTurn(t)){o.next=8;break}return o.abrupt("return");case 8:setTimeout((function(){var t=a.token;t&&t.object&&t.object.isVisible&&(canvas.animatePan({x:t.x,y:t.y}),a.actor&&a.actor.isOwner&&t.object.control({releaseOthers:!0}))}),300);case 9:case"end":return o.stop()}}),_callee2,this)}))),function conditionalPanToCurrentCombatant(t){return o.apply(this,arguments)})},{key:"_onWheelResize",value:(a=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee3(t){var r;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return r=game.settings.get("dsk","iniTrackerSize"),r=t.originalEvent.deltaY>0?Math.min(140,r+5):Math.max(30,r-5),a.next=4,game.settings.set("dsk","iniTrackerSize",r);case 4:return a.next=6,this.render(!0);case 6:case"end":return a.stop()}}),_callee3,this)}))),function _onWheelResize(t){return a.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;dsk_ini_tracker_get(dsk_ini_tracker_getPrototypeOf(DSKIniTracker.prototype),"activateListeners",this).call(this,t);var a=t.find(".dragHandler");new Draggable(this,t,a[0],this.options.resizable),a.on("wheel",function(){var t=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee4(t){return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return t.stopPropagation(),t.preventDefault(),a.next=4,r._onWheelResize(t);case 4:return a.abrupt("return",!1);case 5:case"end":return a.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.find(".combat-control").click((function(t){return r._onCombatControl(t)}));var o=t.find(".iniItem");o.hover(this._onCombatantHoverIn.bind(this),this._onCombatantHoverOut.bind(this)),o.click(this._onCombatantMouseDown.bind(this)),t.find(".waitingTackerList .iniItem").mousedown((function(t){return r._onRightClick(t)})),t.find(".combatant-control").click((function(t){return r._onCombatantControl(t)})),t.find(".combatant .aggroButton").click((function(t){t.preventDefault(),t.stopPropagation(),fe.runActAttackDialog()})),t.find(".rollMine").click((function(t){return r.rollMyChars()})),game.user.isGM&&t.find(".rolledInit").click((function(t){return r.editCombatant(t)}))}},{key:"rollMyChars",value:function rollMyChars(){game.user.isGM?this._getCombatApp().viewed.rollNPC({}):this._getCombatApp().viewed.rollAll({})}},{key:"_onRightClick",value:function _onRightClick(t){if(2==t.button){var r=game.combat.combatants.get(t.currentTarget.dataset.combatantId);r.isOwner&&r.unsetFlag("dsk","waitInit")}}},{key:"editCombatant",value:function editCombatant(t){this._getCombatApp()._onConfigureCombatant($(t.currentTarget))}},{key:"_onCombatantControl",value:function _onCombatantControl(t){this._getCombatApp()._onCombatantControl(t)}},{key:"_onCombatControl",value:function _onCombatControl(t){"waitInit"==t.currentTarget.dataset.control?this.waitInit(t):this._getCombatApp()._onCombatControl(t)}},{key:"waitInit",value:(r=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee5(t){var r;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return r=game.combat.combatants.get(game.combat.current.combatantId),a.next=3,r.setFlag("dsk","waitInit",game.combat.current.round);case 3:t.currentTarget.dataset.control="nextTurn",this._getCombatApp()._onCombatControl(t);case 5:case"end":return a.stop()}}),_callee5,this)}))),function waitInit(t){return r.apply(this,arguments)})},{key:"_onCombatantHoverOut",value:function _onCombatantHoverOut(t){this._getCombatApp()._onCombatantHoverOut(t)}},{key:"_onCombatantHoverIn",value:function _onCombatantHoverIn(t){this._getCombatApp()._onCombatantHoverIn(t)}},{key:"_onCombatantMouseDown",value:function _onCombatantMouseDown(t){this._getCombatApp()._onCombatantMouseDown(t)}},{key:"_getCombatApp",value:function _getCombatApp(){return game.combats.apps[0]}},{key:"_canDragStart",value:function _canDragStart(t){return!1}},{key:"_canDragDrop",value:function _canDragDrop(t){return!1}},{key:"_onDragStart",value:function _onDragStart(t){var r=$(t.currentTarget).closestData("combatant-id");t.dataTransfer.setData("text/plain",JSON.stringify({type:"IniChange",combatantId:r}))}},{key:"_onDrop",value:function _onDrop(t){JSON.parse(t.dataTransfer.getData("text/plain")).type}}],[{key:"defaultOptions",get:function get(){var t=dsk_ini_tracker_get(dsk_ini_tracker_getPrototypeOf(DSKIniTracker),"defaultOptions",this);mergeObject(t,{classes:t.classes.concat(["dsk","initTracker"]),template:"systems/dsk/templates/system/initracker.html",dragDrop:[{dragSelector:".iniItem",dropSelector:[".iniTrackerList"]}],top:100,left:170,title:"dsk.DSKIniTracker"});var r=game.settings.get("dsk","iniTrackerPosition");return mergeObject(t,r),t}},{key:"connectHooks",value:function connectHooks(){Hooks.on("renderDSKCombatTracker",(function(t,r,a){game.settings.get("dsk","enableCombatFlow")&&(game.combat?(game.dsk.apps.initTracker||(game.dsk.apps.initTracker=new DSKIniTracker),game.dsk.apps.initTracker.updateTracker(a)):game.dsk.apps.initTracker&&(game.dsk.apps.initTracker.close(),game.dsk.apps.initTracker=void 0))}))}}]),DSKIniTracker}(),me=__webpack_require__(604);function tokenHotbar2_typeof(t){return tokenHotbar2_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tokenHotbar2_typeof(t)}function tokenHotbar2_toConsumableArray(t){return function tokenHotbar2_arrayWithoutHoles(t){if(Array.isArray(t))return tokenHotbar2_arrayLikeToArray(t)}(t)||function tokenHotbar2_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||tokenHotbar2_unsupportedIterableToArray(t)||function tokenHotbar2_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tokenHotbar2_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=tokenHotbar2_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function tokenHotbar2_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return tokenHotbar2_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?tokenHotbar2_arrayLikeToArray(t,r):void 0}}function tokenHotbar2_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function tokenHotbar2_regeneratorRuntime(){tokenHotbar2_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==tokenHotbar2_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function tokenHotbar2_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function tokenHotbar2_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){tokenHotbar2_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){tokenHotbar2_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function tokenHotbar2_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function tokenHotbar2_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function tokenHotbar2_createClass(t,r,a){return r&&tokenHotbar2_defineProperties(t.prototype,r),a&&tokenHotbar2_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function tokenHotbar2_get(){return tokenHotbar2_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=tokenHotbar2_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},tokenHotbar2_get.apply(this,arguments)}function tokenHotbar2_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=tokenHotbar2_getPrototypeOf(t)););return t}function tokenHotbar2_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&tokenHotbar2_setPrototypeOf(t,r)}function tokenHotbar2_setPrototypeOf(t,r){return tokenHotbar2_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},tokenHotbar2_setPrototypeOf(t,r)}function tokenHotbar2_createSuper(t){var r=function tokenHotbar2_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=tokenHotbar2_getPrototypeOf(t);if(r){var i=tokenHotbar2_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return tokenHotbar2_possibleConstructorReturn(this,a)}}function tokenHotbar2_possibleConstructorReturn(t,r){if(r&&("object"===tokenHotbar2_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function tokenHotbar2_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function tokenHotbar2_getPrototypeOf(t){return tokenHotbar2_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},tokenHotbar2_getPrototypeOf(t)}var ge=function(t){tokenHotbar2_inherits(TokenHotbar2,Application);var a,o,i,c,u,l,p=tokenHotbar2_createSuper(TokenHotbar2);function TokenHotbar2(t){var r;tokenHotbar2_classCallCheck(this,TokenHotbar2),(r=p.call(this,t)).combatSkills=["selfControl","featOfStrength","bodyControl","perception"].map((function(t){return game.i18n.localize("dsk.LocalizedIDs.".concat(t))})),r.defaultSkills=[game.i18n.localize("dsk.LocalizedIDs.perception")];var a=function parentUpdate(t){var r=t.parent?t.parent.id:void 0;r&&TokenHotbar2.hookUpdate(r)};return Hooks.on("controlToken",(function(t,a){r.updateDSKHotbar()})),Hooks.on("updateActor",(function(t,r){TokenHotbar2.hookUpdate(t.id)})),Hooks.on("updateToken",(function(t,a,o){a._id==getProperty(game.dsk.apps.tokenHotbar,"actor.prototypeToken.id")&&r.updateDSKHotbar()})),Hooks.on("updateOwnedItem",(function(t,r){TokenHotbar2.hookUpdate(t.data.id)})),Hooks.on("createOwnedItem",(function(t,r){TokenHotbar2.hookUpdate(t.data.id)})),Hooks.on("deleteOwnedItem",(function(t,r){TokenHotbar2.hookUpdate(t.data.id)})),Hooks.on("updateItem",(function(t,r){a(t)})),Hooks.on("createItem",(function(t,r){a(t)})),Hooks.on("deleteItem",(function(t,r){a(t)})),r}return tokenHotbar2_createClass(TokenHotbar2,[{key:"resetPosition",value:function resetPosition(){var t=$("#hotbar").first().position(),r=game.settings.get("dsk","tokenhotbarSize");this.position.left=t.left+8,this.position.top=t.top-r-25}},{key:"_onWheelResize",value:(l=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee(t){var r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return r=game.settings.get("dsk","tokenhotbarSize"),r=t.originalEvent.deltaY>0?Math.min(100,r+5):Math.max(15,r-5),a.next=4,game.settings.set("dsk","tokenhotbarSize",r);case 4:return a.next=6,this.render(!0);case 6:case"end":return a.stop()}}),_callee,this)}))),function _onWheelResize(t){return l.apply(this,arguments)})},{key:"_cycleLayout",value:(u=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee2(t){var r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(2!=t.button){a.next=7;break}return 4==(r=game.settings.get("dsk","tokenhotbarLayout")+1)&&(r=0),a.next=5,game.settings.set("dsk","tokenhotbarLayout",r);case 5:return a.next=7,this.render(!0);case 7:case"end":return a.stop()}}),_callee2,this)}))),function _cycleLayout(t){return u.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"activateListeners",this).call(this,t);var a=t.find(".dragHandler");new Draggable(this,t,a[0],this.options.resizable),a.on("wheel",function(){var t=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee3(t){return tokenHotbar2_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return t.stopPropagation(),t.preventDefault(),a.next=4,r._onWheelResize(t);case 4:return a.abrupt("return",!1);case 5:case"end":return a.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()),a.on("mousedown",function(){var t=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee4(t){return tokenHotbar2_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r._cycleLayout(t);case 2:case"end":return a.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.on("mousedown","li",function(){var t=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee5(t){return tokenHotbar2_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return t.stopPropagation(),a.next=3,r.executeQuickButton(t);case 3:return a.abrupt("return",!1);case 4:case"end":return a.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()),t.on("mouseenter","li.primary",(function(a){var o=a.currentTarget.dataset.category;r.category=o,setTimeout((function(){t.find(".secondary").removeClass("shown"),o==r.category&&t.find('.secondary[data-category="'.concat(o,'"]')).addClass("shown")}),700)})),t.on("mouseleave","li.primary",(function(a){var o=a.currentTarget.dataset.category;r.category=void 0,setTimeout((function(){o!=r.category&&t.find('.secondary[data-category="'.concat(o,'"]')).removeClass("shown")}),50)}))}},{key:"executeQuickButton",value:(c=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee6(t){var r,a,o,i,c,u,l,p;return tokenHotbar2_regeneratorRuntime().wrap((function _callee6$(d){for(;;)switch(d.prev=d.next){case 0:r=canvas.tokens.controlled[0].actor,a=canvas.tokens.controlled[0].id,o=t.currentTarget.dataset.id,i=t.currentTarget.dataset.subfunction,d.t0=i,d.next="addEffect"===d.t0?7:"effect"===d.t0?9:"onUse"===d.t0?31:35;break;case 7:return ve.showDialog(),d.abrupt("break",48);case 9:if(c=r.effects.get(o),u=c.getFlag("core","statusId"),0!=t.button){d.next=20;break}if(!u){d.next=17;break}return d.next=15,r.addCondition(u,1,!1,!1);case 15:d.next=18;break;case 17:c.sheet.render(!0);case 18:d.next=28;break;case 20:if(2!=t.button){d.next=28;break}if(!u){d.next=26;break}return d.next=24,r.removeCondition(u,1,!1);case 24:d.next=28;break;case 26:return d.next=28,r.sheet._deleteActiveEffect(o);case 28:return d.next=30,this.render(!0);case 30:return d.abrupt("break",48);case 31:return l=r.items.get(o),new me.Z(l).executeOnUseEffect(),d.abrupt("break",48);case 35:if(!(p=r.items.get(o))){d.next=48;break}if(2!=t.button){d.next=39;break}return d.abrupt("return",p.sheet.render(!0));case 39:d.t1=p.type,d.next="meleeweapon"===d.t1||"rangeweapon"===d.t1||"trait"===d.t1?42:"ahnengabe"===d.t1?44:"skill"===d.t1?46:48;break;case 42:return r.setupWeapon(p,"attack",{},a).then((function(t){r.basicTest(t)})),d.abrupt("break",48);case 44:return r.setupSpell(p,{},a).then((function(t){r.basicTest(t)})),d.abrupt("break",48);case 46:return r.setupSkill(p,{},a).then((function(t){r.basicTest(t)})),d.abrupt("break",48);case 48:case"end":return d.stop()}}),_callee6,this)}))),function executeQuickButton(t){return c.apply(this,arguments)})},{key:"subWidth",value:function subWidth(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;return'style="width:'.concat(200*Math.ceil(t.length/a),'px"')}},{key:"getData",value:(i=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee7(){var t,a,o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,D,R,L,G,j;return tokenHotbar2_regeneratorRuntime().wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"getData",this).call(this);case 2:if(t=M.sent,a=this.actor,o={attacks:[],spells:[],default:[],skills:[]},u=[],l=[],p=[],d=game.settings.get("dsk","tokenhotbarLayout"),h=d%2,y=TokenHotbar2.defaultOptions.itemWidth,m=["ahnengabe"],!a){M.next=25;break}return g=[],v=[],M.next=17,a.actorEffects();case 17:if(p=M.sent.map((function(t){return{name:t.label,id:t.id,icon:t.icon,cssClass:"effect",abbrev:"".concat(t.label[0]," ").concat(t.getFlag("dsk","value")||""),subfunction:"effect"}})),game.combat){_=a.items.filter((function(t){return"combatskill"==t.type})).map((function(t){return r.Z._calculateCombatSkillValues(t.toObject(),a.system)})),b=["meleeweapon","rangeweapon"],k=["meleeAttack","rangeAttack"],w=tokenHotbar2_createForOfIteratorHelper(a.items);try{for(w.s();!(x=w.n()).done;)"trait"==(O=x.value).type&&k.includes(O.system.traitType)?(S=r.Z._parseDmg(O.toObject()),o.attacks.push({name:O.name,id:O.id,icon:O.img,cssClass:"weapon ".concat(O.id),abbrev:O.name[0],attack:O.system.at,damage:S.damagedie,dadd:S.damageAdd})):b.includes(O.type)&&1==O.system.worn.value?(P="meleeweapon"==O.type?r.Z._prepareMeleeWeapon(O.toObject(),_,a):r.Z._prepareRangeWeapon(O.toObject(),[],_,a),o.attacks.push({name:O.name,id:O.id,icon:O.img,cssClass:"weapon ".concat(O.id),abbrev:O.name[0],attack:P.attack,damage:P.damagedie,dadd:P.damageAdd})):m.includes(O.type)?O.system.effectFormula?o.spells.push({name:O.name,id:O.id,icon:O.img,cssClass:"spell",abbrev:O.name[0]}):v.push({name:O.name,id:O.id,icon:O.img,cssClass:"spell",abbrev:O.name[0]}):["skill"].includes(O.type)&&this.combatSkills.includes(O.name)?o.default.push({name:"".concat(O.name," (").concat(O.system.level,")"),id:O.id,icon:O.img,cssClass:"skill",abbrev:O.name[0]}):["skill"].includes(O.type)?(T={name:"".concat(O.name," (").concat(O.system.level,")"),id:O.id,icon:O.img,cssClass:"skill",addClass:O.system.group,abbrev:O.name[0],tw:O.system.level},g.push(T)):"consumable"==O.type&&u.push({name:O.name,id:O.id,icon:O.img,cssClass:"consumable",abbrev:O.system.quantity}),O.getFlag("dsk","onUseEffect")&&l.push({name:O.name,id:O.id,icon:O.img,cssClass:"onUse",abbrev:O.name[0],subfunction:"onUse"})}catch(t){w.e(t)}finally{w.f()}i=u.pop()}else{E=[],C=tokenHotbar2_createForOfIteratorHelper(a.items);try{for(C.s();!(A=C.n()).done;)D=A.value,["skill"].includes(D.type)&&this.defaultSkills.includes(D.name)?o.default.push({name:"".concat(D.name," (").concat(D.system.level,")"),id:D.id,icon:D.img,cssClass:"skill",abbrev:D.name[0]}):["skill"].includes(D.type)?(R={name:"".concat(D.name," (").concat(D.system.level,")"),id:D.id,icon:D.img,cssClass:"skill",addClass:D.system.group,abbrev:D.name[0],tw:D.system.level},D.system.level>0&&E.push(R),g.push(R)):m.includes(D.type)&&(D.system.effectFormula?o.spells.push({name:D.name,id:D.id,icon:D.img,cssClass:"spell",abbrev:D.name[0]}):v.push({name:D.name,id:D.id,icon:D.img,cssClass:"spell",abbrev:D.name[0]})),D.getFlag("dsk","onUseEffect")&&l.push({name:D.name,id:D.id,icon:D.img,cssClass:"onUse",abbrev:D.name[0],subfunction:"onUse"})}catch(t){C.e(t)}finally{C.f()}(I=o.skills).push.apply(I,tokenHotbar2_toConsumableArray(E.sort((function(t,r){return r.tw-t.tw})).slice(0,5)))}c=l.pop(),0==o.spells.length&&v.length>0&&o.spells.push(v.pop()),o.spells.length>0&&v.length>0&&(o.spells[0].more=v.sort((function(t,r){return t.name.localeCompare(r.name)})),o.spells[0].subwidth=this.subWidth(v,y)),o.default.length>0&&g.length>0&&(o.default[0].more=g.sort((function(t,r){return t.addClass.localeCompare(r.addClass)||t.name.localeCompare(r.name)})),o.default[0].subwidth=this.subWidth(g,y,20)),i&&(u.length>0&&(i.more=u,i.subwidth=this.subWidth(u,y)),o.consumables=[i]),c&&(l.length>0&&(c.more=l,c.subwidth=this.subWidth(l,y)),o.onUsages=[c]);case 25:return this.showEffects&&(L=game.i18n.localize("dsk.CONDITION.add"),G={name:L,id:"",icon:"icons/svg/aura.svg",cssClass:"effect",abbrev:L[0],subfunction:"addEffect"},p.length>0&&(G.more=p,G.subwidth=this.subWidth(p,y)),o.effects=[G]),j=Object.keys(o).reduce((function(t,r){return t+o[r].length}),0),h?(this.position.width=y,this.position.height=y*j+14):(this.position.width=y*j+14,this.position.height=y),mergeObject(t,{items:o,itemWidth:y,direction:d,count:j}),M.abrupt("return",t);case 30:case"end":return M.stop()}}),_callee7,this)}))),function getData(){return i.apply(this,arguments)})},{key:"render",value:(o=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee8(t){var r,a,o=arguments;return tokenHotbar2_regeneratorRuntime().wrap((function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},i.next=3,tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"render",this).call(this,t,r);case 3:return a=i.sent,this._element&&this._element.css({zIndex:61}),i.abrupt("return",a);case 6:case"end":return i.stop()}}),_callee8,this)}))),function render(t){return o.apply(this,arguments)})},{key:"setPosition",value:function setPosition(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.left,a=t.top,o=t.width,i=t.height,c=t.scale,u=tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"setPosition",this).call(this,{left:r,top:a,width:o,height:i,scale:c}),l=this.element[0];if(!l.style.width||o){var p=o||l.offsetWidth,d=l.style.maxWidth||window.innerWidth;u.width=o=Math.clamped(p,0,d),l.style.width=o+"px",o+u.left>window.innerWidth&&(r=u.left)}return game.settings.set("dsk","tokenhotbarPosition",{left:u.left,top:u.top}),u}},{key:"updateDSKHotbar",value:(a=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee9(){var t,r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return t=canvas.tokens.controlled,this.actor=void 0,this.showEffects=!1,1===t.length&&(r=t[0].actor)&&r.isOwner&&(this.actor=r),t.length>=1&&(this.showEffects=!0),a.next=7,this.render(!0);case 7:case"end":return a.stop()}}),_callee9,this)}))),function updateDSKHotbar(){return a.apply(this,arguments)})}],[{key:"registerTokenHotbar",value:function registerTokenHotbar(){game.dsk.apps.tokenHotbar||(game.dsk.apps.tokenHotbar=new TokenHotbar2)}},{key:"hookUpdate",value:function hookUpdate(t){t==getProperty(game.dsk.apps.tokenHotbar,"actor.id")&&game.dsk.apps.tokenHotbar.updateDSKHotbar()}},{key:"defaultOptions",get:function get(){var t=tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2),"defaultOptions",this),r=$("#hotbar").first().position(),a=game.settings.get("dsk","tokenhotbarSize"),o=game.settings.get("dsk","tokenhotbarPosition");return mergeObject(t,{classes:t.classes.concat(["dsk","tokenQuickHot"]),itemWidth:a,resizable:!1,height:a+45,zIndex:61,left:r.left+8,top:r.top-a-25,template:"systems/dsk/templates/status/tokenHotbar.html",title:"TokenHotbar"}),mergeObject(t,o),t}}]),TokenHotbar2}(),ve=function(t){tokenHotbar2_inherits(AddEffectDialog,Dialog);var r,a,o=tokenHotbar2_createSuper(AddEffectDialog);function AddEffectDialog(){return tokenHotbar2_classCallCheck(this,AddEffectDialog),o.apply(this,arguments)}return tokenHotbar2_createClass(AddEffectDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;tokenHotbar2_get(tokenHotbar2_getPrototypeOf(AddEffectDialog.prototype),"activateListeners",this).call(this,t),t.find(".reactClick").click((function(t){return r.addEffect(t)}));var a=t.find(".conditionSearch");a.keyup((function(a){return r._filterConditions($(a.currentTarget),t)})),a[0]&&a[0].addEventListener("search",(function filterConditions(a){return r._filterConditions($(a.currentTarget),t)}),!1)}},{key:"_filterConditions",value:function _filterConditions(t,r){if(null!=t.val()){var a=t.val().toLowerCase().trim(),o=r.find(".filterable");r.find(".filterHide").removeClass("filterHide"),o.filter((function(){return-1==$(this).find("span").text().toLowerCase().trim().indexOf(a)})).addClass("filterHide")}}},{key:"addEffect",value:(a=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee10(t){var r,a,o;return tokenHotbar2_regeneratorRuntime().wrap((function _callee10$(i){for(;;)switch(i.prev=i.next){case 0:r=tokenHotbar2_createForOfIteratorHelper(canvas.tokens.controlled),i.prev=1,r.s();case 3:if((a=r.n()).done){i.next=9;break}return o=a.value,i.next=7,o.actor.addCondition(t.currentTarget.dataset.value,1,!1,!1);case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),r.e(i.t0);case 14:return i.prev=14,r.f(),i.finish(14);case 17:game.dsk.apps.tokenHotbar.render(!0),this.close();case 19:case"end":return i.stop()}}),_callee10,this,[[1,11,14,17]])}))),function addEffect(t){return a.apply(this,arguments)})}],[{key:"showDialog",value:(r=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee11(){var t,r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return t=duplicate(CONFIG.statusEffects).map((function(t){return{label:game.i18n.localize(t.label),icon:t.icon,description:game.i18n.localize(t.description),id:t.id}})).sort((function(t,r){return t.label.localeCompare(r.label)})),a.t0=AddEffectDialog,a.t1=game.i18n.localize("dsk.CONDITION.add"),a.next=5,renderTemplate("systems/dsk/templates/dialog/addstatusdialog.html",{effects:t});case 5:a.t2=a.sent,a.t3={},a.t4={title:a.t1,content:a.t2,buttons:a.t3},(r=new a.t0(a.t4)).position.height=36*Math.ceil(t.length/3)+170,r.render(!0);case 11:case"end":return a.stop()}}),_callee11)}))),function showDialog(){return r.apply(this,arguments)})},{key:"defaultOptions",get:function get(){var t=tokenHotbar2_get(tokenHotbar2_getPrototypeOf(AddEffectDialog),"defaultOptions",this),r=32*Math.ceil(CONFIG.statusEffects.length/3);return mergeObject(t,{classes:["dsk","tokenStatusEffects"],width:700,resizable:!0,height:r}),t}}]),AddEffectDialog}();function payment_typeof(t){return payment_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},payment_typeof(t)}function payment_regeneratorRuntime(){payment_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==payment_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function payment_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function payment_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function payment_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var _e=function(){function DSKPayment(){!function payment_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKPayment)}var r;return function payment_createClass(t,r,a){return r&&payment_defineProperties(t.prototype,r),a&&payment_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKPayment,null,[{key:"payMoney",value:function payMoney(r,a){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=DSKPayment.canPay(r,a,o);return i.success&&DSKPayment._updateMoney(r,i.actorsMoney.sum-i.money),o||""==i.msg||ChatMessage.create(t.Z.chatDataSetup("<p>".concat(i.msg,"</p>"),"roll")),i.success}},{key:"canPay",value:function canPay(t,r,a){var o=this._getPaymoney(r),i={success:!1,msg:"",money:o};return o&&(i.actorsMoney=this._actorsMoney(t),i.actorsMoney.sum>=o?(i.msg=game.i18n.format("dsk.PAYMENT.pay",{actor:t.name,amount:DSKPayment._moneyToString(o)}),i.success=!0):(i.msg=game.i18n.format("dsk.PAYMENT.cannotpay",{actor:t.name,amount:DSKPayment._moneyToString(o)}),a&&ui.notifications.notify(i.msg))),i}},{key:"getMoney",value:function getMoney(r,a){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._getPaidmoney(a);if(i){var c=this._actorsMoney(r);DSKPayment._updateMoney(r,c.sum+i);var u="<p>".concat(game.i18n.format("dsk.PAYMENT.getPaid",{actor:r.name,amount:DSKPayment._moneyToString(i)}),"</p>");return o||ChatMessage.create(t.Z.chatDataSetup(u,"roll")),!0}}},{key:"_updateMoney",value:function _updateMoney(t,r){var a=DSKPayment._moneyToCoins(r);t.update({"system.money":a})}},{key:"createGetPaidChatMessage",value:function createGetPaidChatMessage(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=this._getPaidmoney(r);if(o){var i=a?" (".concat(a,")"):"",c="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.wage"),"</b></p><p>").concat(game.i18n.format("dsk.PAYMENT.getPaidSum",{amount:DSKPayment._moneyToString(o)})).concat(i,'</p><button class="payButton" data-pay="1" data-amount="').concat(o,'">').concat(game.i18n.localize("dsk.PAYMENT.getPaidButton"),"</button>");ChatMessage.create(t.Z.chatDataSetup(c,"roll"))}}},{key:"createPayChatMessage",value:function createPayChatMessage(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=this._getPaymoney(r);if(o){var i=a?" (".concat(a,")"):"",c="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.bill"),"</b></p>").concat(game.i18n.format("dsk.PAYMENT.paySum",{amount:DSKPayment._moneyToString(o)})).concat(i,'</p><button class="payButton" data-pay="0" data-amount="').concat(o,'">').concat(game.i18n.localize("dsk.PAYMENT.payButton"),"</button>");ChatMessage.create(t.Z.chatDataSetup(c,"roll"))}}},{key:"_getPaidmoney",value:function _getPaidmoney(r){var a=this._parseMoneyString(r);if(!a){var o="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.error"),"</b></p><p><i>").concat(game.i18n.localize("dsk.PAYMENT.getPaidexample"),"</i></p>");return ChatMessage.create(t.Z.chatDataSetup(o,"roll")),!1}return a}},{key:"_getPaymoney",value:function _getPaymoney(r){var a=this._parseMoneyString(r);if(!a){var o="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.error"),"</b></p><p><i>").concat(game.i18n.localize("dsk.PAYMENT.payexample"),"</i></p>");return ChatMessage.create(t.Z.chatDataSetup(o,"roll")),!1}return a}},{key:"_parseMoneyString",value:function _parseMoneyString(t){var r=t.replace(",",".").match(/\d{1,}(\.\d{1,3}|,\d{1,3})?/);return!!r&&Number(r[0])}},{key:"_actorsMoney",value:function _actorsMoney(t){return{sum:t.system.money}}},{key:"handlePayAction",value:function handlePayAction(t,r,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(!game.user.isGM||o){o?h.Z.playMoneySound(!0):o=game.user.character;var i=!1;o&&r?i=DSKPayment.payMoney(o,a):o&&!r?i=DSKPayment.getMoney(o,a):ui.notifications.notify(game.i18n.localize("dsk.PAYMENT.onlyActors")),i&&t&&(t.fadeOut(),game.socket.emit("system.dsk",{type:"updateMsg",payload:{id:t.closest(".message").attr("data-message-id"),updateData:payment_defineProperty({},"flags.dsk.userHidden.".concat(game.user.id),!0)}}))}else ui.notifications.notify(game.i18n.localize("dsk.PAYMENT.onlyActors"))}},{key:"_moneyToCoins",value:function _moneyToCoins(t){return t}},{key:"_moneyToString",value:function _moneyToString(t){var r=DSKPayment._moneyToCoins(t);return'<span class="nobr">'.concat(r,' <span data-tooltip="dsk.money" class="chatmoney" style="background-size:contain;background-image:url(\'systems/dsk/icons/categories/money.webp\');"></span></span>')}},{key:"chatListeners",value:(r=function payment_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){payment_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){payment_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}(payment_regeneratorRuntime().mark((function _callee(t){return payment_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:t.on("click",".payButton",(function(t){var r=$(t.currentTarget);DSKPayment.handlePayAction(r,1!=Number(r.attr("data-pay")),r.attr("data-amount")),h.Z.playMoneySound()}));case 1:case"end":return r.stop()}}),_callee)}))),function chatListeners(t){return r.apply(this,arguments)})}]),DSKPayment}();function merchantmixin_slicedToArray(t,r){return function merchantmixin_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function merchantmixin_iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var o,i,c=[],u=!0,l=!1;try{for(a=a.call(t);!(u=(o=a.next()).done)&&(c.push(o.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==a.return||a.return()}finally{if(l)throw i}}return c}(t,r)||merchantmixin_unsupportedIterableToArray(t,r)||function merchantmixin_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function merchantmixin_typeof(t){return merchantmixin_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},merchantmixin_typeof(t)}function merchantmixin_toConsumableArray(t){return function merchantmixin_arrayWithoutHoles(t){if(Array.isArray(t))return merchantmixin_arrayLikeToArray(t)}(t)||function merchantmixin_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||merchantmixin_unsupportedIterableToArray(t)||function merchantmixin_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function merchantmixin_regeneratorRuntime(){merchantmixin_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==merchantmixin_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function merchantmixin_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=merchantmixin_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function merchantmixin_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return merchantmixin_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?merchantmixin_arrayLikeToArray(t,r):void 0}}function merchantmixin_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function merchantmixin_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function merchantmixin_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){merchantmixin_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){merchantmixin_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function merchantmixin_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function merchantmixin_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function merchantmixin_createClass(t,r,a){return r&&merchantmixin_defineProperties(t.prototype,r),a&&merchantmixin_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function merchantmixin_get(){return merchantmixin_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=merchantmixin_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},merchantmixin_get.apply(this,arguments)}function merchantmixin_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=merchantmixin_getPrototypeOf(t)););return t}function merchantmixin_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&merchantmixin_setPrototypeOf(t,r)}function merchantmixin_setPrototypeOf(t,r){return merchantmixin_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},merchantmixin_setPrototypeOf(t,r)}function merchantmixin_createSuper(t){var r=function merchantmixin_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=merchantmixin_getPrototypeOf(t);if(r){var i=merchantmixin_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return merchantmixin_possibleConstructorReturn(this,a)}}function merchantmixin_possibleConstructorReturn(t,r){if(r&&("object"===merchantmixin_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function merchantmixin_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function merchantmixin_getPrototypeOf(t){return merchantmixin_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},merchantmixin_getPrototypeOf(t)}var be=function MerchantSheetMixin(r){return function(r){merchantmixin_inherits(_class,r);var o,i,c,u,l,p,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,D=merchantmixin_createSuper(_class);function _class(){return merchantmixin_classCallCheck(this,_class),D.apply(this,arguments)}return merchantmixin_createClass(_class,[{key:"template",get:function get(){if(this.merchantSheetActivated())switch(getProperty(this.actor.system,"merchant.merchantType")){case"merchant":return"systems/dsk/templates/actors/merchant/merchant-limited.html";case"loot":return"systems/dsk/templates/actors/merchant/merchant-limited-loot.html";case"epic":return"systems/dsk/templates/actors/merchant/merchant-epic.html";default:return merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"template",this)}return this.constructor.merchantTemplate}},{key:"merchantSheetActivated",value:function merchantSheetActivated(){return this.showLimited()||this.playerViewEnabled()&&["merchant","loot","epic"].includes(getProperty(this.actor.system,"merchant.merchantType"))}},{key:"allowMerchant",value:(A=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee(t,r){var a,o,i,c,u;return merchantmixin_regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:a=duplicate(this.actor.ownership),o=r?1:0,i=merchantmixin_createForOfIteratorHelper(t);try{for(i.s();!(c=i.n()).done;)u=c.value,a[u]=o}catch(t){i.e(t)}finally{i.f()}return l.next=6,this.actor.update({ownership:a},{diff:!1,recursive:!1,noHook:!0});case 6:case"end":return l.stop()}}),_callee,this)}))),function allowMerchant(t,r){return A.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"activateListeners",this).call(this,t),t.find(".allowMerchant").click(function(){var t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee2(t){var a,o;return merchantmixin_regeneratorRuntime().wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return a=$(t.currentTarget).attr("data-user-id"),o=$(t.currentTarget).find("i"),i.next=4,r.allowMerchant([a],!o.hasClass("fa-check-circle"));case 4:o.toggleClass("fa-circle fa-check-circle");case 5:case"end":return i.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}()),t.find(".toggleAllAllowMerchant").click(function(){var t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee3(t){var a,o;return merchantmixin_regeneratorRuntime().wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:return a=game.users.filter((function(t){return!t.isGM})).map((function(t){return t.id})),o="true"==t.currentTarget.dataset.lock,i.next=4,r.allowMerchant(a,o);case 4:r.render();case 5:case"end":return i.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()),t.find(".lockTradeSection").click((function(t){return r.lockTradeSection(t)})),t.find(".item-tradeLock").click((function(t){return r.toggleTradeLock(t)})),t.find(".randomGoods").click((function(t){return r.randomGoods(t)})),t.find(".clearInventory").click((function(t){return r.clearInventory(t)})),t.find(".removeOtherTradeFriend").click((function(){return r.removeOtherTradeFriend()})),t.find(".choseTradefriend").click((function(){return r.choseTradefriend()})),t.find(".setCustomPrice").click((function(t){return $(t.currentTarget).addClass("edit")})),t.find(".customPriceTag").change(function(){var t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee4(t){return merchantmixin_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r.setCustomPrice(t));case 1:case"end":return a.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()).blur((function(t){return $(t.currentTarget).closest(".setCustomPrice").removeClass("edit")})),t.find(".buy-item").click((function(t){r.advanceWrapper(t,"buyItem",t),h.Z.playMoneySound()})),t.find(".sell-item").click((function(t){r.advanceWrapper(t,"sellItem",t),h.Z.playMoneySound()})),t.find(".item-external-edit").click((function(t){t.preventDefault();var a=r._getItemId(t);r.getTradeFriend().items.get(a).sheet.render(!0)})),t.find(".changeAmountAllItems").mousedown((function(t){return r.changeAmountAllItems(t)})),t.find(".gearSearch").prop("disabled",!1)}},{key:"_canDragStart",value:function _canDragStart(t){return!this.merchantSheetActivated()&&this.isEditable}},{key:"toggleTradeLock",value:(C=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee5(t){var r,a;return merchantmixin_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:r=this._getItemId(t),a=this.actor.items.get(r),this.actor.updateEmbeddedDocuments("Item",[{_id:a.id,"system.tradeLocked":!a.system.tradeLocked}]);case 3:case"end":return o.stop()}}),_callee5,this)}))),function toggleTradeLock(t){return C.apply(this,arguments)})},{key:"setCustomPrice",value:(E=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee6(t){var r;return merchantmixin_regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return t.stopPropagation(),t.preventDefault(),r=this._getItemId(t),a.next=5,this.actor.updateEmbeddedDocuments("Item",[{_id:r,"flags.dsk.customPriceTag":Number(t.target.value)}]);case 5:case"end":return a.stop()}}),_callee6,this)}))),function setCustomPrice(t){return E.apply(this,arguments)})},{key:"removeOtherTradeFriend",value:function removeOtherTradeFriend(){this.otherTradeFriend=void 0,this.render(!0)}},{key:"choseTradefriend",value:(I=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee7(){return merchantmixin_regeneratorRuntime().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ke.getDialog(this);case 2:t.sent.render(!0);case 3:case"end":return t.stop()}}),_callee7,this)}))),function choseTradefriend(){return I.apply(this,arguments)})},{key:"lockTradeSection",value:(T=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee8(t){var r,a,o,i,c,u,l;return merchantmixin_regeneratorRuntime().wrap((function _callee8$(p){for(;;)switch(p.prev=p.next){case 0:r=[],a=this.filterRule(t),i=merchantmixin_createForOfIteratorHelper(this.actor.items);try{for(i.s();!(c=i.n()).done;)u=c.value,a(u)&&(l=u.toObject(),void 0===o&&(o=!l.system.tradeLocked),l.system.tradeLocked=o,r.push(l))}catch(t){i.e(t)}finally{i.f()}this.actor.updateEmbeddedDocuments("Item",r);case 5:case"end":return p.stop()}}),_callee8,this)}))),function lockTradeSection(t){return T.apply(this,arguments)})},{key:"filterRule",value:function filterRule(t){var r=t.currentTarget.dataset.type;return d.Z.equipmentTypes[r]?function(t){return"equipment"==t.type&&t.system.category==r}:function(t){return t.type==r&&d.Z.equipmentCategories.includes(t.type)}}},{key:"changeAmountAllItems",value:(P=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee9(t){var r,a,o,i,c,u;return merchantmixin_regeneratorRuntime().wrap((function _callee9$(l){for(;;)switch(l.prev=l.next){case 0:r=[],a=this.filterRule(t),o=merchantmixin_createForOfIteratorHelper(this.actor.items);try{for(o.s();!(i=o.n()).done;)c=i.value,a(c)&&(u=c.toObject(),y.Z.increment(t,u,"system.quantity",0),r.push(u))}catch(t){o.e(t)}finally{o.f()}this.actor.updateEmbeddedDocuments("Item",r);case 5:case"end":return l.stop()}}),_callee9,this)}))),function changeAmountAllItems(t){return P.apply(this,arguments)})},{key:"playerViewEnabled",value:function playerViewEnabled(){return getProperty(this.actor.system,"merchant.playerView")}},{key:"buyItem",value:(S=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee10(t){return merchantmixin_regeneratorRuntime().wrap((function _callee10$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.transferItem(this.actor,this.getTradeFriend(),t,!0);case 2:case"end":return r.stop()}}),_callee10,this)}))),function buyItem(t){return S.apply(this,arguments)})},{key:"sellItem",value:(O=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee11(t){return merchantmixin_regeneratorRuntime().wrap((function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.transferItem(this.getTradeFriend(),this.actor,t,!1);case 2:case"end":return r.stop()}}),_callee11,this)}))),function sellItem(t){return O.apply(this,arguments)})},{key:"transferItem",value:(x=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee12(t,r,a){var o,i,c,u,l=arguments;return merchantmixin_regeneratorRuntime().wrap((function _callee12$(p){for(;;)switch(p.prev=p.next){case 0:if(o=!(l.length>3&&void 0!==l[3])||l[3],i=this._getItemId(a),c=$(a.currentTarget).attr("data-price"),u=a.ctrlKey?10:1,!game.user.isGM){p.next=9;break}return p.next=7,this.constructor.finishTransaction(t,r,c,i,o,u);case 7:p.next=10;break;case 9:(this.constructor.noNeedToPay(r,t,c)||_e.canPay(r,c,!0))&&game.socket.emit("system.dsk",{type:"trade",payload:{target:this.constructor.transferTokenData(r),source:this.constructor.transferTokenData(t),price:c,itemId:i,buy:o,amount:u}});case 10:case"end":return p.stop()}}),_callee12,this)}))),function transferItem(t,r,a){return x.apply(this,arguments)})},{key:"getTradeFriend",value:function getTradeFriend(){return this.otherTradeFriend||game.user.character}},{key:"_manageDragItems",value:(w=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee13(t,r){return merchantmixin_regeneratorRuntime().wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:a.t0=r,a.next="creature"===a.t0||"npc"===a.t0||"character"===a.t0?3:5;break;case 3:return this.setTradeFriend(t),a.abrupt("break",6);case 5:return a.abrupt("return",merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"_manageDragItems",this).call(this,t,r));case 6:case"end":return a.stop()}}),_callee13,this)}))),function _manageDragItems(t,r){return w.apply(this,arguments)})},{key:"setTradeFriend",value:function setTradeFriend(t){var r=game.actors.get(t._id);r.isOwner&&(this.otherTradeFriend=r,this.render(!0))}},{key:"_render",value:(k=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee14(){var t,r,a=arguments;return merchantmixin_regeneratorRuntime().wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],r=a.length>1&&void 0!==a[1]?a[1]:{},game.user.isGM||"loot"!=getProperty(this.actor.system,"merchant.merchantType")||!getProperty(this.actor.system,"merchant.locked")){o.next=5;break}return AudioHelper.play({src:"sounds/lock.wav",loop:!1},!1),o.abrupt("return");case 5:return o.next=7,merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"_render",this).call(this,t,r);case 7:case"end":return o.stop()}}),_callee14,this)}))),function _render(){return k.apply(this,arguments)})},{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,a=merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"_getHeaderButtons",this).call(this);return this.actor.isOwner&&a.unshift({class:"playerview",icon:"fas fa-toggle-on",onclick:(t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee15(t){return merchantmixin_regeneratorRuntime().wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",r._togglePlayerview(t));case 1:case"end":return a.stop()}}),_callee15)}))),function onclick(r){return t.apply(this,arguments)})}),a}},{key:"_togglePlayerview",value:function _togglePlayerview(t){this.actor.update({"system.merchant.playerView":!getProperty(this.actor.system,"merchant.playerView")})}},{key:"randomGoods",value:(b=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee16(t){var r,a=this;return merchantmixin_regeneratorRuntime().wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,renderTemplate("systems/dsk/templates/dialog/randomGoods-dialog.html",{categories:d.Z.equipmentCategories});case 2:r=o.sent,new Dialog({title:game.i18n.localize("dsk.MERCHANT.randomGoods"),content:r,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(r){return a.addRandomGoods(a.actor,r,t)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 4:case"end":return o.stop()}}),_callee16)}))),function randomGoods(t){return b.apply(this,arguments)})},{key:"clearInventory",value:(_=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee17(t){var r=this;return merchantmixin_regeneratorRuntime().wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:new Dialog({title:game.i18n.localize("dsk.MERCHANT.clearInventory"),content:game.i18n.localize("dsk.MERCHANT.deleteAllGoods"),default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){r.removeAllGoods(r.actor,t)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 1:case"end":return a.stop()}}),_callee17)}))),function clearInventory(t){return _.apply(this,arguments)})},{key:"addRandomGoods",value:(v=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee18(t,r,a){var o,i,c,u,l,p,d,h;return merchantmixin_regeneratorRuntime().wrap((function _callee18$(y){for(;;)switch(y.prev=y.next){case 0:if(o=$(a.currentTarget).text(),$(a.currentTarget).html(' <i class="fa fa-spin fa-spinner"></i>'),i=[],r.find('input[type="checkbox"]:checked').each((function(){var t=$(this).val();i.push({name:t,count:Number(r.find('input[name="each_'.concat(t,'"]')).val()),number:Number(r.find('input[name="number_'.concat(t,'"]')).val())})})),(c=game.dsk.itemLibrary).equipmentBuild){y.next=8;break}return y.next=8,c.buildEquipmentIndex();case 8:u=[],l=merchantmixin_regeneratorRuntime().mark((function _loop(){var t,r,a;return merchantmixin_regeneratorRuntime().wrap((function _loop$(o){for(;;)switch(o.prev=o.next){case 0:return r=d[p],o.next=3,c.getRandomItems(r.name,r.number);case 3:a=o.sent.map((function(t){var a=t.toObject();return a.system.quantity=r.count,a})),(t=u).push.apply(t,merchantmixin_toConsumableArray(a));case 5:case"end":return o.stop()}}),_loop)})),p=0,d=i;case 11:if(!(p<d.length)){y.next=16;break}return y.delegateYield(l(),"t0",13);case 13:p++,y.next=11;break;case 16:return h={},u=u.filter((function(r){var a=getProperty(r,"system.effect");a="object"===merchantmixin_typeof(a)&&null!==a&&getProperty(a,"attributes")||"";var o=Number(getProperty(r,"system.price"))||0;if(""!=a||o>1e4)return!1;var i="".concat(r.type,"_").concat(r.name);return!h.hasOwnProperty(i)&&(h[i]=!0)&&0==t.items.filter((function(t){return t.type==r.type&&t.name==r.name})).length})),y.next=20,t.createEmbeddedDocuments("Item",u);case 20:$(a.currentTarget).text(o);case 21:case"end":return y.stop()}}),_callee18)}))),function addRandomGoods(t,r,a){return v.apply(this,arguments)})},{key:"removeAllGoods",value:(g=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee19(t,r){var a,o;return merchantmixin_regeneratorRuntime().wrap((function _callee19$(i){for(;;)switch(i.prev=i.next){case 0:return a=$(r.currentTarget).text(),$(r.currentTarget).html(' <i class="fa fa-spin fa-spinner"></i>'),o=t.items.filter((function(t){return d.Z.equipmentCategories.includes(t.type)&&!getProperty(t,"worn.value")})).map((function(t){return t.id})),i.next=5,t.deleteEmbeddedDocuments("Item",o);case 5:$(r.currentTarget).text(a);case 6:case"end":return i.stop()}}),_callee19)}))),function removeAllGoods(t,r){return g.apply(this,arguments)})},{key:"getData",value:(m=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee20(t){var r,a=this;return merchantmixin_regeneratorRuntime().wrap((function _callee20$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"getData",this).call(this,t);case 2:return(r=o.sent).merchantType=getProperty(this.actor.system,"merchant.merchantType")||"none",r.merchantTypes={none:game.i18n.localize("dsk.MERCHANT.typeNone"),merchant:game.i18n.localize("dsk.MERCHANT.typeMerchant"),loot:game.i18n.localize("dsk.MERCHANT.typeLoot"),epic:game.i18n.localize("dsk.MERCHANT.typeEpic")},r.invName=r.merchantTypes[r.merchantType],r.players=game.users.filter((function(t){return!t.isGM})).map((function(t){return t.allowedMerchant=a.actor.testUserPermission(t,"LIMITED",!1),t.buyingFactor=getProperty(a.actor.system,"merchant.factors.buyingFactor.".concat(t.id)),t.sellingFactor=getProperty(a.actor.system,"merchant.factors.sellingFactor.".concat(t.id)),t})),"epic"!=r.merchantType?(this.prepareStorage(r),this.merchantSheetActivated()&&(this.filterWornEquipment(r),this.prepareTradeFriend(r),0==r.prepare.inventory.misc.items.length&&(r.prepare.inventory.misc.show=!1))):this.prepareStorage(r),r.hasOtherTradeFriend=!!this.otherTradeFriend,o.abrupt("return",r);case 10:case"end":return o.stop()}}),_callee20,this)}))),function getData(t){return m.apply(this,arguments)})},{key:"filterWornEquipment",value:function filterWornEquipment(t){for(var r=0,a=Object.entries(t.prepare.inventory);r<a.length;r++){var o=merchantmixin_slicedToArray(a[r],2),i=(o[0],o[1]);i.items=i.items.filter((function(t){return!getProperty(t,"system.worn.value")}))}}},{key:"prepareStorage",value:function prepareStorage(t){if("merchant"==t.merchantType)for(var r=0,a=Object.entries(t.prepare.inventory);r<a.length;r++){var o,i=merchantmixin_slicedToArray(a[r],2),c=(i[0],merchantmixin_createForOfIteratorHelper(i[1].items));try{for(c.s();!(o=c.n()).done;){var u=o.value;u.defaultPrice=this.getItemPrice(u),u.calculatedPrice=Number(parseFloat("".concat(u.defaultPrice*(getProperty(this.actor.system,"merchant.sellingFactor")||1))).toFixed(2))*(getProperty(this.actor.system,"merchant.factors.sellingFactor.".concat(game.user.id))||1),u.priceTag=" / ".concat(u.calculatedPrice)}}catch(t){c.e(t)}finally{c.f()}}else if("loot"==t.merchantType)for(var l=0,p=Object.entries(t.prepare.inventory);l<p.length;l++){var d,h=merchantmixin_slicedToArray(p[l],2),y=(h[0],merchantmixin_createForOfIteratorHelper(h[1].items));try{for(y.s();!(d=y.n()).done;){var m=d.value;m.calculatedPrice=this.getItemPrice(m)}}catch(t){y.e(t)}finally{y.f()}}}},{key:"getItemPrice",value:function getItemPrice(t){return Number(getProperty(t,"flags.dsk.customPriceTag"))||Number(t.system.price)*("consumable"==t.type?Number(t.system.QL)||0:1)}},{key:"prepareTradeFriend",value:function prepareTradeFriend(t){var r=this.getTradeFriend();if(r){var a=r.prepareItems({details:[]}),o="loot"==getProperty(this.actor.system,"merchant.merchantType")?1:(getProperty(this.actor.system,"merchant.buyingFactor")||1)*(getProperty(this.actor.system,"merchant.factors.buyingFactor.".concat(game.user.id))||1),i=this.prepareSellPrices(a.inventory,o);0==i.misc.items.length&&(i.misc.show=!1),mergeObject(t,{tradeFriend:{img:r.img,name:r.name,inventory:i,money:r.system.money}})}else mergeObject(t,{tradeFriend:{inventory:[],money:""}})}},{key:"prepareSellPrices",value:function prepareSellPrices(t,r){for(var a=0,o=Object.entries(t);a<o.length;a++){var i,c=merchantmixin_slicedToArray(o[a],2),u=(c[0],merchantmixin_createForOfIteratorHelper(c[1].items));try{for(u.s();!(i=u.n()).done;){var l=i.value;l.calculatedPrice=Number(parseFloat("".concat(this.getItemPrice(l)*r)).toFixed(2))}}catch(t){u.e(t)}finally{u.f()}}return t}}],[{key:"defaultOptions",get:function get(){var t=merchantmixin_get(merchantmixin_getPrototypeOf(_class),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["merchant-sheet"])}),t}},{key:"merchantTemplate",get:function get(){return"systems/dsk/templates/actors/merchant/merchant-sheet.html"}},{key:"transferTokenData",value:function transferTokenData(t){var r={actor:t.id};return t.token&&(r.token=t.token.id),r}},{key:"finishTransaction",value:(p=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee21(t,r,a,o,i,c){var u,l;return merchantmixin_regeneratorRuntime().wrap((function _callee21$(p){for(;;)switch(p.prev=p.next){case 0:if(u=t.items.get(o).toObject(),c=Math.min(Number(u.system.quantity),c),!(Number(u.system.quantity)>0)){p.next=24;break}if(!(l=this.noNeedToPay(r,t,a))&&!_e.payMoney(r,a,!0)){p.next=24;break}if(getProperty(u,"system.worn.value")&&(u.system.worn.value=!1),!i){p.next=18;break}return p.next=10,this.updateTargetTransaction(r,u,c,t,a);case 10:return p.next=12,this.updateSourceTransaction(t,r,u,a,o,c);case 12:return p.next=14,this.transferNotification(u,r,t,i,a,c,l);case 14:return p.next=16,this.selfDestruction(t);case 16:p.next=24;break;case 18:return p.next=20,this.updateSourceTransaction(t,r,u,a,o,c);case 20:return p.next=22,this.updateTargetTransaction(r,u,c,t,a);case 22:return p.next=24,this.transferNotification(u,t,r,i,a,c,l);case 24:case"end":return p.stop()}}),_callee21,this)}))),function finishTransaction(t,r,a,o,i,c){return p.apply(this,arguments)})},{key:"isTemporaryToken",value:function isTemporaryToken(t){return"loot"==getProperty(t.system,"merchant.merchantType")&&getProperty(t.system,"merchant.temporary")}},{key:"selfDestruction",value:(l=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee22(t){var r;return merchantmixin_regeneratorRuntime().wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:if(!this.isTemporaryToken(t)){a.next=10;break}if(t.items.some((function(t){return d.Z.equipmentCategories.includes(t.type)||"money"==t.type&&t.system.quantity>0}))){a.next=10;break}return game.socket.emit("system.dsk",{type:"hideDeletedSheet",payload:{target:this.transferTokenData(t)}}),r=t.getActiveTokens().map((function(t){return t.id})),a.next=7,canvas.scene.deleteEmbeddedDocuments("Token",r);case 7:return a.next=9,game.actors.get(t.id).delete();case 9:this.hideDeletedSheet(t);case 10:case"end":return a.stop()}}),_callee22,this)}))),function selfDestruction(t){return l.apply(this,arguments)})},{key:"hideDeletedSheet",value:(u=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee23(t){return merchantmixin_regeneratorRuntime().wrap((function _callee23$(r){for(;;)switch(r.prev=r.next){case 0:t.sheet.close(!0);case 1:case"end":return r.stop()}}),_callee23)}))),function hideDeletedSheet(t){return u.apply(this,arguments)})},{key:"transferNotification",value:(c=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee24(r,a,o,i,c,u,l){var p,d,h,y;return merchantmixin_regeneratorRuntime().wrap((function _callee24$(m){for(;;)switch(m.prev=m.next){case 0:if(0!=(p=game.settings.get("dsk","merchantNotification"))&&"service"!=getProperty(r,"system.category")){m.next=3;break}return m.abrupt("return");case 3:return d="dsk.MERCHANT."+(i?"buy":"sell")+(l?"Loot":"")+"Notification",h=game.i18n.format(d,{item:r.name,source:a.name,target:o.name,amount:u,price:c,buy:i}),y=t.Z.chatDataSetup(h),2==p&&(y.whisper=ChatMessage.getWhisperRecipients("GM").map((function(t){return t.id}))),m.next=9,ChatMessage.create(y);case 9:case"end":return m.stop()}}),_callee24)}))),function transferNotification(t,r,a,o,i,u,l){return c.apply(this,arguments)})},{key:"noNeedToPay",value:function noNeedToPay(t,r,a){return 0==a||"loot"==getProperty(t.system,"merchant.merchantType")||"loot"==getProperty(r.system,"merchant.merchantType")}},{key:"updateSourceTransaction",value:(i=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee25(t,r,a,o,i,c){var u;return merchantmixin_regeneratorRuntime().wrap((function _callee25$(l){for(;;)switch(l.prev=l.next){case 0:if(u=duplicate(a),!(Number(u.system.quantity)>c||"money"==u.type)){l.next=7;break}return u.system.quantity=Number(u.system.quantity)-c,l.next=5,t.updateEmbeddedDocuments("Item",[u]);case 5:l.next=9;break;case 7:return l.next=9,t.deleteEmbeddedDocuments("Item",[i]);case 9:if(this.noNeedToPay(t,r,o)){l.next=12;break}return l.next=12,_e.getMoney(t,o,!0);case 12:case"end":return l.stop()}}),_callee25,this)}))),function updateSourceTransaction(t,r,a,o,c,u){return i.apply(this,arguments)})},{key:"updateTargetTransaction",value:(o=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee26(r,o,i,c,u){var l,p,d;return merchantmixin_regeneratorRuntime().wrap((function _callee26$(h){for(;;)switch(h.prev=h.next){case 0:if(l=duplicate(o),"service"!=getProperty(l,"system.category")){h.next=7;break}p=game.i18n.format("dsk.MERCHANT.buyNotification",{item:l.name,amount:i,source:r.name,target:c.name,price:u}),ChatMessage.create(t.Z.chatDataSetup(p)),h.next=16;break;case 7:if(d=r.items.find((function(t){return a.Z.areEquals(l,t)})),l.system.quantity=i,d){h.next=14;break}return h.next=12,r.createEmbeddedDocuments("Item",[l]);case 12:h.next=16;break;case 14:return h.next=16,a.Z.stackItems(d,l,r);case 16:case"end":return h.stop()}}),_callee26)}))),function updateTargetTransaction(t,r,a,i,c){return o.apply(this,arguments)})}]),_class}(r)},ke=function(t){merchantmixin_inherits(SelectTradefriendDialog,Dialog);var r,a=merchantmixin_createSuper(SelectTradefriendDialog);function SelectTradefriendDialog(){return merchantmixin_classCallCheck(this,SelectTradefriendDialog),a.apply(this,arguments)}return merchantmixin_createClass(SelectTradefriendDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;merchantmixin_get(merchantmixin_getPrototypeOf(SelectTradefriendDialog.prototype),"activateListeners",this).call(this,t),t.find(".combatant").click((function(t){return r.setTargetToUser(t)}))}},{key:"setTargetToUser",value:function setTargetToUser(t){this.actor.setTradeFriend({_id:t.currentTarget.dataset.id}),this.close()}}],[{key:"defaultOptions",get:function get(){var t=merchantmixin_get(merchantmixin_getPrototypeOf(SelectTradefriendDialog),"defaultOptions",this);return mergeObject(t,{}),t}},{key:"getDialog",value:(r=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee27(t){var r,a,o;return merchantmixin_regeneratorRuntime().wrap((function _callee27$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,null===(r=game.dsk.apps.gameMasterMenu)||void 0===r?void 0:r.getTrackedHeros();case 2:if(a=i.sent){i.next=5;break}return i.abrupt("return",ui.notifications.warn("The required functionality is not yet available."));case 5:return i.t0=SelectTradefriendDialog,i.t1=game.i18n.localize("dsk.DIALOG.setTargetToUser"),i.next=9,renderTemplate("systems/dsk/templates/dialog/selectTradeFriend.html",{users:a});case 9:return i.t2=i.sent,i.t3={},i.t4={title:i.t1,content:i.t2,default:"yes",buttons:i.t3},(o=new i.t0(i.t4)).actor=t,i.abrupt("return",o);case 15:case"end":return i.stop()}}),_callee27)}))),function getDialog(t){return r.apply(this,arguments)})}]),SelectTradefriendDialog}();function merchant_sheet_typeof(t){return merchant_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},merchant_sheet_typeof(t)}function merchant_sheet_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function merchant_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function merchant_sheet_setPrototypeOf(t,r){return merchant_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},merchant_sheet_setPrototypeOf(t,r)}function merchant_sheet_createSuper(t){var r=function merchant_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=merchant_sheet_getPrototypeOf(t);if(r){var i=merchant_sheet_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return merchant_sheet_possibleConstructorReturn(this,a)}}function merchant_sheet_possibleConstructorReturn(t,r){if(r&&("object"===merchant_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function merchant_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function merchant_sheet_getPrototypeOf(t){return merchant_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},merchant_sheet_getPrototypeOf(t)}var we=function(t){!function merchant_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&merchant_sheet_setPrototypeOf(t,r)}(MerchantSheetDSK,t);var r=merchant_sheet_createSuper(MerchantSheetDSK);function MerchantSheetDSK(){return merchant_sheet_classCallCheck(this,MerchantSheetDSK),r.apply(this,arguments)}return function merchant_sheet_createClass(t,r,a){return r&&merchant_sheet_defineProperties(t.prototype,r),a&&merchant_sheet_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(MerchantSheetDSK)}(be(V)),xe=__webpack_require__(61),Oe=__webpack_require__(147);function ready_typeof(t){return ready_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ready_typeof(t)}function ready_regeneratorRuntime(){ready_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==ready_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function ready_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function ready_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){ready_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){ready_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function adventure_wizard_typeof(t){return adventure_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},adventure_wizard_typeof(t)}function adventure_wizard_toConsumableArray(t){return function adventure_wizard_arrayWithoutHoles(t){if(Array.isArray(t))return adventure_wizard_arrayLikeToArray(t)}(t)||function adventure_wizard_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||adventure_wizard_unsupportedIterableToArray(t)||function adventure_wizard_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function adventure_wizard_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=adventure_wizard_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function adventure_wizard_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return adventure_wizard_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?adventure_wizard_arrayLikeToArray(t,r):void 0}}function adventure_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function adventure_wizard_regeneratorRuntime(){adventure_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==adventure_wizard_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function adventure_wizard_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function adventure_wizard_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){adventure_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){adventure_wizard_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function adventure_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function adventure_wizard_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function adventure_wizard_createClass(t,r,a){return r&&adventure_wizard_defineProperties(t.prototype,r),a&&adventure_wizard_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function adventure_wizard_get(){return adventure_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=adventure_wizard_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},adventure_wizard_get.apply(this,arguments)}function adventure_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=adventure_wizard_getPrototypeOf(t)););return t}function adventure_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&adventure_wizard_setPrototypeOf(t,r)}function adventure_wizard_setPrototypeOf(t,r){return adventure_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},adventure_wizard_setPrototypeOf(t,r)}function adventure_wizard_createSuper(t){var r=function adventure_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=adventure_wizard_getPrototypeOf(t);if(r){var i=adventure_wizard_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return adventure_wizard_possibleConstructorReturn(this,a)}}function adventure_wizard_possibleConstructorReturn(t,r){if(r&&("object"===adventure_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function adventure_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function adventure_wizard_getPrototypeOf(t){return adventure_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},adventure_wizard_getPrototypeOf(t)}var Se=function(r){adventure_wizard_inherits(BookWizard,Application);var a,o,i,c,p,d,h,y,m,g,_,b,k,w,x,O,S,P,T=adventure_wizard_createSuper(BookWizard);function BookWizard(t){var r;return adventure_wizard_classCallCheck(this,BookWizard),(r=T.call(this,t)).adventures=[],r.books=[],r.rshs=[],r}return adventure_wizard_createClass(BookWizard,[{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,a=adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"_getHeaderButtons",this).call(this);return a.unshift({label:"Library",class:"library",icon:"fas fa-book",onclick:(t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r._showBooks());case 1:case"end":return t.stop()}}),_callee)}))),function onclick(r){return t.apply(this,arguments)})}),a}},{key:"_render",value:(P=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee2(){var t,r,a=arguments;return adventure_wizard_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],r=a.length>1&&void 0!==a[1]?a[1]:{},o.next=4,adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"_render",this).call(this,t,r);case 4:$(this._element).find(".library").attr("data-tooltip",game.i18n.localize("dsk.Book.home"));case 5:case"end":return o.stop()}}),_callee2,this)}))),function _render(){return P.apply(this,arguments)})},{key:"_showBooks",value:function _showBooks(){this.book=null,this.bookData=null,this.selectedChapter=null,this.selectedType=null,this.journals=null,this.actors=null,this.scenes=null,this.content=void 0,this.journalIndex=null,this.fulltextsearch=!1,this.currentType=void 0,this.loadPage(this._element)}},{key:"toggleBookVisibility",value:(S=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee3(t,r,a){var o,i,c,u,l,p,d;return adventure_wizard_regeneratorRuntime().wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return(o=game.settings.get("dsk","expansionPermissions"))[t]=a,h.next=4,game.settings.set("dsk","expansionPermissions",o);case 4:return i=this[r].find((function(r){return r.id==t})),h.next=7,fetch(i.path);case 7:return h.next=9,h.sent.json();case 9:c=h.sent,u=0,l=["actors","journal","scenes"];case 12:if(!(u<l.length)){h.next=22;break}if(p=l[u],c[p]){h.next=16;break}return h.abrupt("continue",19);case 16:return d=game.packs.get(c[p]),h.next=19,d.configure({private:!a});case 19:u++,h.next=12;break;case 22:this.render();case 23:case"end":return h.stop()}}),_callee3,this)}))),function toggleBookVisibility(t,r,a){return S.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"activateListeners",this).call(this,t),t.on("click",".toggleVisibility",function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee4(t){var a,o,i;return adventure_wizard_regeneratorRuntime().wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:a=t.currentTarget.dataset.itemid,o=t.currentTarget.dataset.type,i=$(t.currentTarget).find("i").hasClass("fa-toggle-off"),r.toggleBookVisibility(a,o,i);case 4:case"end":return c.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".showMapNote",(function(t){game.journal.get(t.currentTarget.dataset.entryid).panToNote()})),t.on("search keyup",".filterJournals",(function(t){r.filterToc($(t.currentTarget).val())})),t.on("click",".loadBook",(function(a){r.selectedChapter=void 0,r.selectedType=void 0,r.content=void 0,r.loadBook($(a.currentTarget).text(),t,$(a.currentTarget).attr("data-type"))})),t.on("click",".getChapter",(function(a){r.selectedType=$(a.currentTarget).closest(".toc").attr("data-type"),r.selectedChapter=$(a.currentTarget).attr("data-id"),r.content=void 0,r.loadPage(t)})),t.on("click",".subChapter",(function(t){var a=$(t.currentTarget).text(),o=$(t.currentTarget).attr("data-jid");o?r.loadJournalById(o):($(r._element).find(".subChapter").removeClass("selected"),$(r._element).find('[data-id="'.concat(a,'"]')).addClass("selected"),r.loadJournal(a))})),l.Z.bindRollCommands(t),t.find(".tocCollapser").click((function(r){$(r.currentTarget).find("i").toggleClass("fa-chevron-right fa-chevron-left"),t.find(".tocCollapsing").toggleClass("expanded")})),t.on("mousedown",".openPin",function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee5(t){var a;return adventure_wizard_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:if(a=t.currentTarget.dataset.uuid,0!=t.button){o.next=9;break}return o.t0=r,o.next=5,fromUuid(a);case 5:o.t1=o.sent,o.t0.showJournal.call(o.t0,o.t1),o.next=10;break;case 9:2==t.button&&r.unpinJournal(a);case 10:case"end":return o.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".showJournal",(function(t){r.popJournal($(t.currentTarget).closest("h1").attr("data-uuid"))})),t.on("click",".pinJournal",(function(t){var a=$(t.currentTarget).closest("h1"),o=a.attr("data-uuid"),i=a.text();r.pinJournal(o,i)})),t.on("click",".activateScene",(function(t){r.showSzene($(t.currentTarget).attr("data-id"),$(t.currentTarget).attr("data-mode"))})),t.on("click",".fulltextsearch",(function(a){r.fulltextsearch=!r.fulltextsearch,$(a.currentTarget).toggleClass("on"),r.filterToc(t.find(".filterJournals").val())})),t.on("mousedown",".chapter img",(function(t){var a=r.book.id;2==t.button&&game.dsk.apps.DSKUtility.showArtwork({name:a,uuid:"",img:$(t.currentTarget).attr("src")})})),u.Z.bindButtons(t),t.on("click",".importBook",adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee6(){return adventure_wizard_regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.importBook());case 1:case"end":return t.stop()}}),_callee6)})))),bindImgToCanvasDragStart(t),(0,v.Jp)(t,".breadcrumbs",this.resaveBreadCrumbs),this.heightFix()}},{key:"heightFix",value:function heightFix(){var t=$(this._element).find(".breadcrumbs").height();$(this._element).find(".col.seventy.scrollable").css({"margin-bottom":"".concat(t,"px")})}},{key:"loadJournal",value:(O=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee7(t){var r=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.showJournal(this.journals.find((function(a){return a.name==t&&a.flags.dsk.parent==r.selectedChapter})));case 2:case"end":return a.stop()}}),_callee7,this)}))),function loadJournal(t){return O.apply(this,arguments)})},{key:"loadJournalById",value:(x=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee8(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.showJournal(this.journals.find((function(r){return r.id==t})));case 2:case"end":return r.stop()}}),_callee8,this)}))),function loadJournalById(t){return x.apply(this,arguments)})},{key:"resaveBreadCrumbs",value:(w=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee9(t){var r,a,o,i;return adventure_wizard_regeneratorRuntime().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:r={},a=adventure_wizard_createForOfIteratorHelper(t.getElementsByTagName("div"));try{for(a.s();!(o=a.n()).done;)i=o.value,r[i.dataset.uuid]=i.innerText}catch(t){a.e(t)}finally{a.f()}return c.next=5,game.settings.set("dsk","breadcrumbs_".concat(game.world.id),JSON.stringify(r));case 5:case"end":return c.stop()}}),_callee9)}))),function resaveBreadCrumbs(t){return w.apply(this,arguments)})},{key:"filterToc",value:(k=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee10(t){var r,a;return adventure_wizard_regeneratorRuntime().wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:if(null==t){o.next=23;break}if(""==(t=t.toLowerCase().trim())){o.next=19;break}if(a=[],!this.fulltextsearch){o.next=14;break}if(this.journalIndex){o.next=9;break}return this.journalIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data"]}}),o.next=9,this.journalIndex.add(this.journals.map((function(t){return new Te(t)})));case 9:return o.next=11,this.journalIndex.search(t);case 11:a=o.sent,o.next=15;break;case 14:a=this.journals.filter((function(r){return-1!=r.name.toLowerCase().trim().indexOf(t)}));case 15:a=a.map((function(t){return'<li class="fas fa-caret-right"><a data-jid="'.concat(t.id,'" class="subChapter">').concat(t.name,"</a></li>")})),$(this._element).find(".tocContent").html("<ul>".concat(a.join("\n"),"</ul>")),o.next=23;break;case 19:return o.next=21,this.getToc();case 21:r=o.sent,$(this._element).find(".adventureWizard > .row-section > .toc").html(r).find(".filterJournals").focus();case 23:case"end":return o.stop()}}),_callee10,this)}))),function filterToc(t){return k.apply(this,arguments)})},{key:"showJournal",value:(b=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee11(t){var r,a,o,i,c,u,l,p,d,h,y,m=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee11$(g){for(;;)switch(g.prev=g.next){case 0:r="",a=adventure_wizard_createForOfIteratorHelper(t.pages),g.prev=2,a.s();case 4:if((o=a.n()).done){g.next=18;break}return i=o.value,c=i.sheet,g.next=9,c.getData();case 9:return u=g.sent,g.next=12,c._renderInner(u);case 12:l=g.sent.get(),p=$(l[l.length-1]).html(),"video"==i.type&&(p='<div class="video-container">'.concat(p,"</div>")),r+=p;case 16:g.next=4;break;case 18:g.next=23;break;case 20:g.prev=20,g.t0=g.catch(2),a.e(g.t0);case 23:return g.prev=23,a.f(),g.finish(23);case 26:return d=this.findSceneNote(t.getFlag("dsk","initId")),g.next=29,TextEditor.enrichHTML(r,{secrets:!0,async:!0});case 29:h=g.sent,this.content='<div><h1 class="journalHeader" data-uuid="'.concat(t.uuid,'">').concat(t.name,'<div class="jrnIcons">').concat(d,'<a class="pinJournal"><i class="fas fa-thumbtack"></i></a><a class="showJournal"><i class="fas fa-eye"></i></a></div></h1>').concat(h),(y=$(this._element).find(".chapter")).html(this.content),bindImgToCanvasDragStart(y),y.find(".documentName-link, .entity-link, .content-link").click((function(t){var r=$(t.currentTarget);m.bookData&&r.attr("data-pack")==m.bookData.journal&&(t.stopPropagation(),m.loadJournalById(r.attr("data-id")))}));case 35:case"end":return g.stop()}}),_callee11,this,[[2,20,23,26]])}))),function showJournal(t){return b.apply(this,arguments)})},{key:"findSceneNote",value:function findSceneNote(t){if(t){var r=game.journal.find((function(r){return r.getFlag("dsk","initId")==t}));if(r&&r.sceneNote)return'<a class="showMapNote" data-entryId="'.concat(r.id,'"><i class="fas fa-map-pin"></i></a>')}return""}},{key:"importBook",value:(_=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee12(){return adventure_wizard_regeneratorRuntime().wrap((function _callee12$(t){for(;;)switch(t.prev=t.next){case 0:game.user.isGM&&(new Pe).render(this.bookData.moduleName);case 1:case"end":return t.stop()}}),_callee12,this)}))),function importBook(){return _.apply(this,arguments)})},{key:"loadBook",value:(g=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee15(t,r,a){var o=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee15$(i){for(;;)switch(i.prev=i.next){case 0:return a||(a=this.currentType),this.currentType=a,this.book=this[a].find((function(r){return r.id==t})),i.next=5,fetch(this.book.path).then(function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee13(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee13$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee14(t){var a,i;return adventure_wizard_regeneratorRuntime().wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return o.bookData=t,a=game.packs.get(t.journal),c.next=4,a.getIndex();case 4:return c.sent,c.next=7,a.getDocuments();case 7:if(i=c.sent,o.journals=i,!t.actors){c.next=15;break}return a=game.packs.get(t.actors),c.next=13,a.getIndex();case 13:i=c.sent,o.actors=i;case 15:if(!t.scenes){c.next=21;break}return a=game.packs.get(t.scenes),c.next=19,a.getIndex();case 19:i=c.sent,o.scenes=i;case 21:o.loadPage(r);case 22:case"end":return c.stop()}}),_callee14)})));return function(r){return t.apply(this,arguments)}}());case 5:case"end":return i.stop()}}),_callee15,this)}))),function loadBook(t,r,a){return g.apply(this,arguments)})},{key:"prefillActors",value:(m=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee16(t){var r,a,o,i,c,u,l=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee16$(p){for(;;)switch(p.prev=p.next){case 0:if(t.actors){p.next=2;break}return p.abrupt("return",[]);case 2:return r=[],p.next=5,game.folders.contents.find((function(t){return t.name==game.i18n.localize("".concat(l.bookData.moduleName,".name"))&&"Actor"==t.type&&null==t.folder}));case 5:if(!(a=p.sent)){p.next=12;break}return p.next=9,game.folders.contents.filter((function(t){var r;return"Actor"==t.type&&(null===(r=t.folder)||void 0===r?void 0:r.id)==a.id})).map((function(t){return t.id}));case 9:p.t0=p.sent,p.next=13;break;case 12:p.t0=void 0;case 13:o=p.t0,i=adventure_wizard_createForOfIteratorHelper(t.actors);try{for(u=function _loop(){var t,a,i,u=c.value,p=null!=o&&o.length?game.actors.contents.find((function(t){var r;return t.name==u&&o.includes(null===(r=t.folder)||void 0===r?void 0:r.id)})):void 0,d=void 0,h=null===(t=p)||void 0===t?void 0:t.id,y=null===(a=p)||void 0===a?void 0:a.uuid;p||(p=l.actors.find((function(t){return t.name==u})),d=l.bookData.actors,h=null===(i=p)||void 0===i?void 0:i._id,y=p?"Compendium.".concat(d,".").concat(h):void 0),r.push({name:u,actor:p,pack:d,id:h,uuid:y})},i.s();!(c=i.n()).done;)u()}catch(t){i.e(t)}finally{i.f()}return p.abrupt("return",r);case 17:case"end":return p.stop()}}),_callee16)}))),function prefillActors(t){return m.apply(this,arguments)})},{key:"popJournal",value:(y=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee17(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee17$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fromUuid(t);case 2:r.sent.sheet.render(!0);case 4:case"end":return r.stop()}}),_callee17)}))),function popJournal(t){return y.apply(this,arguments)})},{key:"showSzene",value:(h=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee18(t){var r,a,o=arguments;return adventure_wizard_regeneratorRuntime().wrap((function _callee18$(i){for(;;)switch(i.prev=i.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"activate",a=game.scenes.contents.find((function(r){return r.name==t}))){i.next=4;break}return i.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.sceneNotInitialized")));case 4:i.t0=r,i.next="activate"===i.t0?7:"view"===i.t0?9:"toggle"===i.t0?11:13;break;case 7:return a.activate(),i.abrupt("break",13);case 9:return a.view(),i.abrupt("break",13);case 11:return a.update({navigation:!a.navigation}),i.abrupt("break",13);case 13:case"end":return i.stop()}}),_callee18)}))),function showSzene(t){return h.apply(this,arguments)})},{key:"getChapter",value:(d=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee19(){var t,r,a,o,i,c,u,l=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee19$(p){for(;;)switch(p.prev=p.next){case 0:if(!this.book){p.next=41;break}if(!this.content){p.next=3;break}return p.abrupt("return",this.content);case 3:if(!this.selectedChapter){p.next=36;break}if("prep"!=this.selectedChapter){p.next=14;break}t={initDescr:game.i18n.format("".concat(this.bookData.moduleName,".importContent"),{defaultText:game.i18n.localize("dsk.importDefault")})},r=this.bookData.modules,a=adventure_wizard_createForOfIteratorHelper(r);try{for(a.s();!(o=a.n()).done;)(i=o.value).enabled=this.moduleEnabled(i.id)}catch(t){a.e(t)}finally{a.f()}return p.next=11,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_preparation.html",{modules:r,info:t});case 11:case 17:case 30:case 35:case 38:case 43:return p.abrupt("return",p.sent);case 14:if("foundryUsage"!=this.selectedChapter){p.next=18;break}return p.next=17,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_foundry.html");case 18:if(c=this.bookData.chapters.find((function(t){return t.name==l.selectedType})).content.find((function(t){return t.id==l.selectedChapter})),u=this.getSubChapters(),!c.scenes&&!c.actors&&0!=u.length){p.next=33;break}return p.t0=renderTemplate,p.t1=c,p.t2=this.getSubChapters(),p.next=26,this.prefillActors(c);case 26:return p.t3=p.sent,p.t4={chapter:p.t1,subChapters:p.t2,actors:p.t3},p.next=30,(0,p.t0)("systems/dsk/templates/wizard/adventure/adventure_chapter.html",p.t4);case 33:return p.next=35,this.loadJournal(u[0].name);case 36:return p.next=38,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_cover.html",{book:this.book,bookData:this.bookData});case 41:return p.next=43,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_intro.html",{rshs:this.filterBooks(this.rshs),rules:this.filterBooks(this.books),adventures:this.filterBooks(this.adventures),isGM:game.user.isGM});case 44:case"end":return p.stop()}}),_callee19,this)}))),function getChapter(){return d.apply(this,arguments)})},{key:"filterBooks",value:function filterBooks(t){var r,a=game.settings.get("dsk","expansionPermissions"),o=adventure_wizard_createForOfIteratorHelper(t);try{for(o.s();!(r=o.n()).done;){var i=r.value;null!=a[i.id]&&(i.visible=a[i.id])}}catch(t){o.e(t)}finally{o.f()}return game.user.isGM?t:t.filter((function(t){return null==t.visible||t.visible})).sort((function(t,r){return t.id.localeCompare(r.id)}))}},{key:"getSubChapters",value:function getSubChapters(){var t=this;return this.journals.filter((function(r){return r.flags.dsk.parent==t.selectedChapter})).sort((function(t,r){return t.flags.dsk.sort>r.flags.dsk.sort?1:-1})).map((function(t){return{name:t.name,id:t.id}}))}},{key:"getToc",value:(p=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee20(){var t,r,a,o,i,c=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee20$(u){for(;;)switch(u.prev=u.next){case 0:if(t=[],!this.book){u.next=29;break}if(t.push.apply(t,adventure_wizard_toConsumableArray(duplicate(this.bookData.chapters))),!this.selectedChapter){u.next=24;break}a=adventure_wizard_createForOfIteratorHelper(t),u.prev=5,a.s();case 7:if((o=a.n()).done){u.next=14;break}if(i=o.value,!(r=i.content.find((function(t){return t.id==c.selectedChapter})))){u.next=12;break}return u.abrupt("break",14);case 12:u.next=7;break;case 14:u.next=19;break;case 16:u.prev=16,u.t0=u.catch(5),a.e(u.t0);case 19:return u.prev=19,a.f(),u.finish(19);case 22:r.cssClass="selected",r.subChapters=this.getSubChapters();case 24:return u.next=26,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_toc.html",{chapters:t,book:this.book,fulltextsearch:this.fulltextsearch?"on":""});case 26:return u.abrupt("return",u.sent);case 29:return u.abrupt("return",'<div class="libraryImg"></div>');case 30:case"end":return u.stop()}}),_callee20,this,[[5,16,19,22]])}))),function getToc(){return p.apply(this,arguments)})},{key:"loadPage",value:(c=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee21(t){var r,a;return adventure_wizard_regeneratorRuntime().wrap((function _callee21$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.getChapter();case 2:return r=o.sent,o.next=5,this.getToc();case 5:a=o.sent,t.find(".toc").html(a),t.find(".chapter").html(r);case 8:case"end":return o.stop()}}),_callee21,this)}))),function loadPage(t){return c.apply(this,arguments)})},{key:"getData",value:(i=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee22(t){var r,a,o;return adventure_wizard_regeneratorRuntime().wrap((function _callee22$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"getData",this).call(this,t);case 2:return r=i.sent,i.next=5,this.getChapter();case 5:return a=i.sent,i.next=8,this.getToc();case 8:return o=i.sent,mergeObject(r,{adventure:this.bookData,currentChapter:a,breadcrumbs:this.renderBreadcrumbs(),toc:o}),i.abrupt("return",r);case 11:case"end":return i.stop()}}),_callee22,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"pinJournal",value:(o=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee23(t){var r,a,o,i=arguments;return adventure_wizard_regeneratorRuntime().wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:if(a=i.length>1&&void 0!==i[1]?i[1]:void 0,o=this.readBreadCrumbs(),a){c.next=18;break}return c.next=5,fromUuid(t);case 5:if(c.t2=r=c.sent,c.t1=null===c.t2,c.t1){c.next=9;break}c.t1=void 0===r;case 9:if(!c.t1){c.next=13;break}c.t3=void 0,c.next=14;break;case 13:c.t3=r.name;case 14:if(c.t0=c.t3,c.t0){c.next=17;break}c.t0="";case 17:a=c.t0;case 18:o[t]=a,game.settings.set("dsk","breadcrumbs_".concat(game.world.id),JSON.stringify(o)),this.render(!0);case 21:case"end":return c.stop()}}),_callee23,this)}))),function pinJournal(t){return o.apply(this,arguments)})},{key:"unpinJournal",value:function unpinJournal(t){var r=this.readBreadCrumbs();delete r[t],game.settings.set("dsk","breadcrumbs_".concat(game.world.id),JSON.stringify(r)),this.render(!0)}},{key:"_canDragDrop",value:function _canDragDrop(t){return!0}},{key:"_onDrop",value:(a=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee24(t){var r;return adventure_wizard_regeneratorRuntime().wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:a.prev=0,r=JSON.parse(t.dataTransfer.getData("text/plain")),a.next=7;break;case 4:return a.prev=4,a.t0=a.catch(0),a.abrupt("return",!1);case 7:"JournalEntry"==r.type&&this.pinJournal(r.pack?"Compendium.".concat(r.pack,".").concat(r.id):"JournalEntry.".concat(r.id));case 8:case"end":return a.stop()}}),_callee24,this,[[0,4]])}))),function _onDrop(t){return a.apply(this,arguments)})},{key:"readBreadCrumbs",value:function readBreadCrumbs(){var t={};try{t=JSON.parse(game.settings.get("dsk","breadcrumbs_".concat(game.world.id)))}catch(t){console.log("No Journalbrowser notes found")}return t}},{key:"renderBreadcrumbs",value:function renderBreadcrumbs(){var t=this.readBreadCrumbs(),r=Object.entries(t).map((function(t){return'<div data-tooltip="'.concat(t[1],'" data-uuid="').concat(t[0],'" class="openPin item">').concat(t[1],"</div>")}));return r.length>0?'<div id="breadcrumbs" class="breadcrumbs wrap row-section">'.concat(r.join(""),"</div>"):""}},{key:"moduleEnabled",value:function moduleEnabled(r){return t.Z.moduleEnabled(r)}}],[{key:"defaultOptions",get:function get(){var t=adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"description"}],mergeObject(t,{classes:t.classes.concat(["dsk","largeDialog","noscrollWizard","bookWizardsheet","dskjournalbrowser"]),width:800,height:880,template:"systems/dsk/templates/wizard/adventure/adventure_wizard.html",title:game.i18n.localize("dsk.Book.Wizard"),resizable:!0,dragDrop:[{dragSelector:".item-list .item",dropSelector:null}]}),t}},{key:"initHook",value:function initHook(){BookWizard.wizard=new BookWizard,game.dsk.apps.journalBrowser=BookWizard.wizard,Hooks.on("renderSidebarTab",(function(t,r){if("journal"==t.options.id){var a=$('<div class="header-actions action-buttons flexrow"></div>'),o=$('<button id="openJournalBrowser"><i class="fa fa-book"></i>'.concat(game.i18n.localize("dsk.Book.Wizard"),"</button>"));o.click((function(){BookWizard.wizard.render(!0)})),a.append(o),r.find(".header-actions:first-child").after(a)}}))}}]),BookWizard}();!function adventure_wizard_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}(Se,"wizard",void 0);var Pe=function(t){adventure_wizard_inherits(InitializerForm,FormApplication);var r=adventure_wizard_createSuper(InitializerForm);function InitializerForm(){return adventure_wizard_classCallCheck(this,InitializerForm),r.apply(this,arguments)}return adventure_wizard_createClass(InitializerForm,[{key:"render",value:function render(t){new game.dsk.apps.DSKInitializer("DSK Module Initialization",game.i18n.format("".concat(t,".importContent"),{defaultText:game.i18n.localize("dsk.importDefault")}),t,game.i18n.lang).render(!0)}}]),InitializerForm}(),Te=function(){function JournalSearch(t){adventure_wizard_classCallCheck(this,JournalSearch);var r=t.pages.find((function(t){return!0})).text.content;this.document={name:t.name,data:$("<div>").html(r).text(),id:t.id}}return adventure_wizard_createClass(JournalSearch,[{key:"name",get:function get(){return this.document.name}},{key:"data",get:function get(){return this.document.data}},{key:"id",get:function get(){return this.document.id}}]),JournalSearch}(),Ie=__webpack_require__(586);function configuration_typeof(t){return configuration_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},configuration_typeof(t)}function configuration_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function configuration_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function configuration_createClass(t,r,a){return r&&configuration_defineProperties(t.prototype,r),a&&configuration_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function configuration_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&configuration_setPrototypeOf(t,r)}function configuration_setPrototypeOf(t,r){return configuration_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},configuration_setPrototypeOf(t,r)}function configuration_createSuper(t){var r=function configuration_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=configuration_getPrototypeOf(t);if(r){var i=configuration_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return configuration_possibleConstructorReturn(this,a)}}function configuration_possibleConstructorReturn(t,r){if(r&&("object"===configuration_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function configuration_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function configuration_getPrototypeOf(t){return configuration_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},configuration_getPrototypeOf(t)}function configuration_regeneratorRuntime(){configuration_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==configuration_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function configuration_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function configuration_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){configuration_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){configuration_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}var Ee=function(t){configuration_inherits(ChangelogForm,FormApplication);var r=configuration_createSuper(ChangelogForm);function ChangelogForm(){return configuration_classCallCheck(this,ChangelogForm),r.apply(this,arguments)}return configuration_createClass(ChangelogForm,[{key:"render",value:function render(){(0,Ie.j)()}}]),ChangelogForm}();var Ce=function combatTurn(t){var r,a;(null===(r=game.combat)||void 0===r||null===(a=r.combatant)||void 0===a?void 0:a.isOwner)&&game.combat[t]()};function setup_typeof(t){return setup_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},setup_typeof(t)}function setup_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function setup_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function setup_createClass(t,r,a){return r&&setup_defineProperties(t.prototype,r),a&&setup_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function setup_get(){return setup_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=setup_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},setup_get.apply(this,arguments)}function setup_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=setup_getPrototypeOf(t)););return t}function setup_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&setup_setPrototypeOf(t,r)}function setup_setPrototypeOf(t,r){return setup_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},setup_setPrototypeOf(t,r)}function setup_createSuper(t){var r=function setup_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=setup_getPrototypeOf(t);if(r){var i=setup_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return setup_possibleConstructorReturn(this,a)}}function setup_possibleConstructorReturn(t,r){if(r&&("object"===setup_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function setup_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function setup_getPrototypeOf(t){return setup_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},setup_getPrototypeOf(t)}function setup_regeneratorRuntime(){setup_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==setup_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function setup_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function setup_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){setup_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){setup_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function initSetup(){Hooks.once("setup",(function(){if(function setupConfiguration(){var t,r,a;game.settings.register("dsk","migrationVersion",{name:"migrationVersion",scope:"world",config:!1,default:22,type:Number}),game.settings.register("dsk","firstTimeStart",{name:"firstTimeStart",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","informationDistribution",{name:"dsk.SETTINGS.informationDistribution",hint:"dsk.SETTINGS.informationDistributionHint",scope:"world",config:!0,default:"0",type:String,choices:{0:game.i18n.localize("dsk.SETTINGS.information0"),1:game.i18n.localize("dsk.SETTINGS.information1"),2:game.i18n.localize("dsk.SETTINGS.information2")}}),game.settings.register("dsk","defaultConfigFinished",{name:"defaultConfigFinished",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","limitCombatSpecAbs",{name:"dsk.SETTINGS.limitCombatSpecAbs",hint:"dsk.SETTINGS.limitCombatSpecAbsHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","merchantNotification",{name:"dsk.SETTINGS.merchantNotification",hint:"dsk.SETTINGS.merchantNotificationHint",scope:"world",config:!0,default:"0",type:String,choices:{0:game.i18n.localize("dsk.no"),1:game.i18n.localize("dsk.yes"),2:game.i18n.localize("dsk.MERCHANT.onlyGM")}}),game.settings.register("dsk","expandChatModifierlist",{name:"dsk.SETTINGS.expandChatModifierlist",hint:"dsk.SETTINGS.expandChatModifierlistHint",scope:"client",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","enableCombatFlow",{name:"dsk.SETTINGS.enableCombatFlow",hint:"dsk.SETTINGS.enableCombatFlowHint",scope:"client",config:!0,default:!0,type:Boolean,onchange:function onchange(t){game.dsk.apps.initTracker&&(game.dsk.apps.initTracker.close(),game.dsk.apps.initTracker=void 0)}}),game.settings.register("dsk","sightAutomationEnabled",{name:"sightAutomationEnabled",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","inventorySound",{name:"dsk.SETTINGS.inventorySound",hint:"dsk.SETTINGS.inventorySoundHint",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","diceSetup",{name:"diceSetup",hint:"diceSetup",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","scrollingFontsize",{name:"dsk.SETTINGS.scrollingFontsize",hint:"dsk.SETTINGS.scrollingFontsizeHint",scope:"client",config:!0,default:16,type:Number,range:{min:6,max:50,step:1}}),game.settings.register("dsk","statusEffectCounterColor",{name:"dsk.SETTINGS.statusEffectCounterColor",hint:"dsk.SETTINGS.statusEffectCounterColorHint",scope:"client",config:!0,default:"#FFFFFF",type:String}),game.settings.register("dsk","playerCanEditSpellMacro",{name:"dsk.SETTINGS.playerCanEditSpellMacro",hint:"dsk.SETTINGS.playerCanEditSpellMacroHint",scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","expansionPermissions",{name:"expansionPermissions",scope:"world",config:!1,default:{},type:Object}),game.settings.register("dsk","breadcrumbs_".concat(game.world.id),{name:"dsk.SETTINGS.breadcrumbs",scope:"client",config:!1,default:"",type:String}),game.settings.register("dsk","soundConfig",{name:"dsk.SETTINGS.soundConfig",hint:"dsk.SETTINGS.soundConfigHint",scope:"world",config:!0,default:"",type:String,onChange:(t=configuration_asyncToGenerator(configuration_regeneratorRuntime().mark((function _callee(){return configuration_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:h.Z.loadSoundConfig();case 1:case"end":return t.stop()}}),_callee)}))),function onChange(){return t.apply(this,arguments)})}),game.settings.register("dsk","allowPhysicalDice",{name:"dsk.SETTINGS.allowPhysicalDice",hint:"dsk.SETTINGS.allowPhysicalDiceHint",scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","enableItemDropToCanvas",{name:"dsk.SETTINGS.enableItemDropToCanvas",hint:"dsk.SETTINGS.enableItemDropToCanvasHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","hideEffects",{name:"dsk.SETTINGS.hideEffects",hint:"dsk.SETTINGS.hideEffectsHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","hideOpposedDamage",{name:"dsk.SETTINGS.hideOpposedDamage",hint:"dsk.SETTINGS.hideOpposedDamageHint",scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","indexDescription",{name:"dsk.SETTINGS.indexDescription",scope:"client",config:!1,default:!0,type:Boolean}),game.settings.register("dsk","enableDPS",{name:"dsk.SETTINGS.enableDPS",hint:"dsk.SETTINGS.enableDPSHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","indexWorldItems",{name:"dsk.SETTINGS.indexWorldItems",scope:"client",config:!1,default:!0,type:Boolean}),game.settings.register("dsk","tokenizerSetup",{name:"tokenizerSetup",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","forceLanguage",{name:"dsk.SETTINGS.forceLanguage",hint:"dsk.SETTINGS.forceLanguageHint",scope:"world",config:!0,default:"none",type:String,choices:{none:"-",de:"German"}}),game.settings.register("dsk","enableCombatPan",{name:"dsk.SETTINGS.enableCombatPan",hint:"dsk.SETTINGS.enableCombatPanHint",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","iniTrackerSize",{name:"dsk.SETTINGS.iniTrackerSize",hint:"dsk.SETTINGS.iniTrackerSizeHint",scope:"client",config:!0,default:70,type:Number,range:{min:30,max:140,step:5},onChange:(r=configuration_asyncToGenerator(configuration_regeneratorRuntime().mark((function _callee2(t){return configuration_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:game.dsk.apps.tokenHotbar.constructor.defaultOptions.itemWidth=t;case 1:case"end":return r.stop()}}),_callee2)}))),function onChange(t){return r.apply(this,arguments)})}),game.settings.register("dsk","iniTrackerPosition",{name:"iniTrackerPosition",scope:"client",config:!1,default:{},type:Object}),game.settings.register("dsk","tokenhotbarPosition",{name:"tokenhotbarPosition",scope:"client",config:!1,default:{},type:Object}),game.settings.registerMenu("dsk","changelog",{name:"Changelog",label:"Changelog",hint:game.i18n.localize("dsk.SETTINGS.changelog"),type:Ee,restricted:!1}),game.settings.register("dsk","disableDidYouKnow",{name:"dsk.SETTINGS.disableDidYouKnow",hint:"dsk.SETTINGS.disableDidYouKnowHint",scope:"client",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","tokenhotbarSize",{name:"dsk.SETTINGS.tokenhotbarSize",hint:"dsk.SETTINGS.tokenhotbarSizeHint",scope:"client",config:!0,default:35,type:Number,range:{min:15,max:100,step:5},onChange:(a=configuration_asyncToGenerator(configuration_regeneratorRuntime().mark((function _callee3(t){return configuration_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:game.dsk.apps.tokenHotbar.constructor.defaultOptions.itemWidth=t;case 1:case"end":return r.stop()}}),_callee3)}))),function onChange(t){return a.apply(this,arguments)})}),game.settings.register("dsk","obfuscateTokenNames",{name:"dsk.SETTINGS.obfuscateTokenNames",hint:"dsk.SETTINGS.obfuscateTokenNamesHint",scope:"world",config:!0,default:"0",type:String,choices:{0:game.i18n.localize("dsk.no"),1:game.i18n.localize("dsk.SETTINGS.yesNumbered"),2:game.i18n.localize("dsk.SETTINGS.renameNumbered"),3:game.i18n.localize("dsk.yes"),4:game.i18n.localize("dsk.SETTINGS.rename")}}),game.settings.register("dsk","tokenhotbarLayout",{name:"dsk.SETTINGS.tokenhotbarLayout",hint:"dsk.SETTINGS.tokenhotbarLayoutHint",scope:"client",config:!0,default:0,type:Number,choices:{0:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout0"),2:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout1"),1:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout2"),3:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout3")}})}(),["de"].includes(game.i18n.lang)){var r=game.settings.get("dsk","forceLanguage");["de"].includes(r)&&game.i18n.lang!=r&&Ae(r)}else console.warn("DSK - ".concat(game.i18n.lang," is not a supported language. Falling back to default language.")),Re();!function setupKeybindings(){game.keybindings.register("dsk","combatTrackerNext",{name:"COMBAT.TurnNext",hint:game.i18n.localize("COMBAT.TurnNext"),editable:[{key:"KeyN"}],onDown:function onDown(){return Ce("nextTurn")}}),game.keybindings.register("dsk","combatTrackerPrevious",{name:"COMBAT.TurnPrev",hint:game.i18n.localize("COMBAT.TurnPrev"),editable:[{key:"KeyV"}],onDown:function onDown(){return Ce("previousTurn")}}),game.keybindings.register("dsk","attacktest",{name:"attacktest",hint:game.i18n.localize("dsk.KEYBINDINGS.attack"),editable:[{key:"KeyB"}],onDown:function onDown(){return fe.runActAttackDialog()}}),game.keybindings.register("dsk","journalBrowser",{name:"Book.Wizard",hint:game.i18n.localize("dsk.KEYBINDINGS.journalBrowser"),editable:[{key:"KeyJ"}],onDown:function onDown(){return t.Z.renderToggle(game.dsk.apps.journalBrowser)}}),game.keybindings.register("dsk","library",{name:"ItemLibrary",hint:game.i18n.localize("dsk.KEYBINDINGS.library"),editable:[{key:"KeyL"}],onDown:function onDown(){return t.Z.renderToggle(game.dsk.itemLibrary)}})}(),function setupScene(){Hooks.on("preCreateScene",(function(t,r,a,o){var i,c;null!==(i=r.grid)&&void 0!==i&&i.units||t.updateSource({grid:{units:game.i18n.localize("dsk.gridUnits")}}),!a.dskInit&&null!==(c=r.notes)&&void 0!==c&&c.some((function(t){return getProperty(t,"flags.dsa5.initName")}))&&ui.notifications.warn(game.i18n.localize("dsk.DSKError.mapsViaJournalbrowser"))})),Hooks.on("preCreateActiveEffect",(function(t,r,a,o){if("Actor"==t.parent.documentName){var i={duration:{}};t.duration.startTime||(i.duration.startTime=game.time.worldTime),game.combat?(i.duration.combat=game.combat.id,i.duration.startRound=game.combat.round,i.duration.startTurn=game.combat.turn,!t.duration.rounds&&t.duration.seconds&&(i.duration.rounds=t.duration.seconds/5),t.updateSource(i)):t.updateSource(i)}}))}(),Se.initHook(),CONFIG.Canvas.lightAnimations.daylight={label:"dsk.LIGHT.daylight",illuminationShader:Le},m.Z.setupFunctions(),g.Z.setupFunctions()}))}var Ae=function showWrongLanguageDialog(t){var r,a={title:game.i18n.localize("dsk.SETTINGS.forceLanguage"),content:game.i18n.format("dsk.DSKError.wrongLanguage",{lang:t}),buttons:{ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:(r=setup_asyncToGenerator(setup_regeneratorRuntime().mark((function _callee(){return setup_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("core","language",t);case 2:foundry.utils.debouncedReload();case 3:case"end":return r.stop()}}),_callee)}))),function callback(){return r.apply(this,arguments)})},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}};new Dialog(a).render(!0)},De=function(t){setup_inherits(ForbiddenLanguageDialog,Dialog);var r,a=setup_createSuper(ForbiddenLanguageDialog);function ForbiddenLanguageDialog(){return setup_classCallCheck(this,ForbiddenLanguageDialog),a.apply(this,arguments)}return setup_createClass(ForbiddenLanguageDialog,[{key:"close",value:(r=setup_asyncToGenerator(setup_regeneratorRuntime().mark((function _callee2(){var t,r=arguments;return setup_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},["de"].includes(game.i18n.lang)){a.next=3;break}return a.abrupt("return");case 3:return a.abrupt("return",setup_get(setup_getPrototypeOf(ForbiddenLanguageDialog.prototype),"close",this).call(this,t));case 4:case"end":return a.stop()}}),_callee2,this)}))),function close(){return r.apply(this,arguments)})}]),ForbiddenLanguageDialog}(),Re=function showForbiddenLanguageDialog(){var t,r,a={title:game.i18n.localize("language"),content:"Your foundry language is not supported by this system. Due to technical reasons your foundry language setting has to be switched to german.",buttons:{de:{icon:'<i class="fa fa-check"></i>',label:"en",callback:(r=setup_asyncToGenerator(setup_regeneratorRuntime().mark((function _callee3(){return setup_regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,game.settings.set("core","language","de");case 2:foundry.utils.debouncedReload();case 3:case"end":return t.stop()}}),_callee3)}))),function callback(){return r.apply(this,arguments)})},logout:{icon:'<i class="fas fa-door-closed"></i>',label:game.i18n.localize("SETTINGS.Logout"),callback:(t=setup_asyncToGenerator(setup_regeneratorRuntime().mark((function _callee4(){return setup_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:ui.menu.items.logout.onClick();case 1:case"end":return t.stop()}}),_callee4)}))),function callback(){return t.apply(this,arguments)})}}};new De(a).render(!0)},Le=function(t){setup_inherits(DaylightIlluminationShader,AdaptiveIlluminationShader);var r=setup_createSuper(DaylightIlluminationShader);function DaylightIlluminationShader(){return setup_classCallCheck(this,DaylightIlluminationShader),r.apply(this,arguments)}return setup_createClass(DaylightIlluminationShader)}();function sidebar_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function sidebar_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return sidebar_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return sidebar_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function sidebar_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function actor_typeof(t){return actor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_typeof(t)}function actor_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function actor_setPrototypeOf(t,r){return actor_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_setPrototypeOf(t,r)}function actor_createSuper(t){var r=function actor_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=actor_getPrototypeOf(t);if(r){var i=actor_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return actor_possibleConstructorReturn(this,a)}}function actor_possibleConstructorReturn(t,r){if(r&&("object"===actor_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_getPrototypeOf(t){return actor_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_getPrototypeOf(t)}function actor_regeneratorRuntime(){actor_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function actor_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function actor_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){actor_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){actor_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}!function setup_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}(Le,"fragmentShader","\n    ".concat(Le.SHADER_HEADER,"\n    ").concat(Le.PERCEIVED_BRIGHTNESS,"\n\n    void main() {\n        ").concat(Le.FRAGMENT_BEGIN,"\n        ").concat(Le.TRANSITION,"\n       \n        // Darkness\n        framebufferColor = max(framebufferColor, colorBackground);        \n        // Elevation\n        finalColor = mix(finalColor, max(finalColor, smoothstep( 0.1, 1.0, finalColor ) * 10.0), 1.0) * depth;        \n        // Final\n        gl_FragColor = vec4(finalColor, 1.0);\n      }"));var Ge=function(t){!function actor_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_setPrototypeOf(t,r)}(AskForNameDialog,Dialog);var r,a=actor_createSuper(AskForNameDialog);function AskForNameDialog(){return actor_classCallCheck(this,AskForNameDialog),a.apply(this,arguments)}return function actor_createClass(t,r,a){return r&&actor_defineProperties(t.prototype,r),a&&actor_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(AskForNameDialog,null,[{key:"getDialog",value:(r=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee5(t,r){return actor_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:new Dialog({title:game.i18n.localize("dsk.SETTINGS.obfuscateTokenNames"),content:'<label for="name">'.concat(game.i18n.localize("dsk.SETTINGS.rename"),'</label> <input dtype="string" name="name" type="text" value="').concat(t.actor.name,'"/>'),default:"Yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function(){var a=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee3(a){var o,i,c,u;return actor_regeneratorRuntime().wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:return o=t.id||t._id,i=a.find('[name="name"]').val(),2==r&&(c=canvas.scene.tokens.filter((function(t){return t.name===i}))).length>0&&(i="".concat(i.replace(/ \d{1,}$/)," ").concat(c.length+1)),u=canvas.scene.tokens.get(o),l.next=6,u.update({name:i});case 6:case"end":return l.stop()}}),_callee3)})));return function callback(t){return a.apply(this,arguments)}}()},unknown:{icon:'<i class="fa fa-question"></i>',label:game.i18n.localize("dsk.unknown"),callback:function(){var r=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee4(r){var a,o;return actor_regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return a=t.id||t._id,o=canvas.scene.tokens.get(a),r.next=4,o.update({name:game.i18n.localize("dsk.unknown")});case 4:case"end":return r.stop()}}),_callee4)})));return function callback(t){return r.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 1:case"end":return a.stop()}}),_callee5)}))),function getDialog(t,a){return r.apply(this,arguments)})}]),AskForNameDialog}();function dicesonice_typeof(t){return dicesonice_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dicesonice_typeof(t)}function dicesonice_regeneratorRuntime(){dicesonice_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dicesonice_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function dicesonice_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function dicesonice_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){dicesonice_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){dicesonice_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dicesonice_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=dicesonice_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function dicesonice_slicedToArray(t,r){return function dicesonice_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function dicesonice_iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var o,i,c=[],u=!0,l=!1;try{for(a=a.call(t);!(u=(o=a.next()).done)&&(c.push(o.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==a.return||a.return()}finally{if(l)throw i}}return c}(t,r)||dicesonice_unsupportedIterableToArray(t,r)||function dicesonice_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dicesonice_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return dicesonice_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?dicesonice_arrayLikeToArray(t,r):void 0}}function dicesonice_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function dicesonice_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dicesonice_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function dicesonice_createClass(t,r,a){return r&&dicesonice_defineProperties(t.prototype,r),a&&dicesonice_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function dicesonice_get(){return dicesonice_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=dicesonice_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},dicesonice_get.apply(this,arguments)}function dicesonice_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dicesonice_getPrototypeOf(t)););return t}function dicesonice_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dicesonice_setPrototypeOf(t,r)}function dicesonice_setPrototypeOf(t,r){return dicesonice_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dicesonice_setPrototypeOf(t,r)}function dicesonice_createSuper(t){var r=function dicesonice_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=dicesonice_getPrototypeOf(t);if(r){var i=dicesonice_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return dicesonice_possibleConstructorReturn(this,a)}}function dicesonice_possibleConstructorReturn(t,r){if(r&&("object"===dicesonice_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dicesonice_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dicesonice_getPrototypeOf(t){return dicesonice_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dicesonice_getPrototypeOf(t)}function dicesonice_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var je=function(r){dicesonice_inherits(DiceSoNiceCustomization,Application);var a,o,i=dicesonice_createSuper(DiceSoNiceCustomization);function DiceSoNiceCustomization(){return dicesonice_classCallCheck(this,DiceSoNiceCustomization),i.apply(this,arguments)}return dicesonice_createClass(DiceSoNiceCustomization,[{key:"initConfigs",value:function initConfigs(){var t=game.dice3d.exports.Utils.prepareColorsetList();this.choices={};for(var r=0,a=Object.entries(t);r<a.length;r++){var o=dicesonice_slicedToArray(a[r],2),i=(o[0],o[1]);mergeObject(this.choices,i)}var c={damage:"black"};game.settings.registerMenu("dsk","dicesonicesettings",{name:"DiceSoNiceSettings",label:"DiceSoNice Settings",hint:game.i18n.localize("dsk.SETTINGS.dicesonicesettings"),type:Me,restricted:!1});var u,l=dicesonice_createForOfIteratorHelper(DiceSoNiceCustomization.attrs);try{for(l.s();!(u=l.n()).done;){var p=u.value;game.settings.register("dsk","dice3d_".concat(p),{name:"CHAR.".concat(p.toUpperCase()),scope:"client",config:!1,default:c[p]||p,type:String}),game.settings.register("dsk","dice3d_system_".concat(p),{name:"CHAR.".concat(p.toUpperCase()),scope:"client",config:!1,default:"standard",type:String})}}catch(t){l.e(t)}finally{l.f()}}},{key:"getAttributeConfiguration",value:function getAttributeConfiguration(r){return t.Z.moduleEnabled("dice-so-nice")?{colorset:game.settings.get("dsk","dice3d_".concat(r)),appearance:{colorset:game.settings.get("dsk","dice3d_".concat(r)),system:game.settings.get("dsk","dice3d_system_".concat(r))}}:{colorset:r}}},{key:"activateListeners",value:function activateListeners(t){dicesonice_get(dicesonice_getPrototypeOf(DiceSoNiceCustomization.prototype),"activateListeners",this).call(this),t.find('[name="entryselection"]').change(function(){var t=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee(t){return dicesonice_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("dsk","dice3d_".concat(t.currentTarget.dataset.attr),t.currentTarget.value);case 2:case"end":return r.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}()),t.find('[name="systemselection"]').change(function(){var t=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee2(t){return dicesonice_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("dsk","dice3d_system_".concat(t.currentTarget.dataset.attr),t.currentTarget.value);case 2:DiceSoNiceCustomization.preloadDiceAssets([t.currentTarget.value]),game.socket.emit("system.dsk",{type:"preloadDice3d",payload:{toPreload:[t.currentTarget.value]}});case 4:case"end":return r.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}())}},{key:"getData",value:(o=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee3(t){var r,a,o,i;return dicesonice_regeneratorRuntime().wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,dicesonice_get(dicesonice_getPrototypeOf(DiceSoNiceCustomization.prototype),"getData",this).call(this,t);case 2:(r=c.sent).choices=this.choices,r.systems=game.dice3d.DiceFactory.systems,r.selections={},a=dicesonice_createForOfIteratorHelper(DiceSoNiceCustomization.attrs);try{for(a.s();!(o=a.n()).done;)i=o.value,r.selections[i]={color:game.settings.get("dsk","dice3d_".concat(i)),system:game.settings.get("dsk","dice3d_system_".concat(i))}}catch(t){a.e(t)}finally{a.f()}return c.abrupt("return",r);case 9:case"end":return c.stop()}}),_callee3,this)}))),function getData(t){return o.apply(this,arguments)})}],[{key:"onConnect",value:function onConnect(){game.socket.on("system.dsk",(function(t){switch(t.type){case"preloadDice3d":console.warn("Preloading forced DSK dice assets"),DiceSoNiceCustomization.preloadDiceAssets(t.payload);break;case"getPreloadDice3d":DiceSoNiceCustomization.requestDicePreloads()}})),this.collectPreloads(),game.socket.emit("system.dsk",{type:"getPreloadDice3d"})}},{key:"collectPreloads",value:function collectPreloads(){var t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=new Set,o=dicesonice_createForOfIteratorHelper(DiceSoNiceCustomization.attrs);try{for(o.s();!(t=o.n()).done;){var i=t.value;a.add(game.settings.get("dsk","dice3d_system_".concat(i)))}}catch(t){o.e(t)}finally{o.f()}a=Array.from(a),r&&this.preloadDiceAssets(a),game.socket.emit("system.dsk",{type:"preloadDice3d",payload:a})}},{key:"requestDicePreloads",value:function requestDicePreloads(){this.collectPreloads(!1)}},{key:"preloadDiceAssets",value:(a=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee4(t){var r,a,o,i,c,u,l,p,d,h=this,y=arguments;return dicesonice_regeneratorRuntime().wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:r=y.length>1&&void 0!==y[1]?y[1]:[],console.warn("loading",t),a=dicesonice_createForOfIteratorHelper(t),m.prev=3,a.s();case 5:if((o=a.n()).done){m.next=42;break}if(i=o.value,c=game.dice3d.DiceFactory.systems[i]){m.next=11;break}return this.unloadedModels.push(i),m.abrupt("continue",40);case 11:u=c.dice.filter((function(t){return 0==r.length||r.includes(t.type)})),l=dicesonice_createForOfIteratorHelper(u),m.prev=13,l.s();case 15:if((p=l.n()).done){m.next=32;break}if(d=p.value,m.prev=17,!d.modelFile){m.next=23;break}return m.next=21,d.loadModel(game.dice3d.DiceFactory.loaderGLTF);case 21:m.next=25;break;case 23:return m.next=25,d.loadTextures();case 25:m.next=30;break;case 27:m.prev=27,m.t0=m.catch(17),console.warn("Unable to load dice model",i,d);case 30:m.next=15;break;case 32:m.next=37;break;case 34:m.prev=34,m.t1=m.catch(13),l.e(m.t1);case 37:return m.prev=37,l.f(),m.finish(37);case 40:m.next=5;break;case 42:m.next=47;break;case 44:m.prev=44,m.t2=m.catch(3),a.e(m.t2);case 47:return m.prev=47,a.f(),m.finish(47);case 50:this.unloadedModels.length&&this.retries<6&&!this.retrying&&(this.retrying=!0,setTimeout((function(){h.retries+=1;var t=new Set(h.unloadedModels);h.unloadedModels=[],h.retrying=!1,h.preloadDiceAssets(t)}),1e4));case 51:case"end":return m.stop()}}),_callee4,this,[[3,44,47,50],[13,34,37,40],[17,27]])}))),function preloadDiceAssets(t){return a.apply(this,arguments)})},{key:"defaultOptions",get:function get(){var t=dicesonice_get(dicesonice_getPrototypeOf(DiceSoNiceCustomization),"defaultOptions",this);return mergeObject(t,{template:"systems/dsk/templates/wizard/dicesonice-configuration.html",title:game.i18n.localize("dsk.SETTINGS.dicesonicesettings"),width:600}),t}}]),DiceSoNiceCustomization}();dicesonice_defineProperty(je,"unloadedModels",[]),dicesonice_defineProperty(je,"retries",0),dicesonice_defineProperty(je,"retrying",!1),dicesonice_defineProperty(je,"attrs",["mu","kl","in","ch","ff","ge","ko","kk","attack","damage"]);var Me=function(t){dicesonice_inherits(DiceSoNiceForm,FormApplication);var r=dicesonice_createSuper(DiceSoNiceForm);function DiceSoNiceForm(){return dicesonice_classCallCheck(this,DiceSoNiceForm),r.apply(this,arguments)}return dicesonice_createClass(DiceSoNiceForm,[{key:"render",value:function render(){game.dsk.apps.DiceSoNiceCustomization.render(!0)}}]),DiceSoNiceForm}(),Fe=__webpack_require__(614);function statuseffect_typeof(t){return statuseffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},statuseffect_typeof(t)}function statuseffect_regeneratorRuntime(){statuseffect_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==statuseffect_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function statuseffect_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function statuseffect_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return statuseffect_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return statuseffect_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function statuseffect_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function statuseffect_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function statuseffect_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){statuseffect_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){statuseffect_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function initTokenHook(){Token.prototype.drawEffects=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee(){var t,r,a,o,i,c,u,l,p,d,h,y;return statuseffect_regeneratorRuntime().wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(this.effects.removeChildren().forEach((function(t){return t.destroy()})),this.effects.bg=this.effects.addChild(new PIXI.Graphics),this.effects.overlay=null,t=this.document.effects,!this.actor){m.next=10;break}return m.next=7,this.actor.actorEffects();case 7:m.t0=m.sent,m.next=11;break;case 10:m.t0=[];case 11:if(r=m.t0,a={src:this.document.overlayEffect,tint:null},!t.length&&!r.length){m.next=41;break}o=[],i=statuseffect_createForOfIteratorHelper(r),m.prev=16,i.s();case 18:if((c=i.n()).done){m.next=29;break}if((l=c.value).icon){m.next=22;break}return m.abrupt("continue",27);case 22:if(p=Color.from(null!==(u=l.tint)&&void 0!==u?u:null),!l.getFlag("core","overlay")){m.next=26;break}return a={src:l.icon,tint:p},m.abrupt("continue",27);case 26:o.push(this._drawEffect(l.icon,p,getProperty(l,"flags.dsk.value")));case 27:m.next=18;break;case 29:m.next=34;break;case 31:m.prev=31,m.t1=m.catch(16),i.e(m.t1);case 34:return m.prev=34,i.f(),m.finish(34);case 37:d=statuseffect_createForOfIteratorHelper(t);try{for(d.s();!(h=d.n()).done;)y=h.value,o.push(this._drawEffect(y,null))}catch(t){d.e(t)}finally{d.f()}return m.next=41,Promise.all(o);case 41:return m.next=43,this._drawOverlay(a.src,a.tint);case 43:this.effects.overlay=m.sent,this._refreshEffects();case 45:case"end":return m.stop()}}),_callee,this,[[16,31,34,37]])}))),Token.prototype._refreshEffects=function(){var t,r=0,a=2*Math.round(canvas.dimensions.size/2/5),o=Math.floor(5*this.document.height),i=this.effects.bg.clear().beginFill(0,.4).lineStyle(1,0),c=statuseffect_createForOfIteratorHelper(this.effects.children);try{for(c.s();!(t=c.n()).done;){var u=t.value;if(u!==i&&!u.isCounter)if(u===this.effects.overlay){var l=Math.min(.6*this.w,.6*this.h);u.width=u.height=l,u.position.set((this.w-l)/2,(this.h-l)/2)}else{if(u.width=u.height=a,u.x=Math.floor(r/o)*a,u.y=r%o*a,i.drawRoundedRect(u.x+1,u.y+1,a-2,a-2,2),u.counter>1&&!u.counterDrawn){var p=game.dsk.config.effectTextStyle,d=game.settings.get("dsk","statusEffectCounterColor");p._fill=/^#[0-9A-F]+$/.test(d)?d:"#000000";var h=this.effects.addChild(new PreciseText(u.counter,p));h.x=u.x,h.y=u.y,h.isCounter=!0,u.counterDrawn=!0}r++}}}catch(t){c.e(t)}finally{c.f()}},Token.prototype._drawEffect=function(){var t=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee2(t,r,a){var o,i;return statuseffect_regeneratorRuntime().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(t){c.next=2;break}return c.abrupt("return");case 2:return c.next=4,loadTexture(t,{fallback:"icons/svg/hazard.svg"});case 4:return o=c.sent,i=new PIXI.Sprite(o),r&&(i.tint=r),i.counter=a,c.abrupt("return",this.effects.addChild(i));case 9:case"end":return c.stop()}}),_callee2,this)})));return function(r,a,o){return t.apply(this,arguments)}}(),TokenHUD.prototype._onToggleEffect=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.overlay;t.preventDefault();var a=t.currentTarget,o=a.dataset.statusId&&this.object.actor?CONFIG.statusEffects.find((function(t){return t.id===a.dataset.statusId})):a.getAttribute("src");if(o.flags.dsk.editable)return 0==t.button?this.object.incrementCondition(o):2==t.button?this.object.decrementCondition(o):void 0},Token.prototype.incrementCondition=function(){var t=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee3(t){var r,a,o,i,c=arguments;return statuseffect_regeneratorRuntime().wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:{},a=r.active,o=r.overlay,void 0!==o&&o,(i=this.actor.effects.find((function(r){return r.getFlag("core","statusId")===t.id})))&&!Number.isNumeric(getProperty(i,"flags.dsk.value"))){u.next=7;break}return u.next=5,this.actor.addCondition(t.id,1,!1,!1);case 5:u.next=10;break;case 7:if(!i){u.next=10;break}return u.next=10,this.actor.removeCondition(t.id,1,!1);case 10:return this.hasActiveHUD&&canvas.tokens.hud.refreshStatusIcons(),u.abrupt("return",a);case 12:case"end":return u.stop()}}),_callee3,this)})));return function(r){return t.apply(this,arguments)}}(),Token.prototype.decrementCondition=function(){var t=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee4(t){var r,a,o,i=arguments;return statuseffect_regeneratorRuntime().wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},a=r.active,o=r.overlay,void 0!==o&&o,this.actor.removeCondition(t.id,1,!1),this.hasActiveHUD&&canvas.tokens.hud.refreshStatusIcons(),c.abrupt("return",a);case 4:case"end":return c.stop()}}),_callee4,this)})));return function(r){return t.apply(this,arguments)}}();var t=Token.prototype._onClickLeft2;Token.prototype._onClickLeft2=function(r){if(!(game.user.isGM||!game.settings.get("dsk","enableDPS")||!function isMerchant(t){return!!t&&["merchant","loot"].includes(getProperty(t.system,"merchant.merchantType"))}(this.actor)||X.Z.inDistance(this)))return ui.notifications.warn(game.i18n.localize("dsk.DSKError.notInRangeToLoot"));t.call(this,r)}}function dskrolls_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function dskrolls_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dskrolls_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dskrolls_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function dskrolls_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function creature_merchant_sheet_typeof(t){return creature_merchant_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},creature_merchant_sheet_typeof(t)}function creature_merchant_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function creature_merchant_sheet_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function creature_merchant_sheet_setPrototypeOf(t,r){return creature_merchant_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},creature_merchant_sheet_setPrototypeOf(t,r)}function creature_merchant_sheet_createSuper(t){var r=function creature_merchant_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=creature_merchant_sheet_getPrototypeOf(t);if(r){var i=creature_merchant_sheet_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return creature_merchant_sheet_possibleConstructorReturn(this,a)}}function creature_merchant_sheet_possibleConstructorReturn(t,r){if(r&&("object"===creature_merchant_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function creature_merchant_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function creature_merchant_sheet_getPrototypeOf(t){return creature_merchant_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},creature_merchant_sheet_getPrototypeOf(t)}var ze=function(t){!function creature_merchant_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&creature_merchant_sheet_setPrototypeOf(t,r)}(CreatureMerchantSheetDSK,t);var r=creature_merchant_sheet_createSuper(CreatureMerchantSheetDSK);function CreatureMerchantSheetDSK(){return creature_merchant_sheet_classCallCheck(this,CreatureMerchantSheetDSK),r.apply(this,arguments)}return function creature_merchant_sheet_createClass(t,r,a){return r&&creature_merchant_sheet_defineProperties(t.prototype,r),a&&creature_merchant_sheet_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(CreatureMerchantSheetDSK,null,[{key:"merchantTemplate",get:function get(){return"systems/dsk/templates/actors/merchant/creature-merchant-sheet.html"}}]),CreatureMerchantSheetDSK}(be(U));function character_merchant_sheet_typeof(t){return character_merchant_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},character_merchant_sheet_typeof(t)}function character_merchant_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function character_merchant_sheet_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function character_merchant_sheet_setPrototypeOf(t,r){return character_merchant_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},character_merchant_sheet_setPrototypeOf(t,r)}function character_merchant_sheet_createSuper(t){var r=function character_merchant_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=character_merchant_sheet_getPrototypeOf(t);if(r){var i=character_merchant_sheet_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return character_merchant_sheet_possibleConstructorReturn(this,a)}}function character_merchant_sheet_possibleConstructorReturn(t,r){if(r&&("object"===character_merchant_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function character_merchant_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function character_merchant_sheet_getPrototypeOf(t){return character_merchant_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},character_merchant_sheet_getPrototypeOf(t)}var Ne=function(t){!function character_merchant_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&character_merchant_sheet_setPrototypeOf(t,r)}(CharacterMerchantSheetDSK,t);var r=character_merchant_sheet_createSuper(CharacterMerchantSheetDSK);function CharacterMerchantSheetDSK(){return character_merchant_sheet_classCallCheck(this,CharacterMerchantSheetDSK),r.apply(this,arguments)}return function character_merchant_sheet_createClass(t,r,a){return r&&character_merchant_sheet_defineProperties(t.prototype,r),a&&character_merchant_sheet_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(CharacterMerchantSheetDSK,null,[{key:"merchantTemplate",get:function get(){return"systems/dsk/templates/actors/merchant/character-merchant-sheet.html"}}]),CharacterMerchantSheetDSK}(be(Y));function chat_context_typeof(t){return chat_context_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},chat_context_typeof(t)}function chat_context_regeneratorRuntime(){chat_context_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==chat_context_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function chat_context_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function chat_context_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){chat_context_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){chat_context_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function ownKeys(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),a.push.apply(a,o)}return a}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(a),!0).forEach((function(r){itemlibrary_advanced_filters_defineProperty(t,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))}))}return t}function itemlibrary_advanced_filters_defineProperty(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}var $e={};Hooks.once("ready",(function(){Promise.all([t.Z.allSkillsList()]).then((function(t){t[0].skills.reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{});var r=t[0].rangeSkills.reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{}),a=t[0].meleeSkills.reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{}),o=t[0].rangeSkills.concat(t[0].meleeSkills).reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{});mergeObject($e,{ammunition:[{label:"dsk.ammunitionType",attr:"ammunitionType",type:"select",options:d.Z.ammunitiongroups}],equipment:[{label:"dsk.category",attr:"category",type:"select",options:d.Z.equipmentTypes}],rangeweapon:[{label:"ITEM.TypeCombatskill",attr:"combatskill",type:"select",options:r},{label:"dsk.ammunitionType",attr:"ammunitionType",type:"select",options:d.Z.ammunitiongroups}],meleeweapon:[{label:"ITEM.TypeCombatskill",attr:"combatskill",type:"select",options:a},{label:"dsk.range",attr:"rw",type:"select",options:d.Z.meleeRanges}],poison:[{label:"dsk.resistanceModifier",attr:"resist",type:"select",options:d.Z.magicResistanceModifiers}],trait:[],profession:[],specialability:[{label:"dsk.category",attr:"category",type:"select",options:d.Z.specialAbilityCategories},{label:"ITEM.TypeCombatskill",attr:"subcategory",type:"select",options:o,notStrict:!0}],ahnengabe:[{label:"dsk.resistanceModifier",attr:"resist",type:"select",options:d.Z.magicResistanceModifiers},{label:"dsk.targetCategory",attr:"targetCategory",type:"text"},{label:"dsk.distribution",attr:"distribution",type:"text"}],ahnengeschenk:[],npc:[{label:"ITEM.TypeSpecies",attr:"details.species",type:"text"},{label:"ITEM.TypeProfession",attr:"details.profession",type:"text"},{label:"ITEM.TypeCulture",attr:"details.culture",type:"text"}],character:[{label:"ITEM.TypeSpecies",attr:"details.species",type:"text"},{label:"ITEM.TypeProfession",attr:"details.profession",type:"text"},{label:"ITEM.TypeCulture",attr:"details.culture",type:"text"}],creature:[{label:"ITEM.TypeSpecies",attr:"details.species",type:"text"},{label:"dsk.sizeCategory",attr:"details.size",type:"select",options:d.Z.sizeCategories}],armor:[{label:"dsk.protection",attr:"rs",type:"select",options:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7"}}]})}))}));const He=$e;function itemlibrary_typeof(t){return itemlibrary_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},itemlibrary_typeof(t)}function itemlibrary_toConsumableArray(t){return function itemlibrary_arrayWithoutHoles(t){if(Array.isArray(t))return itemlibrary_arrayLikeToArray(t)}(t)||function itemlibrary_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||itemlibrary_unsupportedIterableToArray(t)||function itemlibrary_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function itemlibrary_get(){return itemlibrary_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=itemlibrary_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},itemlibrary_get.apply(this,arguments)}function itemlibrary_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=itemlibrary_getPrototypeOf(t)););return t}function itemlibrary_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=itemlibrary_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function itemlibrary_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return itemlibrary_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?itemlibrary_arrayLikeToArray(t,r):void 0}}function itemlibrary_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function itemlibrary_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&itemlibrary_setPrototypeOf(t,r)}function itemlibrary_setPrototypeOf(t,r){return itemlibrary_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},itemlibrary_setPrototypeOf(t,r)}function itemlibrary_createSuper(t){var r=function itemlibrary_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=itemlibrary_getPrototypeOf(t);if(r){var i=itemlibrary_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return itemlibrary_possibleConstructorReturn(this,a)}}function itemlibrary_possibleConstructorReturn(t,r){if(r&&("object"===itemlibrary_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function itemlibrary_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function itemlibrary_getPrototypeOf(t){return itemlibrary_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},itemlibrary_getPrototypeOf(t)}function itemlibrary_regeneratorRuntime(){itemlibrary_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==itemlibrary_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function itemlibrary_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function itemlibrary_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){itemlibrary_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){itemlibrary_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function itemlibrary_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function itemlibrary_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function itemlibrary_createClass(t,r,a){return r&&itemlibrary_defineProperties(t.prototype,r),a&&itemlibrary_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}var Ke=function(){function SearchDocument(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};itemlibrary_classCallCheck(this,SearchDocument);var a=t.documentName||t.type;switch(t.documentName){case"Actor":case"Item":a=t.type}var o="";if(game.settings.get("dsk","indexDescription"))switch(a){case"creature":case"npc":case"character":o=getProperty(t,"system.description.value");break;case"JournalEntry":o=getProperty(t,"system.content");break;default:o=getProperty(t,"description.value")}this.document={name:t.name,filterType:a,data:$("<div>").html(o).text(),id:t.id||t._id,visible:!t.visible||t.visible,compendium:t.compendium?t.compendium.metadata.packageName:r.packageName||"",pack:t.pack||(r.packageName?r.id:void 0),img:t.img}}var t,r;return itemlibrary_createClass(SearchDocument,[{key:"uuid",get:function get(){if(this.document.compendium)return"Compendium.".concat(this.document.pack,".").concat(this.document.id);switch(this.itemType){case"character":case"creature":case"npc":return"Actor.".concat(this.id);case"JournalEntry":return"JournalEntry.".concat(this.id);default:return"Item.".concat(this.id)}}},{key:"name",get:function get(){return this.document.name}},{key:"data",get:function get(){return this.document.data}},{key:"id",get:function get(){return this.document.id}},{key:"itemType",get:function get(){return this.document.filterType}},{key:"getItem",value:(r=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee(){return itemlibrary_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fromUuid(this.uuid);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),_callee,this)}))),function getItem(){return r.apply(this,arguments)})},{key:"hasPermission",value:function hasPermission(){return this.document.visible}},{key:"render",value:(t=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee2(){return itemlibrary_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getItem();case 2:t.sent.sheet.render(!0);case 3:case"end":return t.stop()}}),_callee2,this)}))),function render(){return t.apply(this,arguments)})},{key:"compendium",get:function get(){return this.document.compendium}},{key:"img",get:function get(){return"JournalEntry"==this.itemType?"systems/dsk/icons/categories/DSK-Auge.webp":this.document.img}}]),SearchDocument}(),We=function(t){itemlibrary_inherits(AdvancedSearchDocument,t);var r=itemlibrary_createSuper(AdvancedSearchDocument);function AdvancedSearchDocument(t,a){var o;itemlibrary_classCallCheck(this,AdvancedSearchDocument),o=r.call(this,t);var i,c=itemlibrary_createForOfIteratorHelper(He[a]||[]);try{for(c.s();!(i=c.n()).done;){var u=i.value;o[u.attr]=u.attr.split(".").reduce((function(t,r){return void 0===t[r]?{}:t[r]}),t.system)}}catch(t){c.e(t)}finally{c.f()}return o}return itemlibrary_createClass(AdvancedSearchDocument)}(Ke),Be=function(r){itemlibrary_inherits(DSKItemLibrary,Application);var a,o,i,c,u,l,p,d,h,y,m,g,v,_=itemlibrary_createSuper(DSKItemLibrary);function DSKItemLibrary(t){var r;return itemlibrary_classCallCheck(this,DSKItemLibrary),(r=_.call(this,t)).advancedFiltering=!1,r.journalBuild=!1,r.journalWorldBuild=!1,r.equipmentBuild=!1,r.equipmentWorldBuild,r.zooBuild=!1,r.zooWorldBuild=!1,r.currentDetailFilter={equipment:[],character:[],spell:[],journal:[],zoo:[]},r.journalIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data"]}}),r.equipmentIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data","itemType"]}}),r.zooIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data","itemType"]}}),r.detailFilter={},r.pages={equipment:{},character:{},spell:{},journal:{},zoo:{}},r.filters={equipment:{categories:{armor:!1,ammunition:!1,equipment:!1,meleeweapon:!1,rangeweapon:!1,poison:!1},filterBy:{search:""}},character:{categories:{profession:!1,advantage:!1,culture:!1,disadvantage:!1,trait:!1,skill:!1,specialability:!1,species:!1},filterBy:{search:""}},spell:{categories:{ahnengabe:!1,ahnengeschenk:!1},filterBy:{search:""}},journal:{categories:{},filterBy:{search:""}},zoo:{categories:{npc:!1,character:!1,creature:!1},filterBy:{search:""}}},r}return itemlibrary_createClass(DSKItemLibrary,[{key:"getData",value:(v=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee3(t){var r;return itemlibrary_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary.prototype),"getData",this).call(this,t);case 2:if((r=a.sent).categories=this.translateFilters(),r.isGM=game.user.isGM,r.items=this.items,r.advancedMode=this.advancedFiltering?"on":"",r.worldIndexed=game.settings.get("dsk","indexWorldItems")?"on":"",r.fullTextEnabled=game.settings.get("dsk","indexDescription")?"on":"",!this.advancedFiltering){a.next=13;break}return a.next=12,this.buildDetailFilter("tbd",this.subcategory);case 12:r.advancedFilter=a.sent;case 13:return a.abrupt("return",r);case 14:case"end":return a.stop()}}),_callee3,this)}))),function getData(t){return v.apply(this,arguments)})},{key:"translateFilters",value:function translateFilters(){return{equipment:this.buildFilter(this.filters.equipment),character:this.buildFilter(this.filters.character),spell:this.buildFilter(this.filters.spell),zoo:this.buildFilter(this.filters.zoo),journal:this.buildFilter(this.filters.journal)}}},{key:"purgeAdvancedFilters",value:function purgeAdvancedFilters(){var t=this;for(var r in this.filters)for(var a in this.filters[r].categories)this.filters[r].categories[a]=!1;$(this._element).find('.filter[type="checkbox"]').prop("checked",!1),this.buildDetailFilter("none","none").then((function(r){$(t._element).find(".advancedSearch .groupbox").html(r)}))}},{key:"buildFilter",value:function buildFilter(t){var r=[];return Object.keys(t.categories).forEach((function(a){r.push({label:game.i18n.localize("ITEM.Type".concat(a.slice(0,1).toUpperCase()).concat(a.slice(1))),selected:t.categories[a],key:a})})),r=r.sort((function(t,r){return t.label.localeCompare(r.label)}))}},{key:"getRandomItems",value:(g=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee4(t,r){var a,o;return itemlibrary_regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:return a=[],o=this.equipmentIndex,i.t0=a.push,i.t1=a,i.t2=itemlibrary_toConsumableArray,i.next=7,o.search(t,{field:["itemType"]});case 7:return i.t3=i.sent,i.t4=(0,i.t2)(i.t3),i.t0.apply.call(i.t0,i.t1,i.t4),i.next=12,Promise.all(this.shuffle(a.filter((function(t){return t.hasPermission}))).slice(0,r+5).map((function(t){return t.getItem()})));case 12:return i.abrupt("return",i.sent.filter((function(t){var r=t.getFlag("dsk","enchantments");return!r||!r.find((function(t){return t.talisman}))})).slice(0,r));case 13:case"end":return i.stop()}}),_callee4,this)}))),function getRandomItems(t,r){return g.apply(this,arguments)})},{key:"shuffle",value:function shuffle(t){for(var r,a,o=t.length;0!==o;)a=Math.floor(Math.random()*o),r=t[o-=1],t[o]=t[a],t[a]=r;return t}},{key:"findCompendiumItem",value:(m=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee5(t,r){var a,o,i,c=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:if(a=!(c.length>2&&void 0!==c[2])||c[2],this.equipmentBuild){u.next=4;break}return u.next=4,this.buildEquipmentIndex();case 4:return o={field:["name"],where:{itemType:r}},u.next=7,this.equipmentIndex.search(t,o);case 7:return i=u.sent,a&&(i=i.filter((function(t){return""!=t.compendium}))),u.next=11,Promise.all(i.map((function(t){return t.getItem()})));case 11:return u.abrupt("return",u.sent);case 12:case"end":return u.stop()}}),_callee5,this)}))),function findCompendiumItem(t,r){return m.apply(this,arguments)})},{key:"getCategoryItems",value:(y=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee6(t){var r,a=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return r=a.length>1&&void 0!==a[1]&&a[1],o.next=3,this.buildEquipmentIndex();case 3:if(!r){o.next=7;break}return o.next=6,Promise.all(this.equipmentIndex.search(t,{field:["itemType"]}).map((function(t){return t.getItem()})));case 6:return o.abrupt("return",o.sent.map((function(t){return t.toObject()})));case 7:return o.abrupt("return",this.equipmentIndex.search(t,{field:["itemType"]}));case 8:case"end":return o.stop()}}),_callee6,this)}))),function getCategoryItems(t){return y.apply(this,arguments)})},{key:"executeAdvancedFilter",value:(h=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee7(t,r,a,o,i){var c,u,l,p,d,h,y,m=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:return c=m.length>5&&void 0!==m[5]?m[5]:[],u=function selFnct(t){var r,o=itemlibrary_createForOfIteratorHelper(a);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(t[2]?t[i[0]]!=i[1]:-1==t[i[0]].indexOf(i[1]))return!1}}catch(t){o.e(t)}finally{o.f()}return!0},l=function txtFnct(t){var r,a=itemlibrary_createForOfIteratorHelper(o);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(-1==t[i[0]].toLowerCase().indexOf(i[1]))return!1}}catch(t){a.e(t)}finally{a.f()}return!0},p=function cbFnct(t){var r,a=itemlibrary_createForOfIteratorHelper(i);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(t[o[0]]!=o[1])return!1}}catch(t){a.e(t)}finally{a.f()}return!0},d=function rangeFct(t){var r,a=itemlibrary_createForOfIteratorHelper(c);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(t[o[0]]<o[1]||t[o[0]]>o[2])return!1}}catch(t){a.e(t)}finally{a.f()}return!0},h=r.where((function(r){return(""==t||-1!=r.name.toLowerCase().indexOf(t))&&u(r)&&l(r)&&p(r)&&d(r)})),y=(y=h).filter((function(t){return t.hasPermission})).sort((function(t,r){return t.name.toLowerCase()>r.name.toLowerCase()?1:-1})),g.abrupt("return",y);case 9:case"end":return g.stop()}}),_callee7)}))),function executeAdvancedFilter(t,r,a,o,i){return h.apply(this,arguments)})},{key:"advancedFilterStuff",value:(d=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee8(t,r){var a,o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S;return itemlibrary_regeneratorRuntime().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:a=$(this._element).find(".detailFilters"),o=a.attr("data-subc"),i=this.filters[t].filterBy.search.toLowerCase(),c=this.detailFilter[o],u=[],l=[],p=[],d=itemlibrary_createForOfIteratorHelper(a.find("select"));try{for(d.s();!(h=d.n()).done;)y=h.value,""!=(m=$(y).val())&&u.push([$(y).attr("name"),m,"true"!=y.dataset.notstrict])}catch(t){d.e(t)}finally{d.f()}g=itemlibrary_createForOfIteratorHelper(a.find('input[type="text"]:not(.manualFilter)'));try{for(g.s();!(v=g.n()).done;)_=v.value,""!=(b=$(_).val())&&l.push([$(_).attr("name"),b.toLowerCase()])}catch(t){g.e(t)}finally{g.f()}k=itemlibrary_createForOfIteratorHelper(a.find('input[type="checkbox"]:checked:not(.manualFilter)'));try{for(k.s();!(w=k.n()).done;)x=w.value,""!=(O=$(x).val())&&p.push([$(x).attr("name"),O.toLowerCase()])}catch(t){k.e(t)}finally{k.f()}return r.next=15,this.executeAdvancedFilter(i,c,u,l,p);case 15:return S=r.sent,this.setBGImage(S,t),r.abrupt("return",S);case 18:case"end":return r.stop()}}),_callee8,this)}))),function advancedFilterStuff(t,r){return d.apply(this,arguments)})},{key:"filterStuff",value:(p=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee9(t,r,a){var o,i,c,u,l,p,d,h;return itemlibrary_regeneratorRuntime().wrap((function _callee9$(y){for(;;)switch(y.prev=y.next){case 0:for(l in o=this.filters[t].filterBy.search,i={field:["name","data"],limit:60,page:a||!0},c=[],u=!1,this.filters[t].categories)this.filters[t].categories[l]&&(d=void 0,""==o?d=r.search(l,{field:["itemType"],limit:60,page:a||!0}):(h=duplicate(i),mergeObject(h,{where:{itemType:l}}),d=r.search(o,h)),this.pages[t].next=d.next,(p=c).push.apply(p,itemlibrary_toConsumableArray(d.result))),u=this.filters[t].categories[l]||u;return u||(c=r.search(o,i),this.pages[t].next=c.next),c=(c=c.result?c.result:c).filter((function(t){return t.hasPermission})).sort((function(t,r){return t.name.toLowerCase()>r.name.toLowerCase()?1:-1})),this.setBGImage(c,t),y.abrupt("return",c);case 10:case"end":return y.stop()}}),_callee9,this)}))),function filterStuff(t,r,a){return p.apply(this,arguments)})},{key:"setBGImage",value:function setBGImage(t,r){$(this._element).find(".".concat(r," .libcontainer"))["".concat(t.length>0?"remove":"add","Class")]("libraryImg")}},{key:"renderResult",value:function renderResult(t,r,a,o){var i=a.index,c=a.itemType,u=t.find(".searchResult .item-list");renderTemplate("systems/dsk/templates/system/libraryItem.html",{items:r}).then((function(t){o||u.empty(),(t=$(t)).each((function(){var t=$(this);t.attr("draggable",!0).on("dragstart",(function(r){var a=i.find($(t).attr("data-item-id"));r.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({type:c,uuid:a.uuid}))}))})),u.append(t)}))}},{key:"filterItems",value:(l=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee10(t,r,a){var o,i,c;return itemlibrary_regeneratorRuntime().wrap((function _callee10$(u){for(;;)switch(u.prev=u.next){case 0:if(o=this.selectIndex(r),!this.advancedFiltering||"journal"==r){u.next=9;break}return u.next=4,this.advancedFilterStuff(r,a);case 4:return i=u.sent,this.renderResult(t,i,o,a),u.abrupt("return",i);case 9:return u.next=11,this.filterStuff(r,o.index,a);case 11:return c=u.sent,this.renderResult(t,c,o,a),u.abrupt("return",c);case 14:case"end":return u.stop()}}),_callee10,this)}))),function filterItems(t,r,a){return l.apply(this,arguments)})},{key:"selectIndex",value:function selectIndex(t){var r="Item",a=this.equipmentIndex;switch(t){case"zoo":r="Actor",a=this.zooIndex;break;case"journal":r="JournalEntry",a=this.journalIndex}return{index:a,itemType:r}}},{key:"_render",value:(u=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee11(){var t,r,a=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee11$(o){for(;;)switch(o.prev=o.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],r=a.length>1&&void 0!==a[1]?a[1]:{},o.next=4,itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary.prototype),"_render",this).call(this,t,r);case 4:this.buildEquipmentIndex();case 5:case"end":return o.stop()}}),_callee11,this)}))),function _render(){return u.apply(this,arguments)})},{key:"buildEquipmentIndex",value:(c=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee12(){return itemlibrary_regeneratorRuntime().wrap((function _callee12$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._createIndex("equipment","Item",game.items);case 2:case"end":return t.stop()}}),_callee12,this)}))),function buildEquipmentIndex(){return c.apply(this,arguments)})},{key:"_createIndex",value:(i=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee14(t,r,a){var o,i,c,u,l,p,d,h,y=this;return itemlibrary_regeneratorRuntime().wrap((function _callee14$(m){for(;;)switch(m.prev=m.next){case 0:if(!this["".concat(t,"Build")]){m.next=2;break}return m.abrupt("return");case 2:return SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:""}),pct:0}),o=$(this._element).find('*[data-tab="'.concat(t,'"]')),this.showLoading(o,t),i=game.packs.filter((function(t){return t.documentName==r&&(game.user.isGM||!t.private)})),c=100/(i.length+1),u=c,l=["name","system.type","system.description.value","img"],p="Actor"==r?function func(t){return t.getIndex({actorFields:l})}:"JournalEntry"==r?function func(t){return t.getDocuments()}:function func(t){return t.getDocuments({type:{$in:game.system.documentTypes.Item}})},d=this.indexWorldItems(a,t),SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:"world items"}),pct:Math.round(c)}),h=i.map(function(){var t=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee13(t){var r;return itemlibrary_regeneratorRuntime().wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p(t);case 2:r=a.sent,u+=c,SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:"".concat(t.metadata.label," (").concat(t.metadata.id,")")}),pct:Math.round(u)}),d.push.apply(d,itemlibrary_toConsumableArray(r.map((function(r){return new Ke(r,t.metadata)}))));case 6:case"end":return a.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}()),m.abrupt("return",Promise.all(h).then((function(r){y["".concat(t,"Index")].add(d),y["".concat(t,"Build")]=!0,SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:""}),pct:100}),y.hideLoading(o,t)})));case 14:case"end":return m.stop()}}),_callee14,this)}))),function _createIndex(t,r,a){return i.apply(this,arguments)})},{key:"subcategoryFields",value:function subcategoryFields(t){var r,a=["name","itemType"],o=itemlibrary_createForOfIteratorHelper(He[t]||[]);try{for(o.s();!(r=o.n()).done;){var i=r.value;a.push(i.attr)}}catch(t){o.e(t)}finally{o.f()}return a}},{key:"indexWorldItems",value:function indexWorldItems(t,r){var a=[];return game.settings.get("dsk","indexWorldItems")&&(a.push.apply(a,itemlibrary_toConsumableArray(t.filter((function(t){return t.visible})).map((function(t){return new Ke(t)})))),this["".concat(r,"WorldBuild")]=!0),a}},{key:"createDetailIndex",value:(o=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee15(t,r){var a,o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S;return itemlibrary_regeneratorRuntime().wrap((function _callee15$(P){for(;;)switch(P.prev=P.next){case 0:if(this.detailFilter[r]){P.next=39;break}a=this.subcategoryFields(r),(o=$(this._element).find('*[data-tab="'.concat(t,'"]'))).find(".searchResult ul").html(""),this.showLoading(o,t),this.detailFilter[r]=new FlexSearch({encode:"simple",tokenize:"full",cache:!0,doc:{id:"id",field:a}}),i=this.selectIndex(t),c=i.index,u=i.itemType,l="Item"==u?game.items:game.actors,p=l.filter((function(t){return t.visible&&t.type==r})).map((function(t){return new We(t,r)})),d=c.search(r,{field:["itemType"]}),h={},y=itemlibrary_createForOfIteratorHelper(d),P.prev=12,y.s();case 14:if((m=y.n()).done){P.next=22;break}if((g=m.value).document.pack){P.next=18;break}return P.abrupt("continue",20);case 18:h[g.document.pack]||(h[g.document.pack]=[]),h[g.document.pack].push(g.document.id);case 20:P.next=14;break;case 22:P.next=27;break;case 24:P.prev=24,P.t0=P.catch(12),y.e(P.t0);case 27:return P.prev=27,y.f(),P.finish(27);case 30:for(v=[],_=0,b=Object.entries(h);_<b.length;_++)k=b[_],v.push(game.packs.get(k[0]).getDocuments({_id:{$in:k[1]},type:r}));return P.next=34,Promise.all(v);case 34:w=P.sent,x=itemlibrary_createForOfIteratorHelper(w);try{for(x.s();!(O=x.n()).done;)S=O.value,p.push.apply(p,itemlibrary_toConsumableArray(S.map((function(t){return new We(t,r)}))))}catch(t){x.e(t)}finally{x.f()}this.detailFilter[r].add(p),this.hideLoading(o,t);case 39:case"end":return P.stop()}}),_callee15,this,[[12,24,27,30]])}))),function createDetailIndex(t,r){return o.apply(this,arguments)})},{key:"buildDetailFilter",value:(a=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee16(t,r){var a,o,i;return itemlibrary_regeneratorRuntime().wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:if(!(a=He[r]||[])){c.next=11;break}return o=this.createDetailIndex(t,r),c.next=5,renderTemplate("systems/dsk/templates/system/detailFilter.html",{fields:a,subcategory:r});case 5:return i=c.sent,c.next=8,o;case 8:return c.abrupt("return",i);case 11:return c.abrupt("return","<p>".concat(game.i18n.localize("dsk.Library.selectAdvanced"),"</p>"));case 12:case"end":return c.stop()}}),_callee16,this)}))),function buildDetailFilter(t,r){return a.apply(this,arguments)})},{key:"checkWorldStuffIndex",value:function checkWorldStuffIndex(){game.settings.get("dsk","indexWorldItems")&&(!this.journalWorldBuild&&this.journalBuild&&this.journalIndex.add(this.indexWorldItems(game.journal,"journal")),!this.equipmentWorldBuild&&this.equipmentBuild&&this.equipmentIndex.add(this.indexWorldItems(game.items,"equipment")),!this.zooWorldBuild&&this.zooBuild&&this.zooIndex.add(this.indexWorldItems(game.actors,"zoo")))}},{key:"activateListeners",value:function activateListeners(r){var a=this;itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary.prototype),"activateListeners",this).call(this,r),r.on("click",".toggleAdvancedMode",(function(){a.advancedFiltering=!a.advancedFiltering,a.advancedFiltering?($(a._element).find(".toggleAdvancedMode").addClass("on"),$(a._element).find(".advancedSearch").fadeIn(),a.purgeAdvancedFilters()):($(a._element).find(".toggleAdvancedMode").removeClass("on"),$(a._element).find(".advancedSearch").fadeOut())})),r.on("change",".detailFilters input, .detailFilters select",(function(){var t=$(a._element).find(".tab.active"),r=t.attr("data-tab");a.filterItems(t,r)})),r.on("click",".filter",function(){var t=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee17(t){var r,o,i,c;return itemlibrary_regeneratorRuntime().wrap((function _callee17$(u){for(;;)switch(u.prev=u.next){case 0:if(r=$(t.currentTarget).closest(".tab"),o=r.attr("data-tab"),i=$(t.currentTarget).attr("data-category"),c=$(t.currentTarget).is(":checked"),!a.advancedFiltering||!c){u.next=13;break}return a.purgeAdvancedFilters(),a.subcategory=i,$(t.currentTarget).prop("checked",c),u.t0=$(a._element).find(".advancedSearch .groupbox"),u.next=11,a.buildDetailFilter(o,i);case 11:u.t1=u.sent,u.t0.html.call(u.t0,u.t1);case 13:a.filters[o].categories[i]=c,a.filterItems(r,o);case 15:case"end":return u.stop()}}),_callee17)})));return function(r){return t.apply(this,arguments)}}()),r.on("click",".item-name",(function(t){a.getItemFromHTML(t).render()})),r.on("mousedown",".item-name",(function(r){2==r.button&&t.Z.showArtwork(a.getItemFromHTML(r))})),r.on("keyup",".filterBy-search",(function(t){var r=$(t.currentTarget).closest(".tab"),o=r.attr("data-tab");a.filters[o].filterBy.search=$(t.currentTarget).val(),a.filterItems(r,o)})),r.find('*[data-tab="journal"]').click((function(t){a._createIndex("journal","JournalEntry",game.journal)})),r.find('*[data-tab="zoo"]').click((function(t){a._createIndex("zoo","Actor",game.actors)})),r.find(".showDetails").click((function(t){var a=$(t.currentTarget).attr("data-btn");$(t.currentTarget).find("i").toggleClass("fa-caret-left fa-caret-right"),r.find(".".concat(a," .detailBox")).toggleClass("dskhidden")})),r.find(".toggleWorldIndex").click((function(t){game.settings.set("dsk","indexWorldItems",!game.settings.get("dsk","indexWorldItems")),a.checkWorldStuffIndex(),$(t.currentTarget).toggleClass("on")})),r.find(".fulltextsearch").click((function(t){game.settings.set("dsk","indexDescription",!game.settings.get("dsk","indexDescription")),$(t.currentTarget).toggleClass("on")}));var o=this;$(this._element).find(".window-content").on("scroll.infinit",debounce((function(t){if(!o.advancedFiltering){var a=$(t.target),i=a.scrollTop()+a.innerHeight()>=a[0].scrollHeight-100,c=r.find(".tabs .item.active").attr("data-tab");if(i&&o.pages[c].next){var u=r.find(".tab.active");o.filterItems.call(o,u,c,o.pages[c].next)}}}),100))}},{key:"getItemFromHTML",value:function getItemFromHTML(t){var r=$(t.currentTarget).parents(".browser-item").attr("data-item-id");switch($(t.currentTarget).closest(".tab").attr("data-tab")){case"zoo":return this.zooIndex.find(r);case"journal":return this.journalIndex.find(r);default:return this.equipmentIndex.find(r)}}},{key:"showLoading",value:function showLoading(t,r){this.setBGImage([1],r),$('<div class="loader"><i class="fa fa-4x fa-spinner fa-spin"></i>'.concat(game.i18n.localize("dsk.Library.buildingIndex"),"</div>")).appendTo(t.find(".searchResult"))}},{key:"hideLoading",value:function hideLoading(t,r){this.setBGImage([],r),t.find(".loader").remove()}}],[{key:"defaultOptions",get:function get(){var t=itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary),"defaultOptions",this);return t.id="DSKItemLibrary",t.classes.push("dsk","itemlibrary"),t.height=800,t.width=800,t.resizable=!0,t.title=game.i18n.localize("dsk.ItemLibrary"),t.template="systems/dsk/templates/system/itemlibrary.html",t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"equipment"}],t}}]),DSKItemLibrary}(),Ze=__webpack_require__(311);function hotbar_typeof(t){return hotbar_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hotbar_typeof(t)}function hotbar_regeneratorRuntime(){hotbar_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==hotbar_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function hotbar_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function hotbar_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){hotbar_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){hotbar_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function hotbar_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function hotbar_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function hotbar_get(){return hotbar_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=hotbar_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},hotbar_get.apply(this,arguments)}function hotbar_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=hotbar_getPrototypeOf(t)););return t}function hotbar_setPrototypeOf(t,r){return hotbar_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},hotbar_setPrototypeOf(t,r)}function hotbar_createSuper(t){var r=function hotbar_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=hotbar_getPrototypeOf(t);if(r){var i=hotbar_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return hotbar_possibleConstructorReturn(this,a)}}function hotbar_possibleConstructorReturn(t,r){if(r&&("object"===hotbar_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function hotbar_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function hotbar_getPrototypeOf(t){return hotbar_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},hotbar_getPrototypeOf(t)}var qe=function(t){!function hotbar_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&hotbar_setPrototypeOf(t,r)}(DSKHotbar,Hotbar);var r,a,o=hotbar_createSuper(DSKHotbar);function DSKHotbar(){return hotbar_classCallCheck(this,DSKHotbar),o.apply(this,arguments)}return function hotbar_createClass(t,r,a){return r&&hotbar_defineProperties(t.prototype,r),a&&hotbar_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKHotbar,[{key:"collapse",value:(a=hotbar_asyncToGenerator(hotbar_regeneratorRuntime().mark((function _callee(){return hotbar_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!this._collapsed){t.next=2;break}return t.abrupt("return",!0);case 2:return $(this.element).addClass("collapsedHotbar"),t.abrupt("return",hotbar_get(hotbar_getPrototypeOf(DSKHotbar.prototype),"collapse",this).call(this));case 4:case"end":return t.stop()}}),_callee,this)}))),function collapse(){return a.apply(this,arguments)})},{key:"expand",value:(r=hotbar_asyncToGenerator(hotbar_regeneratorRuntime().mark((function _callee2(){return hotbar_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(this._collapsed){t.next=2;break}return t.abrupt("return",!0);case 2:return $(this.element).removeClass("collapsedHotbar"),t.abrupt("return",hotbar_get(hotbar_getPrototypeOf(DSKHotbar.prototype),"expand",this).call(this));case 4:case"end":return t.stop()}}),_callee2,this)}))),function expand(){return r.apply(this,arguments)})}]),DSKHotbar}();function initializer_typeof(t){return initializer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},initializer_typeof(t)}function initializer_slicedToArray(t,r){return function initializer_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function initializer_iterableToArrayLimit(t,r){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==a)return;var o,i,c=[],u=!0,l=!1;try{for(a=a.call(t);!(u=(o=a.next()).done)&&(c.push(o.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==a.return||a.return()}finally{if(l)throw i}}return c}(t,r)||initializer_unsupportedIterableToArray(t,r)||function initializer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function initializer_createForOfIteratorHelper(t,r){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=initializer_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){a&&(t=a);var o=0,i=function F(){};return{s:i,n:function n(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){a=a.call(t)},n:function n(){var t=a.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==a.return||a.return()}finally{if(l)throw c}}}}function initializer_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return initializer_arrayLikeToArray(t,r);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?initializer_arrayLikeToArray(t,r):void 0}}function initializer_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var a=0,o=new Array(r);a<r;a++)o[a]=t[a];return o}function initializer_regeneratorRuntime(){initializer_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,a=r.hasOwnProperty,o=Object.defineProperty||function(t,r,a){t[r]=a.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,a){return Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,a){return t[r]=a}}function wrap(t,r,a,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return o(u,"_invoke",{value:makeInvokeMethod(t,a,l)}),u}function tryCatch(t,r,a){try{return{type:"normal",arg:t.call(r,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&a.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(o,i,c,u){var l=tryCatch(t[o],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==initializer_typeof(d)&&a.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;o(this,"_invoke",{value:function value(t,a){function callInvokeWithMethodAndArg(){return new r((function(r,o){invoke(t,a,r,o)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,a){var o="suspendedStart";return function(i,c){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===i)throw c;return doneResult()}for(a.method=i,a.arg=c;;){var u=a.delegate;if(u){var l=maybeInvokeDelegate(u,a);if(l){if(l===p)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===o)throw o="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o="executing";var d=tryCatch(t,r,a);if("normal"===d.type){if(o=a.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(o="completed",a.method="throw",a.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var a=t.iterator[r.method];if(void 0===a){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=tryCatch(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,p;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function next(){for(;++o<t.length;)if(a.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,a,o,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,a,o,i),c);return t.isGeneratorFunction(a)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),a=[];for(var o in r)a.push(o);return a.reverse(),function next(){for(;a.length;){var t=a.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(a,o){return c.type="throw",c.arg=t,r.next=a,o&&(r.method="next",r.arg=void 0),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),l=a.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),resetTryEntry(a),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc===t){var o=a.completion;if("throw"===o.type){var i=o.arg;resetTryEntry(a)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,a){return this.delegate={iterator:values(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=void 0),p}},t}function initializer_asyncGeneratorStep(t,r,a,o,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void a(t)}l.done?r(p):Promise.resolve(p).then(o,i)}function initializer_asyncToGenerator(t){return function(){var r=this,a=arguments;return new Promise((function(o,i){var c=t.apply(r,a);function _next(t){initializer_asyncGeneratorStep(c,o,i,_next,_throw,"next",t)}function _throw(t){initializer_asyncGeneratorStep(c,o,i,_next,_throw,"throw",t)}_next(void 0)}))}}function initializer_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function initializer_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function initializer_setPrototypeOf(t,r){return initializer_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},initializer_setPrototypeOf(t,r)}function initializer_createSuper(t){var r=function initializer_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=initializer_getPrototypeOf(t);if(r){var i=initializer_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return initializer_possibleConstructorReturn(this,a)}}function initializer_possibleConstructorReturn(t,r){if(r&&("object"===initializer_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function initializer_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function initializer_getPrototypeOf(t){return initializer_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},initializer_getPrototypeOf(t)}var Ye=function(r){!function initializer_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&initializer_setPrototypeOf(t,r)}(DSKInitializer,Dialog);var o,i,c,u=initializer_createSuper(DSKInitializer);function DSKInitializer(t,r,a){var o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";initializer_classCallCheck(this,DSKInitializer);var c,l,p={title:t,content:r,buttons:{initialize:{label:game.i18n.localize("dsk.initialize"),callback:(l=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee(){return initializer_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!o.lock){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,o.initialize();case 4:case"end":return t.stop()}}),_callee)}))),function callback(){return l.apply(this,arguments)})},cancel:{label:game.i18n.localize("dsk.cancel"),callback:(c=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee2(){return initializer_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!o.lock){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,o.dontInitialize();case 4:case"end":return t.stop()}}),_callee2)}))),function callback(){return c.apply(this,arguments)})}}};return(o=u.call(this,p)).module=a,o.lang=i,o.folders={},o.journals={},o.scenes={},o.actors={},o.lock=!1,o}return function initializer_createClass(t,r,a){return r&&initializer_defineProperties(t.prototype,r),a&&initializer_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKInitializer,[{key:"initialize",value:(c=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee13(){var t,r,o=this;return initializer_regeneratorRuntime().wrap((function _callee13$(i){for(;;)switch(i.prev=i.next){case 0:if(this.lock=!0,(t=$(this._element).find(".initialize")).prepend('<i class="fas fa-spinner fa-spin"></i>'),r={},i.prev=4,!game.settings.settings.has("".concat(this.module,".initialized"))){i.next=8;break}return i.next=8,game.settings.set(this.module,"initialized",!0);case 8:i.next=12;break;case 10:i.prev=10,i.t0=i.catch(4);case 12:return i.prev=12,i.next=15,fetch("modules/".concat(this.module,"/adventure").concat(this.lang,".json")).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee3(t){return initializer_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee4(t){return initializer_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:r=t;case 1:case"end":return a.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}());case 15:i.next=27;break;case 17:return i.prev=17,i.t1=i.catch(12),i.prev=19,i.next=22,fetch("modules/".concat(this.module,"/adventure.json")).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee5(t){return initializer_regeneratorRuntime().wrap((function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee6(t){return initializer_regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:r=t;case 1:case"end":return a.stop()}}),_callee6)})));return function(r){return t.apply(this,arguments)}}());case 22:i.next=27;break;case 24:i.prev=24,i.t2=i.catch(19),console.warn("Could not find book data for ".concat(this.module," import."));case 27:return i.next=29,fetch("modules/".concat(this.module,"/initialization").concat(this.lang,".json")).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee7(t){return initializer_regeneratorRuntime().wrap((function _callee7$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee7)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee12(t){var i,c,u,l,p,d,h,y,m,g,v;return initializer_regeneratorRuntime().wrap((function _callee12$(_){for(;;)switch(_.prev=_.next){case 0:if(!(i=t.folders)){_.next=17;break}return _.next=4,o.getFolderForType("JournalEntry");case 4:return c=_.sent,u=t.folders[0].name,c&&(o.folders[c.data.name]=c,t.folders.shift()),_.next=9,Folder.create(i);case 9:l=_.sent,Array.isArray(l)||(l=[l]),p=initializer_createForOfIteratorHelper(l);try{for(p.s();!(d=p.n()).done;)h=d.value,o.folders[h.data.name]=h}catch(t){p.e(t)}finally{p.f()}for(m in y=[],o.folders)g=o.folders[m].getFlag("dsk","parent"),(v=g==u?game.i18n.localize("".concat(o.module,".name")):g)&&y.push({_id:o.folders[m].id,parent:o.folders[v].id});return _.next=17,Folder.updateDocuments(y);case 17:if(!t.items){_.next=19;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee8(){var r,i,c,u,l,p;return initializer_regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,o.getFolderForType("Item");case 2:r=d.sent,i=[],c=[],u=initializer_createForOfIteratorHelper(t.items);try{for(p=function _loop(){var t=l.value;t.folder=r.id;var a=game.items.find((function(a){var o;return a.name==t.name&&(null===(o=a.folder)||void 0===o?void 0:o.id)==r.id}));a?(t._id=a.id,c.push(t)):i.push(t)},u.s();!(l=u.n()).done;)p()}catch(t){u.e(t)}finally{u.f()}return d.next=9,a.Z.create(i);case 9:return d.next=11,a.Z.updateDocuments(c);case 11:case"end":return d.stop()}}),_callee8)}))(),"t0",19);case 19:if(!t.playlists){_.next=21;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee9(){var r,a,i,c,u,l,p,d;return initializer_regeneratorRuntime().wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,o.getFolderForType("Playlist");case 2:return r=h.sent,a=[],i=[],c=game.packs.get(t.playlists),h.next=8,c.getDocuments();case 8:u=h.sent.map((function(t){return t.toObject()})),l=initializer_createForOfIteratorHelper(u);try{for(d=function _loop2(){var t=p.value;t.folder=r.id;var o=game.playlists.find((function(a){var o;return a.name==t.name&&(null===(o=a.folder)||void 0===o?void 0:o.id)==r.id}));o?(t._id=o.data._id,i.push(t)):a.push(t)},l.s();!(p=l.n()).done;)d()}catch(t){l.e(t)}finally{l.f()}return h.next=13,Playlist.create(a,{keepId:!0});case 13:return h.next=15,Playlist.updateDocuments(i);case 15:case"end":return h.stop()}}),_callee9)}))(),"t1",21);case 21:if(!t.scenes){_.next=23;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee10(){var r,a,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I;return initializer_regeneratorRuntime().wrap((function _callee10$(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,o.getFolderForType("Scene");case 2:return r=E.sent,a=game.packs.get(t.scenes),E.next=6,a.getDocuments();case 6:return i=E.sent.map((function(t){return t.toObject()})),c=game.packs.get(t.journal),E.next=10,c.getDocuments();case 10:return u=E.sent.map((function(t){return t.toObject()})),E.next=13,o.getFolderForType("JournalEntry");case 13:l=E.sent,p=[],d=[],h=new Map,y=!1,m=initializer_createForOfIteratorHelper(i),E.prev=19,v=initializer_regeneratorRuntime().mark((function _loop3(){var t,a,i,c,m,v,_,b;return initializer_regeneratorRuntime().wrap((function _loop3$(k){for(;;)switch(k.prev=k.next){case 0:if(t=g.value,a=y,i=game.scenes.find((function(a){var o;return a.name==t.name&&(null===(o=a.folder)||void 0===o?void 0:o.id)==r.id})),y||!i){k.next=10;break}return k.next=6,new Promise((function(r,a){new Dialog({title:game.i18n.localize("dsk.Book.sceneReset"),content:game.i18n.format("dsk.Book.sceneResetDescription",{name:t.name}),default:"Yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){r([!0,!1])}},all:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.LocalizedIDs.all"),callback:function callback(){r([!0,!0])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){r([!1,!1])}}},close:function close(){r([!1,!1])}}).render(!0)}));case 6:c=k.sent,m=initializer_slicedToArray(c,2),a=m[0],y=m[1];case 10:if(!i||a){k.next=13;break}return o.scenes[i.name]=i,k.abrupt("return","continue");case 13:t.folder=r.id,v=initializer_createForOfIteratorHelper(t.notes),k.prev=15,b=initializer_regeneratorRuntime().mark((function _loop4(){var r,a,i,c,p,d;return initializer_regeneratorRuntime().wrap((function _loop4$(y){for(;;)switch(y.prev=y.next){case 0:if(r=_.value,y.prev=1,a=u.find((function(t){return t.flags.dsk.initId==r.entryId})),h.has(a._id)){y.next=26;break}if(i=getProperty(a,"flags.dsk.parent"),c=l,!o.folders[i]){y.next=10;break}c=o.folders[i],y.next=14;break;case 10:if(!i){y.next=14;break}return y.next=13,o.getFolderForType("JournalEntry",l.id,i,0,getProperty(a,"flags.dsk.foldercolor")||"");case 13:c=y.sent;case 14:if(a.folder=c.id,!(p=game.journal.find((function(t){var o;return t.name==a.name&&(null===(o=t.folder)||void 0===o?void 0:o.id)==c.id&&t.flags.dsk.initId==r.entryId})))){y.next=22;break}return y.next=19,p.update(a);case 19:h.set(a._id,p.id),y.next=26;break;case 22:return y.next=24,JournalEntry.create(a);case 24:d=y.sent,h.set(a._id,d.id);case 26:r.entryId=h.get(a._id),y.next=32;break;case 29:y.prev=29,y.t0=y.catch(1),console.warn("Could not initialize Scene Notes for scene :".concat(t.name)+y.t0);case 32:case"end":return y.stop()}}),_loop4,null,[[1,29]])})),v.s();case 18:if((_=v.n()).done){k.next=22;break}return k.delegateYield(b(),"t0",20);case 20:k.next=18;break;case 22:k.next=27;break;case 24:k.prev=24,k.t1=k.catch(15),v.e(k.t1);case 27:return k.prev=27,v.f(),k.finish(27);case 30:i?(t._id=i.id,d.push(t)):p.push(t);case 31:case"end":return k.stop()}}),_loop3,null,[[15,24,27,30]])})),m.s();case 22:if((g=m.n()).done){E.next=29;break}return E.delegateYield(v(),"t0",24);case 24:if("continue"!==E.t0){E.next=27;break}return E.abrupt("continue",27);case 27:E.next=22;break;case 29:E.next=34;break;case 31:E.prev=31,E.t1=E.catch(19),m.e(E.t1);case 34:return E.prev=34,m.f(),E.finish(34);case 37:return E.next=39,Scene.create(p,{dskInit:!0});case 39:_=E.sent,b=initializer_createForOfIteratorHelper(_),E.prev=41,b.s();case 43:if((k=b.n()).done){E.next=53;break}return w=k.value,o.scenes[w.name]=w,E.next=48,w.createThumbnail();case 48:return x=E.sent,E.next=51,w.update({thumb:x.thumb},{diff:!1});case 51:E.next=43;break;case 53:E.next=58;break;case 55:E.prev=55,E.t2=E.catch(41),b.e(E.t2);case 58:return E.prev=58,b.f(),E.finish(58);case 61:O=0,S=d;case 62:if(!(O<S.length)){E.next=71;break}return P=S[O],T=game.scenes.get(P._id),E.next=67,T.update(P);case 67:o.scenes[P.name]=game.scenes.get(P._id);case 68:O++,E.next=62;break;case 71:if(!t.initialScene){E.next=79;break}return I=o.scenes[t.initialScene],E.next=75,game.settings.set("core",NotesLayer.TOGGLE_SETTING,!0);case 75:return E.next=77,I.activate();case 77:return E.next=79,I.update({navigation:!0});case 79:case"end":return E.stop()}}),_callee10,null,[[19,31,34,37],[41,55,58,61]])}))(),"t2",23);case 23:if(!t.actors){_.next=25;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee11(){var a,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C;return initializer_regeneratorRuntime().wrap((function _callee11$(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,o.getFolderForType("Actor");case 2:return a=A.sent,i=game.packs.get(t.actors),A.next=6,i.getDocuments();case 6:if(c=A.sent.map((function(t){return t.toObject()})),u=[],l=[],p=new Map,d=0,!getProperty(r,"chapters")){A.next=50;break}h=initializer_createForOfIteratorHelper(r.chapters),A.prev=13,h.s();case 15:if((y=h.n()).done){A.next=42;break}m=y.value,g=initializer_createForOfIteratorHelper(m.content),A.prev=18,g.s();case 20:if((v=g.n()).done){A.next=32;break}if(!(_=v.value).actors){A.next=30;break}b=!1,k=initializer_createForOfIteratorHelper(_.actors);try{for(k.s();!(w=k.n()).done;)x=w.value,p.has(x)||(p.set(x,_.name),b=!0)}catch(t){k.e(t)}finally{k.f()}if(!b){A.next=30;break}return A.next=29,o.getFolderForType("Actor",a.id,_.name,d);case 29:d+=1;case 30:A.next=20;break;case 32:A.next=37;break;case 34:A.prev=34,A.t0=A.catch(18),g.e(A.t0);case 37:return A.prev=37,g.f(),A.finish(37);case 40:A.next=15;break;case 42:A.next=47;break;case 44:A.prev=44,A.t1=A.catch(13),h.e(A.t1);case 47:return A.prev=47,h.f(),A.finish(47);case 50:O=initializer_createForOfIteratorHelper(c),A.prev=51,P=initializer_regeneratorRuntime().mark((function _loop5(){var t,r,i;return initializer_regeneratorRuntime().wrap((function _loop5$(c){for(;;)switch(c.prev=c.next){case 0:if(t=S.value,!p.has(t.name)){c.next=7;break}return c.next=4,o.getFolderForType("Actor",a.id,p.get(t.name));case 4:c.t0=c.sent,c.next=8;break;case 7:c.t0=a;case 8:if(r=c.t0,t.folder=r.id,t._id&&delete t._id,!(i=game.actors.find((function(o){var i;return o.name==t.name&&[a.id,r.id].includes(null===(i=o.folder)||void 0===i?void 0:i.id)})))){c.next=19;break}return t._id=i.id,c.next=16,i.deleteEmbeddedDocuments("Item",i.items.map((function(t){return t.id})));case 16:l.push(t),c.next=20;break;case 19:u.push(t);case 20:case"end":return c.stop()}}),_loop5)})),O.s();case 54:if((S=O.n()).done){A.next=58;break}return A.delegateYield(P(),"t2",56);case 56:A.next=54;break;case 58:A.next=63;break;case 60:A.prev=60,A.t3=A.catch(51),O.e(A.t3);case 63:return A.prev=63,O.f(),A.finish(63);case 66:return A.next=68,Actor.create(u);case 68:return T=A.sent,A.next=71,Actor.updateDocuments(l);case 71:I=initializer_createForOfIteratorHelper(T);try{for(I.s();!(E=I.n()).done;)C=E.value,o.actors[C.name]=C}catch(t){I.e(t)}finally{I.f()}case 73:case"end":return A.stop()}}),_callee11,null,[[13,44,47,50],[18,34,37,40],[51,60,63,66]])}))(),"t3",25);case 25:case"end":return _.stop()}}),_callee12)})));return function(r){return t.apply(this,arguments)}}());case 29:return this.lock=!1,t.find("i").remove(),ui.notifications.notify(game.i18n.localize("dsk.initComplete")),i.next=34,this.close();case 34:case"end":return i.stop()}}),_callee13,this,[[4,10],[12,17],[19,24]])}))),function initialize(){return c.apply(this,arguments)})},{key:"dontInitialize",value:(i=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee14(){return initializer_regeneratorRuntime().wrap((function _callee14$(t){for(;;)switch(t.prev=t.next){case 0:if(!game.settings.settings.has("".concat(this.module,".initialized"))){t.next=3;break}return t.next=3,game.settings.set(this.module,"initialized",!0);case 3:return ui.notifications.notify(game.i18n.localize("dsk.initSkipped")),t.next=6,this.close();case 6:case"end":return t.stop()}}),_callee14,this)}))),function dontInitialize(){return i.apply(this,arguments)})},{key:"submit",value:function submit(t){try{t.callback&&t.callback(this.options.jQuery?this.element:this.element[0])}catch(t){throw ui.notifications.error(t),new Error(t)}}},{key:"getFolderForType",value:(o=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee15(r){var a,o,i,c,u=arguments;return initializer_regeneratorRuntime().wrap((function _callee15$(l){for(;;)switch(l.prev=l.next){case 0:return a=u.length>1&&void 0!==u[1]?u[1]:null,o=u.length>2&&void 0!==u[2]?u[2]:null,i=u.length>3&&void 0!==u[3]?u[3]:0,c=u.length>4&&void 0!==u[4]?u[4]:"",o||(o=game.i18n.localize("".concat(this.module,".name"))),l.abrupt("return",t.Z.getFolderForType(r,a,o,i,c));case 6:case"end":return l.stop()}}),_callee15,this)}))),function getFolderForType(t){return o.apply(this,arguments)})}]),DSKInitializer}();function roll_memory_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Ue=function(){function RollMemory(){!function roll_memory_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RollMemory),this.tokens={},this.actors={}}return function roll_memory_createClass(t,r,a){return r&&roll_memory_defineProperties(t.prototype,r),a&&roll_memory_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(RollMemory,[{key:"getPath",value:function getPath(t,r,a){var o=a||"",i=r._id||r.type;return t.token?"tokens.".concat(t.token||t.actor,".").concat(i).concat(o):"actors.".concat(t.actor,".").concat(i).concat(o)}},{key:"remember",value:function remember(t,r,a,o){var i=this.formDataSerialize(o);Object.entries(i).length>0&&setProperty(this,this.getPath(t,r,a),i)}},{key:"recall",value:function recall(t,r,a){return getProperty(this,this.getPath(t,r,a))}},{key:"formDataSerialize",value:function formDataSerialize(t){var r=t.find("form"),a={};return r.find("select").each((function(){var t=$(this).attr("name");RollMemory.wantedKeys.includes(t)&&(a[t]=$(this).val())})),r.find('input[type="checkbox"]').each((function(){var t=$(this).attr("name");RollMemory.wantedKeys.includes(t)&&(a[t]=this.checked)})),r.find(".specAbs.active").each((function(){a.specAbs||(a.specAbs=[]),a.specAbs.push({id:$(this).attr("data-id"),step:$(this).attr("data-step")})})),t.find('[name="situationalModifiers"] option').each((function(){a.situationalModifiers||(a.situationalModifiers=[]),a.situationalModifiers.push({name:$(this).text().trim(),selected:this.selected})})),a}}],[{key:"wantedKeys",get:function get(){var t=[];return game.settings.get("dsk","enableDPS")||t.push("distance"),t}}]),RollMemory}(),Ve=__webpack_require__(903);function macroControl_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Je=function(){function MacroDSK(){!function macroControl_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,MacroDSK)}return function macroControl_createClass(t,r,a){return r&&macroControl_defineProperties(t.prototype,r),a&&macroControl_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(MacroDSK,null,[{key:"requestRoll",value:function requestRoll(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Ve.Z.showRQMessage(t,r)}},{key:"rollCh",value:function rollCh(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p.Z.check3D20(void 0,t,r)}},{key:"itemMacroById",value:function itemMacroById(t,r,a,o){var i=game.actors.get(t),c=i?i.items.find((function(t){return t.name===r&&t.type==a})):null;this.runItem(i,c,r,o)}},{key:"itemMacro",value:function itemMacro(t,r,a){var o,i=ChatMessage.getSpeaker();i.token&&(o=game.actors.tokens[i.token]),o||(o=game.actors.get(i.actor));var c=o?o.items.find((function(a){return a.name===t&&a.type==r})):null;this.runItem(o,c,t,a,i.token)}},{key:"runItem",value:function runItem(t,r,a,o,i){if(!t)return ui.notifications.error(game.i18n.format("dsk.DSKError.MacroItemMissing",{item:a}));switch(r.type){case"combatskill":case"trait":case"meleeweapon":return t.setupWeapon(r,o.mod,o,i).then((function(r){t.basicTest(r)}));case"rangeweapon":return t.setupWeapon(r,"attack",o,i).then((function(r){t.basicTest(r)}));case"skill":return t.setupSkill(r,o,i).then((function(r){t.basicTest(r)}));case"ahnengabe":return t.setupSpell(r,o,i).then((function(r){t.basicTest(r)}))}}}]),MacroDSK}();function pause_typeof(t){return pause_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pause_typeof(t)}function pause_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function pause_defineProperties(t,r){for(var a=0;a<r.length;a++){var o=r[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function pause_get(){return pause_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,a){var o=pause_superPropBase(t,r);if(o){var i=Object.getOwnPropertyDescriptor(o,r);return i.get?i.get.call(arguments.length<3?t:a):i.value}},pause_get.apply(this,arguments)}function pause_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=pause_getPrototypeOf(t)););return t}function pause_setPrototypeOf(t,r){return pause_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},pause_setPrototypeOf(t,r)}function pause_createSuper(t){var r=function pause_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var a,o=pause_getPrototypeOf(t);if(r){var i=pause_getPrototypeOf(this).constructor;a=Reflect.construct(o,arguments,i)}else a=o.apply(this,arguments);return pause_possibleConstructorReturn(this,a)}}function pause_possibleConstructorReturn(t,r){if(r&&("object"===pause_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function pause_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function pause_getPrototypeOf(t){return pause_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},pause_getPrototypeOf(t)}var Xe=function(t){!function pause_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&pause_setPrototypeOf(t,r)}(DSKPause,Pause);var r=pause_createSuper(DSKPause);function DSKPause(){return pause_classCallCheck(this,DSKPause),r.apply(this,arguments)}return function pause_createClass(t,r,a){return r&&pause_defineProperties(t.prototype,r),a&&pause_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKPause,null,[{key:"defaultOptions",get:function get(){var t=pause_get(pause_getPrototypeOf(DSKPause),"defaultOptions",this);return t.template="systems/dsk/templates/system/pause.html",t}}]),DSKPause}();Hooks.once("init",(function(){var i,c,l;console.log("Initializing DSK system"),CONFIG.statusEffects=d.Z.statusEffects,game.dsk={apps:(i={DSKUtility:t.Z,DSKInitializer:Ye,DSKChatListeners:p.Z,SpecialabilityRulesDSK:g.Z,AdvantageRulesDSK:m.Z,Migrakel:o,DPS:X.Z,DiceDSK:Fe.Z,DSKStatusEffects:u.Z},c="DSKInitializer",l=Ye,c in i?Object.defineProperty(i,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[c]=l,i),documents:{ActorDSK:r.Z,ItemDSK:a.Z},sheets:{ActorSheetDSK:_,ItemSheetDSK:k,ActorSheetCreature:U,ActorSheetCharacter:Y,ActorSheetNPC:V},config:d.Z,macro:Je,memory:new Ue,itemLibrary:new Be},CONFIG.Actor.documentClass=r.Z,CONFIG.Item.documentClass=a.Z,CONFIG.ActiveEffect.documentClass=Ze.Z,CONFIG.ui.combat=fe,CONFIG.ui.hotbar=qe,CONFIG.ui.pause=Xe,CONFIG.Combat.documentClass=pe,CONFIG.Combatant.documentClass=de,CONFIG.ActiveEffect.documentClass=Ze.Z,CONFIG.ChatMessage.template="systems/dsk/templates/chat/chat-message.html"})),function initHooks(){setupJournal(),function setupHandlebars(){Handlebars.registerHelper({roman:function roman(t,r){return null!=r&&Number(r)<2?"":[" I"," II"," III"," IV"," V"," VI"," VII"," VIII"," IX"," X"][t-1]},itemCategory:function itemCategory(r){return t.Z.categoryLocalization(r)},diceThingsUp:function diceThingsUp(r,a){return t.Z.replaceDies(r,!1)},concat:function concat(){var t;return(t=HandlebarsHelpers).concat.apply(t,arguments).string},replaceConditions:t.Z.replaceConditions,attrLoc:function attrLoc(t,r){return game.i18n.localize("dsk.characteristics.".concat(t,".").concat(r))},floor:function floor(t){return Math.floor(Number(t))},situationalTooltip:function situationalTooltip(t){var r=game.i18n.localize("".concat(Q[t.type]||"dsk.Modifier")),a="".concat(t.name,"<br/>").concat(r,": ").concat(t.value);return t.source&&(a+="<br/>".concat(game.i18n.localize("dsk.source"),": ").concat(t.source)),a}})}(),function setupMacros(){Hooks.on("hotbarDrop",(function(t,r,a){if("Item"==r.type){var o=fromUuidSync(r.uuid);if(!["ahnengabe","meleeweapon","rangeweapon","skill","combatskill","char","trait"].includes(o.type))return;if(!("meleeweapon"!=o.type&&"combatskill"!=o.type||["attack","parry"].includes(r.mod)))return;if(("rangeweapon"==o.type||"trait"==o.type)&&!["attack"].includes(r.mod))return;var i='{mod: "'.concat(r.mod,'"}');return createHotBarMacro(game.user.isGM||null==r.actorId?'game.dsk.macro.itemMacro("'.concat(o.name,'", "').concat(o.type,'", ').concat(i,");"):'game.dsk.macro.itemMacroById("'.concat(r.actorId,'", "').concat(o.name,'", "').concat(o.type,'", ').concat(i,")"),null==r.mod?o.name:"".concat(o.name," - ").concat(game.i18n.localize("dsk.characteristics."+r.mod+".name")),o.img,a)}if("Actor"==r.type||"JournalEntry"==r.type){var c=fromUuidSync(r.uuid);return createHotBarMacro("(await fromUuid('".concat(r.uuid,"')).sheet.render(true)"),c.name,c.img,a)}}))}(),function initSidebar(){Hooks.on("renderSettings",(function(t,r,a){var o=$('<button id="reportADSKBug"><i class="fas fa-bug"></i> '.concat(game.i18n.localize("dsk.DSKError.reportBug"),"</button>"));o.click((function(){window.open("https://github.com/Plushtoast/dsk-foundryVTT/issues","_blank")})),r.find("#settings-documentation").append(o),(o=$('<button class="fshopButton"><div></div> F-Shop</button>')).click((function(){window.open(game.i18n.localize("dsk.fshopLink"),"_blank")})),r.find("#settings-documentation").append(o);var i=game.system.title.split("/")["de"==game.i18n.lang?0:1],c=r.find("#game-details .system span").html();r.find("#game-details .system").html("".concat(i,"<span>").concat(c,"</span>"))})),Hooks.on("renderCompendiumDirectory",(function(t,r,a){var o=$('<button id="openLibrary"><i class="fas fa-university"></i>'.concat(game.i18n.localize("dsk.ItemLibrary"),"</button>")),i=r.find(".header-actions");i.append(o),o.click((function(){game.dsk.itemLibrary.render(!0)}));var c,u="de"==game.i18n.lang?"en":"de",l=sidebar_createForOfIteratorHelper(game.packs.filter((function(t){return getProperty(t.metadata,"flags.dsklang")==u})));try{for(l.s();!(c=l.n()).done;){var p=c.value,d="".concat(p.metadata.packageName,".").concat(p.metadata.name);game.packs.delete(d),r.find('li[data-pack="'.concat(d,'"]')).hide()}}catch(t){l.e(t)}finally{l.f()}var h=$('\n        <div class="header-search flexrow">\n            <i class="fas fa-search"></i>\n            <input type="search" name="search" value="" placeholder="'.concat(game.i18n.localize("dsk.searchCompendium"),'" autocomplete="off">\n            <a></a>\n        </div>'));i.after(h),h.find('[name="search"]').keyup((function(t){var a,o=t.currentTarget.value.toLowerCase(),i=sidebar_createForOfIteratorHelper(r.find(".compendium-pack"));try{for(i.s();!(a=i.n()).done;){var c=a.value,u=$(c).find(".pack-title").text().trim().toLowerCase(),l=$(c).find("footer span:nth-child(2)").text().trim().toLowerCase();c.style.display=!o||u.indexOf(o)>=0||l.indexOf(o)>=0?"block":"none"}}catch(t){i.e(t)}finally{i.f()}}))})),Hooks.on("renderActorDirectory",(function(t,r,a){if(!game.user.isGM){var o,i=sidebar_createForOfIteratorHelper(t.documents.filter((function(t){return t.isMerchant()&&getProperty(t,"system.merchant.hidePlayer")})));try{for(i.s();!(o=i.n()).done;){var c=o.value;r.find('[data-document-id="'.concat(c.id,'"]')).remove()}}catch(t){i.e(t)}finally{i.f()}}}))}(),function initActorHooks(){function checkIniChange(t){if(game.user.isGM&&game.combat&&t.changes.some((function(t){return/(system\.stats\.ini|system\.characteristics.mu|system\.characteristics\.ge)/.test(t.key)}))){var r=t.parent.id,a=game.combat.combatants.find((function(t){return t.actor.id==r}));a&&a.recalcInitiative()}}Hooks.on("deleteActiveEffect",(function(t,r){if(!r.noHook){var a=t.parent;if(a&&"Actor"==a.documentName){var o=getProperty(t,"flags.core.statusId");if("bloodrush"==o)return a.addCondition("stunned",4,!1,!1),!1;if("dead"==o&&game.combat)return a.markDead(!1),!1;if(xe.Z.onEffectRemove(a,t),!1===Hooks.call("deleteActorActiveEffect",a,t))return!1}}})),Hooks.on("updateActor",(function(t,r){!game.user.isGM&&t.limited&&hasProperty(r,"system.merchant.hidePlayer")&&ui.sidebar.render(!0)})),Hooks.on("dropActorSheetData",(function(t,r,a){var o;switch(null===(o=a.data)||void 0===o?void 0:o.type){case"condition":return t.addCondition(a.data.payload.id,1,!1,!1),!1;case"lookup":return r._handleLookup(a.data),!1;case"fullpack":return r._addFullPack(a.data),!1}})),Hooks.on("createActiveEffect",(function(t,r,a){checkIniChange(t)})),Hooks.on("deleteActiveEffect",(function(t,r,a){checkIniChange(t)}));var r=function(){var t=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee(t,r){return actor_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:(game.dsk.apps.AskForNameDialog||Ge).getDialog(t,r);case 2:case"end":return a.stop()}}),_callee)})));return function askForName(r,a){return t.apply(this,arguments)}}(),a=function(){var a=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee2(a,o){var i,c,u,l;return actor_regeneratorRuntime().wrap((function _callee2$(p){for(;;)switch(p.prev=p.next){case 0:if(t.Z.isActiveGM()){p.next=2;break}return p.abrupt("return");case 2:if(!(i=a.actor).hasPlayerOwner){p.next=5;break}return p.abrupt("return");case 5:if(0!=(c=Number(game.settings.get("dsk","obfuscateTokenNames")))&&"loot"!=getProperty(i,"merchant.merchantType")){p.next=8;break}return p.abrupt("return");case 8:if(u=canvas.scene.tokens.filter((function(t){return t.actor&&t.actor.id===i.id})),l=game.i18n.localize("dsk.unknown"),![2,4].includes(c)){p.next=16;break}if(a.id||a._id){p.next=14;break}return p.abrupt("return");case 14:return r(a,c),p.abrupt("return");case 16:u.length>0&&c<3&&(l="".concat(u[0].name.replace(/ \d{1,}$/)," ").concat(u.length+1)),o.name=l;case 18:case"end":return p.stop()}}),_callee2)})));return function obfuscateName(t,r){return a.apply(this,arguments)}}();Hooks.on("preCreateToken",(function(r,o,i,c){var u=r.actor;if(u){var l={};"loot"==getProperty(u,"system.merchant.merchantType")?mergeObject(l,{displayBars:0}):getProperty(u,"system.config.autoBar")&&(mergeObject(l,{bar1:{attribute:"stats.LeP"}}),u.system.isMage?mergeObject(l,{bar2:{attribute:"stats.AeP"}}):mergeObject(l,{bar2:{attribute:"tbd"}})),getProperty(u,"system.config.autoSize")&&t.Z.calcTokenSize(u,l),a(r,l),r.updateSource(l)}})),Hooks.on("createToken",(function(t,r,o){r.noHook||a(t,{})}))}(),function initDSN(){Hooks.once("init",(function(){game.dsk.apps.DiceSoNiceCustomization=new je})),Hooks.once("diceSoNiceReady",(function(t,r,a,o){t.addColorset({name:"mu",description:"DSK.mu",category:"DSK.dies",foreground:"#FFFFFF",background:"#b3241a",edge:"#b3241a",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"kl",description:"DSK.kl",category:"DSK.dies",foreground:"#FFFFFF",background:"#8259a3",edge:"#8259a3",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"in",description:"DSK.in",category:"DSK.dies",foreground:"#FFFFFF",background:"#388834",edge:"#388834",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ch",description:"DSK.ch",category:"DSK.dies",foreground:"#FFFFFF",background:"#0d0d0d",edge:"#0d0d0d",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ff",description:"DSK.ff",category:"DSK.dies",foreground:"#000000",background:"#d5b467",edge:"#d5b467",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ge",description:"DSK.ge",category:"DSK.dies",foreground:"#000000",background:"#688ec4",edge:"#688ec4",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ko",description:"DSK.ko",category:"DSK.dies",foreground:"#000000",background:"#a3a3a3",edge:"#a3a3a3",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"kk",description:"DSK.kk",category:"DSK.dies",foreground:"#000000",background:"#d6a878",edge:"#d6a878",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"attack",description:"DSK.attack",category:"DSK.dies",foreground:"#FFFFFF",background:"#b3241a",edge:"#b3241a",outline:"#b3241a",texture:"none"}),game.dsk.apps.DiceSoNiceCustomization.initConfigs(),je.onConnect()}))}(),function initChatlogHooks(){Hooks.on("renderChatLog",(function(t,r,a){Fe.Z.chatListeners(r),_e.chatListeners(r);var o=new l.Z;Hooks.call("startDSKChatAutoCompletion",o),o.chatListeners(r),p.Z.chatListeners(r)})),Hooks.on("renderChatMessage",(function(r,a,o){if(game.user.isGM)a.find(".chat-button-player").remove();else{var i;a.find(".chat-button-gm").remove();var c=a.find(".chat-button-target");c.length&&(i=ue.getTargetActor(o.message))&&i.actor&&!i.actor.isOwner&&c.remove();var l=t.Z.getSpeaker(o.message.speaker);l&&!l.isOwner&&(a.find(".selfButton").remove(),a.find(".d20").data("tooltip",""));var p=a.find(".onlyTarget");p.length&&(i=t.Z.getSpeaker({token:p.attr("data-token"),actor:p.attr("data-actor"),scene:canvas.scene?canvas.scene.id:null}))&&!i.isOwner&&p.remove(),a.find(".hideData").remove(),getProperty(o.message,"flags.dsk.userHidden.".concat(game.user.id))&&a.find(".payButton").remove()}game.settings.get("dsk","expandChatModifierlist")&&(a.find(".expand-mods i").toggleClass("fa-minus fa-plus"),a.find(".expand-mods + ul").css({display:"block"})),u.Z.bindButtons(a)})),Hooks.on("chatMessage",(function(r,a,o){var i=a.match(/^\/(pay|getPaid|help$|conditions$|tables)/);switch(i=i?i[0]:""){case"/pay":return game.user.isGM?_e.createPayChatMessage(a):_e.payMoney(t.Z.getSpeaker(o.speaker),a),!1;case"/getPaid":return game.user.isGM?_e.createGetPaidChatMessage(a):_e.getMoney(t.Z.getSpeaker(o.speaker),a),!1;case"/help":return p.Z.getHelp(),!1;case"/conditions":return p.Z.showConditions(),!1;case"/tables":return p.Z.showTables(),!1}}))}(),initTokenHook(),function initTokenHUD(){Hooks.on("renderTokenHUD",(function(t,r,a){var o=t.object.actor;o&&game.dsk.apps.LightDialog&&game.dsk.apps.LightDialog.lightHud(r,o,a),r.find('.control-icon[data-action="target"]').mousedown((function(t){2==t.button&&(game.user.updateTokenTargets([]),$(t.currentTarget).click(),t.preventDefault())})),r.find(".attribute input").off("change")}))}(),function initRollsFunction(){Roll.prototype.editRollAtIndex=function(t){var r,a=[],o=dskrolls_createForOfIteratorHelper(t);try{for(o.s();!(r=o.n()).done;){var i,c=r.value,u=c.index,l=c.val,p=0,d=dskrolls_createForOfIteratorHelper(this.terms);try{for(d.s();!(i=d.n()).done;){var h=i.value,y=h instanceof DiceTerm||"DiceTerm"==h.class||h instanceof Die||"Die"==h.class,m=h instanceof OperatorTerm;if(y||h.faces){if(h.results[u-p]){var g=h.results[u-p].result;h.results[u-p].result=l,a.push(g)}y||(h.total=h.results.reduce((function(t,r){return t+r.result}),0)),p+=h.results.length}else m||"OperatorTerm"!=h.class&&!h.operator||(h.total=h.operator)}}catch(t){d.e(t)}finally{d.f()}a.push(0)}}catch(t){o.e(t)}finally{o.f()}return this._total=this._evaluateTotal(),a}}(),(0,Ie.Z)(),function initChatContext(){var a=function fateAvailable(r,a){return t.Z.fateAvailable(r,a)},o=function canHurt(t){var r=game.messages.get(t.attr("data-message-id")).flags.opposeData;return(game.user.isGM&&t.find(".opposed-card").length||t.find(".dice-roll").length)&&(getProperty(r,"damage.value")||0)>0},i=function canHurtSP(t){var r=game.messages.get(t.attr("data-message-id")).flags.opposeData;return(game.user.isGM&&t.find(".opposed-card").length||t.find(".dice-roll").length)&&(getProperty(r,"damage.sp")||0)>0},c=function canCostMana(t){var r=game.messages.get(t.attr("data-message-id"));return!(!r.speaker.actor||!r.flags.data||!game.actors.get(r.speaker.actor).isOwner&&!game.user.isGM)&&(["ahnengabe"].includes(r.flags.data.preData.source.type)||getProperty(r.flags.data.preData,"calculatedSpellModifiers.costsMana"))},u=function canUnhideData(t){if(game.user.isGM&&game.settings.get("dsk","hideOpposedDamage")){var r=game.messages.get(t.attr("data-message-id"));return"hideData"in r.flags&&r.flags.hideData}return!1},l=function canHideData(t){if(game.user.isGM&&game.settings.get("dsk","hideOpposedDamage")){var r=game.messages.get(t.attr("data-message-id"));return"hideData"in r.flags&&!r.flags.hideData}return!1},p=function isTalented(t){var r=game.messages.get(t.attr("data-message-id"));if(r.speaker.actor&&r.flags.data){var a=game.actors.get(r.speaker.actor);if(a.isOwner)return null!=a.items.find((function(t){return t.name=="".concat(game.i18n.localize("dsk.LocalizedIDs.aptitude")," (").concat(r.flags.data.preData.source.name,")")}))&&!r.flags.data.talentedRerollUsed}return!1},d=function canRerollDamage(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=game.messages.get(t.attr("data-message-id"));if(o.speaker.actor&&o.flags.data){var i=game.actors.get(o.speaker.actor);if(i.isOwner&&a(i,r))return null!=o.flags.data.postData.damageRoll&&!o.flags.data.fatePointDamageRerollUsed}return!1},h=function canReroll(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=game.messages.get(t.attr("data-message-id"));if(o.speaker.actor&&o.flags.data){var i=game.actors.get(o.speaker.actor);if(i.isOwner&&a(i,r))return!(o.flags.data.fatePointRerollUsed||"regenerate"==o.flags.data.postData.rollType)}return!1},y=function canHeal(t){var r=game.messages.get(t.attr("data-message-id"));return!!(r.speaker.actor&&r.flags.data&&game.actors.get(r.speaker.actor).isOwner&&["LeP","AeP"].some((function(t){return null!=getProperty(r.flags,"data.postData.".concat(t))})))&&!r.flags.data.healApplied},m=function showHideData(t){if(game.user.isGM){var r=game.messages.get(t.attr("data-message-id"));if("hideData"in r.flags){var a=!r.flags.hideData,o=$(r.content);o.find(".hideAnchor")[a?"addClass":"removeClass"]("hideData"),o=$("<div></div>").append(o),r.update({content:o.html(),"flags.hideData":a})}}},g=function canApplyDefaultRolls(t){var r=game.messages.get(t.data("messageId"));return!(!r||!canvas.tokens)&&r.isRoll&&r.isContentVisible&&canvas.tokens.controlled.length&&t.find(".dice-roll").length},v=function useFate(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=game.messages.get(t.attr("data-message-id"));game.actors.get(o.speaker.actor).useFateOnRoll(o,r,a)},_=function(){var r=chat_context_asyncToGenerator(chat_context_regeneratorRuntime().mark((function _callee(r,a){var o,i,c,u;return chat_context_regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:if(o=game.messages.get(r.attr("data-message-id")),i=o.flags.opposeData,c=i.speakerDefend.speaker,(u=t.Z.getSpeaker(c)).isOwner){l.next=6;break}return l.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.DamagePermission")));case 6:return l.next=8,u.applyDamage(i.damage[a]);case 8:return l.next=10,o.update({"flags.data.damageApplied":!0,content:o.content.replace(/hideAnchor">/,'hideAnchor"><i class="fas fa-check" style="float:right" data-tooltip="'.concat(game.i18n.localize("damageApplied"),'"></i>'))});case 10:case"end":return l.stop()}}),_callee)})));return function applyDamage(t,a){return r.apply(this,arguments)}}(),b=function applyChatCardDamage(t,a){var o=game.messages.get(t.data("messageId")).rolls[0];return Promise.all(canvas.tokens.controlled.map((function(t){var i=t.actor,c="sp"!=a?o.total-r.Z.armorValue(i).armor:o.total;return i.applyDamage(Math.max(0,c))})))},k=function(){var r=chat_context_asyncToGenerator(chat_context_regeneratorRuntime().mark((function _callee2(r){var a,o,i,c;return chat_context_regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:if(a=game.messages.get(r.attr("data-message-id")),o=a.flags.data,(i=t.Z.getSpeaker(a.speaker)).isOwner){u.next=5;break}return u.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.DamagePermission")));case 5:return c=["ritual","spell"].includes(o.preData.source.type)||getProperty(o.preData.calculatedSpellModifiers,"costsMana")?"AeP":"KaP",u.next=8,i.applyMana(o.preData.calculatedSpellModifiers.finalcost,c);case 8:return u.sent,u.next=11,a.update({"flags.data.manaApplied":!0,content:a.content.replace(/<span class="costCheck">/,'<span class="costCheck"><i class="fas fa-check" style="float:right"></i>')});case 11:case"end":return u.stop()}}),_callee2)})));return function payMana(t){return r.apply(this,arguments)}}();Hooks.on("getChatLogEntryContext",(function(r,a){var w,x;a.push({name:game.i18n.localize("dsk.CHATCONTEXT.hideData"),icon:'<i class="fas fa-eye"></i>',condition:l,callback:function callback(t){m(t)}},{name:game.i18n.localize("dsk.CHATCONTEXT.showData"),icon:'<i class="fas fa-eye"></i>',condition:u,callback:function callback(t){m(t)}},{name:game.i18n.localize("dsk.regenerate"),icon:'<i class="fas fa-user-plus"></i>',condition:y,callback:(x=chat_context_asyncToGenerator(chat_context_regeneratorRuntime().mark((function _callee3(r){var a,o;return chat_context_regeneratorRuntime().wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,game.messages.get(r.attr("data-message-id"));case 2:if(a=i.sent,(o=t.Z.getSpeaker(a.speaker)).isOwner){i.next=6;break}return i.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.DamagePermission")));case 6:return i.next=8,a.update({"flags.data.healApplied":!0,content:a.content.replace(/<\/div>$/,'<i class="fas fa-check" style="float:right"></i></div>')});case 8:return i.next=10,o.applyRegeneration(a.flags.data.postData.LeP,a.flags.data.postData.AeP,a.flags.data.postData.KaP);case 10:case"end":return i.stop()}}),_callee3)}))),function callback(t){return x.apply(this,arguments)})},{name:game.i18n.localize("dsk.CHATCONTEXT.ApplyMana"),icon:'<i class="fas fa-user-minus"></i>',condition:c,callback:(w=chat_context_asyncToGenerator(chat_context_regeneratorRuntime().mark((function _callee4(t){return chat_context_regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:k(t);case 1:case"end":return r.stop()}}),_callee4)}))),function callback(t){return w.apply(this,arguments)})},{name:game.i18n.localize("dsk.CHATCONTEXT.ApplyDamage"),icon:'<i class="fas fa-user-minus"></i>',condition:o,callback:function callback(t){_(t,"value")}},{name:game.i18n.localize("dsk.CHATCONTEXT.ApplyDamageSP"),icon:'<i class="fas fa-user-minus"></i>',condition:i,callback:function callback(t){_(t,"sp")}},{name:game.i18n.localize("dsk.CHATCONTEXT.ApplyDamage"),icon:'<i class="fas fa-user-minus"></i>',condition:g,callback:function callback(t){b(t,"value")}},{name:game.i18n.localize("dsk.CHATCONTEXT.ApplyDamageSP"),icon:'<i class="fas fa-user-minus"></i>',condition:g,callback:function callback(t){b(t,"sp")}},{name:game.i18n.localize("dsk.CHATCONTEXT.Reroll"),icon:'<i class="fas fa-dice"></i>',condition:h,callback:function callback(t){v(t,"reroll")}},{name:game.i18n.localize("dsk.CHATCONTEXT.talentedReroll"),icon:'<i class="fas fa-dice"></i>',condition:p,callback:function callback(t){v(t,"isTalented")}},{name:game.i18n.localize("dsk.CHATCONTEXT.rerollDamage"),icon:'<i class="fas fa-dice"></i>',condition:d,callback:function callback(t){v(t,"rerollDamage")}})}))}(),Hooks.once("init",(function(){loadTemplates(["systems/dsk/templates/items/item-equipment.html","systems/dsk/templates/items/item-header.html","systems/dsk/templates/items/item-description.html","systems/dsk/templates/items/item-effects.html","systems/dsk/templates/items/item-stat.html","systems/dsk/templates/actors/parts/healthbar.html","systems/dsk/templates/actors/actor-talents.html","systems/dsk/templates/actors/actor-combat.html","systems/dsk/templates/actors/actor-equipment.html","systems/dsk/templates/actors/parts/gearSearch.html","systems/dsk/templates/actors/parts/purse.html","systems/dsk/templates/actors/parts/characteristics-small.html","systems/dsk/templates/actors/parts/status_effects.html","systems/dsk/templates/actors/parts/containerContent.html","systems/dsk/templates/actors/actor-notes.html","systems/dsk/templates/actors/creature/creature-combat.html","systems/dsk/templates/actors/creature/creature-main.html","systems/dsk/templates/actors/creature/creature-magic.html","systems/dsk/templates/status/advanced_functions.html","systems/dsk/templates/actors/creature/creature-loot.html","systems/dsk/templates/dialog/default-dialog.html","systems/dsk/templates/actors/character/actor-magic.html","systems/dsk/templates/actors/parts/characteristics-large.html","systems/dsk/templates/actors/npc/npc-main.html","systems/dsk/templates/actors/parts/rollhead.html","systems/dsk/templates/actors/actor-main.html","systems/dsk/templates/chat/roll/test-card.html","systems/dsk/templates/dialog/parts/targets.html","systems/dsk/templates/dialog/default-combat-dialog.html","systems/dsk/templates/actors/creature/creature-notes.html","systems/dsk/templates/dialog/enhanced-default-dialog.html","systems/dsk/templates/actors/parts/information.html","systems/dsk/templates/actors/merchant/merchant-commerce.html","systems/dsk/templates/actors/parts/normalhead.html"])})),Actors.unregisterSheet("core",ActorSheet),Actors.registerSheet("dsk",Y,{types:["character"],makeDefault:!0}),Actors.registerSheet("dsk",U,{types:["creature"],makeDefault:!0}),Actors.registerSheet("dsk",V,{types:["npc"],makeDefault:!0}),Actors.registerSheet("dsk",we,{types:["npc"]}),Actors.registerSheet("dsk",ze,{types:["creature"]}),Actors.registerSheet("dsk",Ne,{types:["character"]}),DocumentSheetConfig.registerSheet(ActiveEffect,"dsk",xe.Z,{makeDefault:!0}),Journal.registerSheet("dsk",J,{makeDefault:!0}),k.setupSheets(),function initReady(){Hooks.once("ready",ready_asyncToGenerator(ready_regeneratorRuntime().mark((function _callee(){return ready_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return game.socket.on("system.dsk",(function(t){if("hideDeletedSheet"===t.type){var r=t.payload.target.token?game.actors.tokens[t.payload.target.token]:game.actors.get(t.payload.target.actor);we.hideDeletedSheet(r)}})),game.user.isGM&&game.socket.on("system.dsk",(function(t){switch(t.type){case"target":var r=game.scenes.get(t.payload.scene);new Token(r.getEmbeddedDocument("Token",t.payload.target)).actor.update({"flags.oppose":t.payload.opposeFlag});break;case"addEffect":xe.Z.applyEffect(t.payload.id,t.payload.mode,t.payload.actors);break;case"hideQueryButton":se.Z.hideReactionButton(t.payload.id);break;case"updateDefenseCount":case"updateDefenseCount":game.combat&&game.combat.updateDefenseCount(t.payload.speaker);break;case"updateMsg":game.messages.get(t.payload.id).update(t.payload.updateData);break;case"deleteMsg":game.messages.get(t.payload.id).delete();break;case"showDamage":se.Z.showDamage(game.messages.get(t.payload.id),t.payload.hide);break;case"clearCombat":game.combat&&game.combat.nextRound();break;case"trade":var a=t.payload.source.token?game.actors.tokens[t.payload.source.token]:game.actors.get(t.payload.source.actor),o=t.payload.target.token?game.actors.tokens[t.payload.target.token]:game.actors.get(t.payload.target.actor);we.finishTransaction(a,o,t.payload.price,t.payload.itemId,t.payload.buy,t.payload.amount);break;case"playWhisperSound":t.payload.whisper.includes(game.user.id)&&AudioHelper.play({src:t.payload.soundPath,volume:.8,loop:!1},!1);break;case"socketedConditionAddActor":fromUuid(t.payload.id).then((function(r){new me.Z(r).socketedConditionAddActor(t.payload.actors.map((function(t){return game.actors.get(t)})),t.payload.data)}));break;case"socketedConditionAdd":fromUuid(t.payload.id).then((function(r){new me.Z(r).socketedConditionAdd(t.payload.targets,t.payload.data)}));break;case"socketedRemoveCondition":fromUuid(t.payload.id).then((function(r){new me.Z(r).socketedRemoveCondition(t.payload.targets,t.payload.coreId)}));break;case"socketedActorTransformation":fromUuid(t.payload.id).then((function(r){new me.Z(r).socketedActorTransformation(t.payload.targets,t.payload.update)}));break;case"itemDrop":var i=t.payload.sourceActorId?game.actors.get(t.payload.sourceActorId):void 0;fromUuid(t.payload.itemId).then((function(r){re(i,r,t.payload.data,t.payload.amount)}));break;default:console.warn("Unhandled socket data type ".concat(t.type))}})),r.next=4,te.firstTimeMessage();case 4:if(ee.showOneMessage(),r.t1=t.Z.moduleEnabled("vtta-tokenizer"),!r.t1){r.next=10;break}return r.next=9,game.settings.get("dsk","tokenizerSetup");case 9:r.t1=!r.sent;case 10:if(r.t0=r.t1,!r.t0){r.next=13;break}r.t0=game.user.isGM;case 13:if(!r.t0){r.next=22;break}return r.next=16,game.settings.set("vtta-tokenizer","default-frame-pc","[data] systems/dsk/icons/backgrounds/token_green.webp");case 16:return r.next=18,game.settings.set("vtta-tokenizer","default-frame-npc","[data] systems/dsk/icons/backgrounds/token_black.webp");case 18:return r.next=20,game.settings.set("vtta-tokenizer","default-frame-neutral","[data] systems/dsk/icons/backgrounds/token_blue.webp");case 20:return r.next=22,game.settings.set("dsk","tokenizerSetup",!0);case 22:if(r.t3=t.Z.moduleEnabled("dice-so-nice"),!r.t3){r.next=27;break}return r.next=26,game.settings.get("dsk","diceSetup");case 26:r.t3=!r.sent;case 27:if(r.t2=r.t3,!r.t2){r.next=30;break}r.t2=game.user.isGM;case 30:if(!r.t2){r.next=35;break}return r.next=33,game.settings.set("dice-so-nice","immediatelyDisplayChatMessages",!0);case 33:return r.next=35,game.settings.set("dsk","diceSetup",!0);case 35:a.Z.setupSubClasses(),ye.connectHooks(),oe(),ge.registerTokenHotbar(),(0,Oe.Y)(),(0,ce.v)();case 41:case"end":return r.stop()}}),_callee)}))))}(),initSetup(),X.Z.initDoorMinDistance()}()})()})();