/*! For license information please see dsk.bundle.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={231:(t,r,o)=>{o.d(r,{Z:()=>g});var a=o(140),i=o(973),c=o(278),u=o(930),l=o(614),p=(o(608),o(832)),d=o(122),h=o(707),y=o(448),m=o(514);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==o)return;var a,i,c=[],u=!0,l=!1;try{for(o=o.call(t);!(u=(a=o.next()).done)&&(c.push(a.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==o.return||o.return()}finally{if(l)throw i}}return c}(t,r)||_unsupportedIterableToArray(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var g=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(ActorDSK,Actor);var r,o,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A=_createSuper(ActorDSK);function ActorDSK(){return _classCallCheck(this,ActorDSK),A.apply(this,arguments)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorDSK,[{key:"prepareDerivedData",value:function prepareDerivedData(){var t=this.system;try{t.canAdvance="character"==this.type;for(var r=0,o=Object.values(t.characteristics);r<o.length;r++){var a=o[r];a.value=a.initial+a.advances+(a.modifier||0)+a.gearmodifier,a.cost=game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(a.initial+a.advances,"Eig")}),a.refund=game.i18n.format("dsk.refundCost",{cost:p.Z._calculateAdvCost(a.initial+a.advances,"Eig",0)})}t.isMage=this.items.some((function(t){return["ahnengeschenk","ahnengabe"].includes(t.type)||"specialability"==t.type&&["ahnen"].includes(t.system.category)})),t.canAdvance&&(t.details.experience.current=t.details.experience.total-t.details.experience.spent),"character"!=this.type&&"npc"!=this.type||(t.stats.LeP.current=t.stats.LeP.initial+2*t.characteristics.ko.value,t.stats.AeP.current=t.guidevalue&&"-"!=t.guidevalue?ActorDSK._attrFromCharacteristic(t.guidevalue,t):0,t.stats.sk.value=(t.stats.sk.initial||0)+Math.round((t.characteristics.mu.value+t.characteristics.kl.value+t.characteristics.in.value)/3)-10,t.stats.zk.value=(t.stats.zk.initial||0)+Math.round((t.characteristics.ko.value+t.characteristics.ko.value+t.characteristics.kk.value)/3)-10,t.stats.ini.value=Math.round((t.characteristics.mu.value+t.characteristics.ge.value)/2)+(t.stats.ini.modifier||0)),"creature"==this.type&&(t.stats.LeP.current=t.stats.LeP.initial,t.stats.AeP.current=t.stats.AeP.initial,t.stats.ini.value=t.stats.ini.current+(t.stats.ini.modifier||0)),t.stats.schips.max=Number(t.stats.schips.current)+Number(t.stats.schips.modifier)+t.stats.schips.gearmodifier,t.stats.regeneration.LePmax=t.stats.regeneration.LePTemp+t.stats.regeneration.LePMod+t.stats.regeneration.LePgearmodifier,t.stats.regeneration.AePmax=t.stats.regeneration.AePTemp+t.stats.regeneration.AePMod+t.stats.regeneration.AePgearmodifier,t.stats.LeP.max=Math.round((t.stats.LeP.current+t.stats.LeP.modifier+t.stats.LeP.advances)*t.stats.LeP.multiplier+t.stats.LeP.gearmodifier),t.stats.AeP.max=t.stats.AeP.current+t.stats.AeP.modifier+t.stats.AeP.advances+t.stats.AeP.gearmodifier,t.stats.gs.max=t.stats.gs.initial+(t.stats.gs.modifier||0)+t.stats.gs.gearmodifier,t.stats.sk.max=t.stats.sk.value+t.stats.sk.modifier+t.stats.sk.gearmodifier,t.stats.zk.max=t.stats.zk.value+t.stats.zk.modifier+t.stats.zk.gearmodifier;t.stats.ini.value+=t.stats.ini.gearmodifier-Math.min(4,0);var i=Number((.01*t.stats.ini.value).toFixed(2));t.stats.ini.value*=t.stats.ini.multiplier||1,t.stats.ini.value=Math.round(t.stats.ini.value)+i,p.Z.isActiveGM()&&this.isMerchant()&&this.prepareMerchant(),t.maxDefense=this.maxDefenseValue()}catch(t){console.error("Something went wrong with preparing actor data: "+t+t.stack),ui.notifications.error(game.i18n.format("dsk.DSKError.PreparationError",{name:this.name})+t+t.stack)}}},{key:"prepareMerchant",value:(C=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if("loot"!=getProperty(this,"system.merchant.merchantType")){r.next=11;break}if(!getProperty(this,"system.merchant.locked")||this.hasCondition("locked")){r.next=6;break}return r.next=4,this.addCondition(ActorDSK.lockedCondition());case 4:r.next=11;break;case 6:if(getProperty(this,"system.merchant.locked")){r.next=11;break}if(!(t=this.effects.find((function(t){return"locked"==getProperty(t,"flags.core.statusId")})))){r.next=11;break}return r.next=11,this.deleteEmbeddedDocuments("ActiveEffect",[t.id]);case 11:case"end":return r.stop()}}),_callee,this)}))),function prepareMerchant(){return C.apply(this,arguments)})},{key:"isMerchant",value:function isMerchant(){return["merchant","loot"].includes(getProperty(this,"system.merchant.merchantType"))}},{key:"applyActiveEffects",value:function applyActiveEffects(){var t=this,r={},o=this.effects.reduce((function(r,o){if(o.disabled)return r;var a=1;if(o.origin){var i=o.origin.match(/[^.]+$/)[0],c=t.items.get(i);if(c){var u=!0;switch(c.type){case"meleeweapon":case"rangeweapon":case"armor":u=c.system.worn.value;break;case"equipment":u=!c.system.worn.wearable||c.system.worn.wearable&&c.system.worn.value;break;case"trait":u=!["meleeAttack","rangeAttack"].includes(c.system.traitType);break;case"ammunition":case"combatskill":case"poison":case"ahnengabe":case"ahnengeschenk":u=!1;break;case"specialability":u="combat"!=c.system.category||[2,3].includes(c.system.subcategory),a=Number(c.system.level)||1;break;case"advantage":case"disadvantage":a=Number(c.system.level)||1}if(o.notApplicable=!u,!u)return r}}for(var l=0;l<a;l++)r.push.apply(r,_toConsumableArray(o.changes.map((function(t){return(t=foundry.utils.duplicate(t)).effect=o,t.priority=t.priority?t.priority:10*t.mode,t}))));return r}),[]);o.sort((function(t,r){return t.priority-r.priority}));var a,i=_createForOfIteratorHelper(o);try{for(i.s();!(a=i.n()).done;){var c=a.value,u=c.effect.apply(this,c);null!==u&&(r[c.key]=u)}}catch(t){i.e(t)}finally{i.f()}this.overrides=foundry.utils.expandObject(r)}},{key:"maxDefenseValue",value:function maxDefenseValue(){var t,r=this,o=[0],a=[],i=[],c=_createForOfIteratorHelper(this.items);try{for(c.s();!(t=c.n()).done;){var u=t.value;"combatskill"==u.type?a.push(ActorDSK._calculateCombatSkillValues(u,this.system)):"meleeweapon"==u.type?getProperty(u,"system.worn.value")&&i.push(u):"trait"==u.type&&"meleeAttack"==u.system.traitType&&o.push(ActorDSK._prepareMeleetrait(u).parry)}}catch(t){c.e(t)}finally{c.f()}for(var l=function _loop(){var t=h[p],c=ActorDSK._prepareMeleeWeapon(t,a,r,i.filter((function(r){return r._id!=t._id&&!d.Z.isYieldedTwohanded(r)})));o.push(c.parry)},p=0,h=i;p<h.length;p++)l();return Math.max.apply(Math,o)}},{key:"prepareBaseData",value:function prepareBaseData(){var t=this.system;mergeObject(t,{skillModifiers:_objectSpread({FP:[],step:[],QL:[],TPM:[],FW:[],botch:20,crit:1,global:[],conditional:{AePCost:[]},feature:{FP:[],step:[],QL:[],TPM:[],FW:[],AePCost:[]}},["ahnengabe","skill"].reduce((function(t,r){return t[r]={FP:[],step:[],QL:[],TPM:[],FW:[]},t}),{})),repeatingEffects:{startOfRound:{LeP:[],AeP:[]}},aepModifier:0,creatureBonus:[],stats:{initiative:{multiplier:1},LeP:{multiplier:1},regeneration:{LePgearmodifier:0,AePgearmodifier:0}},status:{encumbered:0,stunned:0,feared:0,inpain:0,selfconfidence:0},spellStats:{damage:"0"},meleeStats:{parry:0,attack:0,damage:"0",defenseMalus:0,botch:20,crit:1},rangeStats:{attack:0,damage:"0",defenseMalus:0,botch:20,crit:1},totalArmor:0,carryModifier:0});for(var r=0,o=Object.values(t.stats);r<o.length;r++){o[r].gearmodifier=0}for(var a=0,i=Object.values(t.characteristics);a<i.length;a++){i[a].gearmodifier=0}}},{key:"prepareSheet",value:function prepareSheet(t){var r=duplicate(this),o={system:{}};if(mergeObject(o,this.prepareItems(t)),o.canAdvance)for(var a=0,i=["LeP","AeP"];a<i.length;a++){var c=i[a];mergeObject(o.system,{stats:_defineProperty({},c,{cost:game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(r.system.stats[c].advances,"D")}),refund:game.i18n.format("dsk.refundCost",{cost:p.Z._calculateAdvCost(r.system.stats[c].advances,"D",0)})})})}return o}},{key:"_perpareItemAdvancementCost",value:function _perpareItemAdvancementCost(t){return t.cost=game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(t.system.level,t.system.StF)}),t.refund=game.i18n.format("dsk.refundCost",{cost:p.Z._calculateAdvCost(t.system.level,t.system.StF,0)}),t.canAdvance=this.system.canAdvance,t}},{key:"_setOnUseEffect",value:function _setOnUseEffect(t){getProperty(t,"flags.dsk.onUseEffect")&&(t.OnUseEffect=!0)}},{key:"prepareItems",value:function prepareItems(t){var r=this,o=this.toObject(!1),a=[],i=[],c=[],l=[],p=[],h=[],y=[],m=[],g=[],v=[],_=Object.fromEntries(Object.keys(u.Z.specialAbilityCategories).map((function(t){return[t,[]]}))),b=Object.fromEntries(Object.keys(u.Z.traitCategories).map((function(t){return[t,[]]}))),k={hasSpells:this.system.isMage,ahnengabe:[],ahnengeschenk:[]},w={body:[],social:[],knowledge:[],trade:[]},x={meleeweapons:{items:[],show:!1,dataType:"meleeweapon"},rangeweapons:{items:[],show:!1,dataType:"rangeweapon"},armor:{items:[],show:!1,dataType:"armor"},ammunition:{items:[],show:!1,dataType:"ammunition"},poison:{items:[],show:!1,dataType:"poison"}};for(var O in u.Z.equipmentTypes)x[O]={items:[],show:!1,dataType:O};x.misc.show=!0;for(var S=1;S<=Number(o.system.stats.schips.max);S++)v.push({value:S,cssClass:S<=Number(o.system.stats.schips.value)?"fullSchip":"emptySchip"});var P,T=new Map,I=_createForOfIteratorHelper(o.items.filter((function(t){return"equipment"==t.type&&"bags"==t.system.category})));try{for(I.s();!(P=I.n()).done;){var E=P.value;T.set(E._id,[])}}catch(t){I.e(t)}finally{I.f()}o.items=o.items.sort((function(t,r){return t.name.localeCompare(r.name)}));var C,A=o.system.totalArmor||0,R=0,G=!1,L=_createForOfIteratorHelper(this.items);try{for(L.s();!(C=L.n()).done;){var D=C.value;try{var j=getProperty(D,"system.parent_id");if("ammunition"==D.type&&g.push(ActorDSK._prepareitemStructure(D)),j&&j!=D._id&&T.has(j)){T.get(j).push(D);continue}switch(t.details&&t.details.includes(D._id)&&(D.detailed="shown"),D.type){case"skill":w[D.system.group].push(ActorDSK._calculatePW(this._perpareItemAdvancementCost(D,o.system),o.system));break;case"information":l.push(D);break;case"ahnengabe":k[D.type].push(ActorDSK._calculatePW(this._perpareItemAdvancementCost(D),o.system));break;case"ahnengeschenk":k[D.type].push(D);break;case"combatskill":a.push(ActorDSK._calculateCombatSkillValues(this._perpareItemAdvancementCost(D,o.system),o.system));break;case"ammunition":D.weight=parseFloat((D.system.weight*D.system.quantity).toFixed(3)),x.ammunition.items.push(ActorDSK.prepareMag(D)),x.ammunition.show=!0,R+=Number(D.weight);break;case"meleeweapon":D.weight=parseFloat((D.system.weight*D.system.quantity).toFixed(3)),D.toggleValue=getProperty(D.system,"worn.value")||!1,D.toggle=!0,this._setOnUseEffect(D),D.system.notInInventory||(x.meleeweapons.items.push(ActorDSK._prepareitemStructure(D)),x.meleeweapons.show=!0),D.toggleValue&&m.push(D),R+=Number(D.weight);break;case"rangeweapon":D.weight=parseFloat((D.system.weight*D.system.quantity).toFixed(3)),D.toggleValue=getProperty(D.system,"worn.value")||!1,D.toggle=!0,this._setOnUseEffect(D),x.rangeweapons.items.push(ActorDSK._prepareitemStructure(D)),x.rangeweapons.show=!0,R+=Number(D.weight);break;case"armor":D.toggleValue=getProperty(D.system,"worn.value")||!1,x.armor.items.push(ActorDSK._prepareitemStructure(D)),x.armor.show=!0,D.toggle=!0,this._setOnUseEffect(D),D.weight=parseFloat((D.system.weight*D.system.quantity).toFixed(3)),R+=parseFloat((D.system.weight*(D.toggleValue?Math.max(0,D.system.quantity-1):D.system.quantity.value)).toFixed(3)),D.system.worn.value&&(A+=Number(D.system.rs),p.push(D));break;case"trait":switch(D.system.traitType){case"rangeAttack":D=ActorDSK._prepareRangeTrait(D);break;case"meleeAttack":D=ActorDSK._prepareMeleetrait(D);break;case"armor":A+=Number(D.system.at)}b[D.system.traitType].push(D),G=!0;break;case"poison":D.weight=parseFloat((D.system.weight*D.system.quantity).toFixed(3)),x.poison.items.push(D),x.poison.show=!0,R+=Number(D.weight);break;case"equipment":D.weight=parseFloat((D.system.weight*D.system.quantity).toFixed(3)),D.toggle=getProperty(D,"system.worn.wearable")||!1,D.toggle&&(D.toggleValue=getProperty(D.system,"worn.value")||!1),this._setOnUseEffect(D),x[D.system.category].items.push(ActorDSK._prepareitemStructure(D)),x[D.system.category].show=!0,R+=Number(D.weight);break;case"advantage":this._setOnUseEffect(D),i.push(D);break;case"disadvantage":this._setOnUseEffect(D),c.push(D);break;case"specialability":this._setOnUseEffect(D),_[D.system.category].push(D)}}catch(t){this._itemPreparationError(D,t)}}}catch(t){L.e(t)}finally{L.f()}var M,z=_createForOfIteratorHelper(x.bags.items);try{for(z.s();!(M=z.n()).done;){var N=M.value;R+=this._setBagContent(N,T)}}catch(t){z.e(t)}finally{z.f()}var $,H=_createForOfIteratorHelper(x.rangeweapons.items);try{for(H.s();!($=H.n()).done;){var K=$.value;try{K.system.worn.value&&h.push(ActorDSK._prepareRangeWeapon(K,g,a,this))}catch(t){this._itemPreparationError(K,t)}}}catch(t){H.e(t)}finally{H.f()}for(var W=function _loop2(){var t=Z[B];try{y.push(ActorDSK._prepareMeleeWeapon(t,a,o,m.filter((function(r){return r._id!=t._id&&!d.Z.isYieldedTwohanded(r)}))))}catch(o){r._itemPreparationError(t,o)}},B=0,Z=m;B<Z.length;B++)W();var q=2*o.system.characteristics.kk.value+o.system.carryModifier;R=parseFloat(R.toFixed(3));var Y=duplicate(u.Z.characteristics);return Y["-"]="-",{totalWeight:R,armorSum:A,carrycapacity:q,wornRangedWeapons:h,guidevalues:Y,wornMeleeWeapons:y,advantages:i,disadvantages:c,specAbs:_,information:l,combatskills:a,hasTrait:G,traits:b,wornArmor:p,inventory:x,canAdvance:this.system.canAdvance,sheetLocked:o.system.sheetLocked,magic:k,allSkillsLeft:{body:w.body,social:w.social},allSkillsRight:{knowledge:w.knowledge,trade:w.trade},schips:v}}},{key:"setupWeapon",value:function setupWeapon(t,r,o,i){return o.mode=r,a.Z.getSubClass(t.type).setupDialog(null,o,t,this,i)}},{key:"setupSpell",value:function setupSpell(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return a.Z.getSubClass(t.type).setupDialog(null,r,t,this,o)}},{key:"checkEnoughXP",value:(E=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var r,o,a,i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:if(this.system.canAdvance){u.next=2;break}return u.abrupt("return",!0);case 2:if(!isNaN(t)&&null!=t){u.next=4;break}return u.abrupt("return",!0);case 4:if(!(Number(this.system.details.experience.total)-Number(this.system.details.experience.spent)>=t)){u.next=8;break}return u.abrupt("return",!0);case 8:if(!Number(0==this.system.details.experience.total)){u.next=22;break}return r="<p>".concat(game.i18n.localize("dsk.DSKError.zeroXP"),"</p><label>").concat(game.i18n.localize("dsk.APValue"),': </label><input type="number" name="APsel" value="150"/>'),o=0,a=!1,u.next=14,new Promise((function(t,o){new Dialog({title:game.i18n.localize("dsk.DSKError.NotEnoughXP"),content:r,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(r){t([!0,r.find('[name="APsel"]')[0].value])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){t([!1,0])}}}}).render(!0)}));case 14:if(i=u.sent,c=_slicedToArray(i,2),a=c[0],o=c[1],!a){u.next=22;break}return u.next=21,this.update({"system.details.experience.total":Number(o)});case 21:return u.abrupt("return",!0);case 22:return ui.notifications.error(game.i18n.localize("dsk.DSKError.NotEnoughXP")),u.abrupt("return",!1);case 24:case"end":return u.stop()}}),_callee2,this)}))),function checkEnoughXP(t){return E.apply(this,arguments)})},{key:"getSkillModifier",value:function getSkillModifier(t,r){for(var o=this,a=[],i=function _loop3(){var i=u[c],l="step"==i?"":i;a.push.apply(a,_toConsumableArray(o.system.skillModifiers[i].filter((function(r){return r.target==t})).map((function(t){return{name:t.source,value:t.value,type:l}})))),o.system.skillModifiers[r]&&a.push.apply(a,_toConsumableArray(o.system.skillModifiers[r][i].map((function(t){return{name:t.source,value:t.value,type:l}}))))},c=0,u=["FP","step","QL","TPM","FW"];c<u.length;c++)i();return a}},{key:"setupSkill",value:function setupSkill(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return a.Z.getSubClass(t.type).setupDialog(null,r,t,this,o)}},{key:"_updateAPs",value:(I=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r,o,a,i=arguments;return _regeneratorRuntime().wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},!this.system.canAdvance){c.next=12;break}if(isNaN(t)||null==t){c.next=11;break}return o=Number(t),r["system.details.experience.spent"]=Number(this.system.details.experience.spent)+o,c.next=7,this.update(r);case 7:a=game.i18n.format(o>0?"dsk.advancementCost":"dsk.refundCost",{cost:Math.abs(o)}),(0,h.p0)(a),c.next=12;break;case 11:ui.notifications.error(game.i18n.localize("dsk.DSKError.APUpdateError"));case 12:case"end":return c.stop()}}),_callee3,this)}))),function _updateAPs(t){return I.apply(this,arguments)})},{key:"setupRegeneration",value:function setupRegeneration(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2?arguments[2]:void 0,p=game.i18n.localize("dsk.regenerationTest"),d={source:{type:"regenerate",system:{}},opposable:!1,extra:{statusId:t,actor:this.toObject(!1),options:o,speaker:a.Z.buildSpeaker(this.actor,c)}};d.extra.actor.isMage=this.system.isMage;var h=i.Z.getRollModifiers(d.extra.actor,d.source),y={title:p,template:"/systems/dsk/templates/dialog/regeneration-dialog.html",data:{rollMode:o.rollMode,regenerationInterruptOptions:u.Z.regenerationInterruptOptions,regnerationCampLocations:u.Z.regnerationCampLocations,showAepModifier:this.system.isMage,situationalModifiers:h,modifier:o.modifier||0},callback:function callback(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.situationalModifiers=ActorDSK._parseModifiers(t),m.rollMode=t.find('[name="rollMode"]').val(),d.situationalModifiers.push({name:game.i18n.localize("dsk.camplocation")+" - "+t.find('[name="regnerationCampLocations"] option:selected').text(),value:t.find('[name="regnerationCampLocations"]').val()},{name:game.i18n.localize("dsk.interruption")+" - "+t.find('[name="regenerationInterruptOptions"] option:selected').text(),value:t.find('[name="regenerationInterruptOptions"]').val()}),d.regenerationFactor=t.find('[name="badEnvironment"]').is(":checked")?.5:1;for(var a=["LeP","AeP"],i={},c=0,u=a;c<u.length;c++){var l=u[c];d["".concat(l,"Modifier")]=Number(t.find('[name="'.concat(l,'Modifier"]')).val()||0),d["regeneration".concat(l)]=Number(r.system.stats.regeneration["".concat(l,"max")]);var p=t.find('[name="regenerate'.concat(l,'"]')).is(":checked")?1:0;d["regenerate".concat(l)]=p,p&&(i["system.stats.regeneration.".concat(l,"Temp")]=0)}return mergeObject(d.extra.options,o),r.update(i),{testData:d,cardOptions:m}}},m=this._setupCardOptions("systems/dsk/templates/chat/roll/regeneration-card.html",p,c);return l.Z.setupDialog({dialogOptions:y,testData:d,cardOptions:m})}},{key:"setupCharacteristic",value:function setupCharacteristic(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,i=(this.system.characteristics[t],game.i18n.localize("dsk.characteristics.".concat(t,".name"))+" "+game.i18n.localize("dsk.probe")),c={opposable:!1,source:{type:"char",system:{characteristic1:t,characteristic2:t}},extra:{characteristicId:t,actor:this.toObject(!1),options:r,speaker:a.Z.buildSpeaker(this,o)}},u={title:i,template:"/systems/dsk/templates/dialog/characteristic-dialog.html",data:{rollMode:r.rollMode,modifier:r.modifier||0},callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.rollMode=t.find('[name="rollMode"]').val(),c.situationalModifiers=ActorDSK._parseModifiers(t),mergeObject(c.extra.options,r),{testData:c,cardOptions:p}}},p=this._setupCardOptions("systems/dsk/templates/chat/roll/characteristic-card.html",i,o);return l.Z.setupDialog({dialogOptions:u,testData:c,cardOptions:p})}},{key:"_setupCardOptions",value:function _setupCardOptions(t,r,o){var a=game.canvas.tokens.get(o),i={speaker:{alias:a?a.name:this.prototypeToken.name,actor:this.id},title:r,template:t,flags:{img:this.prototypeToken.randomImg?this.img:this.prototypeToken.img}};if(this.token)i.speaker.alias=this.token.name,i.speaker.token=this.token.id,i.speaker.scene=canvas.scene.id,i.flags.img=this.token.img;else{var c=ChatMessage.getSpeaker();c.actor==this.id&&(i.speaker.alias=c.alias,i.speaker.token=c.token,i.speaker.scene=c.scene,i.flags.img=c.token?canvas.tokens.get(c.token).img:i.flags.img)}return i}},{key:"consumeAmmunition",value:(T=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r;return _regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:if(!t.extra.ammo||t.extra.ammoDecreased){o.next=9;break}if(t.extra.ammoDecreased=!0,!t.extra.ammo._id){o.next=7;break}return r={_id:t.extra.ammo._id},"mag"==t.extra.ammo.system.ammunitionType?t.extra.ammo.system.mag.value<=0?(t.extra.ammo.system.quantity--,r["system.quantity"]=t.extra.ammo.system.quantity,r["system.mag.value"]=t.extra.ammo.system.mag.max-1):r["system.mag.value"]=t.extra.ammo.system.mag.value-1:(t.extra.ammo.system.quantity--,r["system.quantity"]=t.extra.ammo.system.quantity),o.next=7,this.updateEmbeddedDocuments("Item",[r,{_id:t.source._id,"system.reloadTimeprogress":0}]);case 7:case 13:o.next=18;break;case 9:if("rangeweapon"!=t.source.type&&("trait"!=t.source.type||"rangeAttack"!=t.source.system.traitType)||t.extra.ammoDecreased){o.next=15;break}return t.extra.ammoDecreased=!0,o.next=13,this.updateEmbeddedDocuments("Item",[{_id:t.source._id,"system.reloadTimeprogress":0}]);case 15:if(!["ahnengabe"].includes(t.source.type)||"emptyActor"==t.extra.speaker.token){o.next=18;break}return o.next=18,this.updateEmbeddedDocuments("Item",[{_id:t.source._id,"system.castingTime.progress":0,"system.castingTime.modified":0}]);case 18:case"end":return o.stop()}}),_callee4,this)}))),function consumeAmmunition(t){return T.apply(this,arguments)})},{key:"basicTest",value:(P=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r,o,a,i,c,u,p,d=arguments;return _regeneratorRuntime().wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return r=t.testData,o=t.cardOptions,a=d.length>1&&void 0!==d[1]?d[1]:{},h.next=4,l.Z.rollDices(r,o);case 4:return r=h.sent,h.next=7,l.Z.rollTest(r);case 7:return i=h.sent,r.extra.options.other&&(i.other||(i.other=[]),(c=i.other).push.apply(c,_toConsumableArray(r.extra.options.other))),i.postFunction="basicTest",game.user.targets.size&&(o.isOpposedTest=r.opposable,u=" - ".concat(game.i18n.localize("dsk.Opposed")),o.isOpposedTest&&o.title.match(u+"$")!=u&&(o.title+=u)),h.next=13,this.consumeAmmunition(r);case 13:if(a.suppressMessage){h.next=20;break}return h.next=16,l.Z.renderRollCard(o,i,a.rerenderMessage);case 16:return p=h.sent,h.next=19,y.Z.handleOpposedTarget(p);case 19:i.messageId=p.id;case 20:return h.abrupt("return",{result:i,cardOptions:o,options:a});case 21:case"end":return h.stop()}}),_callee5,this)}))),function basicTest(t){return P.apply(this,arguments)})},{key:"tokenScrollingText",value:function tokenScrollingText(t){var r,o,a=_createForOfIteratorHelper(this.isToken?[null===(r=this.token)||void 0===r?void 0:r.object]:this.getActiveTokens(!0));try{for(a.s();!(o=a.n()).done;){var i=o.value;if(i){var c,u=0,l=_createForOfIteratorHelper(t);try{for(l.s();!(c=l.n()).done;){var p=c.value;canvas.interface.createScrollingText(i.center,p.value,{anchor:u,direction:p.value>0?2:1,fontSize:game.settings.get("dsk","scrollingFontsize"),stroke:p.stroke,strokeThickness:1,jitter:.25,duration:1e3}),u+=1}}catch(t){l.e(t)}finally{l.f()}}}}catch(t){a.e(t)}finally{a.f()}}},{key:"_preUpdate",value:(S=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r,o){var a,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee6$(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,_get(_getPrototypeOf(ActorDSK.prototype),"_preUpdate",this).call(this,t,r,o);case 2:for(a={LeP:9109504,AeP:723929},i=[],c=0,u=Object.keys(a);c<u.length;c++)l=u[c],(p=getProperty(t,"system.stats.".concat(l,".value")))&&i.push({value:p-this.system.stats[l].value,stroke:a[l]});i.length&&this.tokenScrollingText(i);case 6:case"end":return d.stop()}}),_callee6,this)}))),function _preUpdate(t,r,o){return S.apply(this,arguments)})},{key:"_itemPreparationError",value:function _itemPreparationError(t,r){console.error("Something went wrong with preparing item "+t.name+": "+r),console.warn(r),console.warn(t),ui.notifications.error("Something went wrong with preparing item "+t.name+": "+r)}},{key:"_setBagContent",value:function _setBagContent(t,r){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=0;if(r.has(t._id)){t.children=[];var i=0;!t.toggleValue&&o&&(a-=t.weight);var c,u=_createForOfIteratorHelper(r.get(t._id));try{for(u.s();!(c=u.n()).done;){var l=c.value;l.weight=Number(parseFloat((l.system.weight*l.system.quantity).toFixed(3))),i+=l.weight,t.children.push(ActorDSK._prepareitemStructure(ActorDSK._prepareConsumable(l))),r.has(l._id)&&(i+=this._setBagContent(l,r,!1))}}catch(t){u.e(t)}finally{u.f()}!t.toggleValue&&o||(a+=i),t.bagweight="".concat(i.toFixed(3),"/").concat(t.system.capacity||0)}return a}},{key:"applyDamage",value:(O=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r;return _regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return r=Math.min(this.system.stats.LeP.max,this.system.stats.LeP.value-t),o.next=3,this.update({"system.stats.LeP.value":r});case 3:case"end":return o.stop()}}),_callee7,this)}))),function applyDamage(t){return O.apply(this,arguments)})},{key:"applyRegeneration",value:(x=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r){var o;return _regeneratorRuntime().wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return o={"system.stats.LeP.value":Math.min(this.system.stats.LeP.max,this.system.stats.LeP.value+(t||0)),"system.stats.AeP.value":Math.min(this.system.stats.AeP.max,this.system.stats.AeP.value+(r||0))},a.next=3,this.update(o);case 3:case"end":return a.stop()}}),_callee8,this)}))),function applyRegeneration(t,r){return x.apply(this,arguments)})},{key:"applyMana",value:(w=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t){var r;return _regeneratorRuntime().wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:if(!((r=Math.min(this.system.stats.AeP.max,this.system.stats.AeP.value-t))>=0)){o.next=7;break}return o.next=4,this.update(_defineProperty({},"data.stats.AeP.value",r));case 4:return o.abrupt("return",!0);case 7:return ui.notifications.error(game.i18n.localize("dsk.DSKError.NotEnoughAeP")),o.abrupt("return",!1);case 9:case"end":return o.stop()}}),_callee9,this)}))),function applyMana(t){return w.apply(this,arguments)})},{key:"actorEffects",value:(k=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(){var t,r,o=this;return _regeneratorRuntime().wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:if(t=["dead"],a.t0=game.user.isGM||this.testUserPermission(game.user,"OBSERVER"),a.t0){a.next=6;break}return a.next=5,game.settings.get("dsk","hideEffects");case 5:a.t0=!a.sent;case 6:return r=a.t0,a.abrupt("return",r?this.effects.filter((function(t){return!t.disabled&&!t.notApplicable&&(game.user.isGM||!t.getFlag("dsk","hidePlayers"))&&!t.getFlag("dsk","hideOnToken")&&(t.origin==o.uuid||!t.origin)})):this.effects.filter((function(r){return t.includes(r.getFlag("core","statusId"))})));case 8:case"end":return a.stop()}}),_callee10,this)}))),function actorEffects(){return k.apply(this,arguments)})},{key:"_preCreate",value:(b=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t,r,o){var a;return _regeneratorRuntime().wrap((function _callee11$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,_get(_getPrototypeOf(ActorDSK.prototype),"_preCreate",this).call(this,t,r,o);case 2:a={},t.img||(a.img="icons/svg/mystery-man-black.svg"),"character"==t.type&&mergeObject(a,{prototypeToken:{sight:{enabled:!0},actorLink:!0}}),this.updateSource(a);case 6:case"end":return i.stop()}}),_callee11,this)}))),function _preCreate(t,r,o){return b.apply(this,arguments)})},{key:"markDead",value:(_=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(t){var r,o,a,i;return _regeneratorRuntime().wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:r=this.getActiveTokens(),o=_createForOfIteratorHelper(r),c.prev=2,o.s();case 4:if((a=o.n()).done){c.next=11;break}if(!(i=a.value).combatant){c.next=9;break}return c.next=9,i.combatant.update({defeated:t});case 9:c.next=4;break;case 11:c.next=16;break;case 13:c.prev=13,c.t0=c.catch(2),o.e(c.t0);case 16:return c.prev=16,o.f(),c.finish(16);case 19:case"end":return c.stop()}}),_callee12,this,[[2,13,16,19]])}))),function markDead(t){return _.apply(this,arguments)})},{key:"_dependentEffects",value:(v=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(t,r,o){var a;return _regeneratorRuntime().wrap((function _callee13$(i){for(;;)switch(i.prev=i.next){case 0:if(4!=duplicate(r).flags.dsk.value){i.next=22;break}if("inpain"!=t){i.next=7;break}return i.next=5,this.initResistPainRoll();case 5:i.next=22;break;case 7:if(!["encumbered","stunned","feared","confused","trance"].includes(t)){i.next=12;break}return i.next=10,this.addCondition("incapacitated");case 10:i.next=22;break;case 12:if("paralysed"!=t){i.next=17;break}return i.next=15,this.addCondition("rooted");case 15:i.next=22;break;case 17:if(!["drunken","exhaustion"].includes(t)){i.next=22;break}return i.next=20,this.addCondition("stunned");case 20:return i.next=22,this.removeCondition(t);case 22:if("dead"!=t||!game.combat){i.next=25;break}return i.next=25,this.markDead(!0);case 25:if("unconscious"!=t){i.next=28;break}return i.next=28,this.addCondition("prone");case 28:if(!(o>0&&"inpain"==t&&!this.hasCondition("bloodrush")&&c.Z.hasVantage(this,game.i18n.localize("dsk.LocalizedIDs.frenzy")))){i.next=33;break}return i.next=31,this.addCondition("bloodrush");case 31:a=p.Z.replaceConditions("".concat(game.i18n.format("dsk.CHATNOTIFICATION.gainsBloodrush",{character:"<b>"+this.name+"</b>"}))),ChatMessage.create(p.Z.chatDataSetup(a));case 33:case"end":return i.stop()}}),_callee13,this)}))),function _dependentEffects(t,r,o){return v.apply(this,arguments)})},{key:"addCondition",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(t){var r,o,a,c=arguments;return _regeneratorRuntime().wrap((function _callee14$(u){for(;;)switch(u.prev=u.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:1,o=c.length>2&&void 0!==c[2]&&c[2],a=!(c.length>3&&void 0!==c[3])||c[3],"bleeding"!=t){u.next=7;break}return u.next=6,d.Z.bleedingMessage(this);case 6:case 9:return u.abrupt("return",u.sent);case 7:return u.next=9,i.Z.addCondition(this,t,r,o,a);case 10:case"end":return u.stop()}}),_callee14,this)}))),function addCondition(t){return g.apply(this,arguments)})},{key:"removeCondition",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(t){var r,o,a,c=arguments;return _regeneratorRuntime().wrap((function _callee15$(u){for(;;)switch(u.prev=u.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:1,o=!(c.length>2&&void 0!==c[2])||c[2],a=c.length>3&&void 0!==c[3]&&c[3],u.next=5,i.Z.removeCondition(this,t,r,o,a);case 5:return u.abrupt("return",u.sent);case 6:case"end":return u.stop()}}),_callee15,this)}))),function removeCondition(t){return o.apply(this,arguments)})},{key:"hasCondition",value:function hasCondition(t){return i.Z.hasCondition(this,t)}}],[{key:"create",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(t,r){return _regeneratorRuntime().wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:if(!(t instanceof Array||t.items)){o.next=4;break}return o.next=3,_get(_getPrototypeOf(ActorDSK),"create",this).call(this,t,r);case 3:case 10:return o.abrupt("return",o.sent);case 4:return t.img&&"icons/svg/mystery-man.svg"!=t.img||(t.img="icons/svg/mystery-man-black.svg"),o.next=7,p.Z.allSkills();case 7:return t.items=o.sent,o.next=10,_get(_getPrototypeOf(ActorDSK),"create",this).call(this,t,r);case 11:case"end":return o.stop()}}),_callee16,this)}))),function create(t,o){return r.apply(this,arguments)})},{key:"_calculateCombatSkillValues",value:function _calculateCombatSkillValues(t,r){return(t=ActorDSK._calculatePW(t,r)).system.attack=t.PW,"melee"==t.system.weapontype?t.system.parry=Math.round(.25*t.PW):t.system.parry=0,t.cost=game.i18n.format("dsk.advancementCost",{cost:p.Z._calculateAdvCost(t.system.level,t.system.StF)}),t}},{key:"lockedCondition",value:function lockedCondition(){return{label:game.i18n.localize("dsk.MERCHANT.locked"),icon:"icons/svg/padlock.svg",flags:{core:{statusId:"locked"},dsk:{value:null,editable:!0,noEffect:!0,hidePlayers:!0,description:game.i18n.localize("dsk.MERCHANT.locked"),custom:!0}}}}},{key:"_prepareRangeTrait",value:function _prepareRangeTrait(t){return t.attack=Number(t.system.at),t.LZ=Number(t.system.lz),t.LZ>0&&ActorDSK.buildReloadProgress(t),this._parseDmg(t)}},{key:"_prepareRangeWeapon",value:function _prepareRangeWeapon(t,r,o,a){var i,c=o.find((function(r){return r.name==t.system.combatskill}));if(t.calculatedRange=t.system.rw,c){if(t.attack=Number(c.system.attack),"-"!=t.system.ammunitionType&&(t.ammo=r.filter((function(r){return r.system.ammunitionType==t.system.ammunitionType})),i=r.find((function(r){return r._id==t.system.currentAmmo})))){var u=Number(i.system.rangeMultiplier)||1;t.calculatedRange=t.calculatedRange.split("/").map((function(t){return Math.round(Number(t)*u)})).join("/"),t.attack+=Number(i.system.atmod)||0,"mag"==i.system.ammunitionType&&(t.ammoMax=i.system.mag.max,t.ammoCurrent=i.system.mag.value)}t.LZ=ActorDSK.calcLZ(t,a),t.LZ>0&&ActorDSK.buildReloadProgress(t)}else ui.notifications.error(game.i18n.format("dsk.DSKError.unknownCombatSkill",{skill:t.system.combatskill,item:t.name}));return this._parseDmg(t,i)}},{key:"_prepareMeleetrait",value:function _prepareMeleetrait(t){return t.attack=Number(t.system.at),t.parry=t.system.pa||Math.round(t.attack/4),this._parseDmg(t)}},{key:"_prepareMeleeWeapon",value:function _prepareMeleeWeapon(t,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=r.find((function(r){return r.name==t.system.combatskill}));if(i){t.attack=Number(i.system.attack)+Number(t.system.aw),t.parry=i.system.parry+Number(t.system.vw)+(t.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Shields")?Number(t.system.vw):0),t.yieldedTwoHand=d.Z.isYieldedTwohanded(t),t.yieldedTwoHand||(a||(a=duplicate(o.items).filter((function(r){return"meleeweapon"==r.type&&r.system.worn.value&&r._id!=t._id&&!d.Z.isYieldedTwohanded(r)}))),a.length>0&&(t.parry+=Math.max.apply(Math,_toConsumableArray(a.map((function(t){return t.system.vwoffhand})))),t.attack+=Math.max.apply(Math,_toConsumableArray(a.map((function(t){return t.system.awoffhand}))))));var c=0;t.system.worn.wrongGrip&&t.yieldedTwoHand&&(t.parry-=1,c+=1),t=this._parseDmg(t),c>0&&(t.extraDamage=c,t.damageAdd=Roll.safeEval(t.damageAdd+" + "+Number(c)),t.damageAdd=(t.damageAdd>0?"+":"")+t.damageAdd)}else ui.notifications.error(game.i18n.format("dsk.DSKError.unknownCombatSkill",{skill:t.system.combatskill,item:t.name}));return t}},{key:"_parseDmg",value:function _parseDmg(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=new Roll(t.system.tp.replace(/[Ww]/g,"d"),{async:!1}),i="",c="",u="+",l=_createForOfIteratorHelper(a.terms);try{for(l.s();!(r=l.n()).done;){var p=r.value;p.faces?i=p.number+"d"+p.faces:p.operator?u=p.operator:p.number&&(c+=Number("".concat(u).concat(p.number)))}}catch(t){l.e(t)}finally{l.f()}if(o){var d=getProperty(o,"system.damageMod");Number(d)?c+="+".concat(Number(d)):d&&(t.damageBonusDescription=", ".concat(d," ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")," ").concat(o.name))}return c&&(c=Roll.safeEval(c)),t.damagedie=i||"0d6",t.damageAdd=""!=c?(Number(c)>=0?"+":"")+c:"",t}},{key:"calcLZ",value:function calcLZ(t,r){var o=1,a=0;t.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Throwing Weapons")?a=-1*m.Z.abilityStep(r,game.i18n.localize("dsk.LocalizedIDs.quickdraw")):t.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Crossbows")&&m.Z.hasAbility(r,"".concat(game.i18n.localize("dsk.LocalizedIDs.quickload")," (").concat(game.i18n.localize("dsk.LocalizedIDs.Crossbows"),")"))?o=.5:a=-1*m.Z.abilityStep(r,"".concat(game.i18n.localize("dsk.LocalizedIDs.quickload")," (").concat(game.i18n.localize(t.system.combatskill),")"));var i="".concat(t.system.lz).split("/");if("mag"==t.system.ammunitionType){var c=r.items.find((function(r){return r.id==t.system.currentAmmo||r._id==t.system.currentAmmo})),u=0;c&&(c=p.Z.toObjectIfPossible(c)).system.mag.value<=0&&(u=1),i=i[u]||i[0]}else i=i[0];return Math.max(0,Math.round(Number(i)*o)+a)}},{key:"_attrFromCharacteristic",value:function _attrFromCharacteristic(t,r){return r.characteristics[t].value}},{key:"_calculatePW",value:function _calculatePW(t,r){return t.PW=Math.round((ActorDSK._attrFromCharacteristic(t.system.characteristic1,r)+ActorDSK._attrFromCharacteristic(t.system.characteristic2,r))/2)+5+(t.system.level||0),t}},{key:"buildReloadProgress",value:function buildReloadProgress(t){var r=t.system.reloadTimeprogress/t.LZ;t.title=game.i18n.format("dsk.WEAPON.loading",{status:"".concat(t.system.reloadTimeprogress,"/").concat(t.LZ)}),t.progress="".concat(t.system.reloadTimeprogress,"/").concat(t.LZ),r>=1&&(t.title=game.i18n.localize("dsk.WEAPON.loaded")),this.progressTransformation(t,r)}},{key:"progressTransformation",value:function progressTransformation(t,r){r>=.5?(t.transformRight="181deg",t.transformLeft="".concat(Math.round(360*r-179),"deg")):(t.transformRight="".concat(Math.round(360*r+1),"deg"),t.transformLeft=0)}},{key:"_prepareitemStructure",value:function _prepareitemStructure(t){var r=getProperty(t,"flags.dsk.enchantments");return r&&r.length>0?t.enchantClass="rar":t.effects.length>0&&(t.enchantClass="common"),t}},{key:"prepareMag",value:function prepareMag(t){return"mag"==t.system.ammunitiongroup&&(t.structureMax=t.system.mag.max,t.structureCurrent=t.system.mag.value),t}},{key:"_parseModifiers",value:function _parseModifiers(t,r){var o=[];return t.find('[name="situationalModifiers"] option:selected').each((function(){var t=$(this).val(),r={name:$(this).text().trim().split("[")[0],value:isNaN(t)?t:Number(t),type:$(this).attr("data-type")};"dmg"==r.type&&(r.damageBonus=r.value,r.value=0),$(this).attr("data-specAbId")&&(r.specAbId=$(this).attr("data-specAbId")),$(this).attr("data-armorPen")&&(r.armorPen=$(this).attr("data-armorPen")),o.push(r)})),o.push({name:game.i18n.localize("dsk.manual"),value:Number(t.find('[name="testModifier"]').val()),type:""}),o}}]),ActorDSK}()},582:(t,r,o)=>{o.d(r,{Z:()=>m});var a=o(231),i=o(140),c=o(278),u=o(614),l=o(832),p=o(514),d=o(96),h=o(564),y=o(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var m=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(DSKCombatDialog,t);var r,o=_createSuper(DSKCombatDialog);function DSKCombatDialog(){return _classCallCheck(this,DSKCombatDialog),o.apply(this,arguments)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKCombatDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(DSKCombatDialog.prototype),"activateListeners",this).call(this,t);var o=t.find(".specAbs");o.mouseenter((function(t){if(0==t.currentTarget.getElementsByClassName("hovermenu").length){var o=document.createElement("div");o.classList.add("hovermenu");var a=document.createElement("i");a.classList.add("fas","fa-comment"),a.title=game.i18n.localize("dsk.SHEET.PostItem"),a.addEventListener("mousedown",r._postItem,!1),o.appendChild(a),t.currentTarget.appendChild(o)}})),o.mouseleave((function(t){var o=t.toElement||t.relatedTarget;o.parentNode!=r&&o!=r&&t.currentTarget.querySelectorAll(".hovermenu").forEach((function(t){return t.remove()}))})),t.on("mousedown",".specAbs",(function(o){if(t.find(".opportunityAttack").is(":checked"))ui.notifications.error(game.i18n.localize("dsk.DSKError.opposedAttackNoSpecAbs"));else{var a=$(o.currentTarget),i=Number(a.attr("data-step")),c=Number(a.attr("data-maxStep")),u=Number(a.attr("data-category"));if(0==o.button){if(i=Math.min(c,i+1),[0,1].includes(u)&&game.settings.get("dsk","limitCombatSpecAbs")){var l=a.siblings('[data-category="'.concat(u,'"]'));l.removeClass("active").attr("data-step",0),l.find(".step").text(h.Z.roman[0])}}else 2==o.button&&(i=Math.clamped(c,0,i-1));a.attr("data-step",i),i>0?a.addClass("active"):a.removeClass("active"),a.find(".step").text(h.Z.roman[i]),r.calculateModifier()}})),t.find(".opportunityAttack").change((function(r){if($(r.currentTarget).is(":checked")){var o,a=function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}(t.find(".specAbs"));try{for(a.s();!(o=a.n()).done;){var i=o.value;$(i).removeClass("active").attr("data-step",0).find(".step").text("")}}catch(t){a.e(t)}finally{a.f()}}})),t.on("change","input,select",(function(t){return r.calculateModifier(t)})),t.find(".modifiers option").mousedown((function(t){r.calculateModifier(t)})),t.find(".quantity-click").mousedown((function(t){return r.calculateModifier(t)}));var a=this.readTargets();this.calculateModifier();var i=this;this.checkTargets=setInterval((function(){a=i.compareTargets(t,a)}),500)}},{key:"close",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t,r=arguments;return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},clearInterval(this.checkTargets),o.next=4,_get(_getPrototypeOf(DSKCombatDialog.prototype),"close",this).call(this,t);case 4:return o.abrupt("return",o.sent);case 5:case"end":return o.stop()}}),_callee,this)}))),function close(){return r.apply(this,arguments)})},{key:"_postItem",value:function _postItem(t){t.stopPropagation();var r=$(t.currentTarget).closest(".specAbs"),o=r.attr("data-actor"),a=r.attr("data-id");return game.actors.get(o).items.get(a).postItem(),!1}},{key:"recallSettings",value:function recallSettings(t,r,o){return _get(_getPrototypeOf(DSKCombatDialog.prototype),"recallSettings",this).call(this,t,r,o),this.prepareWeapon(),this}},{key:"prepareWeapon",value:function prepareWeapon(){var t,r=this.dialogData.source,o=l.Z.getSpeaker(this.dialogData.speaker);if(o)if(["meleeweapon","rangeweapon"].includes(r.type)){var i=r.system.combatskill,c=a.Z._calculateCombatSkillValues(o.items.find((function(t){return"combatskill"==t.type&&t.name==i})).toObject(),o.system);switch(r.type){case"meleeweapon":t=a.Z._prepareMeleeWeapon(r,[c],o);break;case"rangeweapon":t=a.Z._prepareRangeWeapon(r,[],[c],o)}"attack"==this.dialogData.mode&&(this.dialogData.rollValue=t.attack)}else"attack"==this.dialogData.mode&&(this.dialogData.rollValue=Number(r.system.aw))}},{key:"prepareFormRecall",value:function prepareFormRecall(t){if(_get(_getPrototypeOf(DSKCombatDialog.prototype),"prepareFormRecall",this).call(this,t),canvas.scene&&game.settings.get("dsk","sightAutomationEnabled")){for(var r=canvas.scene?canvas.scene.darkness:0,o=game.settings.get("dsk","sightOptions").split("|").map((function(t){return Number(t)})),a=0;o[a]<=r;)a+=1;var i=l.Z.getSpeaker(this.dialogData.speaker);if(i){var u=c.Z.vantageStep(i,game.i18n.localize("dsk.LocalizedIDs.darksight"))+p.Z.abilityStep(i,game.i18n.localize("dsk.LocalizedIDs.sappeurStyle")),d=p.Z.abilityStep(i,game.i18n.localize("dsk.LocalizedIDs.blindFighting"));a<4&&a>0&&(u>1?a=0:(a=Math.max(0,a-u),a=Math.min(4,a+c.Z.vantageStep(i,game.i18n.localize("dsk.LocalizedIDs.nightBlind"))))),a=Math.max(0,a-d)}var h=t.find('[name="vision"] option:nth-child('.concat(a+1,")"));h.length&&(h[0].selected=!0)}}},{key:"calculateModifier",value:function calculateModifier(){if("damage"!=this.dialogData.mode){var t=this.dialogData.source,r="trait"==t.type&&"meleeAttack"==getProperty(t,"system.traitType")||"meleeweapon"==t.type,o={source:this.dialogData.source,extra:{options:{}}},a=l.Z.getSpeaker(this.dialogData.speaker);r?DSKCombatDialog.resolveMeleeDialog(o,{},this.element,a,{},-3,this.dialogData.mode):DSKCombatDialog.resolveRangeDialog(o,{},this.element,a,{},this.dialogData.mode),this.dialogData.modifier=u.Z._situationalModifiers(o),this.updateRollButton(this.readTargets())}}}],[{key:"defaultOptions",get:function get(){var t=_get(_getPrototypeOf(DSKCombatDialog),"defaultOptions",this);return mergeObject(t,{width:700,resizable:!0}),t}},{key:"resolveMeleeDialog",value:function resolveMeleeDialog(t,r,o,a,c,u,l){var d;this._resolveDefault(t,r,o,c);var h=new FormDataExtended(o.find("form")[0]).object;t.opposingWeaponSize=h.weaponsize,t.narrowSpace=h.narrowSpace,t.attackOfOpportunity=this.attackOfOpportunity(t.situationalModifiers,h),(d=t.situationalModifiers).push.apply(d,[i.Z.parseValueType(game.i18n.localize("dsk.sight"),h.vision||0),{name:game.i18n.localize("dsk.attackFromBehind"),value:h.attackFromBehind?-4:0},{name:game.i18n.localize("dsk.MODS.damage"),damageBonus:h.damageModifier,value:0,step:1},{name:game.i18n.format("dsk.defenseCount",{malus:u}),value:(Number(h.defenseCount)||0)*u},{name:game.i18n.localize("dsk.wrongHand"),value:h.wrongHand?-4:0},{name:game.i18n.localize("dsk.advantageousPosition"),value:h.advantageousPosition?2:0},{name:game.i18n.localize("dsk.sizeCategory"),value:y.Z.meleeSizeModifier[h.size]}].concat(_toConsumableArray(i.Z.getSpecAbModifiers(o,l)))),"attack"==l&&t.situationalModifiers.push({name:game.i18n.localize("dsk.doubleAttack"),value:h.doubleAttack?-2+p.Z.abilityStep(a,game.i18n.localize("dsk.LocalizedIDs.twoWeaponCombat")):0})}},{key:"resolveRangeDialog",value:function resolveRangeDialog(t,r,o,a,c){var u;this._resolveDefault(t,r,o,c);var l=new FormDataExtended(o.find("form")[0]).object;t.rangeModifier=l.distance,(u=t.situationalModifiers).push.apply(u,[{name:game.i18n.localize("dsk.target")+" "+o.find('[name="targetMovement"] option:selected').text(),value:Number(l.targetMovement)||0},{name:game.i18n.localize("dsk.shooter")+" "+o.find('[name="shooterMovement"] option:selected').text(),value:Number(l.shooterMovement)||0},{name:game.i18n.localize("dsk.mount")+" "+o.find('[name="mountedOptions"] option:selected').text(),value:Number(l.mountedOptions)||0},{name:game.i18n.localize("dsk.rangeMovementOptions.QUICKCHANGE"),value:l.quickChange?-4:0},{name:game.i18n.localize("dsk.MODS.combatTurmoil"),value:l.combatTurmoil?-2:0},{name:game.i18n.localize("dsk.aim"),value:Number(l.aim)||0},{name:game.i18n.localize("dsk.MODS.damage"),damageBonus:l.damageModifier,value:0,step:1},{name:game.i18n.localize("dsk.sight"),value:Number(l.vision||0)}].concat(_toConsumableArray(i.Z.getSpecAbModifiers(o,"attack")),[{name:game.i18n.localize("dsk.sizeCategory"),value:y.Z.rangeSizeModifier[l.size]}]))}},{key:"_resolveDefault",value:function _resolveDefault(t,r,o,i){r.rollMode=o.find('[name="rollMode"]').val(),t.situationalModifiers=a.Z._parseModifiers(o),mergeObject(t.extra.options,i)}},{key:"attackOfOpportunity",value:function attackOfOpportunity(t,r){var o=r.opportunityAttack?-4:0;if(o){t.push({name:game.i18n.localize("dsk.opportunityAttack"),value:o});var a=game.i18n.localize("dsk.LocalizedIDs.enemySense");game.user.targets.forEach((function(r){r.actor&&r.actor.items.find((function(t){return"specialability"==t.type&&t.name==a}))&&t.push({name:a,value:o})}))}return 0!=o}},{key:"getRollButtons",value:function getRollButtons(t,r,o,i){var c,u=d.Z.getRollButtons(t,r,o,i);if("rangeweapon"==t.source.type||"trait"==t.source.type&&"rangeAttack"==t.source.system.traitType){var p="trait"==t.source.type?Number(t.source.system.lz):a.Z.calcLZ(t.source,t.extra.actor),h=t.source.system.reloadTimeprogress;h<p&&mergeObject(u,{reloadButton:{label:"".concat(game.i18n.localize("dsk.WEAPON.reload")," (").concat(h,"/").concat(p,")"),callback:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var r,o;return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.Z.getSpeaker(t.extra.speaker);case 2:return r=a.sent,a.next=5,r.updateEmbeddedDocuments("Item",[{_id:t.source._id,"system.reloadTimeprogress":h+1}]);case 5:return o=game.i18n.format("dsk.WEAPON.isReloading",{actor:t.extra.actor.name,item:t.source.name,status:"".concat(h+1,"/").concat(p)}),a.next=8,ChatMessage.create(l.Z.chatDataSetup(o));case 8:case"end":return a.stop()}}),_callee2)}))),function callback(){return c.apply(this,arguments)})}})}return u}}]),DSKCombatDialog}(h.Z)},96:(t,r,o)=>{o.d(r,{Z:()=>d});var a=o(582),i=o(564),c=o(231);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var u=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(SkillDialogDSK,t);var r=_createSuper(SkillDialogDSK);function SkillDialogDSK(){return _classCallCheck(this,SkillDialogDSK),r.apply(this,arguments)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(SkillDialogDSK,[{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(SkillDialogDSK.prototype),"activateListeners",this).call(this,t),t.on("change","input,select",(function(t){return r.rememberFormData(t)}));var o=this.readTargets(),a=this;this.checkTargets=setInterval((function(){o=a.compareTargets(t,o)}),500),this.rememberFormData(),t.on("mousedown",".quantity-click",(function(t){return r.rememberFormData(t)})),t.find(".modifiers option").mousedown((function(t){r.rememberFormData(t)}))}},{key:"rememberFormData",value:function rememberFormData(t){new FormDataExtended(this.element.find("form")[0]).object.situationalModifiers=c.Z._parseModifiers(this._element)}}],[{key:"getRollButtons",value:function getRollButtons(t,r,o,a){var i=d.getRollButtons(t,r,o,a);i.rollButton.label=game.i18n.localize("dsk.Opposed");var c={nonOpposedButton:{label:game.i18n.localize("dsk.Roll"),callback:function callback(a){game.dsk.memory.remember(t.extra.speaker,t.source,t.mode,a),t.opposable=!1,o(r.callback(a))}}};return mergeObject(c,i),c}},{key:"defaultOptions",get:function get(){var t=_get(_getPrototypeOf(SkillDialogDSK),"defaultOptions",this);return mergeObject(t,{width:700,resizable:!0}),t}}]),SkillDialogDSK}(i.Z),l=(o(122),o(832));function dialog_spell_typeof(t){return dialog_spell_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_spell_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_spell_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_spell_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_spell_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dialog_spell_get(){return dialog_spell_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dialog_spell_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dialog_spell_get.apply(this,arguments)}function dialog_spell_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_spell_getPrototypeOf(t)););return t}function dialog_spell_setPrototypeOf(t,r){return dialog_spell_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_spell_setPrototypeOf(t,r)}function dialog_spell_createSuper(t){var r=function dialog_spell_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dialog_spell_getPrototypeOf(t);if(r){var i=dialog_spell_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dialog_spell_possibleConstructorReturn(this,o)}}function dialog_spell_possibleConstructorReturn(t,r){if(r&&("object"===dialog_spell_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_spell_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_spell_getPrototypeOf(t){return dialog_spell_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_spell_getPrototypeOf(t)}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}var p=function(t){!function dialog_spell_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_spell_setPrototypeOf(t,r)}(DSKpellDialog,t);var r,o=dialog_spell_createSuper(DSKpellDialog);function DSKpellDialog(){return dialog_spell_classCallCheck(this,DSKpellDialog),o.apply(this,arguments)}return function dialog_spell_createClass(t,r,o){return r&&dialog_spell_defineProperties(t.prototype,r),o&&dialog_spell_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKpellDialog,[{key:"prepareFormRecall",value:function prepareFormRecall(t){dialog_spell_get(dialog_spell_getPrototypeOf(DSKpellDialog.prototype),"prepareFormRecall",this).call(this,t),t.find(".spellModifier").trigger("change")}},{key:"recalcSpellModifiers",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var o,a,i,c,u,l,p,d,h,y,m,g;return _regeneratorRuntime().wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:if(o=t,a=duplicate(this.dialogData.source),i=o.find(".castingTime"),c=o.find(".aspcost"),u=o.find(".reach"),o.find(".maintainCost"),l=o.find(".ritual").length>0,p=o.find(".maxMods"),!(o.find(".spellModifier:checked").length>Number(p.text()))){v.next=13;break}return r&&(r.currentTarget.checked=!1),p.addClass("emphasize"),setTimeout((function(){p.removeClass("emphasize")}),600),v.abrupt("return");case 13:d=a.system.AeP,h=a.system.range,y=d,o.find(".variableBaseCost")["true"==a.system.variableBaseCost?"show":"hide"](),m=0,o.find(".spellModifier[data-cost]:checked").each((function(t,r){y*=r.value<0?.5:2,m+=Number(r.value)})),y<1?r&&(r.currentTarget.checked=!1):(c.text(y),c.attr("data-mod",m)),m=0,y=2,o.find(".spellModifier[data-castingTime]:checked").each((function(t,r){if(l){var o=DSKpellDialog.bigTimes.indexOf(Number(y));if(null!=o){var a=o+(r.value>0?1:-1);a<DSKpellDialog.bigTimes.length&&a>=0?y=DSKpellDialog.bigTimes[a]:ui.notifications.error(game.i18n.localize("dsk.DSKError.CastingTimeLimit"))}else ui.notifications.error(game.i18n.localize("dsk.DSKError.TimeCannotBeParsed"))}else y*=r.value>0?2:.5;m+=Number(r.value)})),y<1?r&&(r.currentTarget.checked=!1):(i.text(y),i.attr("data-mod",m)),m=0,g=game.i18n.localize("dsk.ReverseSpellRanges."+h),u.text(h),o.find(".spellModifier[data-reach]:checked").each((function(t,o){if("self"==g)o.checked=!1;else if("touch"==g)u.text("4 "+game.i18n.localize("dsk.step")),m+=Number(o.value);else{var a=h.split(" ");g=Number(a[0]),isNaN(g)?(r&&(r.currentTarget.checked=!1),ui.notifications.error(game.i18n.localize("dsk.DSKError.RangeCannotBeParsed"))):(u.text(2*g+" "+game.i18n.localize("dsk.step")),m+=Number(o.value))}})),u.attr("data-mod",m),t.find(".reloadButton").prop("disabled",Number(t.find(".castingTime").text())<2);case 31:case"end":return v.stop()}}),_callee,this)}))),function recalcSpellModifiers(t,o){return r.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;dialog_spell_get(dialog_spell_getPrototypeOf(DSKpellDialog.prototype),"activateListeners",this).call(this,t),t.find(".reloadButton").prop("disabled",Number(t.find(".castingTime").text())<2),t.find(".specAbs").mousedown((function(o){$(o.currentTarget).toggleClass("active"),r.recalcSpellModifiers(t)})),t.find(".variableBaseCost").change((function(t){var r=$(t.currentTarget).parents(".skill-test"),o=r.find(".aspcost").attr("data-base"),a=$(t.currentTarget).val();r.find(".aspcost").attr("data-base",a),r.find(".aspcost").text(Number(r.find(".aspcost").text())*a/o)})),t.find(".spellModifier").change((function(o){return r.recalcSpellModifiers(t,o)}));var o=this.readTargets();0==o.length&&this.setRollButtonWarning();var a=this;this.checkTargets=setInterval((function(){o=a.compareTargets(t,o)}),500)}}],[{key:"defaultOptions",get:function get(){var t=dialog_spell_get(dialog_spell_getPrototypeOf(DSKpellDialog),"defaultOptions",this);return mergeObject(t,{width:700,resizable:!0}),t}},{key:"getRollButtons",value:function getRollButtons(t,r,o,a){var i,c=d.getRollButtons(t,r,o,a);if(["spell","liturgy"].includes(t.source.type)){var u=Number(t.source.system.castingTime.value),p=t.source.system.castingTime.progress,h=t.source.system.castingTime.modified;if(u&&"emptyActor"!=t.extra.speaker.token){var y=h>0?" (".concat(p,"/").concat(h,")"):"";mergeObject(c,{reloadButton:{label:"".concat(game.i18n.localize("dsk.SPELL.reload")).concat(y),callback:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(r){var o,a,i;return _regeneratorRuntime().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,l.Z.getSpeaker(t.extra.speaker);case 2:return o=c.sent,a={_id:t.source._id,"system.castingTime.progress":p+1},0==h&&(h=Number(r.find(".castingTime").text())-1,a["system.castingTime.modified"]=h),c.next=7,o.updateEmbeddedDocuments("Item",[a]);case 7:return i=game.i18n.format("dsk.SPELL.isReloading",{actor:t.extra.actor.name,item:t.source.name,status:"".concat(p+1,"/").concat(h)}),c.next=10,ChatMessage.create(l.Z.chatDataSetup(i));case 10:case"end":return c.stop()}}),_callee2)}))),function callback(t){return i.apply(this,arguments)})}})}}return c}}]),DSKpellDialog}(i.Z);function dialog_dsk_typeof(t){return dialog_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_dsk_typeof(t)}function dialog_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_dsk_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dialog_dsk_get(){return dialog_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dialog_dsk_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dialog_dsk_get.apply(this,arguments)}function dialog_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_dsk_getPrototypeOf(t)););return t}function dialog_dsk_setPrototypeOf(t,r){return dialog_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_dsk_setPrototypeOf(t,r)}function dialog_dsk_createSuper(t){var r=function dialog_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dialog_dsk_getPrototypeOf(t);if(r){var i=dialog_dsk_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dialog_dsk_possibleConstructorReturn(this,o)}}function dialog_dsk_possibleConstructorReturn(t,r){if(r&&("object"===dialog_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_dsk_getPrototypeOf(t){return dialog_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_dsk_getPrototypeOf(t)}_defineProperty(p,"rollChanges",["defenseMalus"]),_defineProperty(p,"bigTimes",[5,30,120,480,960,1920]);var d=function(t){!function dialog_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_dsk_setPrototypeOf(t,r)}(DSKDialog,t);var r=dialog_dsk_createSuper(DSKDialog);function DSKDialog(){return dialog_dsk_classCallCheck(this,DSKDialog),r.apply(this,arguments)}return function dialog_dsk_createClass(t,r,o){return r&&dialog_dsk_defineProperties(t.prototype,r),o&&dialog_dsk_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKDialog,[{key:"activateListeners",value:function activateListeners(t){dialog_dsk_get(dialog_dsk_getPrototypeOf(DSKDialog.prototype),"activateListeners",this).call(this,t),t.find(".dieButton").click((function(t){var r=$(t.currentTarget);"true"==r.attr("data-single")&&r.closest(".dialog-content").find(".dieButton").removeClass("dieSelected"),r.toggleClass("dieSelected")}))}}],[{key:"getDialogForItem",value:function getDialogForItem(t){switch(t){case"rangeweapon":case"meleeweapon":case"trait":return a.Z;case"ahnengabe":return p;case"skill":return u}return DSKDialog}},{key:"getRollButtons",value:function getRollButtons(t,r,o,a){var i={rollButton:{label:game.i18n.localize("dsk.check"),callback:function callback(a){game.dsk.memory.remember(t.extra.speaker,t.source,t.mode,a),o(r.callback(a))}}};return game.user.isGM&&mergeObject(i,{cheat:{label:game.i18n.localize("dsk.DIALOG.cheat"),callback:function callback(a){game.dsk.memory.remember(t.extra.speaker,t.source,t.mode,a),o(r.callback(a,{cheat:!0}))}}}),i}},{key:"defaultOptions",get:function get(){var t=dialog_dsk_get(dialog_dsk_getPrototypeOf(DSKDialog),"defaultOptions",this);return mergeObject(t,{resizable:!0}),t}}]),DSKDialog}(i.Z)},564:(t,r,o)=>{o.d(r,{Z:()=>u});var a=o(122),i=o(565);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var c=function(t){_inherits(AddTargetDialog,Dialog);var r,o,a=_createSuper(AddTargetDialog);function AddTargetDialog(){return _classCallCheck(this,AddTargetDialog),a.apply(this,arguments)}return _createClass(AddTargetDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(AddTargetDialog.prototype),"activateListeners",this).call(this,t);var o=t.find(".combatant");o.click((function(t){return r.setTargets(t)})),o.hover(this._onCombatantHoverIn.bind(this),this._onCombatantHoverOut.bind(this)),o.mousedown((function(t){return r._onRightClick(t)}))}},{key:"_onCombatantHoverOut",value:function _onCombatantHoverOut(t){this._getCombatApp()._onCombatantHoverOut(t)}},{key:"_onCombatantHoverIn",value:function _onCombatantHoverIn(t){this._getCombatApp()._onCombatantHoverIn(t)}},{key:"_onRightClick",value:function _onRightClick(t){if(2==t.button){var r=game.combat.combatants.get(t.currentTarget.dataset.combatantId);if(r.token)return canvas.animatePan({x:r.token.x,y:r.token.y})}}},{key:"_getCombatApp",value:function _getCombatApp(){return game.combats.apps[0]}},{key:"setTargets",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,o;return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:(r=t.originalEvent.shiftKey)||$(t.currentTarget).closest(".directory").find(".combatant").removeClass("selectedTarget"),$(t.currentTarget).addClass("selectedTarget"),o=t.currentTarget.dataset.combatantId,game.combat.combatants.get(o).token.object.setTarget(!0,{user:game.user,releaseOthers:!r,groupSelection:!0});case 6:case"end":return a.stop()}}),_callee)}))),function setTargets(t){return o.apply(this,arguments)})}],[{key:"getDialog",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var r,o,a,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:return o=Array.from(game.user.targets).map((function(t){return t.id})),a=[],c=canvas.scene?null===(r=canvas.scene.tokens.get(t.token))||void 0===r?void 0:r.object:void 0,game.combat&&game.combat.combatants.forEach((function(t){if(t.visible){if(t.isSelected=o.includes(t.token.id),c&&t.token){var r=canvas.scene.tokens.get(t.token.id).object;t.distance=i.Z.rangeFinder(c,r),t.distance.distanceSum=Number(t.distance.distanceSum.toFixed(1))}a.push(t)}})),u.t0=AddTargetDialog,u.t1=game.i18n.localize("dsk.DIALOG.addTarget"),u.next=8,renderTemplate("systems/dsk/templates/dialog/addTarget-dialog.html",{selectables:a});case 8:return u.t2=u.sent,u.t3={},u.t4={title:u.t1,content:u.t2,default:"yes",buttons:u.t3},u.abrupt("return",new u.t0(u.t4));case 12:case"end":return u.stop()}}),_callee2)}))),function getDialog(t){return r.apply(this,arguments)})}]),AddTargetDialog}();function dialog_shared_typeof(t){return dialog_shared_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_shared_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function dialog_shared_regeneratorRuntime(){dialog_shared_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_shared_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dialog_shared_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dialog_shared_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dialog_shared_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dialog_shared_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_shared_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_shared_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dialog_shared_get(){return dialog_shared_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dialog_shared_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dialog_shared_get.apply(this,arguments)}function dialog_shared_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_shared_getPrototypeOf(t)););return t}function dialog_shared_setPrototypeOf(t,r){return dialog_shared_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_shared_setPrototypeOf(t,r)}function dialog_shared_createSuper(t){var r=function dialog_shared_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dialog_shared_getPrototypeOf(t);if(r){var i=dialog_shared_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dialog_shared_possibleConstructorReturn(this,o)}}function dialog_shared_possibleConstructorReturn(t,r){if(r&&("object"===dialog_shared_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_shared_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_shared_getPrototypeOf(t){return dialog_shared_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_shared_getPrototypeOf(t)}var u=function(t){!function dialog_shared_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_shared_setPrototypeOf(t,r)}(DialogShared,Dialog);var r,o,i,u,l=dialog_shared_createSuper(DialogShared);function DialogShared(){return dialog_shared_classCallCheck(this,DialogShared),l.apply(this,arguments)}return function dialog_shared_createClass(t,r,o){return r&&dialog_shared_defineProperties(t.prototype,r),o&&dialog_shared_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DialogShared,[{key:"recallSettings",value:function recallSettings(t,r,o){return this.recallData=game.dsk.memory.recall(t,r,o),this.dialogData={mode:o,speaker:t,source:r},this}},{key:"_render",value:(u=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee(t,r){return dialog_shared_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,dialog_shared_get(dialog_shared_getPrototypeOf(DialogShared.prototype),"_render",this).call(this,t,r);case 2:this.prepareFormRecall($(this._element));case 3:case"end":return o.stop()}}),_callee,this)}))),function _render(t,r){return u.apply(this,arguments)})},{key:"setRollButtonWarning",value:function setRollButtonWarning(){if("attack"==this.dialogData.mode){var t=game.i18n.localize("dsk.DIALOG.noTarget");return'<span class="missingTarget"><i class="fas fa-exclamation-circle"></i> '.concat(t,"</span>")}return""}},{key:"setMultipleTargetsWarning",value:function setMultipleTargetsWarning(){if("attack"==this.dialogData.mode){var t=game.i18n.localize("dsk.DIALOG.multipleTarget");return'<span class="multipleTarget"><i class="fas fa-exclamation-circle"></i> '.concat(t,"</span>")}return""}},{key:"renderRollValueDie",value:function renderRollValueDie(){if(this.dialogData.rollValue&&"damage"!=this.dialogData.mode){var t="attack"==this.dialogData.mode?"die-mu":"die-in",r=this.dialogData.modifier||0;return'<span class="rollValue '.concat(t,' d20">').concat(this.dialogData.rollValue+r,"</span>")}return""}},{key:"updateRollButton",value:(i=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee2(t){var r;return dialog_shared_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:r=this.renderRollValueDie()+game.i18n.localize("dsk.Roll"),t.length>0?t.length>1&&(r+=this.setMultipleTargetsWarning()):r+=this.setRollButtonWarning(),$(this._element).find(".dialog-buttons .rollButton").html(r);case 3:case"end":return o.stop()}}),_callee2,this)}))),function updateRollButton(t){return i.apply(this,arguments)})},{key:"updateTargets",value:(o=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee3(t,r){var o;return dialog_shared_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,renderTemplate("systems/dsk/templates/dialog/parts/targets.html",{targets:r});case 2:o=a.sent,t.find(".targets").html(o),this.updateRollButton(r);case 5:case"end":return a.stop()}}),_callee3,this)}))),function updateTargets(t,r){return o.apply(this,arguments)})},{key:"removeTarget",value:function removeTarget(t){var r=t.currentTarget.dataset.id;$(t.currentTarget).remove();var o=[];game.user.targets.forEach((function(t){r!=t.id&&o.push(t.id)})),game.user.updateTokenTargets(o)}},{key:"readTargets",value:function readTargets(){var t=[];return game.user.targets.forEach((function(r){r.actor&&t.push({name:r.actor.name,img:r.actor.img,id:r.id})})),t}},{key:"compareTargets",value:function compareTargets(t,r){var o=this.readTargets();return JSON.stringify(r)!=JSON.stringify(o)&&(r=o,this.updateTargets(t,r)),r}},{key:"activateListeners",value:function activateListeners(t){var r=this;dialog_shared_get(dialog_shared_getPrototypeOf(DialogShared.prototype),"activateListeners",this).call(this,t),t.find(".quantity-click").mousedown((function(t){var r=t.currentTarget.dataset.quantityfocus,o=$(t.currentTarget);if(!r||o.is(":focus")){var i={val:Number(o.val())};a.Z.increment(t,i,"val"),o.val(i.val)}else setTimeout((function(){o.select()}))})),t.find(".modifiers option").mousedown((function(t){return t.preventDefault(),$(t.currentTarget).prop("selected",!$(t.currentTarget).prop("selected")),!1})),t.on("click",".rollTarget",(function(t){return r.removeTarget(t)})),t.on("click",".addTarget",(function(t){return r.addTarget(t)}))}},{key:"addTarget",value:(r=dialog_shared_asyncToGenerator(dialog_shared_regeneratorRuntime().mark((function _callee4(t){return dialog_shared_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.getDialog(this.dialogData.speaker);case 2:t.sent.render(!0);case 3:case"end":return t.stop()}}),_callee4,this)}))),function addTarget(t){return r.apply(this,arguments)})},{key:"prepareFormRecall",value:function prepareFormRecall(t){var r=this;if(this.recallData)for(var o in this.recallData)if("specAbs"==o){var a,i=_createForOfIteratorHelper(this.recallData[o]);try{for(i.s();!(a=i.n()).done;){var c=a.value,u=t.find('.specAbs[data-id="'.concat(c.id,'"]'));u.addClass("active").attr("data-step",c.step),u.find(".step").text(DialogShared.roman[c.step])}}catch(t){i.e(t)}finally{i.f()}}else{var l=t.find('[name="'.concat(o,'"]'));if(Array.isArray(this.recallData[o])){var p,d=_createForOfIteratorHelper(l.find("option"));try{var h=function _loop(){var t=p.value,a=r.recallData[o].find((function(r){return r.name==$(t).text().trim()}));a&&(t.selected=a.selected)};for(d.s();!(p=d.n()).done;)h()}catch(t){d.e(t)}finally{d.f()}}else"checkbox"==l.attr("type")?l[0].checked=this.recallData[o]:l.val(this.recallData[o])}}}]),DialogShared}();!function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(u,"roman",[""," I"," II"," III"," IV"," V"," VI"," VII"," VIII"," IX"," X"])},846:(t,r,o)=>{o.d(r,{q:()=>conditionsMatcher,v:()=>setEnrichers});var a=o(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function setEnrichers(){var t,r={Rq:"roll"},o={Rq:"dice"},i={Rq:""},c=/(-|\+)?\d+/,u=/\[[a-zA-zöüäÖÜÄ&; -]+/,l=/[\[\]]/g;if(!a.Z.statusRegex){var p=a.Z.statusEffects.map((function(t){return game.i18n.localize(t.label).toLowerCase()})),d=["status","condition","level","levels"].map((function(t){return game.i18n.localize(t)})).join("|");a.Z.statusRegex={effects:p,regex:new RegExp("(".concat(d,") (").concat(p.join("|"),")"),"gi")}}CONFIG.TextEditor.enrichers.push({pattern:/@(Rq|Gc|Ch)\[[a-zA-zöüäÖÜÄ&; -]+ (-|\+)?\d+\]/g,enricher:function enricher(t,a){var p=t[0],d=t[1],h=Number(p.match(c)[0]),y=p.replace(h,"").match(u)[0].replace(l,"").trim();return $('<a class="roll-button request-'.concat(r[d],'" data-type="skill" data-modifier="').concat(h,'" data-name="').concat(y,'"><em class="fas fa-').concat(o[d],'"></em>').concat(i[d]).concat(y," ").concat(h,"</a>"))[0]}},{pattern:a.Z.statusRegex.regex,enricher:function enricher(t,r){return $(conditionsMatcher(t))[0]}},{pattern:/@Info\[[a-zA-zöüäÖÜÄ&; -\.0-9]+\]/g,enricher:(t=function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(t,r){var o,a,i;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return o=t[0].match(/(?<=\[)(.*?)(?=\])/)[0],r.next=3,fromUuid(o);case 3:if((a=r.sent)&&"information"==a.type){r.next=6;break}return r.abrupt("return",$('<a class="content-link broken"><i class="fas fa-unlink"></i>info</a>')[0]);case 6:if(game.user.isGM){r.next=8;break}return r.abrupt("return",$('<a class="content-link"><i class="fas fa-mask"></i>'.concat(game.i18n.localize("dsk.GM notes"),"</a>"))[0]);case 8:return r.next=10,renderTemplate("systems/dsk/templates/items/infopreview.html",{item:a});case 10:return i=r.sent,r.abrupt("return",$(i)[0]);case 12:case"end":return r.stop()}}),_callee)}))),function enricher(r,o){return t.apply(this,arguments)})})}function conditionsMatcher(t){var r=t[0].split(" "),o=r.shift();r=r.join(" ");var i=a.Z.statusEffects[a.Z.statusRegex.effects.indexOf(r.toLowerCase())];return"<span>".concat(o,' <a class="chatButton chat-condition" data-id="').concat(i.id,'"><img src="').concat(i.icon,'"/>').concat(r,"</a></span>")}},140:(t,r,o)=>{o.d(r,{Z:()=>j});var a=o(231),i=o(973),c=o(278),u=o(614),l=o(832),p=o(930),d=o(582),h=o(122),y=o(514),m=o(565);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}Hooks.once("ready",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:if(g.creatureData){r.next=11;break}return r.next=3,fetch("systems/dsk/lazy/creaturetype/".concat(game.i18n.lang,".json"));case 3:return t=r.sent,r.next=6,t.json();case 6:g.creatureData=r.sent,g.magical=game.i18n.localize("dsk.WEAPON.magical"),g.clerical=game.i18n.localize("dsk.WEAPON.clerical"),g.silverPlated=game.i18n.localize("dsk.WEAPON.silverPlated"),game.dsk.apps.CreatureType=g;case 11:case"end":return r.stop()}}),_callee)}))));var g=function(){function CreatureType(t){_classCallCheck(this,CreatureType),this.creatureClass=t,this.spellImmunities=[],this.poisonImmunity=!1,this.diseaseImmunity=!1}return _createClass(CreatureType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!1}},{key:"damageModifier",value:function damageModifier(t){return[]}},{key:"spellImmunity",value:function spellImmunity(t){return this.spellImmunities.some((function(r){return t.includes(r)}))}},{key:"spellArmorModifier",value:function spellArmorModifier(t){return 0}},{key:"poisonImmunity",value:function poisonImmunity(){return this.poisonImmunity}},{key:"diseaseImmunity",value:function diseaseImmunity(){return this.diseaseImmunity}},{key:"spellResistanceModifier",value:function spellResistanceModifier(t){return 0}},{key:"weaponAttributes",value:function weaponAttributes(t){return getProperty(t,"system.effect.attributes")||""}},{key:"getTypeByClass",value:function getTypeByClass(t){return Object.keys(CreatureType.creatureData.types).find((function(r){return CreatureType.creatureData.types[r]===t}))}},{key:"isAttackItem",value:function isAttackItem(t){return["meleeweapon","trait","rangeweapon"].includes(t.type)&&function isNotEmpty(t){return!(!t||0===t.length)}(this.weaponAttributes(t))}},{key:"attributesRegex",value:function attributesRegex(t){var r=this.weaponAttributes(t);return new RegExp("(".concat(r.split(",").map((function(t){return l.Z.escapeRegex(t.split("(")[0].trim())})).join("|"),")"),"i")}}],[{key:"detectCreatureType",value:function detectCreatureType(t){var r=this,o=t.system.details.species;return Object.keys(CreatureType.creatureData.types).filter((function(t){return o.indexOf(t)>=0})).map((function(t){return r.getClass(CreatureType.creatureData.types[t],o)}))}},{key:"getClass",value:function getClass(t,r){return new(0,{DemonType:w,ChimeraType:_,DaimonidType:b,DragonType:k,ElementalType:x,FairyType:O,GhostType:S,GolemType:P,HomunculiType:T,IntelligentCreatureType:I,PlantType:E,AnimalType:C,UndeadType:A,SupernaturalType:R,MagicalConstructType:G,WerCreatureType:L,VampireType:D}[t])(r)}},{key:"creatureTypeName",value:function creatureTypeName(t){if("creature"==t.type){var r=t.system.species;return Object.keys(CreatureType.creatureData.types).filter((function(t){return r.indexOf(t)>=0}))[0]}return t.system.details.species}},{key:"addCreatureTypeModifiers",value:function addCreatureTypeModifiers(t,r,o,a){var i,c=CreatureType.detectCreatureType(t),u=["spell","ceremony","liturgy","ritual"].includes(r.type),l=_createForOfIteratorHelper(c);try{for(l.s();!(i=l.n()).done;){var p=i.value,d=p.damageModifier(r);if(u){var h,y=_createForOfIteratorHelper(d);try{for(y.s();!(h=y.n()).done;){h.value.armorPen=p.spellResistanceModifier(t)}}catch(t){y.e(t)}finally{y.f()}}o.push.apply(o,_toConsumableArray(d))}}catch(t){l.e(t)}finally{l.f()}o.push.apply(o,_toConsumableArray(this.creatureBonusDamage(t,a))),CreatureType.addVulnerabilitiesToSource(t,r,o)}},{key:"addVulnerabilitiesToSource",value:function addVulnerabilitiesToSource(t,r,o){var a=getProperty(t,"system.vulnerabilities");a&&(["meleeweapon","rangeweapon"].includes(r.type)&&getProperty(a,"combatskill").reduce((function(t,a){if(a.target==r.system.combatskill){var i=(/\*/.test(a.value)?Number(a.value.replace("*",""))>1:Number(a.value)>0)?"WEAPON.vulnerableTo":"WEAPON.resistantTo";o.push.apply(o,_toConsumableArray(CreatureType.buildDamageMod("".concat(game.i18n.format(i,{name:r.system.combatskill})," (").concat(a.source,")"),a.value)))}}),o))}},{key:"creatureBonusDamage",value:function creatureBonusDamage(t,r){var o,a=[],i=t.system.details.species,c=_createForOfIteratorHelper(getProperty(r,"system.creatureBonus"));try{for(c.s();!(o=c.n()).done;){var u=o.value;i.indexOf(u.target)>=0&&a.push.apply(a,_toConsumableArray(this.buildDamageMod(u.source,u.value,!0)))}}catch(t){c.e(t)}finally{c.f()}return a}},{key:"buildDamageMod",value:function buildDamageMod(t,r){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return[{name:t,value:r,selected:o,type:"dmg",source:game.i18n.localize("dsk.target")}]}}]),CreatureType}();_defineProperty(g,"creatureData",void 0),_defineProperty(g,"magical",void 0),_defineProperty(g,"clerical",void 0);var v=function(t){_inherits(VulnerableToLifeGods,t);var r=_createSuper(VulnerableToLifeGods);function VulnerableToLifeGods(){return _classCallCheck(this,VulnerableToLifeGods),r.apply(this,arguments)}return _createClass(VulnerableToLifeGods,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r,o=this.attributesRegex(t),a=_createForOfIteratorHelper(g.creatureData.godOfLife);try{for(a.s();!(r=a.n()).done;){var i=r.value,c="".concat(g.clerical," (").concat(i,")");if(o.test(c))return g.buildDamageMod(c,"*2")}}catch(t){a.e(t)}finally{a.f()}}return _get(_getPrototypeOf(VulnerableToLifeGods.prototype),"damageModifier",this).call(this,t)}}]),VulnerableToLifeGods}(g),_=function(t){_inherits(ChimeraType,t);var r=_createSuper(ChimeraType);function ChimeraType(){return _classCallCheck(this,ChimeraType),r.apply(this,arguments)}return _createClass(ChimeraType)}(v),b=function(t){_inherits(DaimonidType,t);var r=_createSuper(DaimonidType);function DaimonidType(t){var o;return _classCallCheck(this,DaimonidType),(o=r.call(this,t)).spellImmunities=["Influence","Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o}return _createClass(DaimonidType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)&&this.attributesRegex(t).test(g.clerical))return g.buildDamageMod(g.clerical,"*2");return _get(_getPrototypeOf(DaimonidType.prototype),"damageModifier",this).call(this,t)}}]),DaimonidType}(g),k=function(t){_inherits(DragonType,t);var r=_createSuper(DragonType);function DragonType(){return _classCallCheck(this,DragonType),r.apply(this,arguments)}return _createClass(DragonType)}(g),w=function(t){_inherits(DemonType,t);var r=_createSuper(DemonType);function DemonType(t){var o;return _classCallCheck(this,DemonType),(o=r.call(this,t)).spellImmunities=["Influence","Transformation","Healing","Illusion"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o.poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(DemonType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r=this.attributesRegex(t);if(r.test(g.clerical))return g.buildDamageMod("".concat(g.clerical," (").concat(g.creatureData.opposingGod,")"),"*2",!1);if(r.test(g.magical))return _get(_getPrototypeOf(DemonType.prototype),"damageModifier",this).call(this,t)}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return _get(_getPrototypeOf(DemonType.prototype),"damageModifier",this).call(this,t);return g.buildDamageMod(this.getTypeByClass("DemonType"),"*0.5")}},{key:"spellArmorModifier",value:function spellArmorModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"spellResistanceModifier",value:function spellResistanceModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"ignoredCondition",value:function ignoredCondition(t){return!0}}]),DemonType}(g),x=function(t){_inherits(ElementalType,t);var r=_createSuper(ElementalType);function ElementalType(t){var o;return _classCallCheck(this,ElementalType),(o=r.call(this,t)).poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(ElementalType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){if(this.attributesRegex(t).test(g.magical))return _get(_getPrototypeOf(ElementalType.prototype),"damageModifier",this).call(this,t)}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return g.buildDamageMod(this.getTypeByClass("ElementalType"),"*1");return g.buildDamageMod(this.getTypeByClass("ElementalType"),"*0.5")}},{key:"spellArmorModifier",value:function spellArmorModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"spellResistanceModifier",value:function spellResistanceModifier(t){return Number(t.system.stats.soulpower.max)}},{key:"ignoredCondition",value:function ignoredCondition(t){return!0}}]),ElementalType}(g),O=function(t){_inherits(FairyType,t);var r=_createSuper(FairyType);function FairyType(t){var o;return _classCallCheck(this,FairyType),(o=r.call(this,t)).spellImmunities=["Illusion"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o.poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(FairyType)}(g),S=function(t){_inherits(GhostType,t);var r=_createSuper(GhostType);function GhostType(t){var o;return _classCallCheck(this,GhostType),(o=r.call(this,t)).spellImmunities=["Illusion","Healing","Telekinesis","Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o.poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(GhostType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r,o=this.attributesRegex(t),a=_createForOfIteratorHelper(g.creatureData.godOfDeath);try{for(a.s();!(r=a.n()).done;){var i=r.value,c="".concat(g.clerical," (").concat(i,")");if(o.test(c))return[]}}catch(t){a.e(t)}finally{a.f()}if((o=this.attributesRegex(t)).test(g.clerical))return g.buildDamageMod(g.clerical,"*0.5");if(o.test(g.magical))return g.buildDamageMod(g.magical,"*0.5")}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return g.buildDamageMod(g.magical,"*0.5");return g.buildDamageMod(this.getTypeByClass("GhostType"),"*0")}},{key:"ignoredCondition",value:function ignoredCondition(t){return!["feared","inpain","confused"].includes(t)}}]),GhostType}(g),P=function(t){_inherits(GolemType,t);var r=_createSuper(GolemType);function GolemType(t){var o;return _classCallCheck(this,GolemType),(o=r.call(this,t)).spellImmunities=["Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o.poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(GolemType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!["confused","paralysed"].includes(t)}}]),GolemType}(v),T=function(t){_inherits(HomunculiType,t);var r=_createSuper(HomunculiType);function HomunculiType(t){var o;return _classCallCheck(this,HomunculiType),(o=r.call(this,t)).spellImmunities=["Healing"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o}return _createClass(HomunculiType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!["inpain","encumbered","stunned","feared","paralysed","confused"].includes(t)}}]),HomunculiType}(v),I=function(t){_inherits(IntelligentCreatureType,t);var r=_createSuper(IntelligentCreatureType);function IntelligentCreatureType(){return _classCallCheck(this,IntelligentCreatureType),r.apply(this,arguments)}return _createClass(IntelligentCreatureType)}(g),E=function(t){_inherits(PlantType,t);var r=_createSuper(PlantType);function PlantType(){return _classCallCheck(this,PlantType),r.apply(this,arguments)}return _createClass(PlantType)}(g),C=function(t){_inherits(AnimalType,t);var r=_createSuper(AnimalType);function AnimalType(){return _classCallCheck(this,AnimalType),r.apply(this,arguments)}return _createClass(AnimalType)}(g),A=function(t){_inherits(UndeadType,t);var r=_createSuper(UndeadType);function UndeadType(t){var o;return _classCallCheck(this,UndeadType),(o=r.call(this,t)).spellImmunities=["Influence","Healing","Illusion"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o.poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(UndeadType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){var r,o=this.attributesRegex(t),a=_createForOfIteratorHelper(g.creatureData.godOfDeath);try{for(a.s();!(r=a.n()).done;){var i=r.value,c="".concat(g.clerical," (").concat(i,")");if(o.test(c))return g.buildDamageMod(c,"*2")}}catch(t){a.e(t)}finally{a.f()}}return _get(_getPrototypeOf(UndeadType.prototype),"damageModifier",this).call(this,t)}},{key:"ignoredCondition",value:function ignoredCondition(t){return!["paralysed"].includes(t)}}]),UndeadType}(g),R=function(t){_inherits(SupernaturalType,t);var r=_createSuper(SupernaturalType);function SupernaturalType(){return _classCallCheck(this,SupernaturalType),r.apply(this,arguments)}return _createClass(SupernaturalType)}(g),G=function(t){_inherits(MagicalConstructType,t);var r=_createSuper(MagicalConstructType);function MagicalConstructType(t){var o;return _classCallCheck(this,MagicalConstructType),(o=r.call(this,t)).spellImmunities=["Transformation"].map((function(t){return game.i18n.localize("Features.".concat(t))})),o.poisonImmunity=!0,o.diseaseImmunity=!0,o}return _createClass(MagicalConstructType,[{key:"ignoredCondition",value:function ignoredCondition(t){return!["stunned","feared","paralysed","confused"].includes(t)}}]),MagicalConstructType}(g),L=function(t){_inherits(WerCreatureType,t);var r=_createSuper(WerCreatureType);function WerCreatureType(){return _classCallCheck(this,WerCreatureType),r.apply(this,arguments)}return _createClass(WerCreatureType,[{key:"damageModifier",value:function damageModifier(t){if(this.isAttackItem(t)){if(this.attributesRegex(t).test(g.silverPlated))return g.buildDamageMod(this.getTypeByClass("WerCreatureType"),"*2")}else if(["spell","ceremony","liturgy","ritual"].includes(t.type))return _get(_getPrototypeOf(WerCreatureType.prototype),"damageModifier",this).call(this,t);return g.buildDamageMod(this.getTypeByClass("WerCreatureType"),"*0.5")}}]),WerCreatureType}(g),D=function(t){_inherits(VampireType,t);var r=_createSuper(VampireType);function VampireType(){return _classCallCheck(this,VampireType),r.apply(this,arguments)}return _createClass(VampireType,[{key:"damageModifier",value:function damageModifier(t){return["spell","ceremony","liturgy","ritual"].includes(t.type)?_get(_getPrototypeOf(VampireType.prototype),"damageModifier",this).call(this,t):g.buildDamageMod(this.getTypeByClass("VampireType"),"*0.5")}}]),VampireType}(g);function item_dsk_typeof(t){return item_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},item_dsk_typeof(t)}function item_dsk_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=item_dsk_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){item_dsk_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function item_dsk_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function item_dsk_toConsumableArray(t){return function item_dsk_arrayWithoutHoles(t){if(Array.isArray(t))return item_dsk_arrayLikeToArray(t)}(t)||function item_dsk_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||item_dsk_unsupportedIterableToArray(t)||function item_dsk_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function item_dsk_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return item_dsk_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?item_dsk_arrayLikeToArray(t,r):void 0}}function item_dsk_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function item_dsk_regeneratorRuntime(){item_dsk_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==item_dsk_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function item_dsk_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function item_dsk_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){item_dsk_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){item_dsk_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function item_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function item_dsk_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function item_dsk_createClass(t,r,o){return r&&item_dsk_defineProperties(t.prototype,r),o&&item_dsk_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function item_dsk_get(){return item_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=item_dsk_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},item_dsk_get.apply(this,arguments)}function item_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=item_dsk_getPrototypeOf(t)););return t}function item_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&item_dsk_setPrototypeOf(t,r)}function item_dsk_setPrototypeOf(t,r){return item_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},item_dsk_setPrototypeOf(t,r)}function item_dsk_createSuper(t){var r=function item_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=item_dsk_getPrototypeOf(t);if(r){var i=item_dsk_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return item_dsk_possibleConstructorReturn(this,o)}}function item_dsk_possibleConstructorReturn(t,r){if(r&&("object"===item_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function item_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function item_dsk_getPrototypeOf(t){return item_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},item_dsk_getPrototypeOf(t)}var j=function(t){item_dsk_inherits(ItemDSK,Item);var r,o,a,u,d,h,v,_,b=item_dsk_createSuper(ItemDSK);function ItemDSK(){return item_dsk_classCallCheck(this,ItemDSK),b.apply(this,arguments)}return item_dsk_createClass(ItemDSK,[{key:"addCondition",value:(_=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee(t){var r,o,a,c=arguments;return item_dsk_regeneratorRuntime().wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:1,o=c.length>2&&void 0!==c[2]&&c[2],a=!(c.length>3&&void 0!==c[3])||c[3],u.next=5,i.Z.addCondition(this,t,r,o,a);case 5:return u.abrupt("return",u.sent);case 6:case"end":return u.stop()}}),_callee,this)}))),function addCondition(t){return _.apply(this,arguments)})},{key:"_dependentEffects",value:(v=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee2(t,r,o){return item_dsk_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),_callee2)}))),function _dependentEffects(t,r,o){return v.apply(this,arguments)})},{key:"removeCondition",value:(h=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee3(t){var r,o,a,c=arguments;return item_dsk_regeneratorRuntime().wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:1,o=!(c.length>2&&void 0!==c[2])||c[2],a=c.length>3&&void 0!==c[3]&&c[3],u.abrupt("return",i.Z.removeCondition(this,t,r,o,a));case 4:case"end":return u.stop()}}),_callee3,this)}))),function removeCondition(t){return h.apply(this,arguments)})},{key:"hasCondition",value:function hasCondition(t){return i.Z.hasCondition(this,t)}},{key:"postItem",value:(d=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee4(){return item_dsk_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:ItemDSK.getSubClass(this.type)._postItem(this);case 1:case"end":return t.stop()}}),_callee4,this)}))),function postItem(){return d.apply(this,arguments)})}],[{key:"defaultImages",value:function defaultImages(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o="".concat(t).concat(r);return{effectwrapper:"icons/svg/aura.svg",information:"systems/dsk/icons/categories/DSK-Auge.webp",ammunition:"systems/dsk/icons/categories/arrow.webp",equipment:"systems/dsk/icons/categories/equipment.webp",advantage:"systems/dsk/icons/categories/advantage.webp",disadvantage:"systems/dsk/icons/categories/disadvantage.webp",specialability:"systems/dsk/icons/categories/specialability.webp",combatskill:"systems/dsk/icons/categories/combatskill.webp"}[o]}},{key:"defaultIcon",value:function defaultIcon(t){t.img&&""!=t.img||(t.img=this.defaultImages(t.type)||"systems/dsk/icons/blank.webp")}},{key:"attackStatEffect",value:function attackStatEffect(t,r){0!=r&&t.push({name:game.i18n.localize("dsk.statuseffects"),value:r,selected:!0})}},{key:"prepareRangeAttack",value:function prepareRangeAttack(t,r,o,a,i,u){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:void 0;t.push.apply(t,item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.restrictedSenseSight"),-2))),this.getCombatSkillModifier(r,a,t);var d=this.getTargetSizeAndModifier(r,a,t),h=-1*Number(r.system.rangeStats.defenseMalus);0!=h&&t.push({name:"".concat(game.i18n.localize("dsk.statuseffects")," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),value:h,type:"defenseMalus",selected:!0});var g=_objectSpread({},p.Z.rangeWeaponModifiers);delete g[c.Z.hasVantage(r,game.i18n.localize("dsk.LocalizedIDs.senseOfRange"))?"long":"rangesense"],y.Z.hasAbility(r,game.i18n.localize("dsk.LocalizedIDs.extremeShot"))||delete g.extreme;var v=y.Z.hasAbility(r,game.i18n.localize("dsk.LocalizedIDs.drivingArcher")),_=v?duplicate(p.Z.drivingArcherOptions):duplicate(p.Z.mountedRangeOptions);mergeObject(o,{rangeOptions:g,rangeDistance:Object.keys(g)[m.Z.distanceModifier(game.canvas.tokens.get(i),a,l)],sizeOptions:p.Z.rangeSizeCategories,visionOptions:p.Z.rangeVision,mountedOptions:_,shooterMovementOptions:p.Z.shooterMovementOptions,targetMovementOptions:p.Z.targetMomevementOptions,targetSize:d,combatSpecAbs:u,aimOptions:p.Z.aimOptions})}},{key:"prepareMeleeAttack",value:function prepareMeleeAttack(t,r,o,a,i,c){var u="short";game.user.targets.forEach((function(t){if(t.actor){var r=t.actor.items.filter((function(t){return"meleeweapon"==t.type&&t.system.worn.value||"trait"==t.type&&"meleeAttack"==t.system.traitType&&t.system.pa}));r.length>0&&(u=r[0].system.rw)}}));var l=this.getTargetSizeAndModifier(r,a,t);this.getCombatSkillModifier(r,a,t);var d=-1*Number(r.system.meleeStats.defenseMalus);0!=d&&t.push({name:"".concat(game.i18n.localize("dsk.statuseffects")," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),value:d,type:"defenseMalus",selected:!0}),mergeObject(o,{visionOptions:p.Z.meleeRangeVision(),weaponSizes:p.Z.meleeRanges,melee:!0,showAttack:!0,targetWeaponSize:u,combatSpecAbs:i,meleeSizeOptions:p.Z.meleeSizeCategories,targetSize:l,constricted:r.hasCondition("constricted"),wrongHandDisabled:c,offHand:!c&&getProperty(a,"system.worn.offHand")})}},{key:"parseValueType",value:function parseValueType(t,r){var o="";return/^\*/.test(r)&&(o="*",r=r.substring(1).replace(",",".")),{name:t,value:Number(r),type:o}}},{key:"getSpecAbModifiers",value:function getSpecAbModifiers(t,r){var o,a=[],i=item_dsk_createForOfIteratorHelper(t.find(".specAbs"));try{for(i.s();!(o=i.n()).done;){var c=o.value,u=Number($(c).attr("data-step"));if(u>0){var l="attack"==r?$(c).attr("data-atbonus"):$(c).attr("data-pabonus"),p=l.split(",").reduce((function(t,r){return t+Number(r)}),0);a.push({name:$(c).find("a").text(),value:isNaN(p)?Number(l.replace("*","")):Number(p)*u,damageBonus:$(c).attr("data-tpbonus"),dmmalus:$(c).attr("data-dmmalus")*u,step:u,specAbId:$(c).attr("data-id"),type:/^\*/.test(l)?"*":void 0})}}}catch(t){i.e(t)}finally{i.f()}return a}},{key:"getTargetSizeAndModifier",value:function getTargetSizeAndModifier(t,r,o){var a="average";return game.user.targets.forEach((function(i){if(i.actor){var c=getProperty(i.actor,"system.details.size");c&&(a=c),g.addCreatureTypeModifiers(i.actor,r,o,t)}})),a}},{key:"getCombatSkillModifier",value:function getCombatSkillModifier(t,r,o){if("trait"!=r.type){var a,i=t.items.find((function(t){return"combatskill"==t.type&&t.name==r.system.combatskill})),c=item_dsk_createForOfIteratorHelper(i.effects);try{for(c.s();!(a=c.n()).done;){var u,l=item_dsk_createForOfIteratorHelper(a.value.changes);try{for(l.s();!(u=l.n()).done;){var p=u.value;switch(p.key){case"system.rangeStats.defenseMalus":case"system.meleeStats.defenseMalus":o.push({name:"".concat(i.name," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),value:-1*p.value,type:"defenseMalus",selected:!0})}}}catch(t){l.e(t)}finally{l.f()}}}catch(t){c.e(t)}finally{c.f()}}}},{key:"buildCombatSpecAbs",value:function buildCombatSpecAbs(t,r,o,a){var i;o?(o.push(game.i18n.localize("dsk.LocalizedIDs.all")),o=o.map((function(t){return t.toLowerCase()})),i=function searchFilter(t,r){return t.system.combatskills.split(/;|,/).map((function(t){return t.trim().toLowerCase()})).filter((function(t){return r.includes(t.replace(/ \([a-zA-Z äüöÄÖÜ]*\)/,""))})).length>0}):i=function searchFilter(){return!0};var c=t.items.filter((function(t){return"specialability"==t.type&&r.includes(t.system.category)&&""!=t.system.effect&&i(t,o)})),u=[],l=game.i18n.localize("dsk.LocalizedAbilityModifiers.at"),d=game.i18n.localize("dsk.LocalizedAbilityModifiers.tp"),h=game.i18n.localize("dsk.LocalizedAbilityModifiers.pa"),y=game.i18n.localize("dsk.LocalizedAbilityModifiers.dm");if("attack"==a){var m,g=item_dsk_createForOfIteratorHelper(c);try{for(g.s();!(m=g.n()).done;){var v=m.value,_=ItemDSK.parseEffect(v.system.effect,t),b=_[l]||0,k=_[d]||0,w=_[y]||0;if(0!=b||0!=k||0!=w||v.effects.size>0){var x=game.i18n.localize(p.Z.combatSkillSubCategories[v.system.subcategory]);u.push({name:v.name,atbonus:b,tpbonus:k,dmmalus:w,label:"".concat(l,": ").concat(b,", ").concat(d,": ").concat(k,", ").concat(y,": ").concat(w),steps:v.system.level,category:{id:v.system.subcategory,css:"ab_".concat(v.system.subcategory),name:x},id:v.id,actor:t.id})}}}catch(t){g.e(t)}finally{g.f()}}else{var O,S=item_dsk_createForOfIteratorHelper(c);try{for(S.s();!(O=S.n()).done;){var P=O.value,T=ItemDSK.parseEffect(P.system.effect,t)[h]||0;if(0!=T){var I=game.i18n.localize(p.Z.combatSkillSubCategories[P.system.subcategory]);u.push({name:P.name,pabonus:T,tpbonus:0,dmmalus:0,label:"".concat(h,": ").concat(T),steps:P.system.level,category:{id:P.system.category.sub,css:"ab_".concat(P.system.subcategory),name:I},id:P.id,actor:t.id})}}}catch(t){S.e(t)}finally{S.f()}}return u}},{key:"getSkZkModifier",value:function getSkZkModifier(t,r){var o=[],a=[],i=["ahnengabe"].includes(r.type)&&""==r.system.effectFormula.trim();game.user.targets.size&&game.user.targets.forEach((function(t){if(t.actor){var r=0;if(i)r=g.detectCreatureType(t.actor).reduce((function(r,o){return r+o.spellResistanceModifier(t.actor)}),0);o.push(-1*t.actor.system.stats.sk.max-r),a.push(-1*t.actor.system.stats.zk.max-r)}})),mergeObject(t,{SKModifier:o.length>0?Math.min.apply(Math,o):0,ZKModifier:a.length>0?Math.min.apply(Math,a):0})}},{key:"create",value:(u=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee5(t,r){return item_dsk_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return this.defaultIcon(t),o.next=3,item_dsk_get(item_dsk_getPrototypeOf(ItemDSK),"create",this).call(this,t,r);case 3:return o.abrupt("return",o.sent);case 4:case"end":return o.stop()}}),_callee5,this)}))),function create(t,r){return u.apply(this,arguments)})},{key:"changeChars",value:function changeChars(t,r,o){t.system.characteristic1=r,t.system.characteristic2=o}},{key:"getSubClass",value:function getSubClass(t){return game.dsk.config.ItemSubClasses[t]||ItemDSK}},{key:"areEquals",value:function areEquals(t,r){return t.type==r.type&&ItemDSK.getSubClass(t.type).checkEquality(t,r)}},{key:"checkEquality",value:function checkEquality(t,r){return r.type==t.type&&t.name==r.name&&t.system.description.value==r.system.description.value}},{key:"setupDialog",value:function setupDialog(t,r,o,a,i){return null}},{key:"buildSpeaker",value:function buildSpeaker(t,r){return{token:r,actor:t?t.id:void 0,scene:canvas.scene?canvas.scene.id:null}}},{key:"stackItems",value:(a=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee6(t,r,o){return item_dsk_regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,ItemDSK.getSubClass(t.type).combineItem(t,r,o);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee6)}))),function stackItems(t,r,o){return a.apply(this,arguments)})},{key:"combineItem",value:(o=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee7(t,r,o){return item_dsk_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return(t=duplicate(t)).system.quantity+=r.system.quantity,a.next=4,o.updateEmbeddedDocuments("Item",[t]);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}}),_callee7)}))),function combineItem(t,r,a){return o.apply(this,arguments)})},{key:"_chatLineHelper",value:function _chatLineHelper(t,r){return"<b>".concat(game.i18n.localize(t),"</b>: ").concat(r||"-")}},{key:"setupSubClasses",value:function setupSubClasses(){game.dsk.config.ItemSubClasses={meleeweapon:H,rangeweapon:K,armor:W,ammunition:B,equipment:Z,species:q,culture:Y,profession:U,advantage:V,disadvantage:J,specialability:Q,ahnengeschenk:X,ahnengabe:ee,poison:te,skill:re,combatskill:ne,effectwrapper:z,information:M,trait:N}}},{key:"parseEffect",value:function parseEffect(t,r){var o,a={},i=new RegExp(game.i18n.localize("dsk.CHARAbbrev.GS"),"gi"),c=item_dsk_createForOfIteratorHelper(t.split(/,|;/).map((function(t){return t.trim()})));try{for(c.s();!(o=c.n()).done;){var u=o.value.replace(/(\s+)/g," ").trim().split(" ");u[0]=u[0].replace(i,r.system.stats.gs.max),2==u.length&&(!isNaN(u[0])||/(=)?[+-]\d([+-]\d)?/.test(u[0])||/(=)?\d[dDwW]\d/.test(u[0])||/=\d+/.test(u[0])||/\*\d(\.\d)*/.test(u[0]))&&(null==a[u[1].toLowerCase()]?a[u[1].toLowerCase()]=[u[0]]:a[u[1].toLowerCase()].push(u[0]))}}catch(t){c.e(t)}finally{c.f()}return a}},{key:"chatData",value:function chatData(t,r){return[]}},{key:"_postItem",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee8(t){var r,o,a,i,c;return item_dsk_regeneratorRuntime().wrap((function _callee8$(u){for(;;)switch(u.prev=u.next){case 0:return r=duplicate(t),o=getProperty(r,"system.obfuscation.details"),a=getProperty(r,"system.obfuscation.description"),mergeObject(r,{properties:o?[]:ItemDSK.getSubClass(t.type).chatData(duplicate(r.system),t.name),descriptionObfuscated:a}),r.hasPrice="price"in r.system&&!o,r.hasPrice&&r.properties.push("<b>".concat(game.i18n.localize("dsk.price"),"</b>: ").concat(r.system.price)),t.pack&&(r.itemLink=t.link),r.img.includes("/blank.webp")&&(r.img=null),u.next=10,renderTemplate("systems/dsk/templates/chat/post-item.html",r);case 10:i=u.sent,c=l.Z.chatDataSetup(i),ChatMessage.create(c);case 13:case"end":return u.stop()}}),_callee8)}))),function _postItem(t){return r.apply(this,arguments)})}]),ItemDSK}(),M=function(t){item_dsk_inherits(ItemInformation,t);var r,o=item_dsk_createSuper(ItemInformation);function ItemInformation(){return item_dsk_classCallCheck(this,ItemInformation),o.apply(this,arguments)}return item_dsk_createClass(ItemInformation,null,[{key:"_postItem",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee9(t){var r,o;return item_dsk_regeneratorRuntime().wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,renderTemplate("systems/dsk/templates/chat/informationRequestRoll.html",{item:t});case 2:r=a.sent,o=l.Z.chatDataSetup(r),ChatMessage.create(o);case 5:case"end":return a.stop()}}),_callee9)}))),function _postItem(t){return r.apply(this,arguments)})}]),ItemInformation}(j),z=function(t){item_dsk_inherits(ItemEffectwrapper,t);var r=item_dsk_createSuper(ItemEffectwrapper);function ItemEffectwrapper(){return item_dsk_classCallCheck(this,ItemEffectwrapper),r.apply(this,arguments)}return item_dsk_createClass(ItemEffectwrapper)}(j),N=function(t){item_dsk_inherits(ItemTrait,t);var r=item_dsk_createSuper(ItemTrait);function ItemTrait(){return item_dsk_classCallCheck(this,ItemTrait),r.apply(this,arguments)}return item_dsk_createClass(ItemTrait,null,[{key:"chatData",value:function chatData(t,r){var o=[];switch(t.traitType){case"meleeAttack":o=[this._chatLineHelper("dsk.ABBR.AW",t.at),this._chatLineHelper("dsk.damage",t.damage),this._chatLineHelper("dsk.range",t.rw)];break;case"rangeAttack":o=[this._chatLineHelper("dsk.ABBR.AW",t.at),this._chatLineHelper("dsk.damage",t.damage),this._chatLineHelper("dsk.range",t.rw),this._chatLineHelper("dsk.reloadTime",t.lz)];break;case"armor":o=[this._chatLineHelper("dsk.protection",t.damage)]}return o}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,o,a,i){var c=(a=l.Z.toObjectIfPossible(a)).system.traitType,u=j.buildCombatSpecAbs(r,["Combat","animal"],void 0,o.mode);"attack"==o.mode&&"meleeAttack"==c?this.prepareMeleeAttack(t,r,o,a,u,!1):"attack"==o.mode&&"rangeAttack"==c&&this.prepareRangeAttack(t,r,o,a,i,u),this.attackStatEffect(t,Number(r.system["meleeAttack"==c?"meleeStats":"rangeStats"][o.mode]))}},{key:"setupDialog",value:function setupDialog(t,r,o,a,c){var l=r.mode,p=o.name+" "+game.i18n.localize(l+"test");mergeObject(o.system,{characteristic1:"attack",characteristic2:"attack"});var y={opposable:!0,source:o,mode:l,extra:{actor:a.toObject(!1),options:r,speaker:j.buildSpeaker(a,c)}},m=h.Z.multipleDefenseValue(a,o.toObject()),g={rollMode:r.rollMode,mode:l,defenseCountString:game.i18n.format("dsk.defenseCount",{malus:m})},v=getProperty(o,"system.traitType"),_=a?i.Z.getRollModifiers(a,o,{mode:l}):[];this.getSituationalModifiers(_,a,g,o,c),g.situationalModifiers=_;var b={title:p,template:"/systems/dsk/templates/dialog/combatskill-enhanced-dialog.html",data:g,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"meleeAttack"==v?d.Z.resolveMeleeDialog(y,k,t,a,r,m,l):d.Z.resolveRangeDialog(y,k,t,a,r),y.isRangeDefense=g.isRangeDefense,Hooks.call("callbackDialogCombatDSK",y,a,t,o,c),{testData:y,cardOptions:k}}},k=a._setupCardOptions("systems/dsk/templates/chat/roll/combatskill-card.html",p,c);return u.Z.setupDialog({dialogOptions:b,testData:y,cardOptions:k})}}]),ItemTrait}(j),H=function(t){item_dsk_inherits(ItemMeleeweapon,t);var r=item_dsk_createSuper(ItemMeleeweapon);function ItemMeleeweapon(){return item_dsk_classCallCheck(this,ItemMeleeweapon),r.apply(this,arguments)}return item_dsk_createClass(ItemMeleeweapon,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.damage",t.tp),this._chatLineHelper("dsk.ABBR.awvw","".concat(t.aw," / ").concat(t.vw)),this._chatLineHelper("ITEM.TypeCombatskill",t.combatskill),this._chatLineHelper("dsk.range",game.i18n.localize("dsk.Range.".concat(t.rw)))]}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,o,a){var i=c.Z.hasVantage(r,game.i18n.localize("dsk.LocalizedIDs.ambidextrous")),u=[(a=l.Z.toObjectIfPossible(a)).system.combatskill],p=j.buildCombatSpecAbs(r,["Combat"],u,o.mode);"attack"==o.mode&&this.prepareMeleeAttack(t,r,o,a,p,i),this.attackStatEffect(t,Number(r.system.meleeStats[o.mode]))}},{key:"setupDialog",value:function setupDialog(t,r,o,a,c){var l=r.mode,p=o.name+" "+game.i18n.localize("dsk."+l+"test"),y=a.items.find((function(t){return"combatskill"==t.type&&t.name==o.system.combatskill}));mergeObject(o.system,{characteristic1:y.system.characteristic1,characteristic2:y.system.characteristic2});var m={opposable:!0,source:o,mode:l,extra:{actor:a.toObject(!1),options:r,speaker:j.buildSpeaker(a,c)}},g=h.Z.multipleDefenseValue(a,m.source),v={rollMode:r.rollMode,mode:l,defenseCountString:game.i18n.format("dsk.defenseCount",{malus:g})},_=a?i.Z.getRollModifiers(a,o,{mode:l}):[];this.getSituationalModifiers(_,a,v,o),v.situationalModifiers=_;var b={title:p,template:"/systems/dsk/templates/dialog/combatskill-enhanced-dialog.html",data:v,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.Z.resolveMeleeDialog(m,k,t,a,r,g,l),Hooks.call("callbackDialogCombatDSK",m,a,t,o,c),m.isRangeDefense=v.isRangeDefense,{testData:m,cardOptions:k}}},k=a._setupCardOptions("systems/dsk/templates/chat/roll/combatskill-card.html",p,c);return u.Z.setupDialog({dialogOptions:b,testData:m,cardOptions:k})}}]),ItemMeleeweapon}(j),K=function(t){item_dsk_inherits(ItemRangeweapon,t);var r,o,a=item_dsk_createSuper(ItemRangeweapon);function ItemRangeweapon(){return item_dsk_classCallCheck(this,ItemRangeweapon),a.apply(this,arguments)}return item_dsk_createClass(ItemRangeweapon,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.damage",t.tp),this._chatLineHelper("ITEM.TypeCombatskill",t.combatskill),this._chatLineHelper("dsk.range",t.rw)]}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,o,a,i){if("attack"==o.mode){var c=l.Z.toObjectIfPossible(a),u=[c.system.combatskill],p=j.buildCombatSpecAbs(r,["Combat"],u,o.mode),d=r.items.get(c.system.currentAmmo);if(d){d=d.toObject(!1);var h=getProperty(d.flags,"dsk.poison");h&&mergeObject(a.flags,{dsk:{poison:h}})}if(this.prepareRangeAttack(t,r,o,c,i,p,d),d){if(d.system.atmod&&t.push({name:"".concat(d.name," - ").concat(game.i18n.localize("dsk.atmod")),value:d.system.atmod,selected:!0,specAbId:c.system.currentAmmo}),d.system.damageMod||d.system.armorMod){var y={name:"".concat(d.name," - ").concat(game.i18n.localize("dsk.MODS.damage")),value:d.system.damageMod.replace(/wWD/g,"d")||0,type:"dmg",selected:!0,specAbId:c.system.currentAmmo};d.system.armorMod&&(y.armorPen=d.system.armorMod),t.push(y)}d.effects.length&&t.push({name:"".concat(d.name," - ").concat(game.i18n.localize("dsk.effect")),value:1,type:game.i18n.localize("dsk.effect"),selected:!0,specAbId:c.system.currentAmmo})}}this.attackStatEffect(t,Number(r.system.rangeStats[o.mode]))}},{key:"checkAmmunitionState",value:(o=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee10(t,r,o,a){var i,c,u;return item_dsk_regeneratorRuntime().wrap((function _callee10$(l){for(;;)switch(l.prev=l.next){case 0:return i=!0,"damage"!=a&&("infinite"==(c=t.system).ammunitionType||("-"==c.ammunitionType?(r.extra.ammo=duplicate(t),i=r.extra.ammo.system.quantity>0):(u=o.items.get(c.currentAmmo))?(r.extra.ammo=u.toObject(),i="mag"==c.ammunitionType?r.extra.ammo.system.quantity>1||r.extra.ammo.system.mag.value>0&&r.extra.ammo.system.quantity>0:r.extra.ammo.system.quantity>0):i=!1),i||"creature"!=o.type||(i=!0)),i||ui.notifications.error(game.i18n.localize("dsk.DSKError.NoAmmo")),l.abrupt("return",i);case 4:case"end":return l.stop()}}),_callee10)}))),function checkAmmunitionState(t,r,a,i){return o.apply(this,arguments)})},{key:"setupDialog",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee11(t,r,o,a,c){var l,p,h,y,m,g,v,_;return item_dsk_regeneratorRuntime().wrap((function _callee11$(t){for(;;)switch(t.prev=t.next){case 0:return l=r.mode,p=o.name+" "+game.i18n.localize("dsk."+l+"test"),h=a.items.find((function(t){return"combatskill"==t.type&&t.name==o.system.combatskill})),mergeObject(o.system,{characteristic1:h.system.characteristic1,characteristic2:h.system.characteristic2}),y={opposable:!0,source:o,mode:l,extra:{actor:a.toObject(!1),options:r,speaker:j.buildSpeaker(a,c)}},t.next=7,this.checkAmmunitionState(o,y,a,l);case 7:if(t.sent){t.next=9;break}return t.abrupt("return");case 9:return m={rollMode:r.rollMode,mode:l},g=a?i.Z.getRollModifiers(a,o,{mode:l}):[],this.getSituationalModifiers(g,a,m,o,c),m.situationalModifiers=g,v={title:p,template:"/systems/dsk/templates/dialog/combatskill-enhanced-dialog.html",data:m,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.Z.resolveRangeDialog(y,_,t,a,r),Hooks.call("callbackDialogCombatDSK",y,a,t,o,c),{testData:y,cardOptions:_}}},_=a._setupCardOptions("systems/dsk/templates/chat/roll/combatskill-card.html",p,c),t.abrupt("return",u.Z.setupDialog({dialogOptions:v,testData:y,cardOptions:_}));case 16:case"end":return t.stop()}}),_callee11,this)}))),function setupDialog(t,o,a,i,c){return r.apply(this,arguments)})}]),ItemRangeweapon}(j),W=function(t){item_dsk_inherits(ItemArmor,t);var r=item_dsk_createSuper(ItemArmor);function ItemArmor(){return item_dsk_classCallCheck(this,ItemArmor),r.apply(this,arguments)}return item_dsk_createClass(ItemArmor,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.protection",t.rs)]}}]),ItemArmor}(j),B=function(t){item_dsk_inherits(ItemAmmunition,t);var r=item_dsk_createSuper(ItemAmmunition);function ItemAmmunition(){return item_dsk_classCallCheck(this,ItemAmmunition),r.apply(this,arguments)}return item_dsk_createClass(ItemAmmunition,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.ammunitionType",game.i18n.localize("dsk.ammunition.".concat(t.ammunitionType)))]}}]),ItemAmmunition}(j),Z=function(t){item_dsk_inherits(ItemEquipment,t);var r=item_dsk_createSuper(ItemEquipment);function ItemEquipment(){return item_dsk_classCallCheck(this,ItemEquipment),r.apply(this,arguments)}return item_dsk_createClass(ItemEquipment,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.equipmentType",game.i18n.localize("dsk.Equipment.".concat(t.category)))]}}]),ItemEquipment}(j),q=function(t){item_dsk_inherits(ItemSpecies,t);var r=item_dsk_createSuper(ItemSpecies);function ItemSpecies(){return item_dsk_classCallCheck(this,ItemSpecies),r.apply(this,arguments)}return item_dsk_createClass(ItemSpecies)}(j),Y=function(t){item_dsk_inherits(ItemCulture,t);var r=item_dsk_createSuper(ItemCulture);function ItemCulture(){return item_dsk_classCallCheck(this,ItemCulture),r.apply(this,arguments)}return item_dsk_createClass(ItemCulture)}(j),U=function(t){item_dsk_inherits(ItemProfession,t);var r=item_dsk_createSuper(ItemProfession);function ItemProfession(){return item_dsk_classCallCheck(this,ItemProfession),r.apply(this,arguments)}return item_dsk_createClass(ItemProfession)}(j),V=function(t){item_dsk_inherits(ItemAdvantage,t);var r=item_dsk_createSuper(ItemAdvantage);function ItemAdvantage(){return item_dsk_classCallCheck(this,ItemAdvantage),r.apply(this,arguments)}return item_dsk_createClass(ItemAdvantage,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.rule",t.rule)]}}]),ItemAdvantage}(j),J=function(t){item_dsk_inherits(ItemDisadvantage,t);var r=item_dsk_createSuper(ItemDisadvantage);function ItemDisadvantage(){return item_dsk_classCallCheck(this,ItemDisadvantage),r.apply(this,arguments)}return item_dsk_createClass(ItemDisadvantage)}(V),Q=function(t){item_dsk_inherits(ItemSpecialability,t);var r=item_dsk_createSuper(ItemSpecialability);function ItemSpecialability(){return item_dsk_classCallCheck(this,ItemSpecialability),r.apply(this,arguments)}return item_dsk_createClass(ItemSpecialability,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.rule",t.rule)]}}]),ItemSpecialability}(j),X=function(t){item_dsk_inherits(ItemAhnengeschenk,t);var r=item_dsk_createSuper(ItemAhnengeschenk);function ItemAhnengeschenk(){return item_dsk_classCallCheck(this,ItemAhnengeschenk),r.apply(this,arguments)}return item_dsk_createClass(ItemAhnengeschenk)}(j),ee=function(t){item_dsk_inherits(ItemAhnengabe,t);var r,o=item_dsk_createSuper(ItemAhnengabe);function ItemAhnengabe(){return item_dsk_classCallCheck(this,ItemAhnengabe),o.apply(this,arguments)}return item_dsk_createClass(ItemAhnengabe,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.AeP",t.AeP),this._chatLineHelper("dsk.distribution",t.distribution),this._chatLineHelper("dsk.duration",t.duration),this._chatLineHelper("dsk.range",t.range),this._chatLineHelper("dsk.targetCategory",t.targetCategory)]}},{key:"getCallbackData",value:(r=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee12(t,r,o){var i;return item_dsk_regeneratorRuntime().wrap((function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:t.testDifficulty=0,t.situationalModifiers=a.Z._parseModifiers(r),i=new FormDataExtended(r.find("form")[0]).object,t.calculatedSpellModifiers={castingTime:r.find(".castingTime").text(),cost:r.find(".aspcost").text(),reach:r.find(".reach").text()},t.situationalModifiers.push({name:game.i18n.localize("dsk.removeGesture"),value:Number(i.removeGesture)||0},{name:game.i18n.localize("dsk.removeFormula"),value:Number(i.removeFormula)||0},{name:game.i18n.localize("dsk.zkModifier"),value:i.zkModifier||0},{name:game.i18n.localize("dsk.skModifier"),value:i.skModifier||0}),t.extensions=ItemAhnengabe.getSpecAbModifiers(r),t.advancedModifiers={chars:[0,1].map((function(t){return i["ch".concat(t)]})),fws:i.fw,qls:i.qs},j.changeChars.apply(j,[t.source].concat(item_dsk_toConsumableArray([0,1].map((function(t){return i["characteristics".concat(t)]})))));case 8:case"end":return o.stop()}}),_callee12)}))),function getCallbackData(t,o,a){return r.apply(this,arguments)})},{key:"getSpecAbModifiers",value:function getSpecAbModifiers(t){var r,o=[],a=item_dsk_createForOfIteratorHelper(t.find(".specAbs.active"));try{for(a.s();!(r=a.n()).done;){var i=r.value;o.push({name:i.dataset.name,title:i.getAttribute("title"),uuid:i.dataset.uuid})}}catch(t){a.e(t)}finally{a.f()}return o}},{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,o,a){t.push.apply(t,item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.magicalAttunement"),1,!0)).concat(item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.magicalRestriction"),-1,!0)),item_dsk_toConsumableArray(c.Z.getVantageAsModifier(r,game.i18n.localize("dsk.LocalizedIDs.boundToArtifact"),-1,!0)))),game.user.targets.size&&game.user.targets.forEach((function(o){o.actor&&g.addCreatureTypeModifiers(o.actor,a,t,r)})),t.push.apply(t,item_dsk_toConsumableArray(r.getSkillModifier(a.name,a.type)));var i,u=item_dsk_createForOfIteratorHelper(r.system.skillModifiers.global);try{for(u.s();!(i=u.n()).done;){var l=i.value;t.push({name:l.source,value:l.value})}}catch(t){u.e(t)}finally{u.f()}this.getSkZkModifier(o,a)}},{key:"setupDialog",value:function setupDialog(t,r,o,a,c){var l=this,p=o.name+" "+game.i18n.localize("".concat(o.type,"Test"))+(r.subtitle||""),d={opposable:!!o.system.effectFormula,source:o,extra:{actor:a.toObject(!1),options:r,speaker:j.buildSpeaker(a,c)},advancedModifiers:{chars:[0,0],fws:0,qls:0}},h={rollMode:r.rollMode,hasSKModifier:"sk"==o.system.resist,hasZKModifier:"zk"==o.system.resist,spellReach:o.system.range,characteristics:[1,2].map((function(t){return o.system["characteristic".concat(t)]}))},y=a?i.Z.getRollModifiers(a,o):[];this.getSituationalModifiers(y,a,h,o),h.situationalModifiers=y;var m,g={title:p,template:"/systems/dsk/templates/dialog/".concat("ahnen","-enhanced-dialog.html"),data:h,callback:(m=item_dsk_asyncToGenerator(item_dsk_regeneratorRuntime().mark((function _callee13(t){var r,o=arguments;return item_dsk_regeneratorRuntime().wrap((function _callee13$(i){for(;;)switch(i.prev=i.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},v.rollMode=t.find('[name="rollMode"]').val(),i.next=4,l.getCallbackData(d,t,a);case 4:return mergeObject(d.extra.options,r),i.abrupt("return",{testData:d,cardOptions:v});case 6:case"end":return i.stop()}}),_callee13)}))),function callback(t){return m.apply(this,arguments)})},v=a._setupCardOptions("systems/dsk/templates/chat/roll/spell-card.html",p,c);return u.Z.setupDialog({dialogOptions:g,testData:d,cardOptions:v})}}]),ItemAhnengabe}(j),te=function(t){item_dsk_inherits(ItemPoison,t);var r=item_dsk_createSuper(ItemPoison);function ItemPoison(){return item_dsk_classCallCheck(this,ItemPoison),r.apply(this,arguments)}return item_dsk_createClass(ItemPoison,null,[{key:"chatData",value:function chatData(t,r){return[this._chatLineHelper("dsk.stepValue",t.level),this._chatLineHelper("dsk.poisonType",t.category),this._chatLineHelper("dsk.start",t.start),this._chatLineHelper("dsk.duration",t.duration),this._chatLineHelper("dsk.resistanceModifier",t.resist),this._chatLineHelper("dsk.effect",l.Z.replaceConditions(l.Z.replaceDies(t.effect)))]}}]),ItemPoison}(j),re=function(t){item_dsk_inherits(ItemSkill,t);var r=item_dsk_createSuper(ItemSkill);function ItemSkill(){return item_dsk_classCallCheck(this,ItemSkill),r.apply(this,arguments)}return item_dsk_createClass(ItemSkill,null,[{key:"getSituationalModifiers",value:function getSituationalModifiers(t,r,o,a){t.push.apply(t,item_dsk_toConsumableArray(r.getSkillModifier(a.name,a.type)));var i,c=item_dsk_createForOfIteratorHelper(r.system.skillModifiers.global);try{for(c.s();!(i=c.n()).done;){var u=i.value;t.push({name:u.source,value:u.value})}}catch(t){c.e(t)}finally{c.f()}}},{key:"setupDialog",value:function setupDialog(t,r,o,c,l){var d,h=o.name+" "+game.i18n.localize("dsk.probe")+(r.subtitle||""),y={opposable:!0,source:o,extra:{actor:c.toObject(!1),options:r,speaker:j.buildSpeaker(c,l)}},m={rollMode:r.rollMode,modifier:r.modifier||0,difficultyLabels:p.Z.skillDifficultyLabels,characteristics:[1,2].map((function(t){return o.system["characteristic".concat(t)]})),situationalModifiers:c?i.Z.getRollModifiers(c,o):[]};r.situationalModifiers&&(d=m.situationalModifiers).push.apply(d,item_dsk_toConsumableArray(r.situationalModifiers)),this.getSituationalModifiers(m.situationalModifiers,c,m,o);var g={title:h,template:"/systems/dsk/templates/dialog/skill-dialog.html",data:m,callback:function callback(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v.rollMode=t.find('[name="rollMode"]').val(),y.situationalModifiers=a.Z._parseModifiers(t),y.testDifficulty=p.Z.skillDifficultyModifiers[t.find('[name="testDifficulty"]').val()],y.advancedModifiers={chars:[0,1].map((function(r){return Number(t.find('[name="ch'.concat(r,'"]')).val())})),fws:Number(t.find('[name="fw"]').val()),qls:Number(t.find('[name="qs"]').val())},j.changeChars.apply(j,[y.source].concat(item_dsk_toConsumableArray([0,1].map((function(r){return t.find('[name="characteristics'.concat(r,'"]')).val()}))))),mergeObject(y.extra.options,r),{testData:y,cardOptions:v}}},v=c._setupCardOptions("systems/dsk/templates/chat/roll/skill-card.html",h,l);return u.Z.setupDialog({dialogOptions:g,testData:y,cardOptions:v})}}]),ItemSkill}(j),ne=function(t){item_dsk_inherits(ItemCombatskill,t);var r=item_dsk_createSuper(ItemCombatskill);function ItemCombatskill(){return item_dsk_classCallCheck(this,ItemCombatskill),r.apply(this,arguments)}return item_dsk_createClass(ItemCombatskill)}(j)},61:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>DSKActiveEffectConfig});var _system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(832),_system_config_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(930),_system_dicedsk_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(614);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=_isNativeReflectConstruct();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function automatedAnimation(t){_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.moduleEnabled("autoanimations")&&console.warn("Animations for on use effects not enabled yet")}function callMacro(t,r,o,a,i){return _callMacro.apply(this,arguments)}function _callMacro(){return _callMacro=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t,r,o,a,i){var c,u,l,p,d,h,y,m,g,v,_=arguments;return _regeneratorRuntime().wrap((function _callee11$(b){for(;;)switch(b.prev=b.next){case 0:if(c=_.length>5&&void 0!==_[5]?_[5]:{},u={},game.user.can("MACRO_SCRIPT")){b.next=6;break}ui.notifications.warn("You are not allowed to use JavaScript macros."),b.next=49;break;case 6:return l=game.packs.get(t),b.next=9,l.getDocuments({name:r});case 9:if((p=b.sent).length){b.next=31;break}d=_createForOfIteratorHelper(game.packs.filter((function(t){return"Macro"==t.documentName&&/\(internal\)/.test(t.metadata.label)}))),b.prev=12,d.s();case 14:if((h=d.n()).done){b.next=23;break}return y=h.value,b.next=18,y.getDocuments({name:r});case 18:if(!(p=b.sent).length){b.next=21;break}return b.abrupt("break",23);case 21:b.next=14;break;case 23:b.next=28;break;case 25:b.prev=25,b.t0=b.catch(12),d.e(b.t0);case 28:return b.prev=28,d.f(),b.finish(28);case 31:if(!p.length){b.next=48;break}return m="(async () => {".concat(p[0].command,"})()"),g=Function("actor","item","qs","automatedAnimation","args",m),b.prev=34,c.result=u,v=mergeObject({automatedAnimation},this),b.next=39,g.call(v,o,a,i,automatedAnimation,c);case 39:b.next=46;break;case 41:b.prev=41,b.t1=b.catch(34),ui.notifications.error("There was an error in your macro syntax. See the console (F12) for details"),console.error(b.t1),u.error=!0;case 46:b.next=49;break;case 48:ui.notifications.error(game.i18n.format("dsk.DSKError.macroNotFound",{name:r}));case 49:return b.abrupt("return",u);case 50:case"end":return b.stop()}}),_callee11,this,[[12,25,28,31],[34,41]])}))),_callMacro.apply(this,arguments)}var DSKActiveEffectConfig=function(_ActiveEffectConfig){_inherits(DSKActiveEffectConfig,_ActiveEffectConfig);var _super=_createSuper(DSKActiveEffectConfig),_parseEffectDuration2,_createResistRollMessage,_applyEffect,_resistEffect,_onSubmit2,_render2,_checkTimesUpInstalled;function DSKActiveEffectConfig(){return _classCallCheck(this,DSKActiveEffectConfig),_super.apply(this,arguments)}return _createClass(DSKActiveEffectConfig,[{key:"checkTimesUpInstalled",value:(_checkTimesUpInstalled=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t;return _regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return!(t=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.moduleEnabled("times-up"))&&game.user.isGM&&ui.notifications.warn(game.i18n.localize("dsk.DSKError.shouldTimesUp")),r.abrupt("return",t);case 3:case"end":return r.stop()}}),_callee)}))),function checkTimesUpInstalled(){return _checkTimesUpInstalled.apply(this,arguments)})},{key:"_render",value:(_render2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,o,a,i,c,u,l,p,d=this,h=arguments;return _regeneratorRuntime().wrap((function _callee2$(y){for(;;)switch(y.prev=y.next){case 0:return t=h.length>0&&void 0!==h[0]&&h[0],r=h.length>1&&void 0!==h[1]?h[1]:{},y.next=4,_get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"_render",this).call(this,t,r);case 4:if(o=-1,a=["none","systemEffect","macro","creature"].map((function(t){return{name:"dsk.ActiveEffects.advancedFunctions.".concat(t),index:o+=1}})),i=getProperty(this.object,"parent.type"),(c={hasSpellEffects:["ahnengabe","consumable","poison","ammunition","meleeweapon","rangeweapon"].includes(i)||["specialability"].includes(i)&&"Combat"==getProperty(this.object,"parent.system.category")||"trait"==i&&["meleeAttack","rangeAttack"].includes(getProperty(this.object,"parent.system.traitType")),hasDamageTransformation:["ammunition"].includes(i)}).hasDamageTransformation&&a.push({name:"ActiveEffects.advancedFunctions.armorPostprocess",index:4},{name:"ActiveEffects.advancedFunctions.damagePostprocess",index:5}),y.t0=this.getStatusEffects(),y.t1=game.user.isGM,y.t1){y.next=15;break}return y.next=14,game.settings.get("dsk","playerCanEditSpellMacro");case 14:y.t1=y.sent;case 15:return y.t2=y.t1,u={systemEffects:y.t0,canEditMacros:y.t2},(l=$(this._element)).find(".tabs").append('<a class="item" data-tab="advanced"><i class="fas fa-shield-alt"></i>'.concat(game.i18n.localize("dsk.advanced"),"</a>")),y.next=21,renderTemplate("systems/dsk/templates/status/advanced_effect.html",{effect:this.object,advancedFunctions:a,effectConfigs:c,config:u});case 21:p=y.sent,l.find('.tab[data-tab="effects"]').after($(p)),l.find(".advancedSelector").change((function(t){var r=d.object;r.flags.dsk.advancedFunction=$(t.currentTarget).val(),renderTemplate("systems/dsk/templates/status/advanced_functions.html",{effect:r,config:u}).then((function(t){l.find(".advancedFunctions").html(t)}))})),this.checkTimesUpInstalled();case 25:case"end":return y.stop()}}),_callee2,this)}))),function _render(){return _render2.apply(this,arguments)})},{key:"_onSubmit",value:(_onSubmit2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r,o,a,i,c,u,l,p=arguments;return _regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:return r=p.length>1&&void 0!==p[1]?p[1]:{},o=r.updateData,a=void 0===o?null:o,i=r.preventClose,c=void 0!==i&&i,u=r.preventRender,l=void 0!==u&&u,"Actor"!=getProperty(this.object,"system.document.parent.documentName")&&getProperty(this.object,"system.document.parent.parent")&&ui.notifications.error(game.i18n.localize("dsk.DSKError.nestedEffectNotSupported")),d.next=5,_get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"_onSubmit",this).call(this,t,{updateData:a,preventClose:c,preventRender:l});case 5:return d.abrupt("return",d.sent);case 6:case"end":return d.stop()}}),_callee3,this)}))),function _onSubmit(t){return _onSubmit2.apply(this,arguments)})},{key:"getStatusEffects",value:function getStatusEffects(){return duplicate(CONFIG.statusEffects).map((function(t){return{id:t.id,label:game.i18n.localize(t.label)}})).sort((function(t,r){return t.label.localeCompare(r.label)}))}},{key:"getData",value:function getData(t){return _get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"getData",this).call(this,t)}},{key:"dropDownMenu",value:function dropDownMenu(){for(var t,r=game.i18n.localize("dsk.MODS.FW"),o=game.i18n.localize("ITEM.TypeSkill"),a=game.i18n.localize("dsk.regenerate"),i=game.i18n.localize("dsk.MODS.FP"),c=game.i18n.localize("dsk.stepValue"),u=game.i18n.localize("dsk.MODS.QS"),l=game.i18n.localize("dsk.MODS.partChecks"),p="".concat(game.i18n.localize("dsk.LocalizedIDs.perception")," 1"),d="".concat(game.i18n.localize("dsk.LocalizedIDs.wrestle")," 1"),h=game.i18n.localize("dsk.closeCombatAttacks"),y=game.i18n.localize("dsk.rangeCombatAttacks"),m="".concat(a," (").concat(game.i18n.localize("dsk.CHARAbbrev.CR"),")"),g=game.i18n.localize("dsk.AePCost"),v="".concat(game.i18n.localize("dsk.description")," 1"),_="".concat(game.i18n.localize("Healing")," 1"),b=[{name:game.i18n.localize("dsk.protection"),val:"system.totalArmor",mode:2,ph:"1"},{name:"".concat(game.i18n.localize("dsk.resistanceModifier")," (").concat(game.i18n.localize("dsk.condition"),")"),val:"system.resistances.effects",mode:0,ph:"inpain 1"},{name:game.i18n.localize("dsk.carrycapacity"),val:"system.carryModifier",mode:2,ph:"1"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.CHARAbbrev.AW")),val:"system.meleeStats.attack",mode:2,ph:"1"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.CHARAbbrev.VW")),val:"system.meleeStats.parry",mode:2,ph:"1"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")),val:"system.meleeStats.damage",mode:2,ph:"1d6"},{name:"".concat(h," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),val:"system.meleeStats.defenseMalus",mode:2,ph:"1"},{name:game.i18n.localize("dsk.MODS.creatureBonus"),val:"system.creatureBonus",mode:0,ph:"Elementar 1"},{name:"".concat(y," - ").concat(game.i18n.localize("dsk.CHARAbbrev.AW")),val:"system.rangeStats.attack",mode:2,ph:"1"},{name:"".concat(y," - ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")),val:"system.rangeStats.damage",mode:2,ph:"1d6"},{name:"".concat(y," - ").concat(game.i18n.localize("dsk.MODS.defenseMalus")),val:"system.rangeStats.defenseMalus",mode:2,ph:"1"},{name:"".concat(game.i18n.localize("ITEM.TypeAhnengabe")," - ").concat(game.i18n.localize("dsk.CHARAbbrev.damage")),val:"system.spellStats.damage",mode:2,ph:"1"},{name:g,val:"system.aepModifier",mode:2,ph:"1"},{name:"".concat(o," - ").concat(r),val:"system.skillModifiers.FW",mode:0,ph:p},{name:"".concat(o," - ").concat(i),val:"system.skillModifiers.FP",mode:0,ph:p},{name:"".concat(o," - ").concat(c),val:"system.skillModifiers.step",mode:0,ph:p},{name:"".concat(o," - ").concat(u),val:"system.skillModifiers.QL",mode:0,ph:p},{name:"".concat(o," - ").concat(l),val:"system.skillModifiers.TPM",mode:0,ph:p},{name:"".concat(game.i18n.localize("dsk.vulnerability")," - ").concat(game.i18n.localize("ITEM.TypeCombatskill")),val:"system.vulnerabilities.combatskill",mode:0,ph:d},{name:"".concat(o," - ").concat(game.i18n.localize("dsk.MODS.global")),val:"system.skillModifiers.global",mode:0,ph:"1"},{name:"".concat(m," - ").concat(game.i18n.localize("dsk.LeP")),val:"system.repeatingEffects.startOfRound.LeP",mode:0,ph:"1d6"},{name:"".concat(m," - ").concat(game.i18n.localize("dsk.AeP")),val:"system.repeatingEffects.startOfRound.AeP",mode:0,ph:"1d6"},{name:"".concat(a," - ").concat(game.i18n.localize("dsk.LeP")),val:"system.stats.regeneration.LePgearmodifier",mode:2,ph:"1"},(t={name:"".concat(a," - ").concat(game.i18n.localize("dsk.AeP")),val:"system.stats.regeneration.AePgearmodifier",mode:2,ph:"1"},_defineProperty(t,"mode",0),_defineProperty(t,"ph",_),t),{name:"".concat(game.i18n.localize("dsk.advanced")," - ").concat(g),val:"system.skillModifiers.conditional.AePCost",mode:0,ph:v}],k=0,w=["ahnengabe","skill","feature"];k<w.length;k++){var x=w[k],O="skill"==x?"skillglobal":x,S=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.categoryLocalization(O);b.push({name:"".concat(S," - ").concat(r),val:"system.skillModifiers.".concat(x,".FW"),mode:0,ph:p},{name:"".concat(S," - ").concat(i),val:"system.skillModifiers.".concat(x,".FP"),mode:0,ph:p},{name:"".concat(S," - ").concat(c),val:"system.skillModifiers.".concat(x,".step"),mode:0,ph:p},{name:"".concat(S," - ").concat(u),val:"system.skillModifiers.".concat(x,".QL"),mode:0,ph:p},{name:"".concat(S," - ").concat(l),val:"system.skillModifiers.".concat(x,".TPM"),mode:0,ph:p})}for(var P=0,T=Object.keys(_system_config_js__WEBPACK_IMPORTED_MODULE_1__.Z.characteristics);P<T.length;P++){var I=T[P];b.push({name:game.i18n.localize("dsk.characteristics.".concat(I,".name")),val:"system.characteristics.".concat(I,".gearmodifier"),mode:2,ph:"1"})}var E,C=_createForOfIteratorHelper(_system_config_js__WEBPACK_IMPORTED_MODULE_1__.Z.gearModifyableCalculatedAttributes);try{for(C.s();!(E=C.n()).done;){var A=E.value;b.push({name:game.i18n.localize("dsk.".concat(A)),val:"system.stats.".concat(A,".gearmodifier"),mode:2,ph:"1"})}}catch(t){C.e(t)}finally{C.f()}var R,G=_createForOfIteratorHelper(b=b.sort((function(t,r){return t.name.localeCompare(r.name)})));try{for(G.s();!(R=G.n()).done;){var L=R.value;L.ph&&null!=L.mode||console.warn(L)}}catch(t){G.e(t)}finally{G.f()}return b=b.map((function(t){return'<option value="'.concat(t.val,'" data-mode="').concat(t.mode,'" data-ph="').concat(t.ph,'">').concat(t.name,"</option>")})).join("\n"),'<select class="selMenu">'.concat(b,"</select>")}},{key:"activateListeners",value:function activateListeners(t){_get(_getPrototypeOf(DSKActiveEffectConfig.prototype),"activateListeners",this).call(this,t);var r=this.dropDownMenu();t.find(".changes-list .effect-change .key").append(r),t.find(".selMenu").change((function(t){var r=$(t.currentTarget);r.siblings("input").val(r.val());var o=r.closest(".effect-change"),a=r.find("option:selected");o.find(".mode select").val(a.attr("data-mode")),o.find(".value input").attr("placeholder",a.attr("data-ph")),r.blur()}))}}],[{key:"defaultOptions",get:function get(){return mergeObject(_get(_getPrototypeOf(DSKActiveEffectConfig),"defaultOptions",this),{resizable:!0})}},{key:"onEffectRemove",value:function(){var _onEffectRemove=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(actor,effect){var onRemoveMacro;return _regeneratorRuntime().wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(onRemoveMacro=getProperty(effect,"flags.dsk.onRemove"),!onRemoveMacro){_context4.next=8;break}if(game.user.can("MACRO_SCRIPT")){_context4.next=6;break}ui.notifications.warn("You are not allowed to use JavaScript macros."),_context4.next=8;break;case 6:return _context4.next=8,eval("(async () => {".concat(onRemoveMacro,"})()"));case 8:case"end":return _context4.stop()}}),_callee4)})));function onEffectRemove(t,r){return _onEffectRemove.apply(this,arguments)}return onEffectRemove}()},{key:"applyRollTransformation",value:function applyRollTransformation(actor,options,functionID){var msg="",source=options.origin,_iterator3=_createForOfIteratorHelper(source.effects),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var ef=_step3.value;try{Number(getProperty(ef,"flags.dsk.advancedFunction"))==functionID&&eval(getProperty(ef,"flags.dsk.args3"))}catch(t){console.warn("Unable to apply advanced effect",t,ef)}}}catch(t){_iterator3.e(t)}finally{_iterator3.f()}return options.origin=source,{msg,options}}},{key:"applyAdvancedFunction",value:function(){var _applyAdvancedFunction=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(actor,effects,source,testData,sourceActor){var skipResistRolls,msg,resistRolls,effectApplied,effectsWithChanges,effectNames,_iterator4,_step4,_loop,_args6=arguments;return _regeneratorRuntime().wrap((function _callee5$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:skipResistRolls=!(_args6.length>5&&void 0!==_args6[5])||_args6[5],msg="",resistRolls=[],effectApplied=!1,effectsWithChanges=[],effectNames=new Set,_iterator4=_createForOfIteratorHelper(effects),_context6.prev=7,_loop=_regeneratorRuntime().mark((function _loop(){var ef,specStep,customEf,qs,resistRoll,skills,mod,effect,value,creatures;return _regeneratorRuntime().wrap((function _loop$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(ef=_step4.value,ef.origin&&delete ef.origin,specStep=Number(getProperty(ef,"flags.dsk.specStep"))||0,_context5.prev=3,customEf=Number(getProperty(ef,"flags.dsk.advancedFunction")),qs=Math.min(testData.qualityStep||0,6),resistRoll=getProperty(ef,"flags.dsk.resistRoll"),!resistRoll||skipResistRolls){_context5.next=13;break}skills=resistRoll.split(" "),mod="".concat(skills.pop()),resistRolls.push({skill:skills.join(" "),mod:Math.round(Roll.safeEval("".concat(mod).replace(/q(l|s)/i,qs).replace("step",specStep)))||0,effect:ef,target:actor,token:actor.token?actor.token.id:void 0}),_context5.next=37;break;case 13:if(effectApplied=!0,effectNames.has(ef.label)||effectNames.add(ef.label),ef.changes&&ef.changes.length>0&&effectsWithChanges.push(ef),!customEf){_context5.next=37;break}_context5.t0=customEf,_context5.next=1===_context5.t0?20:2===_context5.t0?27:3===_context5.t0?34:37;break;case 20:return effect=duplicate(CONFIG.statusEffects.find((function(t){return t.id==getProperty(ef,"flags.dsk.args0")}))),value="".concat(getProperty(ef,"flags.dsk.args1"))||"1",effect.duration=ef.duration,value=/,/.test(value)?Number(value.split(",")[qs-1]):Number(value.replace(game.i18n.localize("dsk.CHARAbbrev.QS"),qs)),_context5.next=26,actor.addCondition(effect,value,!1,!1);case 26:return _context5.abrupt("break",37);case 27:if(game.user.can("MACRO_SCRIPT")){_context5.next=31;break}ui.notifications.warn("You are not allowed to use JavaScript macros."),_context5.next=33;break;case 31:return _context5.next=33,eval("(async () => {".concat(getProperty(ef,"flags.dsk.args3"),"})()"));case 33:return _context5.abrupt("break",37);case 34:return creatures=(getProperty(ef,"flags.dsk.args4")||"").split(",").map((function(t){return"@Compendium[".concat(t.trim().replace(/(@Compendium\[|\])/),"]")})).join(" "),msg+="<p><b>".concat(game.i18n.localize("dsk.ActiveEffects.advancedFunctions.creature"),"</b>:</p><p>").concat(creatures,"</p>"),_context5.abrupt("break",37);case 37:_context5.next=44;break;case 39:_context5.prev=39,_context5.t1=_context5.catch(3),console.warn("Unable to apply advanced effect"),console.warn(_context5.t1),console.warn(ef);case 44:case"end":return _context5.stop()}}),_loop,null,[[3,39]])})),_iterator4.s();case 10:if((_step4=_iterator4.n()).done){_context6.next=14;break}return _context6.delegateYield(_loop(),"t0",12);case 12:_context6.next=10;break;case 14:_context6.next=19;break;case 16:_context6.prev=16,_context6.t1=_context6.catch(7),_iterator4.e(_context6.t1);case 19:return _context6.prev=19,_iterator4.f(),_context6.finish(19);case 22:return _context6.next=24,actor.createEmbeddedDocuments("ActiveEffect",effectsWithChanges.map((function(t){return t.origin=actor.uuid,t})));case 24:return _context6.abrupt("return",{msg,resistRolls,effectApplied,effectNames:Array.from(effectNames)});case 25:case"end":return _context6.stop()}}),_callee5,null,[[7,16,19,22]])})));function applyAdvancedFunction(t,r,o,a,i){return _applyAdvancedFunction.apply(this,arguments)}return applyAdvancedFunction}()},{key:"resistEffect",value:(_resistEffect=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,o,a,i,c=this;return _regeneratorRuntime().wrap((function _callee7$(u){for(;;)switch(u.prev=u.next){case 0:r=t.currentTarget.dataset,o={token:r.token,actor:r.actor,scene:canvas.id},(a=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(o))?(i=a.items.find((function(t){return"skill"==t.type&&t.name==r.skill})),a.setupSkill(i,{modifier:r.mod},r.token).then(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){return _regeneratorRuntime().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:return t.testData.opposable=!1,i.next=3,a.basicTest(t);case 3:if(!((i.sent.result.qualityStep||0)<1)){i.next=8;break}return i.next=8,c.applyEffect(r.message,r.mode,[o],{effectIds:[r.effect],skipResistRolls:!0});case 8:case"end":return i.stop()}}),_callee6)})));return function(r){return t.apply(this,arguments)}}())):console.warn("Actor not found for resist roll.");case 4:case"end":return u.stop()}}),_callee7)}))),function resistEffect(t){return _resistEffect.apply(this,arguments)})},{key:"applyEffect",value:(_applyEffect=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r,o){var a,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T=arguments;return _regeneratorRuntime().wrap((function _callee8$(I){for(;;)switch(I.prev=I.next){case 0:return a=T.length>3&&void 0!==T[3]?T[3]:{},i=game.messages.get(t),c=i.flags.data.preData.source,u=i.flags.data.postData,l=i.speaker,["poison","disease"].includes(c.type)&&(u.qualityStep=u.successLevel>0?2:1),p=_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(l)||_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(getProperty(i.flags,"data.preData.extra.speaker"))||game.actors.get(getProperty(i.flags,"data.preData.extra.actor.id")),d=p,I.next=10,this._parseEffectDuration(c,u,i.flags.data.preData,p);case 10:if(h=I.sent,a.effectIds&&(h=h.filter((function(t){return a.effectIds.includes(t._id)}))),y=[],"self"==r?p&&y.push(p):o?y=o.map((function(t){return _system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.getSpeaker(t)})):game.user.targets.size&&game.user.targets.forEach((function(t){t.actor&&y.push(t.actor)})),!game.user.isGM){I.next=47;break}m=_createForOfIteratorHelper(y),I.prev=16,m.s();case 18:if((g=m.n()).done){I.next=37;break}return v=g.value,I.next=22,DSKActiveEffectConfig.applyAdvancedFunction(v,h,c,u,d,a.skipResistRolls||!1);case 22:if(_=I.sent,b=_.msg,k=_.resistRolls,w=_.effectApplied,x=_.effectNames,!w){I.next=32;break}return S=game.i18n.format("dsk.ActiveEffects.appliedEffect",{target:(null===(O=v.token)||void 0===O?void 0:O.name)||v.name,source:x.join(", ")}),P="".concat(S).concat(b||""),I.next=32,ChatMessage.create(_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.chatDataSetup(P));case 32:if(!k.length){I.next=35;break}return I.next=35,this.createResistRollMessage(k,t,r);case 35:I.next=18;break;case 37:I.next=42;break;case 39:I.prev=39,I.t0=I.catch(16),m.e(I.t0);case 42:return I.prev=42,m.f(),I.finish(42);case 45:I.next=48;break;case 47:game.socket.emit("system.dsk",{type:"addEffect",payload:{mode:r,id:t,actors:y.map((function(t){return{token:t.token?t.token.id:void 0,actor:t.id,scene:canvas.scene.id}}))}});case 48:case"end":return I.stop()}}),_callee8,this,[[16,39,42,45]])}))),function applyEffect(t,r,o){return _applyEffect.apply(this,arguments)})},{key:"createResistRollMessage",value:(_createResistRollMessage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t,r,o){var a,i,c,u;return _regeneratorRuntime().wrap((function _callee9$(l){for(;;)switch(l.prev=l.next){case 0:a=_createForOfIteratorHelper(t),l.prev=1,a.s();case 3:if((i=a.n()).done){l.next=12;break}return c=i.value,l.next=7,renderTemplate("systems/dsk/templates/chat/roll/resist-roll.html",{resist:c,id:r,mode:o});case 7:return u=l.sent,l.next=10,ChatMessage.create(_system_dsk_utility_js__WEBPACK_IMPORTED_MODULE_0__.Z.chatDataSetup(u));case 10:l.next=3;break;case 12:l.next=17;break;case 14:l.prev=14,l.t0=l.catch(1),a.e(l.t0);case 17:return l.prev=17,a.f(),l.finish(17);case 20:case"end":return l.stop()}}),_callee9,null,[[1,14,17,20]])}))),function createResistRollMessage(t,r,o){return _createResistRollMessage.apply(this,arguments)})},{key:"_parseEffectDuration",value:(_parseEffectDuration2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(t,r,o,a){var i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,R,G,L;return _regeneratorRuntime().wrap((function _callee10$(D){for(;;)switch(D.prev=D.next){case 0:i={},c=_createForOfIteratorHelper(o.situationalModifiers.filter((function(t){return t.specAbId})));try{for(c.s();!(u=c.n()).done;)l=u.value,i[l.specAbId]=l.step}catch(t){c.e(t)}finally{c.f()}p=Object.keys(i),d=a?a.items.filter((function(t){return p.includes(t.id)})):[],h=t.effects?duplicate(t.effects):[],y=_createForOfIteratorHelper(d);try{for(y.s();!(m=y.n()).done;){g=m.value,v=duplicate(g).effects,_=_createForOfIteratorHelper(v);try{for(_.s();!(b=_.n()).done;)k=b.value,setProperty(k,"flags.dsk.specStep",i[g.id])}catch(t){_.e(t)}finally{_.f()}h.push.apply(h,_toConsumableArray(v))}}catch(t){y.e(t)}finally{y.f()}w=(w=getProperty(t,"system.duration")||"").replace(" x "," * ").replace(game.i18n.localize("dsk.CHARAbbrev.QS"),r.qualityStep),D.prev=10,x=[{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.combatRounds"),"gi"),seconds:5},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.minutes"),"gi"),seconds:60},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.hours"),"gi"),seconds:3600},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEX.days"),"gi"),seconds:86400},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEXmaintain.weeks"),"gi"),seconds:604800},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEXmaintain.months"),"gi"),seconds:2592e3},{regEx:new RegExp(game.i18n.localize("dsk.DSKREGEXmaintain.years"),"gi"),seconds:3024e4}],O=0,S=x;case 13:if(!(O<S.length)){D.next=25;break}if(!(P=S[O]).regEx.test(w)){D.next=22;break}return T=w.replace(P.regEx,"").trim(),D.next=19,_system_dicedsk_js__WEBPACK_IMPORTED_MODULE_2__.Z._stringToRoll(T);case 19:if(I=D.sent,!isNaN(I)){E=_createForOfIteratorHelper(h);try{for(E.s();!(C=E.n()).done;)A=C.value,R=I*P.seconds,(G=getProperty(A,"flags.dsk.customDuration"))&&(L=G.split(",")[r.qualityStep-1])&&"-"!=L&&(R=Number(L)),A.duration.seconds=R,A.duration.rounds=A.duration.seconds/5}catch(t){E.e(t)}finally{E.f()}}return D.abrupt("break",25);case 22:O++,D.next=13;break;case 25:D.next=30;break;case 27:D.prev=27,D.t0=D.catch(10),console.error("Could not parse duration '".concat(w,"' of '").concat(t.name,"'"));case 30:return D.abrupt("return",h);case 31:case"end":return D.stop()}}),_callee10,null,[[10,27]])}))),function _parseEffectDuration(t,r,o,a){return _parseEffectDuration2.apply(this,arguments)})}]),DSKActiveEffectConfig}(ActiveEffectConfig)},973:(t,r,o)=>{o.d(r,{Z:()=>i});var a=o(774);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var i=function(){function DSKStatusEffects(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKStatusEffects)}var t,r,o,i,c;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKStatusEffects,null,[{key:"bindButtons",value:function bindButtons(t){t.find(".chat-condition").each((function(t,r){r.setAttribute("draggable",!0),r.addEventListener("dragstart",(function(t){var r={data:{type:"condition",payload:{id:$(t.currentTarget).attr("data-id")}}};t.dataTransfer.setData("text/plain",JSON.stringify(r))}))})),t.find(".chat-condition").click((function(t){return a.Z.postStatus($(t.currentTarget).attr("data-id"))}))}},{key:"createCustomEffect",value:function createCustomEffect(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;o=o||game.i18n.localize("dsk.CONDITION.custom"),""==r&&(r=o),t.addCondition({label:o,icon:"icons/svg/aura.svg",origin:t.uuid,flags:{dsk:{value:null,editable:!0,description:r,custom:!0}}})}},{key:"addCondition",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var o,a,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:if(o=u.length>2&&void 0!==u[2]?u[2]:1,a=u.length>3&&void 0!==u[3]&&u[3],i=!(u.length>4&&void 0!==u[4])||u[4],t.isOwner){l.next=5;break}return l.abrupt("return","Not owned");case 5:if(!t.compendium){l.next=7;break}return l.abrupt("return","Can not add in compendium");case 7:if(!(a&&o<1)){l.next=9;break}return l.abrupt("return",this.removeCondition(t,r,o,i,a));case 9:if("string"==typeof r&&(r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))),r){l.next=12;break}return l.abrupt("return","No Effect Found");case 12:if(!(c=this.hasCondition(t,r.id))||null!=c.flags.dsk.value){l.next=17;break}return l.abrupt("return",c);case 17:if(!c){l.next=21;break}return l.next=20,DSKStatusEffects.updateEffect(t,c,o,a,i,r);case 20:case 23:return l.abrupt("return",l.sent);case 21:return l.next=23,DSKStatusEffects.createEffect(t,r,o,i);case 24:case"end":return l.stop()}}),_callee,this)}))),function addCondition(t,r){return c.apply(this,arguments)})},{key:"createEffect",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r,o,a){var i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:if(!(i=this.immuneToEffect(t,r))){u.next=3;break}return u.abrupt("return",i);case 3:return r.label=game.i18n.localize(r.label),a?(r.flags.dsk.auto=Math.min(r.flags.dsk.max,o),r.flags.dsk.manual=0):(r.flags.dsk.manual=Math.min(r.flags.dsk.max,o),r.flags.dsk.auto=0),r.flags.dsk.value=Math.min(4,r.flags.dsk.manual+r.flags.dsk.auto),r["flags.core.statusId"]=r.id,"dead"==r.id&&(r["flags.core.overlay"]=!0),u.next=10,t.createEmbeddedDocuments("ActiveEffect",[duplicate(r)]);case 10:return c=u.sent,u.next=13,t._dependentEffects(r.id,r,1);case 13:return delete r.id,u.abrupt("return",c);case 15:case"end":return u.stop()}}),_callee2,this)}))),function createEffect(t,r,o,a){return i.apply(this,arguments)})},{key:"removeCondition",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r){var o,a,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee3$(p){for(;;)switch(p.prev=p.next){case 0:if(o=l.length>2&&void 0!==l[2]?l[2]:1,a=!(l.length>3&&void 0!==l[3])||l[3],i=l.length>4&&void 0!==l[4]&&l[4],t.isOwner){p.next=5;break}return p.abrupt("return","Not owned");case 5:if("string"==typeof r&&(r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))),r){p.next=8;break}return p.abrupt("return","No Effect Found");case 8:if(!(c=this.hasCondition(t,r.id))||null!=c.flags.dsk.value){p.next=17;break}return t.token&&(t=t.token.actor),p.next=13,t.deleteEmbeddedDocuments("ActiveEffect",[c.id]);case 13:return u=p.sent,p.abrupt("return",u);case 17:if(!c){p.next=21;break}return p.next=20,DSKStatusEffects.removeEffect(t,c,o,i,a);case 20:return p.abrupt("return",p.sent);case 21:case"end":return p.stop()}}),_callee3,this)}))),function removeCondition(t,r){return o.apply(this,arguments)})},{key:"removeEffect",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,o,a,i){var c,u,l;return _regeneratorRuntime().wrap((function _callee4$(p){for(;;)switch(p.prev=p.next){case 0:if(c=i?a?o:Math.max(0,r.flags.dsk.auto-o):r.flags.dsk.auto,u=i?r.flags.dsk.manual:a?o:r.flags.dsk.manual-o,!((l={flags:{dsk:{auto:c,manual:u,value:Math.max(0,Math.min(r.flags.dsk.max,u+c))}}}).flags.dsk.auto<1&&0==l.flags.dsk.manual)){p.next=9;break}return p.next=6,t.deleteEmbeddedDocuments("ActiveEffect",[r.id]);case 6:case 11:return p.abrupt("return",p.sent);case 9:return p.next=11,r.update(l);case 12:case"end":return p.stop()}}),_callee4)}))),function removeEffect(t,o,a,i,c){return r.apply(this,arguments)})},{key:"updateEffect",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t,r,o,a,i){var c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee5$(y){for(;;)switch(y.prev=y.next){case 0:if(c=h.length>5&&void 0!==h[5]?h[5]:void 0,!(u=this.immuneToEffect(t,r,!0))){y.next=4;break}return y.abrupt("return",u);case 4:if(i?(p=Math.min(r.flags.dsk.max,a?o:r.flags.dsk.auto+o),l=p-r.flags.dsk.auto,d={flags:{dsk:{auto:p,manual:r.flags.dsk.manual}}}):(p=a?o:r.flags.dsk.manual+o,l=p-r.flags.dsk.manual,d={flags:{dsk:{manual:p,auto:r.flags.dsk.auto}}}),0!=l){y.next=7;break}return y.abrupt("return",r);case 7:return d.flags.dsk.value=Math.max(0,Math.min(r.flags.dsk.max,d.flags.dsk.manual+d.flags.dsk.auto)),c.duration&&(d.duration=c.duration,d.duration.startTime=game.time.worldTime),y.next=11,r.update(d);case 11:return y.next=13,t._dependentEffects(r.flags.core.statusId,r,l);case 13:return y.abrupt("return",r);case 14:case"end":return y.stop()}}),_callee5,this)}))),function updateEffect(r,o,a,i,c){return t.apply(this,arguments)})},{key:"immuneToEffect",value:function immuneToEffect(t,r){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=getProperty(t,"system.immunities")||[];if(a.includes(r.id)){var i=game.i18n.format("dsk.DSKError.immuneTo",{name:t.name,condition:game.i18n.localize("dsk.CONDITION.".concat(r.id))});return ui.notifications&&!o&&ui.notifications.warn(i),i}return!1}},{key:"resistantToEffect",value:function resistantToEffect(t,r){var o=getProperty(r,"flags.core.statusId");return o?(getProperty(t,"system.resistances.effects")||[]).reduce((function(t,r){return r.target==o&&(t+=Number(r.value)),t}),0):0}},{key:"hasCondition",value:function hasCondition(t,r){return!(null==t||!r)&&(!!t.effects&&t.effects.find((function(t){return getProperty(t,"flags.core.statusId")==r})))}},{key:"prepareActiveEffects",value:function prepareActiveEffects(t,r){var o=duplicate(CONFIG.statusEffects),a=[];r.conditions=[],r.transferedConditions=[];var i,c=_createForOfIteratorHelper(t.effects.filter((function(r){return game.user.isGM||"Item"==t.documentName||!r.getFlag("dsk","hidePlayers")})));try{for(c.s();!(i=c.n()).done;){var u=i.value;u.disabled=u.disabled,u.boolean=null==u.getFlag("dsk","value"),u.label=u.label,u.icon=u.icon;var l=u.getFlag("core","statusId");l&&(u.value=u.getFlag("dsk","value"),u.editable=u.getFlag("dsk","editable"),u.descriptor=l,u.manual=u.getFlag("dsk","manual"),a.push(l)),u.origin!=t.uuid&&u.origin||u.notApplicable?u.notApplicable||r.transferedConditions.push(u):r.conditions.push(u)}}catch(t){c.e(t)}finally{c.f()}r.manualConditions=o.filter((function(t){return!a.includes(t.id)}))}},{key:"getRollModifiers",value:function getRollModifiers(t,r){return[]}}]),DSKStatusEffects}()},278:(t,r,o)=>{o.d(r,{Z:()=>c});var a=o(404),i=o(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var c=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(AdvantageRulesDSK,t);var r,o,a,c,u=_createSuper(AdvantageRulesDSK);function AdvantageRulesDSK(){return _classCallCheck(this,AdvantageRulesDSK),u.apply(this,arguments)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(AdvantageRulesDSK,null,[{key:"setupFunctions",value:function setupFunctions(){}},{key:"vantageAdded",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:game.dsk.config.addvantageRules[r.name]&&game.dsk.config.addvantageRules[r.name](t,r);case 1:case"end":return o.stop()}}),_callee)}))),function vantageAdded(t,r){return c.apply(this,arguments)})},{key:"vantageRemoved",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){return _regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:game.dsk.config.removevantageRules[r.name]&&game.dsk.config.removevantageRules[r.name](t,r);case 1:case"end":return o.stop()}}),_callee2)}))),function vantageRemoved(t,r){return a.apply(this,arguments)})},{key:"_vantageReturnFunction",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,o,a){var c,u,l,p;return _regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:if(null!=r){d.next=2;break}return d.abrupt("return");case 2:if(r=duplicate(r),/,/.test(r.system.ap)&&(c=r.name.replace(" ()",""),r.system.ap=r.system.ap.split(",")[t.items.filter((function(t){return t.type==r.type&&t.name.includes(c)})).length].trim()),null!=a&&(AdvantageRulesDSK.simpleAdoption(r,a,r.name,i.Z.vantagesNeedingAdaption),r.name="".concat(r.name.replace(" ()","")," (").concat(a.name,")"),a.data&&(r.system.ap=r.system.ap.split("/")[a.system.StF.charCodeAt(0)-65].trim())),!(u=t.items.find((function(t){return t.type==o&&t.name==r.name})))){d.next=24;break}if(l=duplicate(u),p=/;/.test(l.system.ap)?l.system.ap.split(";").map((function(t){return Number(t.trim())}))[l.system.level]:l.system.ap,d.t0=l.system.level+1<=l.system.max,!d.t0){d.next=14;break}return d.next=13,t.checkEnoughXP(p);case 13:d.t0=d.sent;case 14:if(!d.t0){d.next=22;break}return l.system.level+=1,d.next=18,t._updateAPs(p);case 18:return d.next=20,t.updateEmbeddedDocuments("Item",[l]);case 20:return d.next=22,AdvantageRulesDSK.vantageAdded(t,l);case 22:d.next=33;break;case 24:return d.next=26,t.checkEnoughXP(r.system.ap.split(";").map((function(t){return t.trim()}))[0]);case 26:if(!d.sent){d.next=33;break}return d.next=29,AdvantageRulesDSK.vantageAdded(t,r);case 29:return d.next=31,t._updateAPs(r.system.ap.split(";").map((function(t){return t.trim()}))[0]);case 31:return d.next=33,t.createEmbeddedDocuments("Item",[r]);case 33:case"end":return d.stop()}}),_callee3)}))),function _vantageReturnFunction(t,r,a,i){return o.apply(this,arguments)})},{key:"needsAdoption",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,o){var a,c,u;return _regeneratorRuntime().wrap((function _callee4$(l){for(;;)switch(l.prev=l.next){case 0:if(!i.Z.vantagesNeedingAdaption[r.name]){l.next=17;break}if("text"!=i.Z.vantagesNeedingAdaption[r.name].items){l.next=8;break}return l.next=4,renderTemplate("systems/dsk/templates/dialog/requires-adoption-string-dialog.html",{original:r});case 4:a=l.sent,c=function callback(a){var i={name:a.find('[name="entryselection"]').val()};AdvantageRulesDSK._vantageReturnFunction(t,r,o,i)},l.next=13;break;case 8:return u=t.items.filter((function(t){return i.Z.vantagesNeedingAdaption[r.name].items.includes(t.type)})),l.next=11,renderTemplate("systems/dsk/templates/dialog/requires-adoption-dialog.html",{items:u,original:r});case 11:a=l.sent,c=function callback(a){var i=u.find((function(t){return t.name==a.find('[name="entryselection"]').val()}));AdvantageRulesDSK._vantageReturnFunction(t,r,o,i)};case 13:return l.next=15,new Dialog({title:game.i18n.localize("dsk.DIALOG.ItemRequiresAdoption"),content:a,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:c},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 15:l.next=18;break;case 17:AdvantageRulesDSK._vantageReturnFunction(t,r,o,null);case 18:case"end":return l.stop()}}),_callee4)}))),function needsAdoption(t,o,a){return r.apply(this,arguments)})},{key:"hasVantage",value:function hasVantage(t,r){return _get(_getPrototypeOf(AdvantageRulesDSK),"hasItem",this).call(this,t,r,["advantage","disadvantage"])}},{key:"vantageStep",value:function vantageStep(t,r){return _get(_getPrototypeOf(AdvantageRulesDSK),"itemStep",this).call(this,t,r,["advantage","disadvantage"])}},{key:"getVantageAsModifier",value:function getVantageAsModifier(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return _get(_getPrototypeOf(AdvantageRulesDSK),"itemAsModifier",this).call(this,t,r,o,["advantage","disadvantage"],a,i)}}]),AdvantageRulesDSK}(a.Z);a.Z.children.AdvantageRulesDSK=c},530:(t,r,o)=>{o.d(r,{Z:()=>u});var a=o(774),i=o(832),c=o(903);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}var u=function(){function DSKChatAutoCompletion(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKChatAutoCompletion),0==DSKChatAutoCompletion.skills.length&&i.Z.allSkills().then((function(t){DSKChatAutoCompletion.skills=t.map((function(t){return{name:t.name,type:"skill"}})).concat(Object.values(game.dsk.config.characteristics).map((function(t){return{name:game.i18n.localize(t),type:"attribute"}})).concat({name:game.i18n.localize("dsk.regenerate"),type:"regeneration"}))})),this.regex,this.filtering=!1}var t,r;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKChatAutoCompletion,[{key:"regex",get:function get(){return new RegExp("^/(".concat(DSKChatAutoCompletion.cmds.join(" |"),")"))}},{key:"chatListeners",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r;return _regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:r=this,this.anchor=$("#chat-message").parent(),$("#chat-message").off("keydown",ui.chat._onChatKeyDownBinding),t.on("keyup","#chat-message",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:r._parseInput(t);case 1:case"end":return o.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".quick-item",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:r._quickSelect($(t.currentTarget));case 1:case"end":return o.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}()),t.on("keydown","#chat-message",(function(t){r._navigateQuickFind(t)}));case 6:case"end":return o.stop()}}),_callee3,this)}))),function chatListeners(t){return r.apply(this,arguments)})},{key:"_parseInput",value:function _parseInput(t){var r=t.target.value;if(this.regex.test(r)){if([38,40,13,9].includes(t.which))return!1;if(27==t.which)return this._closeQuickfind(),!1;var o=this._getCmd(r),a=r.substring(1+o.length).toLowerCase().trim();this["_filter".concat(o)](a),this.filtering=!0}else this._closeQuickfind()}},{key:"_getCmd",value:function _getCmd(t){return t.substring(1,3).toUpperCase().trim()}},{key:"_completeCurrentEntry",value:function _completeCurrentEntry(t){$("#chat-message").val($("#chat-message").val().split(" ")[0]+" "+t.text())}},{key:"_closeQuickfind",value:function _closeQuickfind(){this.filtering=!1,this.anchor.find(".quickfind").remove()}},{key:"_filterW",value:function _filterW(t){var r=game.users.contents.filter((function(r){return r.active&&-1!=r.name.toLowerCase().trim().indexOf(t)})).map((function(t){return{name:t.name,type:"user"}}));this._checkEmpty(r),this._setList(r,"W")}},{key:"_filterAT",value:function _filterAT(t){var r=DSKChatAutoCompletion._getActor(),o=r.actor;r.tokenId;if(o){var a=["meleeweapon","rangeweapon"],i=["meleeAttack","rangeAttack"],c=o.items.filter((function(r){return(a.includes(r.type)&&1==r.system.worn.value||"trait"==r.type&&i.includes(r.system.traitType))&&-1!=r.name.toLowerCase().trim().indexOf(t)})).slice(0,5).map((function(t){return{name:t.name,type:"item"}}));this._checkEmpty(c),this._setList(c,"AT")}}},{key:"_filterAH",value:function _filterAH(t){var r=DSKChatAutoCompletion._getActor(),o=r.actor;r.tokenId;if(o){var a=["ahnengabe"],i=o.items.filter((function(r){return a.includes(r.type)&&-1!=r.name.toLowerCase().trim().indexOf(t)})).slice(0,5).map((function(t){return{name:t.name,type:"item"}}));this._checkEmpty(i),this._setList(i,"SP")}}},{key:"_checkEmpty",value:function _checkEmpty(t){t.length||t.push({name:game.i18n.localize("dsk.DSKError.noMatch"),type:"none"})}},{key:"_getSkills",value:function _getSkills(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t=t.replace(/(-|\+)?\d+/g,"").trim();var o=DSKChatAutoCompletion.skills.filter((function(o){return-1!=o.name.toLowerCase().trim().indexOf(t)&&(null==r||r==o.type)})).slice(0,5);return this._checkEmpty(o),o}},{key:"_filterCH",value:function _filterCH(t){this._setList(this._getSkills(t),"CH")}},{key:"_filterSK",value:function _filterSK(t){this._setList(this._getSkills(t),"SK")}},{key:"_filterRQ",value:function _filterRQ(t){this._setList(this._getSkills(t),"RQ")}},{key:"_filterGC",value:function _filterGC(t){this._setList(this._getSkills(t,"skill"),"GC")}},{key:"_setList",value:function _setList(t,r){var o=$('<div class="quickfind dsklist"><ul>'.concat(t.map((function(t){return'<li data-type="'.concat(t.type,'" data-category="').concat(r,'" class="quick-item">').concat(t.name,"</li>")})).join(""),"</ul></div>"));o.find(".quick-item:first").addClass("focus");var a=this.anchor.find(".quickfind");a.length?a.replaceWith(o):this.anchor.append(o)}},{key:"_navigateQuickFind",value:function _navigateQuickFind(t){if(this.filtering){var r=this.anchor.find(".focus");switch(t.which){case 38:return r.prev(".quick-item").length&&r.removeClass("focus").prev(".quick-item").addClass("focus"),!1;case 40:return r.next(".quick-item").length&&r.removeClass("focus").next(".quick-item").addClass("focus"),!1;case 13:if("W"==r.attr("data-category"))break;return t.stopPropagation(),t.preventDefault(),this._quickSelect(r),!1;case 9:return t.stopPropagation(),t.preventDefault(),this._completeCurrentEntry(r),!1}}ui.chat._onChatKeyDown(t)}},{key:"_quickSelect",value:function _quickSelect(t){var r=t.attr("data-category");switch(r){case"NM":case"GC":case"RQ":case"CH":this["_quick".concat(r)](t);break;case"W":this._completeCurrentEntry(t);break;default:var o=DSKChatAutoCompletion._getActor(),a=o.actor,i=o.tokenId;a&&(this._resetChatAutoCompletion(),this["_quick".concat(r)](t,a,i))}}},{key:"_quickW",value:function _quickW(t,r,o){}},{key:"_quickCH",value:function _quickCH(t){a.Z.check3D20(t),this._resetChatAutoCompletion()}},{key:"_quickSK",value:function _quickSK(t,r,o){switch(t.attr("data-type")){case"skill":var a=r.items.find((function(r){return r.name==t.text()&&"skill"==r.type}));a&&r.setupSkill(a,{},o).then((function(t){r.basicTest(t)}));break;case"attribute":var i=Object.keys(game.dsk.config.characteristics).find((function(r){return game.i18n.localize(game.dsk.config.characteristics[r])==t.text()}));r.setupCharacteristic(i,{},o).then((function(t){r.basicTest(t)}));break;case"regeneration":r.setupRegeneration("regenerate",{},o).then((function(t){r.basicTest(t)}))}}},{key:"_resetChatAutoCompletion",value:function _resetChatAutoCompletion(){$("#chat-message").val(""),this.anchor.find(".quickfind").remove()}},{key:"_quickGC",value:function _quickGC(t){var r=Number($("#chat-message").val().match(/(-|\+)?\d+/g))||0;this._resetChatAutoCompletion(),c.Z.showGCMessage(t.text(),r)}},{key:"_quickRQ",value:function _quickRQ(t){var r=Number($("#chat-message").val().match(/(-|\+)?\d+/g))||0;this._resetChatAutoCompletion(),c.Z.showRQMessage(t.text(),r)}},{key:"_quickAT",value:function _quickAT(t,r,o){var a=["meleeweapon","rangeweapon"],i=["meleeAttack","rangeAttack"],c=r.items.find((function(r){return a.includes(r.type)&&r.name==t.text()}));c||(c=r.items.find((function(r){return"trait"==r.type&&r.name==t.text()&&i.includes(r.system.traitType)}))),c&&r.setupWeapon(c,"attack",{},o).then((function(t){r.basicTest(t)}))}},{key:"_quickSP",value:function _quickSP(t,r,o){var a=["ahnengabe"],i=r.items.find((function(r){return a.includes(r.type)&&r.name==t.text()}));i&&r.setupSpell(i,{},o).then((function(t){r.basicTest(t)}))}}],[{key:"_getActor",value:function _getActor(){var t,r=ChatMessage.getSpeaker();return r.token&&(t=game.actors.tokens[r.token]),t||(t=game.actors.get(r.actor)),t?{actor:t,tokenId:r.token}:(ui.notifications.error(game.i18n.localize("dsk.DSKError.noProperActor")),{})}},{key:"infoItemAsync",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){return _regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fromUuid(t);case 2:r.sent.postItem();case 4:case"end":return r.stop()}}),_callee4)}))),function infoItemAsync(r){return t.apply(this,arguments)})},{key:"bindRollCommands",value:function bindRollCommands(t){var r=this;t.on("click",".request-roll",(function(t){return c.Z.showRQMessage(t.currentTarget.dataset.name,Number(t.currentTarget.dataset.modifier)||0),t.stopPropagation(),!1})),t.on("click",".postInfo",(function(t){var o=fromUuidSync(t.currentTarget.dataset.uuid);return o&&("function"==typeof o.postItem?o.postItem():r.infoItemAsync(t.currentTarget.dataset.uuid)),t.stopPropagation(),!1})),t.on("click",".request-GC",(function(t){return c.Z.showGCMessage(t.currentTarget.dataset.name,Number(t.currentTarget.dataset.modifier)||0),t.stopPropagation(),!1})),t.on("click",".request-CH",(function(t){return a.Z.check3D20(void 0,t.currentTarget.dataset.name,{modifier:Number(t.currentTarget.dataset.modifier)||0}),t.stopPropagation(),!1}))}}]),DSKChatAutoCompletion}();_defineProperty(u,"skills",[]),_defineProperty(u,"cmds",["sk","at","ah","rq","gc","w","ch"])},774:(t,r,o)=>{o.d(r,{Z:()=>l});var a=o(832);var i=o(930),c=o(586),u=o(122);function chat_listeners_typeof(t){return chat_listeners_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},chat_listeners_typeof(t)}function chat_listeners_regeneratorRuntime(){chat_listeners_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==chat_listeners_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function chat_listeners_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function chat_listeners_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){chat_listeners_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){chat_listeners_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var l=function(){function DSKChatListeners(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKChatListeners)}var t,r,o;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKChatListeners,null,[{key:"chatListeners",value:function chatListeners(t){t.on("click",".openJournalBrowser",(function(){return game.dsk.apps.journalBrowser.render(!0)}));var r=$('<a class="button showHelp" data-tooltip="dsk.HELP.showHelp"><i class="fas fa-question"></i></a>');r.click((function(){DSKChatListeners.getHelp()})),$(t.find(".control-buttons")).prepend(r),t.on("click",".showPatchViewer",(function(){return(0,c.j)()})),t.on("click",".functionswitch",(function(t){return u.Z[t.currentTarget.dataset.function](t)})),t.on("click",".panToToken",(function(t){return DSKChatListeners.panToToken(t)})),t.on("click",".popoutImage",(function(t){return function showPopout(t){var r=t.currentTarget.dataset;a.Z.showArtwork(r,!1)}(t)}))}},{key:"panToToken",value:(o=chat_listeners_asyncToGenerator(chat_listeners_regeneratorRuntime().mark((function _callee(t){var r;return chat_listeners_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,fromUuid(t.currentTarget.dataset.uuid);case 2:if(r=o.sent){o.next=5;break}return o.abrupt("return");case 5:if(canvas.animatePan({x:r.x,y:r.y}),r.isOwner){o.next=8;break}return o.abrupt("return");case 8:r.object.control({releaseOthers:!0});case 9:case"end":return o.stop()}}),_callee)}))),function panToToken(t){return o.apply(this,arguments)})},{key:"postStatus",value:function postStatus(t){var r=CONFIG.statusEffects.find((function(r){return r.id==t})),o='<h2><a class="chat-condition chatButton" data-id="'.concat(t,'"><img class="sender-image" style="background-color:black;margin-right: 8px;" src="').concat(r.icon,'"/>').concat(game.i18n.localize(r.label),"</h2></a><p>").concat(game.i18n.localize(r.description),"</p>");ChatMessage.create(a.Z.chatDataSetup(o,"roll"))}},{key:"getHelp",value:function getHelp(){var t=i.Z.helpContent.map((function(t){return"<h2>".concat(game.i18n.localize("dsk.HELP.".concat(t.name)),"</h2>\n            <p><b>").concat(game.i18n.localize("dsk.HELP.command"),"</b>: ").concat(t.command,"</p>\n            <p><b>").concat(game.i18n.localize("dsk.HELP.example"),"</b>: ").concat(t.example,"</p>\n            <p><b>").concat(game.i18n.localize("dsk.description"),"</b>: ").concat(game.i18n.localize("dsk.HELP.descr".concat(t.name)))})).join("")+"<br>\n            <p>".concat(game.i18n.localize("dsk.HELP.default"),"</p>");ChatMessage.create(a.Z.chatDataSetup(t,"roll"))}},{key:"showConditions",value:function showConditions(){var t=duplicate(CONFIG.statusEffects).map((function(t){return t.label=game.i18n.localize(t.label),t})).sort((function(t,r){return t.label.localeCompare(r.label)})).map((function(t){return'<a class="chat-condition chatButton" data-id="'.concat(t.id,'"><img src="').concat(t.icon,'"/>').concat(t.label,"</a>")})).join(" ");ChatMessage.create(a.Z.chatDataSetup(t,"roll"))}},{key:"check3D20",value:(r=chat_listeners_asyncToGenerator(chat_listeners_regeneratorRuntime().mark((function _callee2(t,r){var o,i,c,u=arguments;return chat_listeners_regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:if(o=u.length>2&&void 0!==u[2]?u[2]:{},i=12,!t){l.next=10;break}return t=t.get(0),l.next=6,a.Z.skillByName(t.textContent);case 6:r=l.sent,t.dataset.attrs&&(i=t.dataset.attrs.split("|")),l.next=14;break;case 10:if(!r){l.next=14;break}return l.next=13,a.Z.skillByName(r);case 13:r=l.sent;case 14:return r&&(r=r.toObject()),r||(r={name:"2d20",type:"skill",system:{level:0,characteristic1:"mu",characteristic2:"kl",encumbers:"no"}}),l.next=18,a.Z.emptyActor(i);case 18:(c=l.sent).setupSkill(r,o,"emptyActor").then((function(t){c.basicTest(t)}));case 20:case"end":return l.stop()}}),_callee2)}))),function check3D20(t,o){return r.apply(this,arguments)})},{key:"showTables",value:(t=chat_listeners_asyncToGenerator(chat_listeners_regeneratorRuntime().mark((function _callee3(){var t;return chat_listeners_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,renderTemplate("systems/dsk/templates/tables/systemtables.html",{tables:i.Z.systemTables});case 2:t=r.sent,ChatMessage.create(a.Z.chatDataSetup(t,"roll"));case 4:case"end":return r.stop()}}),_callee3)}))),function showTables(){return t.apply(this,arguments)})}]),DSKChatListeners}()},930:(t,r,o)=>{o.d(r,{Z:()=>i});var a={statusEffects:[{icon:"icons/svg/skull.svg",id:"dead",label:"dsk.CONDITION.defeated",description:"dsk.CONDITIONDESCRIPTION.defeated",flags:{dsk:{value:null,editable:!0}}},{id:"inpain",label:"dsk.CONDITION.inpain",icon:"icons/svg/blood.svg",description:"dsk.CONDITIONDESCRIPTION.inpain",flags:{dsk:{value:1,editable:!0,max:8}}},{id:"encumbered",label:"dsk.CONDITION.encumbered",icon:"icons/svg/anchor.svg",description:"dsk.CONDITIONDESCRIPTION.encumbered",changes:[{key:"system.status.encumbered",mode:2,value:-1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"stunned",label:"dsk.CONDITION.stunned",icon:"icons/svg/daze.svg",description:"dsk.CONDITIONDESCRIPTION.stunned",changes:[{key:"system.status.stunned",mode:2,value:-1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"feared",label:"dsk.CONDITION.feared",icon:"icons/svg/terror.svg",description:"dsk.CONDITIONDESCRIPTION.feared",changes:[{key:"system.status.feared",mode:2,value:-1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"selfconfidence",label:"dsk.CONDITION.selfconfidence",icon:"icons/svg/up.svg",description:"dsk.CONDITIONDESCRIPTION.selfconfidence",changes:[{key:"system.status.selfconfidence",mode:2,value:1}],flags:{dsk:{value:1,editable:!0,max:8}}},{id:"prone",label:"dsk.CONDITION.prone",icon:"icons/svg/falling.svg",description:"dsk.CONDITIONDESCRIPTION.prone",flags:{dsk:{value:null,editable:!0}}},{id:"rooted",label:"dsk.CONDITION.rooted",icon:"icons/svg/net.svg",description:"dsk.CONDITIONDESCRIPTION.rooted",flags:{dsk:{value:null,editable:!0}}},{id:"unconscious",label:"dsk.CONDITION.unconscious",icon:"icons/svg/unconscious.svg",description:"dsk.CONDITIONDESCRIPTION.unconscious",flags:{dsk:{value:null,editable:!0}}},{id:"blind",label:"dsk.CONDITION.blind",icon:"icons/svg/blind.svg",description:"dsk.CONDITIONDESCRIPTION.blind",flags:{dsk:{value:null,editable:!0}}},{id:"constricted",label:"dsk.CONDITION.constricted",icon:"icons/svg/cave.svg",description:"dsk.CONDITIONDESCRIPTION.constricted",flags:{dsk:{value:null,editable:!0}}},{id:"fixated",label:"dsk.CONDITION.fixated",icon:"icons/svg/padlock.svg",description:"dsk.CONDITIONDESCRIPTION.fixated",flags:{dsk:{value:null,editable:!0}}},{id:"hallucinating",label:"dsk.CONDITION.hallucinating",icon:"icons/svg/padlock.svg",description:"dsk.CONDITIONDESCRIPTION.hallucinating",flags:{dsk:{value:null,editable:!0}}},{id:"incapacitated",label:"dsk.CONDITION.incapacitated",icon:"icons/svg/sleep.svg",description:"dsk.CONDITIONDESCRIPTION.incapacitated",flags:{dsk:{value:null,editable:!0}}},{id:"panic",label:"dsk.CONDITION.panic",icon:"icons/svg/terror.svg",description:"dsk.CONDITIONDESCRIPTION.panic",flags:{dsk:{value:1,editable:!0,max:8}}},{id:"bloodrush",label:"dsk.CONDITION.rage",icon:"icons/svg/bones.svg",description:"dsk.CONDITIONDESCRIPTION.rage",flags:{dsk:{value:null,editable:!0}}},{id:"mute",label:"dsk.CONDITION.mute",icon:"icons/svg/silenced.svg",description:"dsk.CONDITIONDESCRIPTION.mute",flags:{dsk:{value:null,editable:!0}}},{id:"deaf",label:"dsk.CONDITION.deaf",icon:"icons/svg/deaf.svg",description:"dsk.CONDITIONDESCRIPTION.deaf",flags:{dsk:{value:null,editable:!0}}},{id:"surprised",label:"dsk.CONDITION.surprised",icon:"icons/svg/hazard.svg",description:"dsk.CONDITIONDESCRIPTION.surprised",flags:{dsk:{value:null,editable:!0}}},{id:"invisible",label:"dsk.CONDITION.invisible",icon:"icons/svg/circle.svg",description:"dsk.CONDITIONDESCRIPTION.invisible",flags:{dsk:{value:null,editable:!0}}},{id:"poisoned",label:"dsk.CONDITION.poisoned",icon:"icons/svg/poison.svg",description:"dsk.CONDITIONDESCRIPTION.poisoned",flags:{dsk:{value:null,editable:!0}}}],StFs:{A:"A",B:"B",C:"C",D:"D",E:"E"},helpContent:[{name:"pay",command:"/pay [0-9]+",example:"/pay 5.03"},{name:"getPaid",command:"/getPaid [0-9]+",example:"/getPaid 5.03"},{name:"quickAbility",command:"/sk [a-z]*, /ah [a-z]*, /at [a-z]*, /pa [a-z]*",example:"/sk sinnesschärfe"},{name:"conditions",command:"/conditions",example:"/conditions"},{name:"tables",command:"/tables",example:"/tables"},{name:"request",command:"/rq",example:"/rq betören"},{name:"twoD20Check",command:"/ch",example:"/ch"},{name:"groupcheck",command:"/gc",example:"/gc"}],meleeRangeVision:function(){return{"+0":"dsk.meleeVisionDisruption.0","-1":"dsk.meleeVisionDisruption.1","-2":"dsk.meleeVisionDisruption.2","-3":"dsk.meleeVisionDisruption.3","-5000":"dsk.meleeVisionDisruption.4"}},addvantageRules:{},removevantageRules:{},vantagesNeedingAdaption:{},addAbilityRules:{},removeAbilityRules:{},AbilitiesNeedingAdaption:{},advancementCosts:{A:[1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,4,5,6,7,8,9,10,11,12,13,14],B:[2,2,2,2,2,2,2,2,2,2,2,2,2,4,6,8,10,12,14,16,18,20,22,24,26,28],C:[3,3,3,3,3,3,3,3,3,3,3,3,3,6,9,12,15,18,21,24,27,30,33,36,39,42],D:[4,4,4,4,4,4,4,4,4,4,4,4,4,8,12,16,20,24,28,32,36,40,44,48,52,56],E:[5,5,5,5,5,5,5,5,5,5,5,5,5,10,15,20,25,30,35,40,45,50,55,60,65,70],Eig:[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,40,60,80,100,120,140,160,180,200,220,240]},specialAbilityCategories:{general:"dsk.SPECIALABILITYCATEGORIES.general",Combat:"dsk.SPECIALABILITYCATEGORIES.combat",ahnen:"dsk.SPECIALABILITYCATEGORIES.ahnen",language:"dsk.SPECIALABILITYCATEGORIES.language"},shieldSizes:{short:"dsk.SIZE.small",medium:"dsk.SIZE.average",long:"dsk.SIZE.big"},combatSkillSubCategories:{0:"dsk.COMBATSKILLCATEGORY.0",1:"dsk.COMBATSKILLCATEGORY.1",2:"dsk.COMBATSKILLCATEGORY.2",3:"dsk.COMBATSKILLCATEGORY.3",4:"dsk.COMBATSKILLCATEGORY.4"},gearModifyableCalculatedAttributes:["schips","ini","gs","AeP","LeP","sk","zk"],rangeWeaponModifiers:{short:"dsk.RangeMod.short",medium:"dsk.RangeMod.medium",long:"dsk.RangeMod.long",rangesense:"dsk.RangeMod.rangesense",extreme:"dsk.RangeMod.extreme"},rangeMods:{short:{damage:1,attack:2},medium:{damage:0,attack:0},long:{damage:-1,attack:-2},rangesense:{damage:-1,attack:-1},extreme:{damage:-2,attack:-4}},regnerationCampLocations:{0:"dsk.regnerationCampLocations.normal","-1":"dsk.regnerationCampLocations.bad",1:"dsk.regnerationCampLocations.good"},regenerationInterruptOptions:{0:"dsk.regenerationInterruptOptions.none","-1":"dsk.regenerationInterruptOptions.small","-2":"dsk.regenerationInterruptOptions.big"},equipmentCategories:["meleeweapon","rangeweapon","equipment","ammunition","armor","poison"],rangeSizeModifier:{tiny:-8,small:-4,average:0,big:4,giant:8},aimOptions:{0:"dsk.aimOptions.0",2:"dsk.aimOptions.1",4:"dsk.aimOptions.2"},rangeVision:{0:"dsk.VisionDisruption.step0","-2":"dsk.VisionDisruption.step1","-4":"dsk.VisionDisruption.step2","-6":"dsk.VisionDisruption.step3","-5000":"dsk.VisionDisruption.step4"},targetMomevementOptions:{0:"dsk.rangeMovementOptions.SLOW","-2":"dsk.rangeMovementOptions.FAST",2:"dsk.rangeMovementOptions.STATIONARY"},shooterMovementOptions:{0:"dsk.rangeMovementOptions.SHOOTERSTATIONARY","-2":"dsk.rangeMovementOptions.SHOOTERMOVING","-4":"dsk.rangeMovementOptions.SHOOTERRUNNING"},mountedRangeOptions:{0:"dsk.mountedRangeOptions.STATIONARY","-4":"dsk.mountedRangeOptions.SCHRITT","-8":"dsk.mountedRangeOptions.GALOPP"},rangeSizeCategories:{tiny:"dsk.RANGESIZE.tiny",small:"dsk.RANGESIZE.small",average:"dsk.RANGESIZE.average",big:"dsk.RANGESIZE.big",giant:"dsk.RANGESIZE.giant"},meleeSizeCategories:{tiny:"dsk.MELEESIZE.tiny",small:"dsk.MELEESIZE.small",average:"dsk.MELEESIZE.average",big:"dsk.MELEESIZE.big",giant:"dsk.MELEESIZE.giant"},narrowSpaceModifiers:{weaponshort:{attack:2,parry:0,label:"dsk.NarrowSpaceModifiers.weapon.short"},weaponmedium:{attack:0,parry:0,label:"dsk.NarrowSpaceModifiers.weapon.medium"},weaponlong:{attack:-2,parry:0,label:"dsk.NarrowSpaceModifiers.weapon.long"},shieldshort:{attack:0,parry:2,label:"dsk.NarrowSpaceModifiers.shield.short"},shieldmedium:{attack:0,parry:0,label:"dsk.NarrowSpaceModifiers.shield.medium"},shieldlong:{attack:-2,parry:-2,label:"dsk.NarrowSpaceModifiers.shield.long"}},meleeSizeModifier:{tiny:-4,small:0,average:0,big:0,giant:0},sizeCategories:{tiny:"dsk.SIZE.tiny",small:"dsk.SIZE.small",average:"dsk.SIZE.average",big:"dsk.SIZE.big",giant:"dsk.SIZE.giant"},equipmentTypes:{misc:"dsk.Equipment.misc",clothes:"dsk.Equipment.clothes",tools:"dsk.Equipment.tools",light:"dsk.Equipment.light",healing:"dsk.Equipment.healing",bags:"dsk.Equipment.bags",wealth:"dsk.Equipment.wealth",writing:"dsk.Equipment.writing",alchemy:"dsk.Equipment.alchemy",service:"dsk.Equipment.service",luxus:"dsk.Equipment.luxus",blessed:"dsk.Equipment.blessed",food:"dsk.Equipment.food",animals:"dsk.Equipment.animals"},systemTables:[{name:"Melee",attrs:'data-weaponless="false"',roll:"botch-roll",pack:{de:"dsk.patzer",en:"dsk.botch"},setting:{module:"",key:""}},{name:"Range",attrs:'data-weaponless="false"',roll:"botch-roll",pack:{de:"dsk.patzer",en:"dsk.botch"},setting:{module:"",key:""}},{name:"Ahnen",attrs:"",roll:"botch-roll",pack:{de:"dsk.patzer",en:"dsk.botch"},setting:{module:"",key:""}}],tokenSizeCategories:{tiny:.5,small:.8,average:1,big:2,giant:4},ammunitiongroups:{"-":"-",arrow:"dsk.ammunition.arrow",bolt:"dsk.ammunition.bolt",bullet:"dsk.ammunition.bullet",stone:"dsk.ammunition.stone",dart:"dsk.ammunition.dart",mag:"dsk.ammunition.mag",infinite:"dsk.ammunition.infinite"},traitCategories:{meleeAttack:"dsk.closeCombatAttacks",rangeAttack:"dsk.rangeCombatAttacks",armor:"ITEM.TypeArmor"},meleeRanges:{short:"dsk.Range.short",medium:"dsk.Range.medium",long:"dsk.Range.long"},magicResistanceModifiers:{"-":"-",sk:"dsk.soulpower",zk:"dsk.toughness"},weapontypes:{melee:"ITEM.TypeMeleeweapon",range:"ITEM.TypeRangeweapon"},characteristics:{mu:"dsk.characteristics.mu.name",kl:"dsk.characteristics.kl.name",in:"dsk.characteristics.in.name",ch:"dsk.characteristics.ch.name",ff:"dsk.characteristics.ff.name",ge:"dsk.characteristics.ge.name",ko:"dsk.characteristics.ko.name",kk:"dsk.characteristics.kk.name"},skillBurdens:{yes:"dsk.yes",no:"dsk.no",maybe:"dsk.maybe"},skillDifficultyLabels:{eeasy:"dsk.Skill-eeasy",veasy:"dsk.Skill-veasy",easy:"dsk.Skill-easy",challenging:"dsk.Skill-challenging",difficult:"dsk.Skill-difficult",hard:"dsk.Skill-hard",vhard:"dsk.Skill-vhard"},skillDifficultyModifiers:{eeasy:16,veasy:8,easy:4,challenging:0,difficult:-4,hard:-8,vhard:-16},skillGroups:{body:"dsk.SKILL.body",social:"dsk.SKILL.social",knowledge:"dsk.SKILL.knowledge",trade:"dsk.SKILL.trade"}};CONFIG.time.roundTime=2,CONFIG.time.turnTime=0;const i=a},565:(t,r,o)=>{function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}o.d(r,{Z:()=>a});var a=function(){function DPS(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DPS)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DPS,null,[{key:"rangeFinder",value:function rangeFinder(t,r){var o=canvas.scene.grid.size,a=new Ray(t,r).distance/o,i=a*canvas.scene.grid.distance,c=Math.abs((getProperty(t,"system.elevation")||0)-(getProperty(r,"system.elevation")||0));return{elevation:c,distance:i,distanceSum:Math.hypot(i,c),tileDistance:a,unit:canvas.scene.grid.units}}},{key:"inDistance",value:function inDistance(t){var r,o=_createForOfIteratorHelper(canvas.scene.tokens);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(a.isOwner&&this.rangeFinder(t,a.object).tileDistance<=2)return!0}}catch(t){o.e(t)}finally{o.f()}return!1}},{key:"distanceModifier",value:function distanceModifier(t,r,o){if(!game.settings.get("dsk","enableDPS")||!t)return 1;var a,i={},c=_createForOfIteratorHelper(game.user.targets);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=DPS.rangeFinder(t,u);(i.distanceSum||0)<l.distanceSum&&(i=l)}}catch(t){c.e(t)}finally{c.f()}if(i.unit==game.i18n.localize("dsk.gridUnits")){for(var p=Number(getProperty(o,"system.rangeMultiplier"))||1,d=r.system.rw.split("/").map((function(t){return Number(t)*p})),h=0;h<2&&d[h]<i.distanceSum;)h++;return h}return 1}},{key:"initDoorMinDistance",value:function initDoorMinDistance(){var t=DoorControl.prototype._onMouseDown;DoorControl.prototype._onMouseDown=function(r){return game.user.isGM||!game.settings.get("dsk","enableDPS")||DPS.inDistance(this)?t.apply(this,arguments):ui.notifications.warn(game.i18n.localize("dsk.DSKError.notInRangeToLoot"))}}}]),DPS}()},614:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>DiceDSK});var _actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(231),_dialog_dialog_dsk_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(96),_status_active_effects_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(61),_status_status_effects_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(973),_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(139),_advantage_rules_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(278),_config_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(930),_dsk_soundeffect_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(608),_dsk_utility_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(832),_request_roll_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(903),_specialability_rules_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(514),_trait_rules_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(969);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _slicedToArray(t,r){return _arrayWithHoles(t)||_iterableToArrayLimit(t,r)||_unsupportedIterableToArray(t,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a,i,c=[],u=!0,l=!1;try{for(o=o.call(t);!(u=(a=o.next()).done)&&(c.push(a.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==o.return||o.return()}finally{if(l)throw i}}return c}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}var DiceDSK=function(){function DiceDSK(){_classCallCheck(this,DiceDSK)}var _chatListeners,_rollDamage,_damageFormula,_rollDices,_rollRegeneration,_rollWeapon,_rollCombatTrait,_manualRolls,_showDiceSoNice,_roll2D,_evaluateDamage,_detailedWeaponResult,_stringToRoll2,_rollSpell,_addRollDiceSoNice2,_rollAttribute,_rollTest,_rollTalent,_getDefenseCount,_setupDialog;return _createClass(DiceDSK,null,[{key:"setupDialog",value:(_setupDialog=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,o,a,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee$(d){for(;;)switch(d.prev=d.next){case 0:return r=t.dialogOptions,o=t.testData,a=t.cardOptions,d.next=3,game.settings.get("core","rollMode");case 3:return i=d.sent,c="challenging","function"==typeof o.source.toObject&&(o.source=o.source.toObject(!1)),mergeObject(o,{testDifficulty:c}),mergeObject(r.data,{testDifficulty:c,testModifier:r.data.modifier||0}),u=r.data.situationalModifiers||(o.extra.actor?_status_status_effects_js__WEBPACK_IMPORTED_MODULE_3__.Z.getRollModifiers(o.extra.actor,o.source):[]),null!=o.extra.options.moreModifiers&&u.push.apply(u,_toConsumableArray(o.extra.options.moreModifiers)),l=[],game.user.targets.forEach((function(t){t.actor&&l.push({name:t.actor.name,id:t.id,img:t.actor.img})})),d.t0=mergeObject,d.t1=r.data,d.t2=u.length>0,d.t3=u,d.t4=r.data.rollMode||i,d.t5=CONFIG.Dice.rollModes,d.next=20,this.getDefenseCount(o);case 20:if(d.t6=d.sent,d.t7=l,d.t8={hasSituationalModifiers:d.t2,situationalModifiers:d.t3,rollMode:d.t4,rollModes:d.t5,defenseCount:d.t6,targets:d.t7},(0,d.t0)(d.t1,d.t8),mergeObject(a,{user:game.user.id}),o.extra.options.bypass){d.next=32;break}return d.next=28,renderTemplate(r.template,r.data);case 28:return p=d.sent,d.abrupt("return",new Promise((function(t,a){var i=_dialog_dialog_dsk_js__WEBPACK_IMPORTED_MODULE_1__.Z.getDialogForItem(o.source.type);new i({title:r.title,content:p,buttons:i.getRollButtons(o,r,t,a),default:"rollButton"}).recallSettings(o.extra.speaker,o.source,o.mode).render(!0)})));case 32:return a.rollMode=o.extra.options.rollMode||i,o.situationalModifiers||(o.situationalModifiers=[]),d.abrupt("return",{testData:o,cardOptions:a});case 35:case"end":return d.stop()}}),_callee,this)}))),function setupDialog(t){return _setupDialog.apply(this,arguments)})},{key:"_appendSituationalModifiers",value:function _appendSituationalModifiers(t,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=t.situationalModifiers.find((function(t){return t.name==r}));i?i.value=o:t.situationalModifiers.push({name:r,value:o,type:a})}},{key:"_situationalPartCheckModifiers",value:function _situationalPartCheckModifiers(t){return t.situationalModifiers.reduce((function(t,r){if("TPM"==r.type){var o=r.value.split("|");return 2!=o.length||(t[0]=t[0]+Number(o[0]),t[1]=t[1]+Number(o[1])),t}return t}),[0,0])}},{key:"_situationalModifiers",value:function _situationalModifiers(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.situationalModifiers.reduce((function(t,o){return t+((o.type==r||""==r&&null==o.type)&&Number(o.value)||0)}),0)}},{key:"getDefenseCount",value:(_getDefenseCount=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:if(!game.combat){r.next=4;break}return r.next=3,game.combat.getDefenseCount(t.extra.speaker);case 3:return r.abrupt("return",r.sent);case 4:return r.abrupt("return",0);case 5:case"end":return r.stop()}}),_callee2)}))),function getDefenseCount(t){return _getDefenseCount.apply(this,arguments)})},{key:"rollTalent",value:(_rollTalent=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r;return _regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this._roll2D20(t);case 2:return(r=o.sent).rollType="talent",o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee3,this)}))),function rollTalent(t){return _rollTalent.apply(this,arguments)})},{key:"rollTest",value:(_rollTest=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r;return _regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:o.t0=t.source.type,o.next="ahnengabe"===o.t0?3:"skill"===o.t0?7:"combatskill"===o.t0?11:"regenerate"===o.t0?15:"trait"===o.t0?19:"meleeweapon"===o.t0||"rangeweapon"===o.t0?30:"poison"===o.t0?41:45;break;case 3:return o.next=5,this.rollSpell(t);case 5:return r=o.sent,o.abrupt("break",48);case 7:return o.next=9,this.rollTalent(t);case 9:return r=o.sent,o.abrupt("break",48);case 11:return o.next=13,this.rollCombatskill(t);case 13:return r=o.sent,o.abrupt("break",48);case 15:return o.next=17,this.rollRegeneration(t);case 17:return r=o.sent,o.abrupt("break",48);case 19:if("damage"!=t.mode){o.next=25;break}return o.next=22,this.rollDamage(t);case 22:o.t1=o.sent,o.next=28;break;case 25:return o.next=27,this.rollCombatTrait(t);case 27:o.t1=o.sent;case 28:return r=o.t1,o.abrupt("break",48);case 30:if("damage"!=t.mode){o.next=36;break}return o.next=33,this.rollDamage(t);case 33:o.t2=o.sent,o.next=39;break;case 36:return o.next=38,this.rollWeapon(t);case 38:o.t2=o.sent;case 39:return r=o.t2,o.abrupt("break",48);case 41:return o.next=43,this.rollItem(t);case 43:return r=o.sent,o.abrupt("break",48);case 45:return o.next=47,this.rollAttribute(t);case 47:r=o.sent;case 48:return mergeObject(r,deepClone(t.extra)),o.abrupt("return",r);case 50:case"end":return o.stop()}}),_callee4,this)}))),function rollTest(t){return _rollTest.apply(this,arguments)})},{key:"rollAttribute",value:(_rollAttribute=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r;return _regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this._roll2D20(t);case 2:return(r=o.sent).rollType="attribute",o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee5,this)}))),function rollAttribute(t){return _rollAttribute.apply(this,arguments)})},{key:"get2D20SuccessLevel",value:function get2D20SuccessLevel(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=t.terms.filter((function(t){return t.results&&t.results[0].result<=a})).length,c=t.terms.filter((function(t){return t.results&&t.results[0].result>=o})).length;return i>=2?i:c>=2?-1*c:r>=0?1:-1}},{key:"_addRollDiceSoNice",value:(_addRollDiceSoNice2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r,o){var a;return _regeneratorRuntime().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:if(!t.rollMode){i.next=4;break}for(a=0;a<r.dice.length;a++)mergeObject(r.dice[a].options,o);return i.next=4,this.showDiceSoNice(r,t.rollMode);case 4:case"end":return i.stop()}}),_callee6,this)}))),function _addRollDiceSoNice(t,r,o){return _addRollDiceSoNice2.apply(this,arguments)})},{key:"rollSpell",value:(_rollSpell=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,o,a,i,c,u,l,p,d,h,y,m,g,v,_;return _regeneratorRuntime().wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this._roll2D20(t);case 2:if((r=b.sent).rollType=t.source.types,r.preData.calculatedSpellModifiers.finalcost=Number(r.preData.calculatedSpellModifiers.cost),r.successLevel>=2?(r.description=r.description+", "+game.i18n.localize("dsk.additionalQLs")+" 10",r.qualityStep=Math.min(6,Math.ceil(r.result/5)+2),r.preData.calculatedSpellModifiers.finalcost=Math.round(r.preData.calculatedSpellModifiers.cost/2)):r.successLevel<=-2&&(r.description+=_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_4__.Z.rollCritBotchButton("Ahnen",!1,t)),!(r.successLevel>0)){b.next=39;break}if(""==t.source.system.effectFormula){b.next=39;break}o=t.source.system.effectFormula.replace(game.i18n.localize("dsk.CHARAbbrev.QS"),r.qualityStep).replace(/[Ww]/g,"d"),a=[],i=_createForOfIteratorHelper(t.situationalModifiers);try{for(i.s();!(c=i.n()).done;)(u=c.value).armorPen&&a.push(u.armorPen)}catch(t){i.e(t)}finally{i.f()}if(/(,|;)/.test(o)&&(o=o.split(/[,;]/)[r.qualityStep-1]),!t.damageRoll){b.next=17;break}b.t0=t.damageRoll,b.next=25;break;case 17:return b.t1=DiceDSK,b.next=20,new Roll(o).evaluate({async:!0});case 20:return b.t2=b.sent,b.t3=t.extra.options,b.next=24,b.t1.manualRolls.call(b.t1,b.t2,"dsk.CHAR.DAMAGE",b.t3);case 24:b.t0=b.sent;case 25:l=b.t0,this._addRollDiceSoNice(t,l,game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration("damage")),r.calculatedEffectFormula=o,p=_createForOfIteratorHelper(l.terms);try{for(p.s();!(d=p.n()).done;)if((h=d.value)instanceof Die||"Die"==h.class){y=_createForOfIteratorHelper(h.results);try{for(y.s();!(m=y.n()).done;)g=m.value,r.characteristics.push({char:"effect",res:g.result,die:"d"+h.faces})}catch(t){y.e(t)}finally{y.f()}}}catch(t){p.e(t)}finally{p.f()}return v=[],b.next=33,DiceDSK._stringToRoll(t.extra.actor.system.spellStats.damage,t);case 33:0!=(_=b.sent)&&v.push(game.i18n.localize("dsk.statuseffects")+" "+_),r.armorPen=a,r.damageRoll=l,r.damage=l.total+_,r.damagedescription=v.join("\n");case 39:return this.calculateEnergyCost(r,t),b.abrupt("return",r);case 41:case"end":return b.stop()}}),_callee7,this)}))),function rollSpell(t){return _rollSpell.apply(this,arguments)})},{key:"calculateEnergyCost",value:function calculateEnergyCost(t,r){var o=[];if(t.successLevel<0){var a=["traditionWitch","traditionFjarning","braniborian"].map((function(t){return game.i18n.localize("LocalizedIDs.".concat(t))})),i=r.extra.actor.items.some((function(t){return"specialability"==t.type&&a.includes(t.name)}))?3:2;t.preData.calculatedSpellModifiers.finalcost=Math.round(t.preData.calculatedSpellModifiers.finalcost/i)}var c=game.i18n.localize("dsk.LocalizedIDs.weakAstralBody"),u=game.i18n.localize("dsk.LocalizedIDs.".concat(t.successLevel>0?"energyControl":"smallEnergyControl")),l="aepModifier",p="AeP";o.push({name:c,value:_advantage_rules_js__WEBPACK_IMPORTED_MODULE_5__.Z.vantageStep(r.extra.actor,c)},{name:u,value:-1*_specialability_rules_js__WEBPACK_IMPORTED_MODULE_10__.Z.abilityStep(r.extra.actor,u)},{name:"".concat(game.i18n.localize("dsk.statuseffects")," (").concat(game.i18n.localize("dsk.CHARAbbrev."+p),")"),value:r.extra.actor.system[l]+this._situationalModifiers(r,"AePCost")}),o=o.filter((function(t){return 0!=t.value})),t.preData.calculatedSpellModifiers.description=o.map((function(t){return"".concat(t.name," ").concat(t.value)})).join("\n"),t.preData.calculatedSpellModifiers.finalcost=Math.max(1,Number(t.preData.calculatedSpellModifiers.finalcost)+o.reduce((function(t,r){return t+r.value}),0))}},{key:"_stringToRoll",value:(_stringToRoll2=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r){var o,a,i,c,u;return _regeneratorRuntime().wrap((function _callee8$(l){for(;;)switch(l.prev=l.next){case 0:return o=[],a=/\d{1}[dDwW]\d/g,(i="".concat(t)).replace(a,(function(t){o.push(new Roll(t.replace(/[Ww]/,"d")).evaluate({async:!0}))})),l.next=6,Promise.all(o);case 6:return c=l.sent,u=i.replace(a,(function(){var t=c.shift();return r&&DiceDSK._addRollDiceSoNice(r,t,game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration("ch")),t.total})),l.next=10,Roll.safeEval(u);case 10:return l.abrupt("return",l.sent);case 11:case"end":return l.stop()}}),_callee8)}))),function _stringToRoll(t,r){return _stringToRoll2.apply(this,arguments)})},{key:"detailedWeaponResult",value:(_detailedWeaponResult=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t,r,o){var a,i;return _regeneratorRuntime().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if("attack"==r.mode){c.next=2;break}return c.abrupt("return");case 2:c.t0=t.successLevel,c.next=2===c.t0?5:-2===c.t0?8:12;break;case 5:return t.description+=_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_4__.Z.defaultAttackCrit(!0),t.doubleDamage=!0,c.abrupt("break",12);case 8:return a="meleeweapon"==o.type||"meleeAttack"==getProperty(o,"system.traitType"),i=getProperty(o,"system.combatskill")==game.i18n.localize("dsk.LocalizedIDs.wrestle")||"trait"==o.type,t.description+=a?_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_4__.Z.rollCritBotchButton("Melee",i,r):_tables_dsktables_js__WEBPACK_IMPORTED_MODULE_4__.Z.rollCritBotchButton("Range",!1,r),c.abrupt("break",12);case 12:case"end":return c.stop()}}),_callee9)}))),function detailedWeaponResult(t,r,o){return _detailedWeaponResult.apply(this,arguments)})},{key:"evaluateDamage",value:(_evaluateDamage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(t,r,o,a,i){var c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,R,G,L,D,j,M;return _regeneratorRuntime().wrap((function _callee10$(z){for(;;)switch(z.prev=z.next){case 0:c=o.system.tp.replace(/[Ww]/g,"d"),u=[],l=o.dmgMultipliers||[],p=l.map((function(t){return"".concat(t.name," *").concat(t.val)})),d=[],h=0,y=_createForOfIteratorHelper(t.situationalModifiers),z.prev=7,y.s();case 9:if((m=y.n()).done){z.next=33;break}if(g=m.value,v=0,g.armorPen&&d.push(g.armorPen),!g.damageBonus){z.next=31;break}if(!/^\*/.test(g.damageBonus)){z.next=17;break}return l.push({name:g.name,val:Number(g.damageBonus.replace("*",""))}),z.abrupt("continue",31);case 17:return _=/^=/.test(g.damageBonus),b="".concat(g.damageBonus).replace(/^=/,""),z.next=21,DiceDSK._stringToRoll(b,t);case 21:if(k=z.sent,v=k*(g.step||1),!_){z.next=29;break}return c=b.replace(/[Ww]/,"d"),u.push({name:g.name,roll:k}),z.abrupt("continue",31);case 29:g.damageBonus=k,h+=v;case 31:z.next=9;break;case 33:z.next=38;break;case 35:z.prev=35,z.t0=z.catch(7),y.e(z.t0);case 38:return z.prev=38,y.f(),z.finish(38);case 41:if(!t.damageRoll){z.next=47;break}return z.next=44,t.damageRoll;case 44:z.t1=z.sent,z.next=55;break;case 47:return z.t2=DiceDSK,z.next=50,new Roll(c).evaluate({async:!0});case 50:return z.t3=z.sent,z.t4=t.extra.options,z.next=54,z.t2.manualRolls.call(z.t2,z.t3,"dsk.damage",z.t4);case 54:z.t1=z.sent;case 55:w=z.t1,x=w.total,O=0,S=_createForOfIteratorHelper(w.terms);try{for(S.s();!(P=S.n()).done;)if((T=P.value)instanceof Die||"Die"==T.class){I=_createForOfIteratorHelper(T.results);try{for(I.s();!(E=I.n()).done;)C=E.value,O+=Number(C.result),r.characteristics.push({char:"damage",res:C.result,die:"d"+T.faces})}catch(t){I.e(t)}finally{I.f()}}}catch(t){S.e(t)}finally{S.f()}if(A=x-O,!(u.length>0)){z.next=65;break}p.push(u[0].name+" "+x),z.next=76;break;case 65:return x+=h,p.push(game.i18n.localize("dsk.Roll")+" "+O),0!=A&&p.push(game.i18n.localize("dsk.weaponModifier")+" "+A),t.situationalModifiers.reduce((function(t,r){if(r.damageBonus){var o=/^\*/.test(r.damageBonus)?r.damageBonus:Number(r.damageBonus)*(r.step||1);p.push("".concat(r.name," ").concat(o))}}),p),t.situationalModifiers.find((function(t){return t.name.indexOf(game.i18n.localize("dsk.CONDITION.bloodrush"))>-1}))&&(x+=2,p.push(game.i18n.localize("dsk.CONDITION.bloodrush")+" 2")),o.extraDamage&&(x=Number(o.extraDamage)+Number(x),p.push(game.i18n.localize("dsk.damageThreshold")+" "+o.extraDamage)),a?(G=_config_js__WEBPACK_IMPORTED_MODULE_6__.Z.rangeMods[t.rangeModifier||"medium"].damage,x+=G,0!=G&&p.push(game.i18n.localize("dsk.distance")+" "+G),R=t.extra.actor.system.rangeStats.damage):R=t.extra.actor.system.meleeStats.damage,z.next=74,DiceDSK._stringToRoll(R,t);case 74:0!=(L=z.sent)&&(x+=L,p.push(game.i18n.localize("dsk.statuseffects")+" "+L));case 76:r.qualityStep>0&&(x+=r.qualityStep,p.push(game.i18n.localize("dsk.qualityStep")+" "+r.qualityStep)),i&&(x*=3,p.push(game.i18n.localize("dsk.doubleDamage"))),D=_createForOfIteratorHelper(l);try{for(D.s();!(j=D.n()).done;)M=j.value,x*=M.val}catch(t){D.e(t)}finally{D.f()}r.armorPen=d,r.damagedescription=p.join(", "),r.damage=Math.round(x),r.damageRoll=duplicate(w);case 84:case"end":return z.stop()}}),_callee10,null,[[7,35,38,41]])}))),function evaluateDamage(t,r,o,a,i){return _evaluateDamage.apply(this,arguments)})},{key:"parseEffect",value:function parseEffect(t){var r=t.system.effect?t.system.effect:void 0,o=[];if(r){var a,i=/^[a-z]+\|[öäüÖÄÜa-zA-z ]+$/,c=_createForOfIteratorHelper(r.split(";"));try{for(c.s();!(a=c.n()).done;){var u=a.value;i.test(u.trim())&&function(){var t=u.split("|").map((function(t){return t.trim()}));if("condition"==t[0]){var r=CONFIG.statusEffects.find((function(r){return r.id==t[1]}));o.push('<a class="chat-condition chatButton" data-id="'.concat(r.id,'">\n                            <img src="').concat(r.icon,'"/>').concat(game.i18n.localize(r.label),"\n                            </a>"))}else o.push('<a class="roll-button roll-item" data-name="'.concat(t[1],'" data-type="').concat(t[0],'"><i class="fas fa-dice"></i>').concat(game.i18n.localize(t[0]),": ").concat(t[1],"</a>"))}()}}catch(t){c.e(t)}finally{c.f()}}var l=getProperty(t,"flags.dsk.poison");return l&&o.push('<a class="roll-button roll-item" data-removecharge="'.concat(!l.permanent,'" data-name="').concat(l.name,'" data-type="poison"><i class="fas fa-dice"></i>').concat(game.i18n.localize("ITEM.TypePoison"),": ").concat(l.name,"</a>")),o.join(", ")}},{key:"_roll2D20",value:(_roll2D=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t){var r,o,a,i,c,u,l,p,d,h,y,m,g,v,_,b;return _regeneratorRuntime().wrap((function _callee11$(k){for(;;)switch(k.prev=k.next){case 0:if(!t.roll){k.next=4;break}k.t0=Roll.fromData(t.roll),k.next=7;break;case 4:return k.next=6,new Roll("1d20+1d20").evaluate({async:!0});case 6:k.t0=k.sent;case 7:if(r=k.t0,o=[],a=0,t.testDifficulty&&this._appendSituationalModifiers(t,game.i18n.localize("dsk.Difficulty"),t.testDifficulty),i=this._situationalModifiers(t),c=this._situationalPartCheckModifiers(t,"TPM"),(u=t.source.attack||Number(t.source.system.at))||(u=null==t.source.system.level?-5+t.extra.actor.system.characteristics[t.source.system.characteristic1].value+t.extra.actor.system.characteristics[t.source.system.characteristic2].value:t.source.system.level+5+Math.round((t.extra.actor.system.characteristics[t.source.system.characteristic1].value+t.extra.actor.system.characteristics[t.source.system.characteristic2].value)/2)),l=u+this._situationalModifiers(t,"FW")+c[0]+c[1]+i,t.advancedModifiers&&(l+=t.advancedModifiers.fws+t.advancedModifiers.chars[0]+t.advancedModifiers.chars[1]),p=l-r.total,d=1,h=20,"skill"!=t.source.type||!_advantage_rules_js__WEBPACK_IMPORTED_MODULE_5__.Z.hasVantage(t.extra.actor,"".concat(game.i18n.localize("dsk.LocalizedIDs.incompetent")," (").concat(t.source.name,")"))){k.next=31;break}return k.next=23,new Roll("1d20").evaluate({async:!0});case 23:y=k.sent,m=res.reduce((function(t,r,o,a){return r<a[t]?o:t}),0),g=r.terms[2*m].total,p+=Math.max(res[m],0),p-=Math.max(0,y.total-tar[m]),r.editRollAtIndex([{index:m,val:y.total}]),this._addRollDiceSoNice(t,y,r.terms[2*m].options),o.push(game.i18n.format("dsk.CHATNOTIFICATION.unableReroll",{die:m+1,oldVal:g,newVal:y.total}));case 31:return v=0,"skill"==t.source.type&&_trait_rules_js__WEBPACK_IMPORTED_MODULE_11__.Z.hasTrait(t.extra.actor,"".concat(game.i18n.localize("dsk.LocalizedIDs.automaticSuccess")," (").concat(t.source.name,")"))?(o.push(game.i18n.localize("dsk.LocalizedIDs.automaticSuccess")),a=1,v=1):"skill"==t.source.type&&_trait_rules_js__WEBPACK_IMPORTED_MODULE_11__.Z.hasTrait(t.extra.actor,"".concat(game.i18n.localize("dsk.LocalizedIDs.automaticFail")," (").concat(t.source.name,")"))?(o.push(game.i18n.localize("dsk.LocalizedIDs.automaticFail")),a=-1):(a=DiceDSK.get2D20SuccessLevel(r,p,h,d),t.routine&&(a=1),o.push(DiceDSK.getSuccessDescription(a))),o=o.join(", "),_=0,a>0&&(p+=this._situationalModifiers(t,"FP"),_=Math.max(1,(0==p?1:p>0?Math.ceil(p/5):0)+(null!=t.qualityStep?Number(t.qualityStep):0))+((null===(b=t.advancedModifiers)||void 0===b?void 0:b.qls)||0)+this._situationalModifiers(t,"QL")),_<v&&(_=v),k.abrupt("return",{result:p,characteristics:[0,1].map((function(o){var a;return{char:t.source.system["characteristic".concat(o+1)],res:r.terms[2*o].results[0].result,tar:null===(a=t.extra.actor.system.characteristics[t.source.system["characteristic".concat(o+1)]])||void 0===a?void 0:a.value}})),qualityStep:_,pw:l,description:o,preData:t,successLevel:a,modifiers:i,extra:{}});case 38:case"end":return k.stop()}}),_callee11,this)}))),function _roll2D20(t){return _roll2D.apply(this,arguments)})},{key:"renderRollCard",value:function(){var _renderRollCard=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(chatOptions,testData,rerenderMessage){var applyEffect,preData,hideDamage,hasAreaTemplate,chatData,html,actor,rollData,enriched,postFunction,newMsg;return _regeneratorRuntime().wrap((function _callee12$(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return applyEffect=this.addApplyEffectData(testData),preData=deepClone(testData.preData),hideDamage=rerenderMessage?rerenderMessage.flags.data.hideDamage:"attack"==preData.mode,_context12.next=5,Hooks.call("postProcessDSKRoll",chatOptions,testData,rerenderMessage,hideDamage);case 5:if(delete preData.extra.actor,delete testData.actor,delete testData.preData,hasAreaTemplate=testData.successLevel>0&&preData.source.system.target&&preData.source.system.target.type in game.dsk.config.areaTargetTypes,chatData={title:chatOptions.title,testData,hideData:game.user.isGM,preData,hideDamage,modifierList:preData.situationalModifiers.filter((function(t){return 0!=t.value})),applyEffect,hasAreaTemplate},preData.advancedModifiers&&(preData.advancedModifiers.chars.some((function(t){return 0!=t}))&&chatData.modifierList.push({name:game.i18n.localize("dsk.MODS.partChecks"),value:preData.advancedModifiers.chars}),0!=preData.advancedModifiers.fws&&chatData.modifierList.push({name:game.i18n.localize("dsk.MODS.FW"),value:preData.advancedModifiers.fws}),0!=preData.advancedModifiers.qls&&chatData.modifierList.push({name:game.i18n.localize("dsk.MODS.QS"),value:preData.advancedModifiers.qls})),["gmroll","blindroll"].includes(chatOptions.rollMode)&&(chatOptions.whisper=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))),"blindroll"===chatOptions.rollMode?chatOptions.blind=!0:"selfroll"===chatOptions.rollMode&&(chatOptions.whisper=[game.user.id]),_dsk_soundeffect_js__WEBPACK_IMPORTED_MODULE_7__.Z.playEffect(preData.mode,preData.source,testData.successLevel,chatOptions.whisper,chatOptions.blind),chatOptions["flags.data"]={preData,postData:testData,template:chatOptions.template,rollMode:chatOptions.rollMode,isOpposedTest:chatOptions.isOpposedTest,title:chatOptions.title,hideData:chatData.hideData,hideDamage:chatData.hideDamage,isDSKRoll:!0},rerenderMessage){_context12.next=24;break}return _context12.next=18,renderTemplate(chatOptions.template,chatData);case 18:return chatOptions.content=_context12.sent,_context12.next=21,ChatMessage.create(chatOptions,!1);case 21:return _context12.abrupt("return",_context12.sent);case 24:return _context12.next=26,renderTemplate(chatOptions.template,chatData);case 26:return html=_context12.sent,actor=ChatMessage.getSpeakerActor(rerenderMessage.speaker)||game.users.get(rerenderMessage.user).character,rollData=actor?actor.getRollData():{},_context12.next=31,TextEditor.enrichHTML(html,{rollData,async:!0});case 31:return enriched=_context12.sent,chatOptions.content=enriched,postFunction=getProperty(rerenderMessage,"flags.data.preData.extra.options.postFunction"),postFunction&&(testData.messageId=rerenderMessage.id,eval(postFunction.functionName)(postFunction,{result:testData},preData.source)),_context12.next=37,rerenderMessage.update(_defineProperty({content:chatOptions.content},"flags.data",chatOptions["flags.data"]));case 37:return newMsg=_context12.sent,ui.chat.updateMessage(newMsg),_context12.abrupt("return",newMsg);case 40:case"end":return _context12.stop()}}),_callee12,this)})));function renderRollCard(t,r,o){return _renderRollCard.apply(this,arguments)}return renderRollCard}()},{key:"addApplyEffectData",value:function addApplyEffectData(t){var r=t.preData.source;if(["ahnengabe","meleeweapon","rangeweapon"].includes(r.type)){if(t.successLevel>0&&r.effects.length>0)return!0}else{if(["poison"].includes(r.type))return r.effects.length>0;if("trait"==r.type&&r.effects.length>0&&t.successLevel>0)return!0}var o=t.preData.situationalModifiers.filter((function(t){return t.specAbId})).map((function(t){return t.specAbId}));if(o.length>0){var a,i=_createForOfIteratorHelper(t.preData.extra.actor.items.filter((function(t){return o.includes(t._id)})));try{for(i.s();!(a=i.n()).done;){if(a.value.effects.length>0)return!0}}catch(t){i.e(t)}finally{i.f()}}return!1}},{key:"getSuccessDescription",value:function getSuccessDescription(t){return game.i18n.localize(["dsk.CriticalFailure","dsk.Failure","","dsk.Success","dsk.CriticalSuccess"][t+2])}},{key:"showDiceSoNice",value:(_showDiceSoNice=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(t,r){var o,a,i;return _regeneratorRuntime().wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:if(!_dsk_utility_js__WEBPACK_IMPORTED_MODULE_8__.Z.moduleEnabled("dice-so-nice")){c.next=17;break}o=null,a=!1,c.t0=r,c.next="blindroll"===c.t0?6:"gmroll"===c.t0?9:"selfroll"===c.t0?11:13;break;case 6:return a=!0,o=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id})),c.abrupt("break",13);case 9:return o=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id})),c.abrupt("break",13);case 11:return o=[],c.abrupt("break",13);case 13:if(i=game.dice3d.showForRoll(t,game.user,!0,o,a),game.settings.get("dice-so-nice","immediatelyDisplayChatMessages")){c.next=17;break}return c.next=17,i;case 17:case"end":return c.stop()}}),_callee13)}))),function showDiceSoNice(t,r){return _showDiceSoNice.apply(this,arguments)})},{key:"manualRolls",value:(_manualRolls=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(t){var r,o,a,i,c,u,l,p,d,h,y,m,g,v,_,b=arguments;return _regeneratorRuntime().wrap((function _callee14$(k){for(;;)switch(k.prev=k.next){case 0:if(r=b.length>1&&void 0!==b[1]?b[1]:"",!(o=b.length>2&&void 0!==b[2]?b[2]:{}).cheat&&!game.settings.get("dsk","allowPhysicalDice")){k.next=21;break}if(o.predefinedResult){k.next=20;break}a=!1,c=[],u=_createForOfIteratorHelper(t.terms);try{for(u.s();!(l=u.n()).done;)if((p=l.value)instanceof Die||"Die"==p.class){d=_createForOfIteratorHelper(p.results);try{for(d.s();!(h=d.n()).done;)y=h.value,c.push({faces:p.faces,val:y.result})}catch(t){d.e(t)}finally{d.f()}}}catch(t){u.e(t)}finally{u.f()}return k.next=10,renderTemplate("systems/dsk/templates/dialog/manualroll-dialog.html",{dice:c,description:r});case 10:return m=k.sent,k.next=13,new Promise((function(t,r){new _dialog_dialog_dsk_js__WEBPACK_IMPORTED_MODULE_1__.Z({title:game.i18n.localize(o.cheat?"dsk.DIALOG.cheat":"dsk.SETTINGS.allowPhysicalDice"),content:m,default:"ok",buttons:{ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(r){t([!0,r])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){t([!1,0])}}}}).render(!0)}));case 13:g=k.sent,v=_slicedToArray(g,2),a=v[0],i=v[1],a&&(_=[],i.find(".dieInput").each((function(t){var r=Number($(this).val());r>0&&_.push({val:r,index:t}),t++})),t.editRollAtIndex(_)),k.next=21;break;case 20:t.editRollAtIndex(o.predefinedResult);case 21:return k.abrupt("return",t);case 22:case"end":return k.stop()}}),_callee14)}))),function manualRolls(t){return _manualRolls.apply(this,arguments)})},{key:"_getNarrowSpaceModifier",value:function _getNarrowSpaceModifier(t,r){return r.narrowSpace?game.i18n.localize("dsk.LocalizedIDs.Shields")==t.system.combatskill?_config_js__WEBPACK_IMPORTED_MODULE_6__.Z.narrowSpaceModifiers["shield"+t.system.shieldsize][r.mode]:_config_js__WEBPACK_IMPORTED_MODULE_6__.Z.narrowSpaceModifiers["weapon"+t.system.rw][r.mode]:0}},{key:"rollCombatTrait",value:(_rollCombatTrait=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(t){var r,o,a,i,c;return _regeneratorRuntime().wrap((function _callee15$(u){for(;;)switch(u.prev=u.next){case 0:return r=t.source,o="meleeAttack"==r.system.traitType,a=r,o?this._appendSituationalModifiers(t,game.i18n.localize("dsk.narrowSpace"),this._getNarrowSpaceModifier(a,t)):this._appendSituationalModifiers(t,game.i18n.localize("dsk.distance"),_config_js__WEBPACK_IMPORTED_MODULE_6__.Z.rangeMods[t.rangeModifier||"medium"].attack),u.next=6,this._roll2D20(t);case 6:return i=u.sent,u.next=9,this.detailedWeaponResult(i,t,r);case 9:if(!("attack"==t.mode&&i.successLevel>0)){u.next=12;break}return u.next=12,DiceDSK.evaluateDamage(t,i,a,!o,i.doubleDamage);case 12:return i.rollType="weapon",(c=DiceDSK.parseEffect(a))&&(i.parsedEffect=c),u.abrupt("return",i);case 16:case"end":return u.stop()}}),_callee15,this)}))),function rollCombatTrait(t){return _rollCombatTrait.apply(this,arguments)})},{key:"rollWeapon",value:(_rollWeapon=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(t){var r,o,a,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee16$(d){for(;;)switch(d.prev=d.next){case 0:return o=t.source,a=t.extra.actor,i=o.system.combatskill,c=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._calculateCombatSkillValues(a.items.find((function(t){return"combatskill"==t.type&&t.name==i})),a.system),(u="meleeweapon"==o.type)?(r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareMeleeWeapon(o,[c],t.extra.actor),this._appendSituationalModifiers(t,game.i18n.localize("dsk.narrowSpace"),this._getNarrowSpaceModifier(r,t))):(r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareRangeWeapon(o,[],[c],t.extra.actor),this._appendSituationalModifiers(t,game.i18n.localize("dsk.distance"),_config_js__WEBPACK_IMPORTED_MODULE_6__.Z.rangeMods[t.rangeModifier||"medium"].attack)),d.next=8,this._roll2D20(t);case 8:return l=d.sent,d.next=11,this.detailedWeaponResult(l,t,o);case 11:if(!("attack"==t.mode&&l.successLevel>0)){d.next=14;break}return d.next=14,DiceDSK.evaluateDamage(t,l,r,!u,l.doubleDamage);case 14:return l.rollType="weapon",(p=DiceDSK.parseEffect(r))&&(l.parsedEffect=p),d.abrupt("return",l);case 18:case"end":return d.stop()}}),_callee16,this)}))),function rollWeapon(t){return _rollWeapon.apply(this,arguments)})},{key:"rollRegeneration",value:(_rollRegeneration=_asyncToGenerator(_regeneratorRuntime().mark((function _callee17(t){var r,o,a,i,c,u,l,p,d,h,y,m;return _regeneratorRuntime().wrap((function _callee17$(g){for(;;)switch(g.prev=g.next){case 0:if(r=this._situationalModifiers(t),o=t.roll,a=[],i={rollType:"regenerate",preData:t,modifiers:r,extra:{}},c=[],t.regenerateLeP&&c.push("LeP"),t.extra.actor.system.isMage&&t.regenerateAsP&&c.push("AeP"),u=0,t.extra.actor.effects.some((function(t){return"sick"==getProperty(t,"flags.core.statusId")}))){this._appendSituationalModifiers(t,game.i18n.localize("dsk.CONDITION.sick"),"*0"),l=_createForOfIteratorHelper(c);try{for(l.s();!(p=l.n()).done;)d=p.value,a.push({char:d,res:0,die:"d6"}),i[d]=0,u+=2}catch(t){l.e(t)}finally{l.f()}}else{h=_createForOfIteratorHelper(c);try{for(h.s();!(y=h.n()).done;)m=y.value,this._appendSituationalModifiers(t,game.i18n.localize("dsk.LocalizedIDs.regeneration".concat(m)),_advantage_rules_js__WEBPACK_IMPORTED_MODULE_5__.Z.vantageStep(t.extra.actor,game.i18n.localize("dsk.LocalizedIDs.regeneration".concat(m))),m),this._appendSituationalModifiers(t,game.i18n.localize("dsk.LocalizedIDs.weakRegeneration".concat(m)),-1*_advantage_rules_js__WEBPACK_IMPORTED_MODULE_5__.Z.vantageStep(t.extra.actor,game.i18n.localize("dsk.LocalizedIDs.weakRegeneration".concat(m))),m),this._appendSituationalModifiers(t,game.i18n.localize("dsk.LocalizedIDs.advancedRegeneration".concat(m)),_specialability_rules_js__WEBPACK_IMPORTED_MODULE_10__.Z.abilityStep(t.extra.actor,game.i18n.localize("dsk.LocalizedIDs.advancedRegeneration".concat(m))),m),this._appendSituationalModifiers(t,"".concat(game.i18n.localize("CHARAbbrev.".concat(m))," ").concat(game.i18n.localize("dsk.Modifier")),t["".concat(m,"Modifier")],m),this._appendSituationalModifiers(t,"".concat(game.i18n.localize("CHARAbbrev.".concat(m))," ").concat(game.i18n.localize("dsk.regenerate")),t["regeneration".concat(m)],m),a.push({char:m,res:o.terms[u].results[0].result,die:"d6"}),i[m]=Math.round(Math.max(0,Number(o.terms[u].results[0].result)+Number(r)+this._situationalModifiers(t,m))*Number(t.regenerationFactor)),u+=2}catch(t){h.e(t)}finally{h.f()}}return i.characteristics=a,g.abrupt("return",i);case 12:case"end":return g.stop()}}),_callee17,this)}))),function rollRegeneration(t){return _rollRegeneration.apply(this,arguments)})},{key:"rollDices",value:(_rollDices=_asyncToGenerator(_regeneratorRuntime().mark((function _callee18(t,r){var o,a,i,c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee18$(h){for(;;)switch(h.prev=h.next){case 0:if(t.roll){h.next=68;break}o=game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration,h.t0=t.source.type,h.next="char"===h.t0||"ahnengabe"===h.t0||"skill"===h.t0?5:"regenerate"===h.t0?11:"meleeweapon"===h.t0||"rangeweapon"===h.t0||"combatskill"===h.t0?20:"trait"===h.t0?36:"poison"===h.t0||"disease"===h.t0?52:60;break;case 5:return h.next=7,new Roll("1d20+1d20").evaluate({async:!0});case 7:return a=h.sent,mergeObject(a.dice[0].options,o(t.source.system.characteristic1)),mergeObject(a.dice[1].options,o(t.source.system.characteristic2)),h.abrupt("break",61);case 11:return i=[],t.regenerateLeP&&i.push("1d6"),t.extra.actor.isMage&&t.regenerateAsP&&i.push("1d6"),h.next=16,new Roll(i.join("+")).evaluate({async:!0});case 16:return a=h.sent,t.regenerateLeP&&mergeObject(a.dice[0].options,o("mu")),t.extra.actor.isMage&&t.regenerateAsP&&mergeObject(a.dice[i.length-1].options,o("ge")),h.abrupt("break",61);case 20:if("damage"!=t.mode){h.next=30;break}return h.next=23,this.damageFormula(t);case 23:return c=h.sent,h.next=26,new Roll(c).evaluate({async:!0});case 26:for(a=h.sent,u=0;u<a.dice.length;u++)mergeObject(a.dice[u].options,o("damage"));h.next=35;break;case 30:return h.next=32,new Roll("1d20+1d20").evaluate({async:!0});case 32:a=h.sent,mergeObject(a.dice[0].options,o("attack")),mergeObject(a.dice[1].options,o("attack"));case 35:return h.abrupt("break",61);case 36:if("damage"!=t.mode){h.next=46;break}return h.next=39,this.damageFormula(t);case 39:return l=h.sent,h.next=42,new Roll(l).evaluate({async:!0});case 42:for(a=h.sent,p=0;p<a.dice.length;p++)mergeObject(a.dice[p].options,o("damage"));h.next=51;break;case 46:return h.next=48,new Roll("1d20+1d20").evaluate({async:!0});case 48:a=h.sent,mergeObject(a.dice[0].options,o("attack")),mergeObject(a.dice[1].options,o("attack"));case 51:return h.abrupt("break",61);case 52:return d=o("in"),h.next=55,new Roll("1d20+1d20+1d20").evaluate({async:!0});case 55:return a=h.sent,mergeObject(a.dice[0].options,d),mergeObject(a.dice[1].options,d),mergeObject(a.dice[2].options,d),h.abrupt("break",61);case 60:console.error("Unexpected roll mode");case 61:return h.next=63,DiceDSK.manualRolls(a,t.source.type,t.extra.options);case 63:return a=h.sent,h.next=66,this.showDiceSoNice(a,r.rollMode);case 66:t.roll=a,t.rollMode=r.rollMode;case 68:return h.abrupt("return",t);case 69:case"end":return h.stop()}}),_callee18,this)}))),function rollDices(t,r){return _rollDices.apply(this,arguments)})},{key:"damageFormula",value:(_damageFormula=_asyncToGenerator(_regeneratorRuntime().mark((function _callee19(t){var r,o,a;return _regeneratorRuntime().wrap((function _callee19$(i){for(;;)switch(i.prev=i.next){case 0:return"meleeweapon"==t.source.type?(o=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._calculateCombatSkillValues(t.extra.actor.items.find((function(r){return"combatskill"==r.type&&r.name==t.source.system.combatskill})),t.extra.actor.system),r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareMeleeWeapon(t.source,[o],t.extra.actor)):"rangeweapon"==t.source.type?(a=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._calculateCombatSkillValues(t.extra.actor.items.find((function(r){return"combatskill"==r.type&&r.name==t.source.system.combatskill})),t.extra.actor.system),r=_actor_actor_dsk_js__WEBPACK_IMPORTED_MODULE_0__.Z._prepareRangeWeapon(t.source,[],[a],t.extra.actor)):r=t.source.system,i.abrupt("return",t.source.system.tp.replace(/[Ww]/g,"d")+"+".concat(r.extraDamage||0));case 2:case"end":return i.stop()}}),_callee19)}))),function damageFormula(t){return _damageFormula.apply(this,arguments)})},{key:"rollDamage",value:(_rollDamage=_asyncToGenerator(_regeneratorRuntime().mark((function _callee20(t){var r,o,a,i,c,u,l,p,d,h;return _regeneratorRuntime().wrap((function _callee20$(y){for(;;)switch(y.prev=y.next){case 0:r=this._situationalModifiers(t),o=[],a=t.roll,i=a.total+r,c=_createForOfIteratorHelper(a.terms);try{for(c.s();!(u=c.n()).done;)if((l=u.value)instanceof Die||"Die"==l.class){p=_createForOfIteratorHelper(l.results);try{for(p.s();!(d=p.n()).done;)h=d.value,o.push({char:t.mode,res:h.result,die:"d"+l.faces})}catch(t){p.e(t)}finally{p.f()}}}catch(t){c.e(t)}finally{c.f()}return y.abrupt("return",{rollType:"damage",damage:i,characteristics:o,preData:t,modifiers:r,extra:{}});case 7:case"end":return y.stop()}}),_callee20,this)}))),function rollDamage(t){return _rollDamage.apply(this,arguments)})},{key:"chatListeners",value:(_chatListeners=_asyncToGenerator(_regeneratorRuntime().mark((function _callee26(t){return _regeneratorRuntime().wrap((function _callee26$(r){for(;;)switch(r.prev=r.next){case 0:t.on("click",".expand-mods",(function(t){t.preventDefault();var r=$(t.currentTarget);r.find("i").toggleClass("fa-minus fa-plus"),r.siblings("ul,div").fadeToggle()})),t.on("click",".edit-toggle",(function(t){t.preventDefault(),$(t.currentTarget).parents(".chat-card").find(".display-toggle").toggle()})),t.on("click",".botch-roll",(function(t){return _tables_dsktables_js__WEBPACK_IMPORTED_MODULE_4__.Z.showBotchCard(t.currentTarget.dataset)})),t.on("click",".roll-item",(function(t){return DiceDSK._itemRoll(t)})),t.on("change",".roll-edit",(function(t){return DiceDSK._rollEdit(t)})),t.on("click",".applyEffect",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee22(t){return _regeneratorRuntime().wrap((function _callee22$(r){for(;;)switch(r.prev=r.next){case 0:DiceDSK.wrapLock(t,function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee21(t,r){var o,a;return _regeneratorRuntime().wrap((function _callee21$(i){for(;;)switch(i.prev=i.next){case 0:return o=r.parents(".message").attr("data-message-id"),a=t.currentTarget.dataset.target,i.next=4,_status_active_effects_js__WEBPACK_IMPORTED_MODULE_2__.Z.applyEffect(o,a);case 4:case"end":return i.stop()}}),_callee21)})));return function(r,o){return t.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),_callee22)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".applyTableEffect",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee24(t){return _regeneratorRuntime().wrap((function _callee24$(r){for(;;)switch(r.prev=r.next){case 0:DiceDSK.wrapLock(t,function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee23(t,r){var o,a;return _regeneratorRuntime().wrap((function _callee23$(i){for(;;)switch(i.prev=i.next){case 0:return o=r.parents(".message").attr("data-message-id"),a=t.currentTarget.dataset.target,i.next=4,TableEffects.applyEffect(o,a);case 4:case"end":return i.stop()}}),_callee23)})));return function(r,o){return t.apply(this,arguments)}}());case 1:case"end":return r.stop()}}),_callee24)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".placeTemplate",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee25(t){return _regeneratorRuntime().wrap((function _callee25$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",MeasuredTemplateDSK.placeTemplateFromChat(t));case 1:case"end":return r.stop()}}),_callee25)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".resistEffect",(function(t){return _status_active_effects_js__WEBPACK_IMPORTED_MODULE_2__.Z.resistEffect(t)})),t.on("click",".resistPain",(function(t){return DiceDSK.rollResistPain(t)})),_request_roll_js__WEBPACK_IMPORTED_MODULE_9__.Z.chatListeners(t);case 11:case"end":return r.stop()}}),_callee26)}))),function chatListeners(t){return _chatListeners.apply(this,arguments)})}]),DiceDSK}()},608:(t,r,o)=>{function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}o.d(r,{Z:()=>a});var a=function(){function DSKSoundEffect(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKSoundEffect)}var t,r,o,a,i,c;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKSoundEffect,null,[{key:"playEffect",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r,o){var a,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:void 0,i=u.length>4&&void 0!==u[4]&&u[4],l.next=4,this.getSound(t,r,o);case 4:if(c=l.sent)try{a?(game.socket.emit("system.dsk",{type:"playWhisperSound",payload:{whisper:a,soundPath:c}}),i||AudioHelper.play({src:c,volume:.8,loop:!1},!1)):AudioHelper.play({src:c,volume:.8,loop:!1},!0)}catch(t){console.warn("Could not play item sound effect ".concat(c))}case 6:case"end":return l.stop()}}),_callee,this)}))),function playEffect(t,r,o){return c.apply(this,arguments)})},{key:"loadSoundConfig",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,o;return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,game.settings.get("dsk","soundConfig");case 2:if(!(t=a.sent)){a.next=18;break}return a.prev=4,a.next=7,fetch(t);case 7:return r=a.sent,a.next=10,r.json();case 10:o=a.sent,this.sounds=o,console.log("DSK | Sound Config Loaded"),a.next=18;break;case 15:a.prev=15,a.t0=a.catch(4),console.warn(a.t0);case 18:case"end":return a.stop()}}),_callee2,this,[[4,15]])}))),function loadSoundConfig(){return i.apply(this,arguments)})},{key:"successLevelToString",value:function successLevelToString(t){switch(t){case-1:return["fail"];case-2:return["botch","fail"];case 1:return["success"];case 2:return["crit","success"];default:return[]}}},{key:"getSound",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,o){var a,i,c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(this.sounds||this.triedInit){h.next=4;break}return h.next=3,this.loadSoundConfig();case 3:this.triedInit=!0;case 4:if(this.sounds){h.next=6;break}return h.abrupt("return",void 0);case 6:i=this.successLevelToString(o),c=[],h.t0=r.type,h.next="meleeweapon"===h.t0||"rangeweapon"===h.t0?11:"skill"===h.t0?13:"ahnengabe"===h.t0?15:17;break;case 11:return c=[].concat(_toConsumableArray(i.map((function(o){return"".concat(r.type,".manual.").concat(r.name,".").concat(t,"_").concat(o)}))),["".concat(r.type,".manual.").concat(r.name,".").concat(t),"".concat(r.type,".manual.").concat(r.name,".default.").concat(t),"".concat(r.type,".manual.").concat(r.name,".default")],_toConsumableArray(i.map((function(o){return"".concat(r.type,".").concat(r.system.combatskill,".").concat(t,"_").concat(o)}))),["".concat(r.type,".").concat(r.system.combatskill,".").concat(t)],_toConsumableArray(i.map((function(t){return"".concat(r.type,".").concat(r.system.combatskill,".default_").concat(t)}))),["".concat(r.type,".").concat(r.system.combatskill,".default")]),h.abrupt("break",17);case 13:case 15:return c=[].concat(_toConsumableArray(i.map((function(o){return"".concat(r.type,".").concat(r.name,".").concat(t,"_").concat(o)}))),["".concat(r.type,".").concat(r.name,".").concat(t)],_toConsumableArray(i.map((function(t){return"".concat(r.type,".").concat(r.name,".default_").concat(t)}))),["".concat(r.type,".").concat(r.name,".default")]),h.abrupt("break",17);case 17:(a=c).push.apply(a,_toConsumableArray(i.map((function(t){return"".concat(r.type,".default_").concat(t)}))).concat(["".concat(r.type,".default")])),l=_createForOfIteratorHelper(c),h.prev=19,l.s();case 21:if((p=l.n()).done){h.next=30;break}if(d=p.value,hasProperty(this.sounds,d)){h.next=25;break}return h.abrupt("continue",28);case 25:if(!(u=getProperty(this.sounds,d))||!("string"==typeof u||u instanceof String)){h.next=28;break}return h.abrupt("break",30);case 28:h.next=21;break;case 30:h.next=35;break;case 32:h.prev=32,h.t1=h.catch(19),l.e(h.t1);case 35:return h.prev=35,l.f(),h.finish(35);case 38:return h.abrupt("return",u);case 39:case"end":return h.stop()}}),_callee3,this,[[19,32,35,38]])}))),function getSound(t,r,o){return a.apply(this,arguments)})},{key:"playMoneySound",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){var t,r,o,a=arguments;return _regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],game.modules.get("gAudioBundle-3")){i.next=3;break}return i.abrupt("return");case 3:return o=(r=["modules/gAudioBundle-3/src/Mint Coins And Money/Coin_Slide_Carpet.ogg","modules/gAudioBundle-3/src/Mint Coins And Money/Coins_Drop_Carpet_06.ogg","modules/gAudioBundle-3/src/Mint Coins And Money/Coins_Bottlecaps_Drop.ogg","modules/gAudioBundle-3/src/Mint Coins And Money/Coins_In_Sack_Held_By_Drawstring_06.ogg","modules/gAudioBundle-3/src/Money/Money_Coins_Handle.ogg"])[Math.floor(Math.random()*r.length)],i.next=7,this.playSoundPath(o,t);case 7:case"end":return i.stop()}}),_callee4,this)}))),function playMoneySound(){return o.apply(this,arguments)})},{key:"playEquipmentWearStatusChange",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r,o,a,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee5$(p){for(;;)switch(p.prev=p.next){case 0:r=l.length>1&&void 0!==l[1]&&l[1],o=[],a=game.modules.get("gAudioBundle-2"),i=game.modules.get("gAudioBundle-3"),c=game.modules.get("gAudioBundle-4"),p.t0=t.type,p.next="armor"===p.t0?8:"meleeweapon"===p.t0?10:"rangeweapon"===p.t0?13:15;break;case 8:return a&&o.push("modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Foley_Soldier_Gear_Equipment_Metal_Cloth_Heavy_Movement_Light_08.ogg"),p.abrupt("break",15);case 10:return a&&o.push("modules/gAudioBundle-2/src/Gore/Melee_Sword_Attack_04.ogg"),i&&o.push("modules/gAudioBundle-3/src/Medieval Armor And Impacts/Weapon_Impact_Parry_01.ogg"),p.abrupt("break",15);case 13:return c&&o.push("modules/gAudioBundle-4/src/Super Heroes Sound Design/Hawk's_Arrow_Flies_Bow_And_Arrow_Shoot_2.ogg"),p.abrupt("break",15);case 15:if(0==o.length&&a&&o.push("modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Foley_Sports_Bag_Grab_Pickup_Catch_04.ogg","modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Footstep_Ice_Crunchy_Run_01.ogg","modules/gAudioBundle-2/src/Footsteps/Footstep And Foley Sounds/Footstep_Ice_Crunchy_Run_02.ogg"),!(o.length>0)){p.next=20;break}return u=o[Math.floor(Math.random()*o.length)],p.next=20,this.playSoundPath(u,r,.5);case 20:case"end":return p.stop()}}),_callee5,this)}))),function playEquipmentWearStatusChange(t){return r.apply(this,arguments)})},{key:"playSoundPath",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){var r,o,a=arguments;return _regeneratorRuntime().wrap((function _callee6$(i){for(;;)switch(i.prev=i.next){case 0:if(r=a.length>1&&void 0!==a[1]&&a[1],o=a.length>2&&void 0!==a[2]?a[2]:.8,game.settings.get("dsk","inventorySound")){i.next=4;break}return i.abrupt("return");case 4:try{AudioHelper.play({src:t,volume:o,loop:!1},r)}catch(r){console.warn("Could not play item sound effect ".concat(t))}case 5:case"end":return i.stop()}}),_callee6)}))),function playSoundPath(r){return t.apply(this,arguments)})}]),DSKSoundEffect}();_defineProperty(a,"sounds",void 0),_defineProperty(a,"triedInit",!1)},832:(t,r,o)=>{o.d(r,{Z:()=>u});var a=o(231),i=o(846),c=o(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var u=function(){function DSKUtility(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKUtility)}var t,r,o,u,l,p,d;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKUtility,null,[{key:"chatDataSetup",value:function chatDataSetup(t,r,o){var a={user:game.user.id,rollMode:r||game.settings.get("core","rollMode"),content:t};return["gmroll","blindroll"].includes(a.rollMode)&&(a.whisper=ChatMessage.getWhisperRecipients("GM").map((function(t){return t.id}))),"blindroll"===a.rollMode?a.blind=!0:"selfroll"===a.rollMode&&(a.whisper=[game.user]),o&&(a.speaker=ChatMessage.getSpeaker(),a.whisper=ChatMessage.getWhisperRecipients(o)),a}},{key:"categoryLocalization",value:function categoryLocalization(t){return game.i18n.localize("ITEM.Type".concat(t.slice(0,1).toUpperCase()).concat(t.slice(1).toLowerCase()))}},{key:"isActiveGM",value:function isActiveGM(){var t=game.users.find((function(t){return t.active&&t.isGM}));return t&&game.user.id==t.id}},{key:"parseAbilityString",value:function parseAbilityString(t){return{original:t.replace(/ (FP|SR|FW|SP)?[+-]?\d{1,2}$/,"").trim(),name:t.replace(/\((.+?)\)/g,"()").replace(/ (FP|SR|FW|SP)?[+-]?\d{1,2}$/,"").trim(),step:Number((t.match(/[+-]?\d{1,2}$/)||[1])[0]),special:(t.match(/\(([^()]+)\)/)||["",""])[1],type:t.match(/ (FP|SP)[+-]?\d{1,2}/)?"FP":t.match(/ (FW|SR)[+-]?\d{1,2}/)?"FW":"",bonus:null!=t.match(/[-+]\d{1,2}$/)}}},{key:"allSkills",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t,r,o=arguments;return _regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:["skill","combatskill","specialability"],r="de"==game.i18n.lang?"dsk.default":"dsk.defaulten",a.next=4,this.getCompendiumEntries(r,t);case 4:return a.abrupt("return",a.sent);case 5:case"end":return a.stop()}}),_callee,this)}))),function allSkills(){return d.apply(this,arguments)})},{key:"escapeRegex",value:function escapeRegex(t){return("string"==typeof t||t instanceof String?t:"").replace(/[-[/\]{}()*+?.,\\^$|#\s]/g,"\\$&")}},{key:"replaceDies",value:function replaceDies(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=/( |^)(\d{1,2})?[wWdD][0-9]+((\+|-)[0-9]+)?/g,a=r?"":"/roll ";return t.replace(o,(function(t){return" [[".concat(a).concat(t.replace(/[DwW]/,"d"),"]]")}))}},{key:"toObjectIfPossible",value:function toObjectIfPossible(t){return"function"==typeof t.toObject?t.toObject(!1):duplicate(t)}},{key:"allSkillsList",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,o,a,i,c,u,l,p=arguments;return _regeneratorRuntime().wrap((function _callee2$(d){for(;;)switch(d.prev=d.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:["skill","combatskill","specialability"],d.next=3,this.allSkills(t);case 3:r=d.sent,o=[],a=[],i=[],c=_createForOfIteratorHelper(r);try{for(c.s();!(u=c.n()).done;)"skill"==(l=u.value).type?o.push(l.name):"combatskill"==l.type&&("melee"==l.system.weapontype?i.push(l.name):a.push(l.name))}catch(t){c.e(t)}finally{c.f()}return d.abrupt("return",{skills:o.sort((function(t,r){return t.localeCompare(r)})),rangeSkills:a.sort((function(t,r){return t.localeCompare(r)})),meleeSkills:i.sort((function(t,r){return t.localeCompare(r)}))});case 10:case"end":return d.stop()}}),_callee2,this)}))),function allSkillsList(){return p.apply(this,arguments)})},{key:"replaceConditions",value:function replaceConditions(t){return t?t.replace(c.Z.statusRegex.regex,(function(t){return(0,i.q)([t])})):t}},{key:"moduleEnabled",value:function moduleEnabled(t){return game.modules.get(t)&&game.modules.get(t).active}},{key:"getSpeaker",value:function getSpeaker(t){var r=ChatMessage.getSpeakerActor(t);if(!r&&canvas.tokens){var o=canvas.tokens.get(t.token);o&&(r=o.actor)}if(!r){var a=game.scenes.get(t.scene);try{var i;a&&(r=null===(i=new Token(a.getEmbeddedDocument("Token",t.token)))||void 0===i?void 0:i.actor)}catch(t){}}return r}},{key:"showArtwork",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r,o,a,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:r=t.img,o=t.name,a=t.uuid,i=t.isOwner,c=u.length>1&&void 0!==u[1]&&u[1],new ImagePopout(r,{title:c?i?o:"-":o,shareable:!0,uuid:a}).render(!0);case 3:case"end":return l.stop()}}),_callee3)}))),function showArtwork(t){return l.apply(this,arguments)})},{key:"renderToggle",value:function renderToggle(t){t.rendered?t._minimized?t.maximize():t.close():t.render(!0)}},{key:"skillByName",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r,o;return _regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return r=game.packs.get("de"==game.i18n.lang?"dsk.default":"dsk.defaulten"),a.next=3,r.getIndex();case 3:return o=r.index.find((function(r){return r.name===t})),a.next=6,r.getDocument(o._id);case 6:return a.abrupt("return",a.sent);case 7:case"end":return a.stop()}}),_callee4)}))),function skillByName(t){return u.apply(this,arguments)})},{key:"emptyActor",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var t,r,o=arguments;return _regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:12,Array.isArray(t)||(t=[t,t,t,t,t,t,t,t]),i.next=4,a.Z.create({name:"Alricat",type:"npc",items:[],system:{stats:{LeP:{value:50},fatePoints:{}},characteristics:{mu:{initial:t[0]},kl:{initial:t[1]},in:{initial:t[2]},ch:{initial:t[3]},ff:{initial:t[4]},ge:{initial:t[5]},ko:{initial:t[6]},kk:{initial:t[7]}}}},{temporary:!0,noHook:!0});case 4:return(r=i.sent).prepareData(),i.abrupt("return",r);case 7:case"end":return i.stop()}}),_callee5)}))),function emptyActor(){return o.apply(this,arguments)})},{key:"calcTokenSize",value:function calcTokenSize(t,r){var o=game.dsk.config.tokenSizeCategories[t.system.details.size];if(o)if(o<1)mergeObject(r,{texture:{scaleX:o,scaleY:o},width:1,height:1});else{var a=Math.floor(o),i=Math.max(o/a,.25);mergeObject(r,{width:a,height:a,texture:{scaleX:i,scaleY:i}})}}},{key:"_calculateAdvCost",value:function _calculateAdvCost(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return c.Z.advancementCosts[r][Number(t)+o]}},{key:"getCompendiumEntries",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){var o,a,i;return _regeneratorRuntime().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,game.packs.get(t);case 2:if(o=c.sent){c.next=6;break}return ui.notifications.error("No content found"),c.abrupt("return",[]);case 6:return a=Array.isArray(r)?r:[r],c.next=9,o.getDocuments({type:{$in:a}});case 9:return i=c.sent,c.abrupt("return",i.map((function(t){return t.toObject()})));case 11:case"end":return c.stop()}}),_callee6)}))),function getCompendiumEntries(t,o){return r.apply(this,arguments)})},{key:"getFolderForType",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,o,a,i,c,u,l=arguments;return _regeneratorRuntime().wrap((function _callee7$(p){for(;;)switch(p.prev=p.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:null,o=l.length>2&&void 0!==l[2]?l[2]:null,a=l.length>3&&void 0!==l[3]?l[3]:0,i=l.length>4&&void 0!==l[4]?l[4]:"",c=l.length>5&&void 0!==l[5]?l[5]:void 0,p.next=7,game.folders.contents.find((function(a){var i;return a.name==o&&a.type==t&&(null===(i=a.folder)||void 0===i?void 0:i.id)==r}));case 7:if(u=p.sent){p.next=12;break}return p.next=11,Folder.create({name:o,type:t,sorting:c||("JournalEntry"==t?"a":"m"),color:i,sort:a,parent:r});case 11:u=p.sent;case 12:return p.abrupt("return",u);case 13:case"end":return p.stop()}}),_callee7)}))),function getFolderForType(r){return t.apply(this,arguments)})}]),DSKUtility}()},404:(t,r,o)=>{o.d(r,{Z:()=>c});var a=o(930),i=o(832);function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var c=function(){function ItemRulesDSK(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,ItemRulesDSK)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(ItemRulesDSK,null,[{key:"simpleAdoption",value:function simpleAdoption(t,r,o,a){if(a[o].activeEffect){var i=duplicate(a[o].activeEffect);i.value="".concat(r.name," ").concat(i.value);var c={changes:[i],duration:{},icon:"icons/svg/aura.svg",label:"".concat(o," (").concat(r.name,")"),transfer:!0,flags:{dsk:{value:null,editable:!0,description:"".concat(o," (").concat(r.name,")"),custom:!0,auto:null,manual:0,hideOnToken:!0,hidePlayers:!1}},tint:""};t.effects.push(c)}}},{key:"reverseAdoptionCalculation",value:function reverseAdoptionCalculation(t,r,o){for(var i=[a.Z.vantagesNeedingAdaption,a.Z.AbilitiesNeedingAdaption],c=function _loop(){var a=l[u];if(a[r.name]){var i=t.items.find((function(t){return a[r.name].items.includes(t.type)&&t.name==r.special}));return i&&(o.system.ap=o.system.ap.split("/")[i.system.StF.charCodeAt(0)-65],ItemRulesDSK.simpleAdoption(o,i,r.name,a)),"break"}},u=0,l=i;u<l.length;u++){if("break"===c())break}return o}},{key:"hasItem",value:function hasItem(t,r,o){return null!=t.items.find((function(t){return o.includes(t.type)&&t.name==r}))}},{key:"itemStep",value:function itemStep(t,r,o){var a=t.items.find((function(t){return o.includes(t.type)&&t.name==r}));return a?Number(a.system.level):0}},{key:"itemAsModifier",value:function itemAsModifier(t,r,o,a){var c=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=[],p=c?new RegExp("^".concat(i.Z.escapeRegex("".concat(r," (")))):new RegExp("^".concat(i.Z.escapeRegex(r),"$")),d=t.items.find((function(t){return a.includes(t.type)&&p.test(t.name)}));return d&&l.push({name:d.name,value:Number(d.system.level)*o,selected:u,source:d.name}),l}}]),ItemRulesDSK}();!function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(c,"children",{})},586:(t,r,o)=>{o.d(r,{Z:()=>migrateWorld,j:()=>showPatchViewer});var a=o(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function setupDefaulTokenConfig(){return _setupDefaulTokenConfig.apply(this,arguments)}function _setupDefaulTokenConfig(){return(_setupDefaulTokenConfig=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){var t;return _regeneratorRuntime().wrap((function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:if(game.settings.get("dsk","defaultConfigFinished")){r.next=13;break}return console.log("Configuring default token settings"),(t=game.settings.get("core","defaultToken")).displayName=CONST.TOKEN_DISPLAY_MODES.OWNER_HOVER,t.displayBars=CONST.TOKEN_DISPLAY_MODES.OWNER_HOVER,t.disposition=CONST.TOKEN_DISPOSITIONS.NEUTRAL,t.bar1={attribute:"status.wounds"},r.next=9,game.settings.set("core","defaultToken",t);case 9:return r.next=11,game.settings.set("core","leftClickRelease",!0);case 11:return r.next=13,game.settings.set("dsk","defaultConfigFinished",!0);case 13:case"end":return r.stop()}}),_callee5)})))).apply(this,arguments)}function migrateDSK(t,r){return _migrateDSK.apply(this,arguments)}function _migrateDSK(){return(_migrateDSK=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){return _regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,showPatchViewer();case 2:return t.next=4,game.settings.set("dsk","migrationVersion",r);case 4:case"end":return t.stop()}}),_callee6)})))).apply(this,arguments)}function showPatchViewer(){return _showPatchViewer.apply(this,arguments)}function _showPatchViewer(){return(_showPatchViewer=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){var t,r;return _regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,fetch("systems/dsk/lazy/updatenotes.json");case 2:return t=o.sent,o.next=5,t.json();case 5:r=o.sent,new i(r).render(!0);case 8:case"end":return o.stop()}}),_callee7)})))).apply(this,arguments)}function migrateWorld(){Hooks.once("ready",_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var t,r;return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:if(game.user.isGM){o.next=2;break}return o.abrupt("return");case 2:return ChatMessage.create(a.Z.chatDataSetup("This is the beta version for DSK for Foundry v10. You might encounter on or more issues. Please report those on the official DSK Github. Thank you.")),o.next=5,setupDefaulTokenConfig();case 5:return o.next=7,game.settings.get("dsk","migrationVersion");case 7:if(t=o.sent,t<(r=21)){o.next=12;break}return o.abrupt("return");case 12:migrateDSK(t,r);case 13:case"end":return o.stop()}}),_callee)}))))}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(PatchViewer,Application);var r,o=_createSuper(PatchViewer);function PatchViewer(t,r){var a;return function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,PatchViewer),(a=o.call(this,r)).json=t,a}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(PatchViewer,[{key:"getData",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){var t,r,o,i,c,u,l,p,d,h;return _regeneratorRuntime().wrap((function _callee4$(y){for(;;)switch(y.prev=y.next){case 0:return t=this.json.notes[this.json.notes.length-1],r=this.json.default.replace(/VERSION/g,t.version),o="<h1>CHANGELOG</h1><p>".concat(r,". </br><b>Important updates</b>: ").concat(t.text,'</p><p>For details or proposals visit our github page at <a href="https://github.com/Plushtoast/dsk-foundryVT" target="_blank">Github</a> or show the <a style="text-decoration: underline;color:#ff6400;" class="showPatchViewer">Full Changelog in Foundry</a>. Have fun.</p>'),y.next=5,ChatMessage.create(a.Z.chatDataSetup(o,"roll"));case 5:return i=game.i18n.lang,y.next=8,renderTemplate("systems/dsk/lazy/patchhtml/changelog_".concat(i,"_").concat(t.version,".html"));case 8:return c=y.sent,y.next=11,renderTemplate("systems/dsk/lazy/patchhtml/news_".concat(i,"_").concat(t.version,".html"));case 11:return u=y.sent,l=[this.json.notes[this.json.notes.length-2]],y.next=15,Promise.all(l.map(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,renderTemplate("systems/dsk/lazy/patchhtml/changelog_".concat(i,"_").concat(t.version,".html"));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}()));case 15:return p=y.sent,y.next=18,Promise.all(l.map(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){return _regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,renderTemplate("systems/dsk/lazy/patchhtml/news_".concat(i,"_").concat(t.version,".html"));case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()));case 18:return d=y.sent,y.next=21,renderTemplate("systems/dsk/lazy/patchhtml/modules_".concat(i,".html"));case 21:return h=y.sent,y.abrupt("return",{patchName:r,changelog:c,news:u,prevVersions:l,prevChangeLogs:p,prevNews:d,modules:h});case 23:case"end":return y.stop()}}),_callee4,this)}))),function getData(){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=_get(_getPrototypeOf(PatchViewer),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"newcontent"}],mergeObject(t,{classes:t.classes.concat(["dsk","largeDialog","patches"]),width:740,height:740,title:"Changelog"}),t.template="systems/dsk/templates/system/patchviewer.html",t.resizable=!0,t}}]),PatchViewer}()},604:(t,r,o)=>{o.d(r,{Z:()=>i});o(122),o(608);var a=o(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var i=function(){function OnUseEffect(t){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OnUseEffect),this.item=t}var t,r,o,i,c,u,l,p;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(OnUseEffect,[{key:"callMacro",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){var o,a,i,c,u,l,p,d,h,y=arguments;return _regeneratorRuntime().wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return o=y.length>2&&void 0!==y[2]?y[2]:{},a=game.packs.get(t),m.next=4,a.getDocuments({name:r});case 4:if((i=m.sent).length){m.next=26;break}c=_createForOfIteratorHelper(game.packs.filter((function(t){return"Macro"==t.documentName&&/\(internal\)/.test(t.metadata.label)}))),m.prev=7,c.s();case 9:if((u=c.n()).done){m.next=18;break}return l=u.value,m.next=13,l.getDocuments({name:r});case 13:if(!(i=m.sent).length){m.next=16;break}return m.abrupt("break",18);case 16:m.next=9;break;case 18:m.next=23;break;case 20:m.prev=20,m.t0=m.catch(7),c.e(m.t0);case 23:return m.prev=23,c.f(),m.finish(23);case 26:if(p={},!i.length){m.next=43;break}return d="(async () => {".concat(i[0].command,"})()"),h=Function("args","actor","item",d),m.prev=30,o.result=p,m.next=34,h.call(this,o,this.item.actor,this.item);case 34:m.next=41;break;case 36:m.prev=36,m.t1=m.catch(30),ui.notifications.error("There was an error in your macro syntax. See the console (F12) for details"),console.error(m.t1),p.error=!0;case 41:m.next=44;break;case 43:ui.notifications.error(game.i18n.format("dsk.DSKError.macroNotFound",{name:r}));case 44:return m.abrupt("return",p);case 45:case"end":return m.stop()}}),_callee,this,[[7,20,23,26],[30,36]])}))),function callMacro(t,r){return p.apply(this,arguments)})},{key:"executeOnUseEffect",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var t,r,o;return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(game.user.can("MACRO_SCRIPT")){a.next=2;break}return a.abrupt("return",ui.notifications.warn("You are not allowed to use JavaScript macros."));case 2:if(this.item.actor){a.next=4;break}return a.abrupt("return");case 4:return t=OnUseEffect.getOnUseEffect(this.item),r="(async () => {".concat(t,"})()"),o=Function("item","actor",r),a.prev=7,a.next=10,o.call(this,this.item,this.item.actor);case 10:a.next=17;break;case 12:a.prev=12,a.t0=a.catch(7),ui.notifications.error("There was an error in your macro syntax. See the console (F12) for details"),console.error(a.t0),console.warn(a.t0.stack);case 17:case"end":return a.stop()}}),_callee2,this,[[7,12]])}))),function executeOnUseEffect(){return l.apply(this,arguments)})},{key:"automatedAnimation",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){var r=arguments;return _regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:r.length>1&&void 0!==r[1]&&r[1],a.Z.moduleEnabled("autoanimations")&&console.warn("Animations for on use effects not enabled yet");case 2:case"end":return t.stop()}}),_callee3)}))),function automatedAnimation(t){return u.apply(this,arguments)})},{key:"effectDummy",value:function effectDummy(t,r,o){return{label:t,icon:"icons/svg/aura.svg",changes:r,duration:o,flags:{dsk:{value:null,editable:!0,customizable:!0,description:t,custom:!0}}}}},{key:"socketedConditionAddActor",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r){var o,a,i,c,u,l;return _regeneratorRuntime().wrap((function _callee4$(p){for(;;)switch(p.prev=p.next){case 0:if(!game.user.isGM){p.next=31;break}(o="string"==typeof r)&&((r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))).label=game.i18n.localize(r.label)),a=[],i=_createForOfIteratorHelper(t),p.prev=5,i.s();case 7:if((c=i.n()).done){p.next=19;break}if(u=c.value,!o){p.next=14;break}return p.next=12,u.addCondition(r,1,!1,!1);case 12:p.next=16;break;case 14:return p.next=16,u.addCondition(r);case 16:a.push(u.name);case 17:p.next=7;break;case 19:p.next=24;break;case 21:p.prev=21,p.t0=p.catch(5),i.e(p.t0);case 24:return p.prev=24,i.f(),p.finish(24);case 27:return p.next=29,this.createInfoMessage(r,a);case 29:p.next=33;break;case 31:l={id:this.item.uuid,data:r,actors:t.map((function(t){return t.id}))},game.socket.emit("system.dsk",{type:"socketedConditionAddActor",payload:l});case 33:case"end":return p.stop()}}),_callee4,this,[[5,21,24,27]])}))),function socketedConditionAddActor(t,r){return c.apply(this,arguments)})},{key:"createInfoMessage",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t,r){var o,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee5$(l){for(;;)switch(l.prev=l.next){case 0:if(o=!(u.length>2&&void 0!==u[2])||u[2],!r.length){l.next=6;break}return i=o?"ActiveEffects.appliedEffect":"ActiveEffects.removedEffect",c=game.i18n.format(i,{source:t.label,target:r.join(", ")}),l.next=6,ChatMessage.create(a.Z.chatDataSetup(c));case 6:case"end":return l.stop()}}),_callee5)}))),function createInfoMessage(t,r){return i.apply(this,arguments)})},{key:"socketedRemoveCondition",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){var o,a,i,c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee6$(y){for(;;)switch(y.prev=y.next){case 0:if(o=h.length>2&&void 0!==h[2]?h[2]:1,!game.user.isGM){y.next=29;break}a=[],i=_createForOfIteratorHelper(t),y.prev=4,i.s();case 6:if((c=i.n()).done){y.next=15;break}if(u=c.value,!(l=canvas.tokens.get(u)).actor){y.next=13;break}return y.next=12,l.actor.removeCondition(r,o,!1);case 12:a.push(l.name);case 13:y.next=6;break;case 15:y.next=20;break;case 17:y.prev=17,y.t0=y.catch(4),i.e(y.t0);case 20:return y.prev=20,i.f(),y.finish(20);case 23:return(p=CONFIG.statusEffects.find((function(t){return t.id==r}))).label=game.i18n.localize(p.label),y.next=27,this.createInfoMessage(p,a,!1);case 27:y.next=31;break;case 29:d={id:this.item.uuid,coreId:r,targets:t},game.socket.emit("system.dsk",{type:"socketedRemoveCondition",payload:d});case 31:case"end":return y.stop()}}),_callee6,this,[[4,17,20,23]])}))),function socketedRemoveCondition(t,r){return o.apply(this,arguments)})},{key:"socketedActorTransformation",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t,r){var o,a,i,c,u;return _regeneratorRuntime().wrap((function _callee7$(l){for(;;)switch(l.prev=l.next){case 0:if(!game.user.isGM){l.next=22;break}o=_createForOfIteratorHelper(t),l.prev=2,o.s();case 4:if((a=o.n()).done){l.next=12;break}if(i=a.value,!(c=canvas.tokens.get(i)).actor){l.next=10;break}return l.next=10,c.actor.update(r);case 10:l.next=4;break;case 12:l.next=17;break;case 14:l.prev=14,l.t0=l.catch(2),o.e(l.t0);case 17:return l.prev=17,o.f(),l.finish(17);case 20:l.next=24;break;case 22:u={id:this.item.uuid,targets:t,update:r},game.socket.emit("system.dsk",{type:"socketedActorTransformation",payload:u});case 24:case"end":return l.stop()}}),_callee7,this,[[2,14,17,20]])}))),function socketedActorTransformation(t,o){return r.apply(this,arguments)})},{key:"socketedConditionAdd",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t,r){var o,a,i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:if(!game.user.isGM){d.next=33;break}(o="string"==typeof r)&&((r=duplicate(CONFIG.statusEffects.find((function(t){return t.id==r})))).label=game.i18n.localize(r.label)),a=[],i=_createForOfIteratorHelper(t),d.prev=5,i.s();case 7:if((c=i.n()).done){d.next=21;break}if(u=c.value,!(l=canvas.tokens.get(u)).actor){d.next=19;break}if(!o){d.next=16;break}return d.next=14,l.actor.addCondition(r,1,!1,!1);case 14:d.next=18;break;case 16:return d.next=18,l.actor.addCondition(r);case 18:a.push(l.name);case 19:d.next=7;break;case 21:d.next=26;break;case 23:d.prev=23,d.t0=d.catch(5),i.e(d.t0);case 26:return d.prev=26,i.f(),d.finish(26);case 29:return d.next=31,this.createInfoMessage(r,a);case 31:d.next=35;break;case 33:p={id:this.item.uuid,data:r,targets:t},game.socket.emit("system.dsk",{type:"socketedConditionAdd",payload:p});case 35:case"end":return d.stop()}}),_callee8,this,[[5,23,26,29]])}))),function socketedConditionAdd(r,o){return t.apply(this,arguments)})}],[{key:"getOnUseEffect",value:function getOnUseEffect(t){return t.getFlag("dsk","onUseEffect")}}]),OnUseEffect}()},448:(t,r,o)=>{o.d(r,{Z:()=>c});var a=o(614),i=o(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var c=function(){function OpposedDSK(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,OpposedDSK)}var t,r,o,c;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(OpposedDSK,null,[{key:"handleOpposedTarget",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,o,a;return _regeneratorRuntime().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:if(t){c.next=2;break}return c.abrupt("return");case 2:if(r=i.Z.getSpeaker(t.speaker)){c.next=5;break}return c.abrupt("return");case 5:return o=t.flags.data.postData,a=t.flags.data.preData,game.user.targets.size&&t.flags.data.isOpposedTest&&!t.flags.data.defenderMessage&&!t.flags.data.attackerMessage&&(console.log("start opposed"),OpposedDSK.createOpposedTest(r,t,o,a)),c.next=10,this.showDamage(t);case 10:return c.next=12,this.showSpellWithoutTarget(t);case 12:case"end":return c.stop()}}),_callee,this)}))),function handleOpposedTarget(t){return c.apply(this,arguments)})},{key:"createOpposedTest",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,o,a){var i;return _regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:i=r.speaker.token?canvas.tokens.get(r.speaker.token).document:t.prototypeToken,o.successLevel>0?game.user.targets.forEach(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var o;return _regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(!t.actor){a.next=4;break}return o=OpposedDSK.opposeMessage(i,t,!1),a.next=4,ChatMessage.create((c={user:game.user.id,content:o,speaker:r.speaker},u="flags.unopposeData",l={attackMessageId:r.id,targetSpeaker:{scene:t.scene.id,token:t.id,alias:t.document.name}},u in c?Object.defineProperty(c,u,{value:l,enumerable:!0,configurable:!0,writable:!0}):c[u]=l,c));case 4:case"end":return a.stop()}var c,u,l}),_callee2)})));return function(r){return t.apply(this,arguments)}}()):game.user.targets.forEach(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t){return _regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(!t.actor){o.next=3;break}return o.next=3,ChatMessage.create({user:game.user.id,content:OpposedDSK.opposeMessage(i,t,!0),speaker:r.speaker});case 3:case"end":return o.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}());case 2:case"end":return a.stop()}}),_callee4)}))),function createOpposedTest(t,r,a,i){return o.apply(this,arguments)})},{key:"opposeMessage",value:function opposeMessage(t,r,o){return'<div class ="opposed-message">\n            <b>'.concat(t.name,"</b> ").concat(game.i18n.localize("dsk.ROLL.Targeting")," <b>").concat(r.document.name,"</b> ").concat(o?game.i18n.localize("dsk.ROLL.failed"):"",'\n            </div>\n            <div class = "opposed-tokens row-section">\n                <div class="col two attacker">').concat(OpposedDSK.videoOrImgTag(t.texture.src),'</div>\n                <div class="col two defender">').concat(OpposedDSK.videoOrImgTag(r.document.texture.src),"</div>\n            </div>\n             ")}},{key:"videoOrImgTag",value:function videoOrImgTag(t){return/\.webm$/.test(t)?'<video loop autoplay src="'.concat(t,'" width="50" height="50"></video>'):'<img src="'.concat(t,'" width="50" height="50"/>')}},{key:"showDamage",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r,o=arguments;return _regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:if(r=o.length>1&&void 0!==o[1]&&o[1],!game.user.isGM){i.next=8;break}if(r&&t.flags.data.hideDamage||!t.flags.data.postData.damageRoll){i.next=6;break}return i.next=5,t.update({content:t.content.replace('data-hide-damage="'.concat(!r,'"'),'data-hide-damage="'.concat(r,'"')),"flags.data.hideDamage":r});case 5:r||a.Z._addRollDiceSoNice(t.flags.data.preData,Roll.fromData(t.flags.data.postData.damageRoll),game.dsk.apps.DiceSoNiceCustomization.getAttributeConfiguration("damage"));case 6:i.next=9;break;case 8:game.socket.emit("system.dsk",{type:"showDamage",payload:{id:t.id,hide:r}});case 9:case"end":return i.stop()}}),_callee5)}))),function showDamage(t){return r.apply(this,arguments)})},{key:"showSpellWithoutTarget",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){var r,o,a,c;return _regeneratorRuntime().wrap((function _callee6$(u){for(;;)switch(u.prev=u.next){case 0:if(!i.Z.moduleEnabled("autoanimations")){u.next=13;break}if((r=getProperty(t,"flags.data"))&&!r.isOpposedTest){u.next=4;break}return u.abrupt("return");case 4:if(!((getProperty(r,"postData.result")||-1)>0)){u.next=13;break}if((o=i.Z.getSpeaker(r.postData.speaker).getActiveTokens()[0])&&o.actor){u.next=9;break}return u.abrupt("return");case 9:a=Array.from(game.user.targets),c=o.actor.items.get(r.preData.source._id),a.length||(a=[o]),AutoAnimations.playAnimation(o,a,c);case 13:case"end":return u.stop()}}),_callee6)}))),function showSpellWithoutTarget(r){return t.apply(this,arguments)})}]),OpposedDSK}()},903:(t,r,o)=>{o.d(r,{Z:()=>u});var a=o(96),i=o(530),c=o(832);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var u=function(){function RequestRoll(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RequestRoll)}var t,r,o,u,l,p,d,h,y,m,g;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(RequestRoll,null,[{key:"requestGC",value:(g=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r,o){var a,c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee2$(y){for(;;)switch(y.prev=y.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:0,c=i.Z._getActor(),u=c.actor,l=c.tokenId,u){y.next=4;break}return y.abrupt("return");case 4:game.user.updateTokenTargets([]),p={modifier:a,postFunction:{cummulative:o,functionName:"game.dsk.apps.RequestRoll.autoEditGroupCheckRoll"}},y.t0=t,y.next="attribute"===y.t0?9:10;break;case 9:return y.abrupt("break",12);case 10:d=u.items.find((function(o){return o.name==r&&o.type==t})),u.setupSkill(d,p,l).then(function(){var a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(a){var i;return _regeneratorRuntime().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,u.basicTest(a);case 2:return i=c.sent,c.next=5,RequestRoll.editGroupCheckRoll(o,i,r,t);case 5:case"end":return c.stop()}}),_callee)})));return function(t){return a.apply(this,arguments)}}());case 12:case"end":return y.stop()}}),_callee2)}))),function requestGC(t,r,o){return g.apply(this,arguments)})},{key:"autoEditGroupCheckRoll",value:(m=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,o){return _regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,RequestRoll.editGroupCheckRoll(t.cummulative,r,o.name,o.type);case 2:case"end":return a.stop()}}),_callee3)}))),function autoEditGroupCheckRoll(t,r,o){return m.apply(this,arguments)})},{key:"editGroupCheckRoll",value:(y=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,o,a){var i,u,l,p,d,h,y;return _regeneratorRuntime().wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,game.messages.get(t);case 2:i=m.sent,u=i.flags,l=r.result.successLevel>1,p=l?2:1,u.botched=u.botched||r.result.successLevel<-1,d=c.Z.getSpeaker(r.result.speaker),h={messageId:r.result.messageId,actor:d.name,qs:(r.result.qualityStep||0)*p,success:r.result.successLevel,target:o,type:a},(y=u.results.findIndex((function(t){return t.messageId==h.messageId})))>=0?u.results[y]=h:u.results.push(h),RequestRoll.rerenderGC(i,u);case 12:case"end":return m.stop()}}),_callee4)}))),function editGroupCheckRoll(t,r,o,a){return y.apply(this,arguments)})},{key:"requestRoll",value:(h=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t,r){var o,a,c,u,l,p,d,h=arguments;return _regeneratorRuntime().wrap((function _callee5$(y){for(;;)switch(y.prev=y.next){case 0:if(o=h.length>2&&void 0!==h[2]?h[2]:0,a=i.Z._getActor(),c=a.actor,u=a.tokenId,!c){y.next=15;break}game.user.updateTokenTargets([]),l={modifier:o},y.t0=t,y.next="attribute"===y.t0?8:"regeneration"===y.t0?11:13;break;case 8:return p=Object.keys(game.dsk.config.characteristics).find((function(t){return game.i18n.localize(game.dsk.config.characteristics[t])==r})),c.setupCharacteristic(p,l,u).then((function(t){c.basicTest(t)})),y.abrupt("break",15);case 11:return c.setupRegeneration("regenerate",l,u).then((function(t){c.basicTest(t)})),y.abrupt("break",15);case 13:d=c.items.find((function(o){return o.name==r&&o.type==t})),c.setupSkill(d,l,u).then((function(t){c.basicTest(t)}));case 15:case"end":return y.stop()}}),_callee5)}))),function requestRoll(t,r){return h.apply(this,arguments)})},{key:"rerenderGC",value:(d=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t,r){var o,a,i,c,u;return _regeneratorRuntime().wrap((function _callee6$(l){for(;;)switch(l.prev=l.next){case 0:if(!game.user.isGM){l.next=14;break}o=0,r.qs=r.results.reduce((function(t,r){return o+=r.success<0?1:0,r.success>1&&(o=0),t+r.qs}),0),r.failed=o,a=_createForOfIteratorHelper(r.rollOptions);try{for(a.s();!(i=a.n()).done;)(c=i.value).calculatedModifier=c.modifier-o}catch(t){a.e(t)}finally{a.f()}return r.openRolls=r.maxRolls-r.results.length,r.doneRolls=r.results.length,l.next=10,renderTemplate("systems/dsk/templates/chat/roll/groupcheck.html",r);case 10:u=l.sent,t.update({content:u,flags:r}),l.next=15;break;case 14:game.socket.emit("system.dsk",{type:"updateGroupCheck",payload:{messageId:t.id,data:r}});case 15:$("#chat-log").find('[data-message-id="'.concat(t.id,'"')).appendTo("#chat-log");case 16:case"end":return l.stop()}}),_callee6)}))),function rerenderGC(t,r){return d.apply(this,arguments)})},{key:"showRQMessage",value:function showRQMessage(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=r<0?" ".concat(r):r>0?" +".concat(r):"",a=i.Z.skills.find((function(r){return r.name==t})).type,u=game.i18n.format("dsk.CHATNOTIFICATION.requestRoll",{user:game.user.name,item:'<a class="roll-button request-roll" data-type="'.concat(a,'" data-modifier="').concat(r,'" data-name="').concat(t,'"><i class="fas fa-dice"></i> ').concat(t).concat(o,"</a>")});ChatMessage.create(c.Z.chatDataSetup(u))}},{key:"showGCMessage",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,o,a,u,l,p,d=arguments;return _regeneratorRuntime().wrap((function _callee7$(h){for(;;)switch(h.prev=h.next){case 0:return r=d.length>1&&void 0!==d[1]?d[1]:0,o=d.length>2&&void 0!==d[2]?d[2]:{},a=i.Z.skills.find((function(r){return r.name==t})).type,u={results:[],qs:0,failed:0,modifier:r,name:game.user.name,maxRolls:7,openRolls:7,doneRolls:0,targetQs:10,rollOptions:[{type:a,modifier:r,calculatedModifier:r,target:t}]},mergeObject(u,o),h.next=7,renderTemplate("systems/dsk/templates/chat/roll/groupcheck.html",u);case 7:l=h.sent,(p=c.Z.chatDataSetup(l)).flags=u,ChatMessage.create(p);case 11:case"end":return h.stop()}}),_callee7)}))),function showGCMessage(t){return p.apply(this,arguments)})},{key:"addSkillToGC",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(t){var r,o,c;return _regeneratorRuntime().wrap((function _callee9$(u){for(;;)switch(u.prev=u.next){case 0:return r=$(t.currentTarget).parents(".message").attr("data-message-id"),u.next=3,renderTemplate("systems/dsk/templates/dialog/addgroupcheckskill.html",{skills:i.Z.skills.filter((function(t){return"skill"==t.type})).sort((function(t,r){return t.name.localeCompare(r.name)}))});case 3:o=u.sent,c={title:game.i18n.localize("dsk.HELP.groupcheck"),content:o,buttons:{ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t){var o,a;return _regeneratorRuntime().wrap((function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:o=game.messages.get(r),(a=o.flags).rollOptions.push({type:"skill",modifier:t.find('[name="modifier"]').val(),target:t.find('[name="skill"]').val()}),RequestRoll.rerenderGC(o,a);case 4:case"end":return i.stop()}}),_callee8)})));return function callback(r){return t.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}},new a.Z(c).render(!0);case 6:case"end":return u.stop()}}),_callee9)}))),function addSkillToGC(t){return l.apply(this,arguments)})},{key:"removeGCEntry",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(t){var r,o,a,i;return _regeneratorRuntime().wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:r=$(t.currentTarget),o=Number(t.currentTarget.dataset.index),a=game.messages.get(r.parents(".message").attr("data-message-id")),(i=a.flags).results.splice(o,1),RequestRoll.rerenderGC(a,i);case 6:case"end":return c.stop()}}),_callee10)}))),function removeGCEntry(t){return u.apply(this,arguments)})},{key:"removeSkillFromGC",value:function removeSkillFromGC(t){var r=$(t.currentTarget),o=game.messages.get(r.parents(".message").attr("data-message-id")),a=o.flags;a.rollOptions=a.rollOptions.filter((function(r){return!(r.type==t.currentTarget.dataset.type&&r.target==t.currentTarget.dataset.name)})),a.results=a.results.filter((function(r){return!(r.type==t.currentTarget.dataset.type&&r.target==t.currentTarget.dataset.name)})),RequestRoll.rerenderGC(o,a)}},{key:"editGC",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(t){var r,o,a,i;return _regeneratorRuntime().wrap((function _callee11$(c){for(;;)switch(c.prev=c.next){case 0:r=$(t.currentTarget),o=Number(t.currentTarget.dataset.index),a=game.messages.get(r.parents(".message").attr("data-message-id")),i=a.flags,o?i.results[o].qs=Number(r.val()):t.currentTarget.dataset.name?i.rollOptions.find((function(r){return r.target==t.currentTarget.dataset.name&&t.currentTarget.dataset.type==r.type}))[t.currentTarget.dataset.field]=Number(r.val()):i[t.currentTarget.dataset.field]=Number(r.val()),RequestRoll.rerenderGC(a,i);case 6:case"end":return c.stop()}}),_callee11)}))),function editGC(t){return o.apply(this,arguments)})},{key:"updateInformationRoll",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(t,r,o){var a,i,u,l,p,d;return _regeneratorRuntime().wrap((function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:if(!((a=r.result.qualityStep||0)>0)){o.next=10;break}return o.next=4,fromUuid(t.uuid);case 4:for(i=o.sent,u=["<p><b>".concat(i.name,"</b></p>")],l=1;l<=a;l++)p="qs".concat(l),i.system[p]&&u.push("<p>".concat(i.system[p],"</p>"));d=c.Z.chatDataSetup(u.join("")),t.recipients.length&&(d.whisper=t.recipients),ChatMessage.create(d);case 10:case"end":return o.stop()}}),_callee12)}))),function updateInformationRoll(t,o,a){return r.apply(this,arguments)})},{key:"informationRequestRoll",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(t){var r,o,a,c,u,l,p,d,h,y=this;return _regeneratorRuntime().wrap((function _callee14$(m){for(;;)switch(m.prev=m.next){case 0:if(r=t.currentTarget.dataset.mod,o=t.currentTarget.dataset.uuid,a=i.Z._getActor(),c=a.actor,u=a.tokenId,c){m.next=5;break}return m.abrupt("return");case 5:l=game.settings.get("dsk","informationDistribution"),p=[],1==l?(p=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))).push(game.user.id):2==l&&(p=game.users.filter((function(t){return t.isGM})).map((function(t){return t.id}))),d={modifier:r,postFunction:{functionName:"game.dsk.apps.RequestRoll.updateInformationRoll",uuid:o,recipients:p}},h=c.items.find((function(r){return r.name==t.currentTarget.dataset.skill&&"skill"==r.type})),c.setupSkill(h,d,u).then(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(t){var r;return _regeneratorRuntime().wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:return t.testData.opposable=!1,o.next=3,c.basicTest(t);case 3:r=o.sent,y.updateInformationRoll(d.postFunction,r);case 5:case"end":return o.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}());case 11:case"end":return m.stop()}}),_callee14)}))),function informationRequestRoll(r){return t.apply(this,arguments)})},{key:"chatListeners",value:function chatListeners(t){t.on("change",".editGC",(function(t){return RequestRoll.editGC(t)})),t.on("click",".request-roll",(function(t){var r=t.currentTarget.dataset;RequestRoll.requestRoll(r.type,r.name,Number(r.modifier)||0)})),t.on("click",".request-gc",(function(t){var r=t.currentTarget.dataset;RequestRoll.requestGC(r.type,r.name,$(t.currentTarget).parents(".message").attr("data-message-id"),Number(r.modifier)||0)})),t.on("click",".removeGC",(function(t){return RequestRoll.removeGCEntry(t)})),t.on("click",".removeSkillFromGC",(function(t){return RequestRoll.removeSkillFromGC(t)})),t.on("click",".addSkillToGC",(function(t){return RequestRoll.addSkillToGC(t)})),t.on("click",".informationRequestRoll",(function(t){return RequestRoll.informationRequestRoll(t)}))}}]),RequestRoll}()},122:(t,r,o)=>{o.d(r,{Z:()=>c});var a=o(832),i=o(514);function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}var c=function(){function RuleChaos(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RuleChaos)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(RuleChaos,null,[{key:"_getFunctionData",value:function _getFunctionData(t){return{data:t.currentTarget.dataset,actor:a.Z.getSpeaker({token:t.currentTarget.dataset.token,actor:t.currentTarget.dataset.actor,scene:canvas.scene?canvas.scene.id:null})}}},{key:"multipleDefenseValue",value:function multipleDefenseValue(t,r){var o=-2;return getProperty(r,"system.combatskill")==game.i18n.localize("dsk.dsk.LocalizedIDs.wrestle")&&i.Z.hasAbility(t,game.i18n.localize("dsk.LocalizedIDs.masterfulDodge"))?o=-2:i.Z.hasAbility(t,game.i18n.localize("dsk.LocalizedIDs.mightyMasterfulParry"))?o=-1:i.Z.hasAbility(t,game.i18n.localize("dsk.LocalizedIDs.masterfulParry"))&&(o=-2),Math.min(0,o)}},{key:"isYieldedTwohanded",value:function isYieldedTwohanded(t){var r=this.regex2h.test(t.name),o=t.system.worn.wrongGrip;return r&&!o||!r&&o}},{key:"obfuscateDropData",value:function obfuscateDropData(t,r){if(r){var o,a=_createForOfIteratorHelper(r);try{for(a.s();!(o=a.n()).done;){var i=o.value;mergeObject(t,{system:{obfuscation:_defineProperty({},i,!0)}})}}catch(t){a.e(t)}finally{a.f()}}}},{key:"_buildDuration",value:function _buildDuration(t){var r={duration:{startTime:game.time.worldTime,rounds:t,seconds:5*t}};return game.combat&&mergeObject(r,{duration:{combat:game.combat.id,startRound:game.combat.round,startTurn:game.combat.turn}}),r}},{key:"increment",value:function increment(t,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=t.ctrlKey?10:1,c=2==t.button?-1:1,u=getProperty(r,o)+i*c;null!=a&&(u=Math.max(a,u)),setProperty(r,o,u)}}]),RuleChaos}();_defineProperty(c,"regex2h",/\(2H/)},514:(t,r,o)=>{o.d(r,{Z:()=>c});var a=o(930),i=o(404);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var c=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(SpecialabilityRulesDSK,t);var r,o,i,c,u=_createSuper(SpecialabilityRulesDSK);function SpecialabilityRulesDSK(){return _classCallCheck(this,SpecialabilityRulesDSK),u.apply(this,arguments)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(SpecialabilityRulesDSK,null,[{key:"setupFunctions",value:function setupFunctions(){}},{key:"abilityAdded",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t,r){return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:a.Z.addAbilityRules[r.name]&&a.Z.addAbilityRules[r.name](t,r);case 1:case"end":return o.stop()}}),_callee)}))),function abilityAdded(t,r){return c.apply(this,arguments)})},{key:"abilityRemoved",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){var o,i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:if(a.Z.removeAbilityRules[r.name]&&a.Z.removeAbilityRules[r.name](t,r),o=r.system.ap*r.system.level,/;/.test(r.system.ap))for(i=r.system.ap.split(";").map((function(t){return Number(t.trim())})),o=0,c=0;c<r.system.level;c++)o+=i[c];return u.next=5,t._updateAPs(-1*o);case 5:case"end":return u.stop()}}),_callee2)}))),function abilityRemoved(t,r){return i.apply(this,arguments)})},{key:"_specialabilityReturnFunction",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,o,i){var c,u,l,p,d;return _regeneratorRuntime().wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:if(null!=r){h.next=2;break}return h.abrupt("return");case 2:if(r=duplicate(r),null!=i&&(/,/.test(r.system.ap)&&(c="".concat(r.name.replace(" ()","")," (").concat(i.name),r.system.ap=r.system.ap.split(",")[t.items.filter((function(t){return t.type==r.type&&t.name.includes(c)})).length].trim()),SpecialabilityRulesDSK.simpleAdoption(r,i,r.name,a.Z.AbilitiesNeedingAdaption),r.name="".concat(r.name.replace(" ()","")," (").concat(i.name).concat(i.customEntry?", "+i.customEntry:"",")"),i.data&&i.system.StF&&/\//.test(r.system.ap)&&(r.system.ap=r.system.ap.split("/")[i.system.StF.charCodeAt(0)-65].trim())),!(u=t.items.find((function(t){return t.type==o&&t.name==r.name})))){h.next=23;break}if(l=duplicate(u),p=/;/.test(l.system.ap)?l.system.ap.split(";").map((function(t){return Number(t.trim())}))[l.system.level]:l.system.ap,h.t0=l.system.level+1<=l.system.max,!h.t0){h.next=13;break}return h.next=12,t.checkEnoughXP(p);case 12:h.t0=h.sent;case 13:if(!h.t0){h.next=21;break}return l.system.level+=1,h.next=17,t._updateAPs(p);case 17:return h.next=19,t.updateEmbeddedDocuments("Item",[l]);case 19:return h.next=21,SpecialabilityRulesDSK.abilityAdded(t,l);case 21:h.next=33;break;case 23:return d=r.system.ap.split(";").map((function(t){return t.trim()}))[0],h.next=26,t.checkEnoughXP(d);case 26:if(!h.sent){h.next=33;break}return h.next=29,SpecialabilityRulesDSK.abilityAdded(t,r);case 29:return h.next=31,t._updateAPs(d);case 31:return h.next=33,t.createEmbeddedDocuments("Item",[r]);case 33:case"end":return h.stop()}}),_callee3)}))),function _specialabilityReturnFunction(t,r,a,i){return o.apply(this,arguments)})},{key:"needsAdoption",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r,o){var i,c,u,l,p;return _regeneratorRuntime().wrap((function _callee4$(d){for(;;)switch(d.prev=d.next){case 0:if(!(i=a.Z.AbilitiesNeedingAdaption[r.name])){d.next=26;break}if("text"!=i.items){d.next=9;break}return d.next=5,renderTemplate("systems/dsk/templates/dialog/requires-adoption-string-dialog.html",{original:r});case 5:c=d.sent,u=function callback(a){var i={name:a.find('[name="entryselection"]').val()};SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,o,i)},d.next=22;break;case 9:if("array"!=i.items){d.next=17;break}return l=i.elems.map((function(t){return{name:t}})),d.next=13,renderTemplate("systems/dsk/templates/dialog/requires-adoption-dialog.html",{items:l,original:r,area:i.area});case 13:c=d.sent,u=function callback(a){var i=l.find((function(t){return t.name==a.find('[name="entryselection"]').val()}));SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,o,i)},d.next=22;break;case 17:return p=t.items.filter((function(t){return i.items.includes(t.type)})).sort((function(t,r){return t.name.localeCompare(r.name)})),d.next=20,renderTemplate("systems/dsk/templates/dialog/requires-adoption-dialog.html",{items:p,original:r,area:i.area});case 20:c=d.sent,u=function callback(a){var i=p.find((function(t){return t.name==a.find('[name="entryselection"]').val()}));i.customEntry=a.find('[name="custom"]').val(),SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,o,i)};case 22:return d.next=24,new Dialog({title:game.i18n.localize("dsk.DIALOG.ItemRequiresAdoption"),content:c,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:u},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0);case 24:d.next=27;break;case 26:SpecialabilityRulesDSK._specialabilityReturnFunction(t,r,o,null);case 27:case"end":return d.stop()}}),_callee4)}))),function needsAdoption(t,o,a){return r.apply(this,arguments)})},{key:"hasAbility",value:function hasAbility(t,r){return _get(_getPrototypeOf(SpecialabilityRulesDSK),"hasItem",this).call(this,t,r,["specialability"])}},{key:"abilityStep",value:function abilityStep(t,r){return _get(_getPrototypeOf(SpecialabilityRulesDSK),"itemStep",this).call(this,t,r,["specialability"])}},{key:"abilityAsModifier",value:function abilityAsModifier(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return _get(_getPrototypeOf(SpecialabilityRulesDSK),"itemAsModifier",this).call(this,t,r,o,["specialability"],a)}}]),SpecialabilityRulesDSK}(i.Z);i.Z.children.SpecialabilityRulesDSK=c},969:(t,r,o)=>{o.d(r,{Z:()=>i});var a=o(930);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(TraitRulesDSK,t);var r,o=_createSuper(TraitRulesDSK);function TraitRulesDSK(){return _classCallCheck(this,TraitRulesDSK),o.apply(this,arguments)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(TraitRulesDSK,null,[{key:"traitAdded",value:(r=function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(_regeneratorRuntime().mark((function _callee(t,r){return _regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:if(!a.Z.addTraitRules[r.name]){o.next=3;break}return o.next=3,a.Z.addTraitRules[r.name](t,r);case 3:case"end":return o.stop()}}),_callee)}))),function traitAdded(t,o){return r.apply(this,arguments)})},{key:"hasTrait",value:function hasTrait(t,r){return _get(_getPrototypeOf(TraitRulesDSK),"hasItem",this).call(this,t,r,["trait"])}}]),TraitRulesDSK}(o(404).Z)},707:(t,r,o)=>{function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function svgAutoFit(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:320,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40;t.attr({width:.8*r,viewBox:"0 0 ".concat(r," ").concat(o)});var a=t.find("text"),i=a.get(0).getBBox(),c=r/i.width,u=o/i.height,l=c<u,p=l?c:u;isFinite(p)&&a.attr({transform:"matrix("+p+", 0, 0, "+p+", 0,0)",x:Math.max(0,(r-i.width)/2),y:.75*o/(l?1:p)})}function slist(t,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"div";if(r=t.find(r)[0]){r.classList.add("slist");var i,c=r.querySelectorAll(a),u=null,l=_createForOfIteratorHelper(c);try{for(l.s();!(i=l.n()).done;){var p=i.value;p.draggable=!0,p.addEventListener("dragstart",(function(t){u=this})),p.addEventListener("dragover",(function(t){t.preventDefault()})),p.addEventListener("drop",function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var a,i,l;return _regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(t.preventDefault(),this==u){p.next=7;break}for(a=0,i=0,l=0;l<c.length;l++)u==c[l]&&(a=l),this==c[l]&&(i=l);return a<i?this.parentNode.insertBefore(u,this.nextSibling):this.parentNode.insertBefore(u,this),p.next=7,o(r);case 7:case"end":return p.stop()}}),_callee,this)})));return function(r){return t.apply(this,arguments)}}())}}catch(t){l.e(t)}finally{l.f()}}}function tinyNotification(t){var r=$(".tinyNotifications");r.length||($("body").append('<ul class="tinyNotifications"></ul>'),r=$(".tinyNotifications"));var o=$("<li>".concat(t,"</li>"));r.prepend(o),setTimeout((function(){o.remove()}),1500)}o.d(r,{Jp:()=>slist,p0:()=>tinyNotification,zJ:()=>svgAutoFit})},139:(t,r,o)=>{o.d(r,{Z:()=>u});var a=o(930),i=o(832),c=o(604);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var u=function(){function DSKTables(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKTables)}var t,r,o,u,l,p;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKTables,null,[{key:"showBotchCard",value:(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,o,c,u,l,p,d,h,y=arguments;return _regeneratorRuntime().wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:return(r=y.length>1&&void 0!==y[1]?y[1]:{}).speaker={token:t.token,actor:t.actor,scene:t.scene},r.source=t.source,o=a.Z.systemTables.find((function(r){return r.name==t.table})),m.next=6,DSKTables.getRollTable(o.pack[game.i18n.lang],game.i18n.localize("dsk.TABLENAMES.".concat(t.table)),t);case 6:if(c=m.sent,!r.speaker){m.next=13;break}return m.next=10,DSKTables.hasEffect(c);case 10:m.t0=m.sent,m.next=14;break;case 13:m.t0=!1;case 14:return u=m.t0,l=i.Z.replaceDies(i.Z.replaceConditions(c.results[0].text)),p="".concat(game.i18n.localize("dsk.TABLENAMES."+t.table)),m.next=19,renderTemplate("systems/dsk/templates/tables/tableCard.html",{result:l,title:p,hasEffect:u});case 19:return d=m.sent,m.next=22,this.buildEffects(c,u);case 22:h=m.sent,ChatMessage.create({user:game.user.id,content:d,whisper:r.whisper,blind:r.blind,flags:{data:{preData:{source:{effects:h},extra:{actor:{id:r.speaker.actor},speaker:r.speaker},situationalModifiers:[]},postData:{}},dsk:{hasEffect:u,options:r}}});case 24:case"end":return m.stop()}}),_callee,this)}))),function showBotchCard(t){return p.apply(this,arguments)})},{key:"hasEffect",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){return _regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",getProperty(t.results[0],"flags.dsk")||!1);case 1:case"end":return r.stop()}}),_callee2)}))),function hasEffect(t){return l.apply(this,arguments)})},{key:"buildEffects",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r){var o,a;return _regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return o=[],r&&r.resistEffect&&(a=(new c.Z).effectDummy(r.resistEffect.fail.description,r.resistEffect.changes||[],r.resistEffect.duration||{}),r.resistEffect.fail.systemEffect&&mergeObject(a,{_id:"botchEffect",flags:{dsk:{hideOnToken:!1,hidePlayers:!1,advancedFunction:2,args3:'await actor.addCondition("prone");'}}}),o.push(a)),t.abrupt("return",o);case 3:case"end":return t.stop()}}),_callee3)}))),function buildEffects(t,r){return u.apply(this,arguments)})},{key:"getRollTable",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t,r){var o,a,i,c,u=arguments;return _regeneratorRuntime().wrap((function _callee4$(l){for(;;)switch(l.prev=l.next){case 0:return o=u.length>2&&void 0!==u[2]?u[2]:{},a=game.packs.get(t),l.next=4,a.getDocuments({name:{$in:[r]}});case 4:return i=l.sent[0],l.next=7,i.draw({displayChat:!1});case 7:if(c=l.sent,!("true"==o.weaponless&&c.roll.total<7)){l.next=13;break}return c.roll.editRollAtIndex([{index:0,val:c.roll.total+5}]),l.next=12,i.draw({displayChat:!1,roll:c.roll});case 12:c=l.sent;case 13:return l.abrupt("return",c);case 14:case"end":return l.stop()}}),_callee4)}))),function getRollTable(t,r){return o.apply(this,arguments)})},{key:"tableEnabledFor",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r;return _regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return r=a.Z.systemTables.find((function(r){return r.name==t})),o.abrupt("return",!!r&&game.settings.get(r.setting.module,r.setting.key));case 2:case"end":return o.stop()}}),_callee5)}))),function tableEnabledFor(t){return r.apply(this,arguments)})},{key:"rollCritBotchButton",value:function rollCritBotchButton(t,r,o){var a=game.i18n.localize("dsk.TABLENAMES.".concat(t)),i=o.extra.speaker,c=o.source._id;return', <a class="roll-button botch-roll" data-table="'.concat(t,'" data-weaponless="').concat(r,'" data-source="').concat(c,'" data-token="').concat(i.token,'" data-actor="').concat(i.actor,'" data-scene="').concat(i.scene,'"><i class="fas fa-dice"></i>').concat(a,"</a>")}},{key:"defaultBotch",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){return _regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=", "+game.i18n.localize("dsk.selfDamage"),t.next=3,new Roll("1d6+2").evaluate({async:!0});case 3:return t.t1=t.sent.total,t.abrupt("return",t.t0+t.t1);case 5:case"end":return t.stop()}}),_callee6)}))),function defaultBotch(){return t.apply(this,arguments)})},{key:"defaultAttackCrit",value:function defaultAttackCrit(t){var r=", "+game.i18n.localize("dsk.halfDefense");return t&&(r+=", "+game.i18n.localize("dsk.doubleDamage")),r}},{key:"defaultParryCrit",value:function defaultParryCrit(){return", "+game.i18n.localize("dsk.attackOfOpportunity")}}]),DSKTables}()}},__webpack_module_cache__={};function __webpack_require__(t){var r=__webpack_module_cache__[t];if(void 0!==r)return r.exports;var o=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(t,r)=>{for(var o in r)__webpack_require__.o(r,o)&&!__webpack_require__.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},__webpack_require__.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var __webpack_exports__={};(()=>{var t=__webpack_require__(832),r=__webpack_require__(231),o=__webpack_require__(140);function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==o)return;var a,i,c=[],u=!0,l=!1;try{for(o=o.call(t);!(u=(a=o.next()).done)&&(c.push(a.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==o.return||o.return()}finally{if(l)throw i}}return c}(t,r)||_unsupportedIterableToArray(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var a=function(){function Migrakel(){!function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Migrakel)}var t,r,o,a,i,c,u,l;return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Migrakel,null,[{key:"showDialog",value:(l=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,o,a;return _regeneratorRuntime().wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,new Promise((function(r,o){new Dialog({title:game.i18n.localize("dsk.Migrakel.Migration"),content:t,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){r([!0])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){r([!1])}}},close:function close(){r([!1])}}).render(!0)}));case 2:return r=i.sent,o=_slicedToArray(r,1),a=o[0],i.abrupt("return",a);case 6:case"end":return i.stop()}}),_callee)}))),function showDialog(t){return l.apply(this,arguments)})},{key:"refreshStatusEffects",value:(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t){var r,o,a,i,c;return _regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:r=[],o=_createForOfIteratorHelper(t.effects),u.prev=2,o.s();case 4:if((a=o.n()).done){u.next=19;break}if(!(i=a.value).origin){u.next=17;break}return c=void 0,u.prev=8,u.next=11,fromUuid(i.origin);case 11:c=u.sent,u.next=16;break;case 14:u.prev=14,u.t0=u.catch(8);case 16:c||r.push(i.id);case 17:u.next=4;break;case 19:u.next=24;break;case 21:u.prev=21,u.t1=u.catch(2),o.e(u.t1);case 24:return u.prev=24,o.f(),u.finish(24);case 27:return u.next=29,t.deleteEmbeddedDocuments("ActiveEffect",r);case 29:case"end":return u.stop()}}),_callee2,null,[[2,21,24,27],[8,14]])}))),function refreshStatusEffects(t){return u.apply(this,arguments)})},{key:"updateVals",value:(c=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(t,r,o){var a,i,c,u,l,p,d,h,y,m,g,v,_,b;return _regeneratorRuntime().wrap((function _callee3$(k){for(;;)switch(k.prev=k.next){case 0:return a=game.dsk.itemLibrary,i=[],c=[],u=new Map,k.next=6,this.refreshStatusEffects(t);case 6:if(!r({type:"equipment"})){k.next=34;break}l=[],p=[],d=_createForOfIteratorHelper(t.items.filter((function(t){return"equipment"==t.type&&"bags"==t.system.category}))),k.prev=10,y=_regeneratorRuntime().mark((function _loop(){var t,r,i;return _regeneratorRuntime().wrap((function _loop$(c){for(;;)switch(c.prev=c.next){case 0:return t=h.value,c.next=3,a.findCompendiumItem(t.name,t.type);case 3:if(!((r=c.sent).length>0)){c.next=12;break}if(r=r.find((function(r){return r.name==t.name&&r.type==t.type}))){c.next=8;break}return c.abrupt("return","continue");case 8:console.log("MIGRATION - Updated ".concat(t.name)),i=mergeObject(t.toObject(),o(r)),p.push(i),l.push(t.id);case 12:case"end":return c.stop()}}),_loop)})),d.s();case 13:if((h=d.n()).done){k.next=20;break}return k.delegateYield(y(),"t0",15);case 15:if("continue"!==k.t0){k.next=18;break}return k.abrupt("continue",18);case 18:k.next=13;break;case 20:k.next=25;break;case 22:k.prev=22,k.t1=k.catch(10),d.e(k.t1);case 25:return k.prev=25,d.f(),k.finish(25);case 28:return k.next=30,t.createEmbeddedDocuments("Item",p);case 30:for(m=k.sent,g=0;g<m.length;g++)u.set(l[g],m[g].id);return k.next=34,t.deleteEmbeddedDocuments("Item",l);case 34:v=_createForOfIteratorHelper(t.items.filter((function(t){return r(t)&&!("equipment"==t.type&&"bags"==t.system.category)}))),k.prev=35,b=_regeneratorRuntime().mark((function _loop2(){var t,r,l;return _regeneratorRuntime().wrap((function _loop2$(p){for(;;)switch(p.prev=p.next){case 0:return t=_.value,p.next=3,a.findCompendiumItem(t.name,t.type);case 3:if(!((r=p.sent).length>0)){p.next=13;break}if(r=r.find((function(r){return r.name==t.name&&r.type==t.type}))){p.next=8;break}return p.abrupt("return","continue");case 8:console.log("MIGRATION - Updated ".concat(t.name)),(l=mergeObject(t.toObject(),o(r))).system.parent_id&&u.has(l.system.parent_id)&&(l.system.parent_id=u.get(l.system.parent_id)),c.push(l),i.push(t.id);case 13:case"end":return p.stop()}}),_loop2)})),v.s();case 38:if((_=v.n()).done){k.next=45;break}return k.delegateYield(b(),"t2",40);case 40:if("continue"!==k.t2){k.next=43;break}return k.abrupt("continue",43);case 43:k.next=38;break;case 45:k.next=50;break;case 47:k.prev=47,k.t3=k.catch(35),v.e(k.t3);case 50:return k.prev=50,v.f(),k.finish(50);case 53:return k.next=55,t.createEmbeddedDocuments("Item",c);case 55:return k.next=57,t.deleteEmbeddedDocuments("Item",i);case 57:ui.notifications.notify(game.i18n.localize("dsk.Migrakel.migrationDone"));case 58:case"end":return k.stop()}}),_callee3,this,[[10,22,25,28],[35,47,50,53]])}))),function updateVals(t,r,o){return c.apply(this,arguments)})},{key:"updateSpellsAndLiturgies",value:(i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(t){var r,o;return _regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.spells"));case 2:if(!a.sent){a.next=7;break}return r=function condition(t){return["spell","liturgy","ritual","ceremony","spellextension"].includes(t.type)},o=function updator(t){var r={effects:t.effects.toObject()};return"spellextension"!=t.type&&(r.system={effectFormula:t.system.effectFormula}),r},a.next=7,this.updateVals(t,r,o);case 7:case"end":return a.stop()}}),_callee4,this)}))),function updateSpellsAndLiturgies(t){return i.apply(this,arguments)})},{key:"updateSpecialAbilities",value:(a=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(t){var r,o,a=this;return _regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.abilities"));case 2:if(!i.sent){i.next=7;break}return r=function updator(t){var r={system:{effect:{value:t.system.effect}},effects:t.effects.toObject()};return"specialability"==t.type&&(mergeObject(r,{system:{category:{sub:t.system.category.sub||0},list:{value:t.system.list.value}}}),"staff"==t.system.category&&mergeObject(r,{system:{feature:getProperty(t,"system.feature")||"",AsPCost:getProperty(t,"system.AsPCost")||"",volume:Number(getProperty(t,"system.volume"))||0,artifact:getProperty(t,"system.artifact")||""}})),a.updateMacro(r,t),r},o=function condition(t){return["specialability","advantage","disadvantage","trait"].includes(t.type)},i.next=7,this.updateVals(t,o,r);case 7:case"end":return i.stop()}}),_callee5,this)}))),function updateSpecialAbilities(t){return a.apply(this,arguments)})},{key:"updateCombatskills",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(t){var r,o;return _regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.cskills"));case 2:if(!a.sent){a.next=7;break}return r=function updator(t){return{effects:t.effects.toObject()}},o=function condition(t){return["combatskill"].includes(t.type)},a.next=7,this.updateVals(t,o,r);case 7:case"end":return a.stop()}}),_callee6,this)}))),function updateCombatskills(t){return o.apply(this,arguments)})},{key:"updateSkills",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(t){var r,o;return _regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.skills"));case 2:if(!a.sent){a.next=7;break}return r=function condition(t){return["skill"].includes(t.type)},o=function updator(t){return{img:t.img}},a.next=7,this.updateVals(t,r,o);case 7:case"end":return a.stop()}}),_callee7,this)}))),function updateSkills(t){return r.apply(this,arguments)})},{key:"updateMacro",value:function updateMacro(t,r){var o=r.getFlag("dsk","onUseEffect");o&&mergeObject(t,{flags:{dsk:{onUseEffect:o}}})}},{key:"updateGear",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(t){var r,o,a=this;return _regeneratorRuntime().wrap((function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.showDialog(game.i18n.localize("dsk.Migrakel.gear"));case 2:if(!i.sent){i.next=7;break}return r=function condition(t){return["meleeweapon","armor","rangeweapon","equipment","poison","consumable","ammunition"].includes(t.type)},o=function updator(t){var r={img:t.img,effects:t.effects.toObject()};return["poison","consumable"].includes(t.type)||mergeObject(r,{system:{effect:{value:t.system.effect}}}),["armor"].includes(t.type)&&mergeObject(r,{system:{subcategory:t.system.subcategory}}),a.updateMacro(r,t),r},i.next=7,this.updateVals(t,r,o);case 7:case"end":return i.stop()}}),_callee8,this)}))),function updateGear(r){return t.apply(this,arguments)})}]),Migrakel}();function dialog_actorConfig_typeof(t){return dialog_actorConfig_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_actorConfig_typeof(t)}function dialog_actorConfig_regeneratorRuntime(){dialog_actorConfig_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_actorConfig_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dialog_actorConfig_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dialog_actorConfig_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dialog_actorConfig_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dialog_actorConfig_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_actorConfig_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,r){if(r&&("object"===dialog_actorConfig_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}var i=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(DialogActorConfig,Dialog);var r,o,i=_createSuper(DialogActorConfig);function DialogActorConfig(t,r){var o;return function dialog_actorConfig_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DialogActorConfig),(o=i.call(this,r)).actor=t,o.lock=!1,o}return function dialog_actorConfig_createClass(t,r,o){return r&&dialog_actorConfig_defineProperties(t.prototype,r),o&&dialog_actorConfig_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DialogActorConfig,[{key:"updateWrapper",value:(o=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee2(t,r){var o,i=this;return dialog_actorConfig_regeneratorRuntime().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",ui.notifications.warn("There is nothing to migrate yet."));case 3:o=function(){var o=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee(){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return i.lock=!0,$(r.currentTarget).prepend('<i class="fas fa-spinner fa-spin"></i>'),o.next=4,a[t](i.actor);case 4:$(r.currentTarget).find("i").remove(),i.lock=!1;case 6:case"end":return o.stop()}}),_callee)})));return function upd(){return o.apply(this,arguments)}}(),o();case 5:case"end":return c.stop()}}),_callee2,this)}))),function updateWrapper(t,r){return o.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;_get(_getPrototypeOf(DialogActorConfig.prototype),"activateListeners",this).call(this,t),t.find(".updateSpells").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee3(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.updateWrapper("updateSpellsAndLiturgies",t));case 1:case"end":return o.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updateAbilities").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee4(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.updateWrapper("updateSpecialAbilities",t));case 1:case"end":return o.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updatecSkills").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee5(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.updateWrapper("updateCombatskills",t));case 1:case"end":return o.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updateSkills").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee6(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.updateWrapper("updateSkills",t));case 1:case"end":return o.stop()}}),_callee6)})));return function(r){return t.apply(this,arguments)}}()),t.find(".updateGear").click(function(){var t=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee7(t){return dialog_actorConfig_regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.updateWrapper("updateGear",t));case 1:case"end":return o.stop()}}),_callee7)})));return function(r){return t.apply(this,arguments)}}())}}],[{key:"buildDialog",value:(r=dialog_actorConfig_asyncToGenerator(dialog_actorConfig_regeneratorRuntime().mark((function _callee8(t){var r;return dialog_actorConfig_regeneratorRuntime().wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,renderTemplate("systems/dsk/templates/actors/parts/actorConfig.html",{actor:t});case 2:r=o.sent,new DialogActorConfig(t,{title:game.i18n.localize("dsk.SHEET.actorConfig"),content:r,default:"Save",buttons:{Save:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.save"),callback:function callback(r){t.update({"system.config.autoBar":r.find('[name="autoBar"]').is(":checked"),"system.config.autoSize":r.find('[name="autoSize"]').is(":checked")})}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 4:case"end":return o.stop()}}),_callee8)}))),function buildDialog(t){return r.apply(this,arguments)})}]),DialogActorConfig}();function bindImgToCanvasDragStart(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"img";game.user.isGM&&t.find(r).each((function(t,r){r.setAttribute("draggable",!0),r.addEventListener("dragstart",(function(t){return c(t)}))}))}var c=function dragTileImg(t){canvas.tiles.activate();var r=t.currentTarget.src,o=t.currentTarget,a=canvas.dimensions.sceneHeight/o.naturalHeight,i=canvas.dimensions.sceneWidth/o.naturalWidth,c=Math.min(1,i,a),u={type:"Tile",texture:{src:r},tileSize:Math.round(canvas.dimensions.size/c)};t.dataTransfer.setData("text/plain",JSON.stringify(u));var l=o.naturalWidth*c*canvas.stage.scale.x,p=o.naturalHeight*c*canvas.stage.scale.y,d=DragDrop.createDragImage(o,l,p);t.dataTransfer.setDragImage(d,l/2,p/2)},u=__webpack_require__(973),l=__webpack_require__(530),p=__webpack_require__(774),d=__webpack_require__(930),h=__webpack_require__(608),y=__webpack_require__(122),m=__webpack_require__(278),g=__webpack_require__(514);function actor_sheet_dsk_typeof(t){return actor_sheet_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_dsk_typeof(t)}function actor_sheet_dsk_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function actor_sheet_dsk_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return actor_sheet_dsk_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return actor_sheet_dsk_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function actor_sheet_dsk_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function actor_sheet_dsk_regeneratorRuntime(){actor_sheet_dsk_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_sheet_dsk_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function actor_sheet_dsk_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function actor_sheet_dsk_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){actor_sheet_dsk_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){actor_sheet_dsk_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function actor_sheet_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_dsk_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function actor_sheet_dsk_get(){return actor_sheet_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=actor_sheet_dsk_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},actor_sheet_dsk_get.apply(this,arguments)}function actor_sheet_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_dsk_getPrototypeOf(t)););return t}function actor_sheet_dsk_setPrototypeOf(t,r){return actor_sheet_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_dsk_setPrototypeOf(t,r)}function actor_sheet_dsk_createSuper(t){var r=function actor_sheet_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=actor_sheet_dsk_getPrototypeOf(t);if(r){var i=actor_sheet_dsk_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return actor_sheet_dsk_possibleConstructorReturn(this,o)}}function actor_sheet_dsk_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_dsk_getPrototypeOf(t){return actor_sheet_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_dsk_getPrototypeOf(t)}var v=function(a){!function actor_sheet_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_dsk_setPrototypeOf(t,r)}(ActorSheetDSK,ActorSheet);var c,v,_,b,k,w,x,O,S,P,T,I,E,C,A,R,G,L,D,j,M,z,N=actor_sheet_dsk_createSuper(ActorSheetDSK);function ActorSheetDSK(){return actor_sheet_dsk_classCallCheck(this,ActorSheetDSK),N.apply(this,arguments)}return function actor_sheet_dsk_createClass(t,r,o){return r&&actor_sheet_dsk_defineProperties(t.prototype,r),o&&actor_sheet_dsk_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetDSK,[{key:"_render",value:(z=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee(){var t,r,o,a,i,c,u,l=arguments;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:return t=l.length>0&&void 0!==l[0]&&l[0],r=l.length>1&&void 0!==l[1]?l[1]:{},this._saveSearchFields(),this._saveCollapsed(),p.next=6,actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"_render",this).call(this,t,r);case 6:for(this._setCollapsed(),this._restoreSeachFields(),o=$(this._element),a={".close":"dsk.SHEET.Close",".configure-sheet":"dsk.SHEET.Configure",".configure-token":"dsk.SHEET.Token",".import":"dsk.SHEET.Import",".locksheet":"dsk.SHEET.Lock",".library":"dsk.SHEET.Library",".playerview":"dsk.SHEET.switchLimited",".actorConfig":"dsk.SHEET.actorConfig"},i=0,c=Object.keys(a);i<c.length;i++)u=c[i],o.find(u).attr("data-tooltip",game.i18n.localize(a[u]));this.currentFocus&&(o.find('[data-item-id="'+this.currentFocus+'"] input').focus().select(),this.currentFocus=null);case 12:case"end":return p.stop()}}),_callee,this)}))),function _render(){return z.apply(this,arguments)})},{key:"swapWeaponHand",value:(M=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee2(t){var r,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return r=this._getItemId(t),o=this.actor.items.get(r),a.next=4,this.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.worn.wrongGrip":!o.system.worn.wrongGrip}]);case 4:case"end":return a.stop()}}),_callee2,this)}))),function swapWeaponHand(t){return M.apply(this,arguments)})},{key:"_saveSearchFields",value:function _saveSearchFields(){if(null!==this.form){var t=$(this.form).parent();this.searchFields={talentFiltered:$(t.find(".filterTalents")).hasClass("filtered"),searchText:$(t.find(".talentSearch")).val(),gearSearch:$(t.find(".gearSearch")).val()}}}},{key:"_restoreSeachFields",value:function _restoreSeachFields(){if(null!=this.searchFields){var t=$(this.form).parent();this.searchFields.talentFiltered&&($(t.find(".filterTalents")).addClass("filtered"),$(t.find(".allTalents")).removeClass("showAll"));var r=$(t.find(".talentSearch"));r.val(this.searchFields.searchText),""!=this.searchFields.searchText&&this._filterTalents(r);var o=$(t.find(".gearSearch"));o.val(this.searchFields.gearSearch),""!=this.searchFields.searchText&&this._filterGear(o)}}},{key:"_saveCollapsed",value:function _saveCollapsed(){if(null!==this.form){var t=$(this.form).parent();this.collapsedBoxes=[],this.openDetails=[];var r,o=actor_sheet_dsk_createForOfIteratorHelper(t.find(".ch-collapse i"));try{for(o.s();!(r=o.n()).done;){var a=r.value;this.collapsedBoxes.push($(a).attr("class"))}}catch(t){o.e(t)}finally{o.f()}var i,c=actor_sheet_dsk_createForOfIteratorHelper($(t.find(".expandDetails.shown")));try{for(c.s();!(i=c.n()).done;){var u=i.value;this.openDetails.push($(u).closest(".item").attr("data-item-id"))}}catch(t){c.e(t)}finally{c.f()}}}},{key:"_setCollapsed",value:function _setCollapsed(){var t=$(this.form).parent();if(this.collapsedBoxes)for(var r=t.find(".ch-collapse i"),o=0;o<r.length;o++)$(r[o]).attr("class",this.collapsedBoxes[o]),this.collapsedBoxes[o]&&-1!=this.collapsedBoxes[o].indexOf("fa-angle-down")&&$(r[o]).closest(".groupbox").find(".row-section:nth-child(2)").hide()}},{key:"getData",value:(j=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee3(t){var r,o,a;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"getData",this).call(this,t);case 2:return r=i.sent,o={actor:r.actor,editable:r.editable,limited:r.limited,owner:r.owner},a=this.actor.prepareSheet({details:this.openDetails}),mergeObject(o.actor,a),o.sizeCategories=d.Z.sizeCategories,o.isGM=game.user.isGM,o.initDies={"":"-","1d6":"1d6","2d6":"2d6","3d6":"3d6","4d6":"4d6"},u.Z.prepareActiveEffects(this.actor,o),i.next=12,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.owner"),{secrets:!0,async:!0});case 12:return o.enrichedOwnerdescription=i.sent,i.next=15,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.gm"),{secrets:!0,async:!0});case 15:return o.enrichedGmdescription=i.sent,i.next=18,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.description"),{secrets:!0,async:!0});case 18:return o.enrichedNotes=i.sent,i.next=21,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.biography"),{secrets:!0,async:!0});case 21:return o.enrichedBiography=i.sent,i.abrupt("return",o);case 23:case"end":return i.stop()}}),_callee3,this)}))),function getData(t){return j.apply(this,arguments)})},{key:"_openLibrary",value:(D=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee4(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:game.dsk.itemLibrary.render(!0);case 1:case"end":return t.stop()}}),_callee4)}))),function _openLibrary(){return D.apply(this,arguments)})},{key:"_configActor",value:(L=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee5(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:i.buildDialog(this.actor);case 1:case"end":return t.stop()}}),_callee5,this)}))),function _configActor(){return L.apply(this,arguments)})},{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r,o,a=this,i=actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"_getHeaderButtons",this).call(this);return i.unshift({class:"library",icon:"fas fa-university",onclick:(t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee6(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a._openLibrary());case 1:case"end":return t.stop()}}),_callee6)}))),function onclick(){return t.apply(this,arguments)})}),this.actor.isOwner&&i.unshift({class:"actorConfig",icon:"fas fa-link",onclick:(r=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee7(){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",a._configActor());case 1:case"end":return t.stop()}}),_callee7)}))),function onclick(){return r.apply(this,arguments)})}),this.actor.system.canAdvance&&i.unshift({class:"locksheet",icon:"fas fa-".concat(this.actor.system.sheetLocked?"":"un","lock"),onclick:(o=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee8(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",a._changeAdvanceLock(t));case 1:case"end":return r.stop()}}),_callee8)}))),function onclick(t){return o.apply(this,arguments)})}),i}},{key:"_changeAdvanceLock",value:(G=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee9(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee9$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.actor.update({"system.sheetLocked":!this.actor.system.sheetLocked});case 2:$(t.currentTarget).find("i").toggleClass("fa-unlock fa-lock");case 3:case"end":return r.stop()}}),_callee9,this)}))),function _changeAdvanceLock(t){return G.apply(this,arguments)})},{key:"showLimited",value:function showLimited(){return!game.user.isGM&&this.actor.limited}},{key:"getTokenId",value:function getTokenId(){return this.token?this.token.id:void 0}},{key:"activateListeners",value:function activateListeners(o){var a=this;actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK.prototype),"activateListeners",this).call(this,o);var i=function posthand(t){a.actor.items.get(a._getItemId(t)).postItem()};o.find(".schip").click((function(t){t.preventDefault();var r=Number(t.currentTarget.getAttribute("data-val")),o=$(a.form).parent().find('[name="system.stats.schips.value"]');1==r&&1==$(a.form).find(".fullSchip").length&&(r=0),o.val(r),o.trigger("change")})),o.find(".swapWeaponHand").click((function(t){return a.swapWeaponHand(t)})),o.find(".loadWeapon").mousedown(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee10(t){var o,i,c,u;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee10$(l){for(;;)switch(l.prev=l.next){case 0:if(o=a._getItemId(t),i=a.actor.items.get(o).toObject(),""!==getProperty(i,"system.currentAmmo")){l.next=4;break}return l.abrupt("return");case 4:return c={_id:o},0==t.button?(u="trait"==i.type?i.system.lz:r.Z.calcLZ(i,a.actor),c["system.reloadTimeprogress"]=Math.min(i.system.reloadTimeprogress+1,u)):2==t.button&&(c["system.reloadTimeprogress"]=0),l.next=8,a.actor.updateEmbeddedDocuments("Item",[c]);case 8:case"end":return l.stop()}}),_callee10)})));return function(r){return t.apply(this,arguments)}}()),o.find(".item-swapMag").click(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee11(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.actor.swapMag(a._getItemId(t));case 2:case"end":return r.stop()}}),_callee11)})));return function(r){return t.apply(this,arguments)}}()),o.find(".ammo-selector").change(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee12(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:return t.preventDefault(),r=a._getItemId(t),o.next=4,a.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.currentAmmo":$(t.currentTarget).val()}]);case 4:case"end":return o.stop()}}),_callee12)})));return function(r){return t.apply(this,arguments)}}()),o.find(".condition-edit").click((function(t){a.actor.effects.get($(t.currentTarget).attr("data-id")).sheet.render(!0)})),o.find(".ch-collapse").click((function(t){$(t.currentTarget).find("i").toggleClass("fa-angle-up fa-angle-down"),$(t.currentTarget).closest(".groupbox").find(".row-section:nth-child(2)").fadeToggle()})),o.find(".item-toggle").click((function(t){var r=a._getItemId(t),o=a.actor.items.get(r).toObject();switch(o.type){case"armor":case"rangeweapon":case"meleeweapon":case"equipment":a.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.worn.value":!o.system.worn.value}]),h.Z.playEquipmentWearStatusChange(o)}})),o.find(".status-create").click((function(t){var r=$(t.currentTarget).closest(".statusEffectMenu").find("ul");r.fadeIn("fast",(function(){r.find("input").focus()}))})),o.find(".statusEffectMenu ul").mouseleave((function(t){return $(t.currentTarget).fadeOut()})),o.find(".status-add").click(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee13(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:if("custom"!=(r=$(t.currentTarget).attr("data-id"))){o.next=5;break}u.Z.createCustomEffect(a.actor),o.next=7;break;case 5:return o.next=7,a.actor.addCondition(r,1,!1,!1);case 7:case"end":return o.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}()),o.find(".skill-select").mousedown((function(t){var r=a._getItemId(t),o=a.actor.items.get(r);0==t.button?a.actor.setupSkill(o,{},a.getTokenId()).then((function(t){a.actor.basicTest(t)})):2==t.button&&o.sheet.render(!0)})),o.find(".advance-attribute").mousedown((function(t){return a.advanceWrapper(t,"_advanceAttribute",$(t.currentTarget).attr("data-attr"))})),o.find(".refund-attribute").mousedown((function(t){return a.advanceWrapper(t,"_refundAttributeAdvance",$(t.currentTarget).attr("data-attr"))})),o.find(".advance-item").mousedown((function(t){return a.advanceWrapper(t,"_advanceItem",a._getItemId(t))})),o.find(".refund-item").mousedown((function(t){return a.advanceWrapper(t,"_refundItemAdvance",a._getItemId(t))})),o.find(".advance-points").mousedown((function(t){return a.advanceWrapper(t,"_advancePoints",$(t.currentTarget).attr("data-attr"))})),o.find(".refund-points").mousedown((function(t){return a.advanceWrapper(t,"_refundPointsAdvance",$(t.currentTarget).attr("data-attr"))})),o.find(".spell-select").mousedown((function(t){var r=a._getItemId(t),o=a.actor.items.get(r);0==t.button?a.actor.setupSpell(o,{},a.getTokenId()).then((function(t){return a.actor.basicTest(t)})):2==t.button&&o.sheet.render(!0)})),o.find(".quantity-click").mousedown((function(t){var r=a._getItemId(t),o=a.actor.items.get(r).toObject();y.Z.increment(t,o,"system.quantity",0),a.actor.updateEmbeddedDocuments("Item",[o])})),o.find(".item-post").click((function(t){return i(t)})),o.find(".item-dropdown").click((function(t){t.preventDefault(),$(t.currentTarget).closest(".item").find(".expandDetails:first").toggleClass("shown")})),o.find(".condition-show").mousedown((function(t){t.preventDefault();var r=t.currentTarget.dataset.id,o=$(t.currentTarget).parents(".statusEffect").attr("data-descriptor");if(0==t.button){var i=$(t.currentTarget).parents(".statusEffect").attr("data-origin");if(i)fromUuid(i).then((function(t){return t.sheet.render(!0)}));else{var c,u;o?(c=CONFIG.statusEffects.find((function(t){return t.id==o})),u=$('<div style="padding:5px;"><b><a class="chat-condition chatButton" data-id="'.concat(c.id,'"><img src="').concat(c.icon,'"/>').concat(game.i18n.localize(c.label),"</a></b>: ").concat(game.i18n.localize(c.description),"</div>"))):(c=a.actor.effects.find((function(t){return t.id==r})))&&(u=$('<div style="padding:5px;"><b><a class="chat-condition chatButton" data-id="'.concat(c.id,'"><img src="').concat(c.icon,'"/>').concat(game.i18n.localize(c.label),"</a></b>: ").concat(game.i18n.localize(c.flags.dsk.description),"</div>")));var l=$(t.currentTarget).closest(".groupbox").find(".effectDescription");l.fadeOut("fast",(function(){l.html(u).fadeIn("fast")}))}}else 2!=t.button||t.currentTarget.dataset.locked||a._deleteActiveEffect(r)})),o.on("click",".chat-condition",(function(t){return p.Z.postStatus($(t.currentTarget).attr("data-id"))})),o.find(".skill-advances").change(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee14(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return r=a._getItemId(t),o.next=3,a.actor.updateEmbeddedDocuments("Item",[{_id:r,"system.level":Number(t.target.value)}]);case 3:case"end":return o.stop()}}),_callee14)})));return function(r){return t.apply(this,arguments)}}()),o.find(".item-edit").click((function(t){t.preventDefault();var r=a._getItemId(t);a.actor.items.get(r).sheet.render(!0)})),o.find(".disableRegeneration").click((function(t){var r=t.currentTarget.dataset.type,o="system.repeatingEffects.disabled.".concat(r);a.actor.update(function _defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}({},o,!getProperty(a.actor,o)))})),o.find(".consume-item").mousedown((function(t){if(2==t.button){var r=a._getItemId(t),o=a.actor.items.get(r);a.consumeItem(o)}})),o.find(".ch-value").click((function(t){t.preventDefault();var r=t.currentTarget.attributes["data-char"].value;a.actor.setupCharacteristic(r,{},a.getTokenId()).then((function(t){return a.actor.basicTest(t)}))})),o.find(".ch-regenerate").click((function(t){t.preventDefault(),a.actor.setupRegeneration("regenerate",{},a.getTokenId()).then((function(t){return a.actor.basicTest(t)}))})),o.find(".item-create").click((function(t){return a._onItemCreate(t)})),o.find(".ch-rollCombat").click((function(t){t.preventDefault();var r=a._getItemId(t),o=$(t.currentTarget).attr("data-mode"),i=a.actor.items.get(r);a.actor.setupWeapon(i,o,{},a.getTokenId()).then((function(t){return a.actor.basicTest(t)}))}));var c=function deletehand(t){return a._deleteItem(t)};o.find(".onUseItem").click((function(t){return a._onMacroUseItem(t)})),o.find(".cards .item").mouseenter((function(t){if(0==t.currentTarget.getElementsByClassName("hovermenu").length){var r=document.createElement("div");r.classList.add("hovermenu");var o=document.createElement("i");o.classList.add("fas","fa-times"),o.title=game.i18n.localize("dsk.SHEET.DeleteItem"),o.addEventListener("click",c,!1);var a=document.createElement("i");a.classList.add("fas","fa-comment"),a.title=game.i18n.localize("dsk.SHEET.PostItem"),a.addEventListener("click",i,!1),r.appendChild(a),r.appendChild(o),t.currentTarget.appendChild(r)}})),o.find(".cards .item").mouseleave((function(t){var r=t.toElement||t.relatedTarget;r&&r.parentNode!=a&&r!=a&&t.currentTarget.querySelectorAll(".hovermenu").forEach((function(t){return t.remove()}))}));var d=this.actor.uuid;o.find(".actorDrag").each((function(t,r){r.setAttribute("draggable",!0),r.addEventListener("dragstart",(function(t){var r={type:"Actor",uuid:d};t.dataTransfer.setData("text/plain",JSON.stringify(r))}))})),o.find(".item-delete").click((function(t){return a._deleteItem(t)})),o.find(".filterTalents").click((function(t){$(t.currentTarget).closest(".content").find(".allTalents").toggleClass("showAll"),$(t.currentTarget).toggleClass("filtered")})),o.find(".condition-value").mousedown(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee15(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:if(r=$(t.currentTarget).parents(".statusEffect").attr("data-descriptor"),0!=t.button){o.next=6;break}return o.next=4,a.actor.addCondition(r,1,!1,!1);case 4:o.next=9;break;case 6:if(2!=t.button){o.next=9;break}return o.next=9,a.actor.removeCondition(r,1,!1);case 9:case"end":return o.stop()}}),_callee15)})));return function(r){return t.apply(this,arguments)}}()),o.find(".condition-toggle").mousedown(function(){var t=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee16(t){var r,o;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee16$(i){for(;;)switch(i.prev=i.next){case 0:if(a.isEditable){i.next=2;break}return i.abrupt("return");case 2:return r=$(t.currentTarget).parents(".statusEffect").attr("data-id"),o=a.actor.effects.get(r),i.next=6,o.update({disabled:!o.disabled});case 6:case"end":return i.stop()}}),_callee16)})));return function(r){return t.apply(this,arguments)}}()),o.find(".charimg").mousedown((function(r){2==r.button&&t.Z.showArtwork(a.actor,!0)})),l.Z.bindRollCommands(o);var m=o.find(".talentSearch");m.keyup((function(t){return a._filterTalents($(t.currentTarget))})),m[0]&&m[0].addEventListener("search",(function filterTalents(t){return a._filterTalents($(t.currentTarget))}),!1);var g=o.find(".conditionSearch");g.keyup((function(t){return a._filterConditions($(t.currentTarget))})),g[0]&&g[0].addEventListener("search",(function filterConditions(t){return a._filterConditions($(t.currentTarget))}),!1);var v=o.find(".gearSearch");v.keyup((function(t){return a._filterGear($(t.currentTarget))})),v[0]&&v[0].addEventListener("search",(function filterGear(t){return a._filterGear($(t.currentTarget))}),!1),bindImgToCanvasDragStart(o,"img.charimg")}},{key:"advanceWrapper",value:(R=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee17(t,r,o){var a,i;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:if(a=$(t.currentTarget),(i=a.find("i")).hasClass("fa-spin")){c.next=7;break}return i.addClass("fa-spin fa-spinner"),c.next=6,this[r](o);case 6:i.removeClass("fa-spin fa-spinner");case 7:case"end":return c.stop()}}),_callee17,this)}))),function advanceWrapper(t,r,o){return R.apply(this,arguments)})},{key:"_onItemCreate",value:function _onItemCreate(r){r.preventDefault();var a=r.currentTarget,i=duplicate(a.dataset);d.Z.equipmentTypes[i.type]&&(i.type="equipment",i=mergeObject(i,{"system.category":r.currentTarget.attributes["item-section"].value,"system.effect":""})),["aggregatedTest","ahnengabe"].includes(i.type)||(i["system.weight"]=0,i["system.quantity"]=0),o.Z.defaultIcon(i),i.name=t.Z.categoryLocalization(i.type),this.actor.createEmbeddedDocuments("Item",[i])}},{key:"_onMacroUseItem",value:function _onMacroUseItem(t){var r=this.actor.items.get(this._getItemId(t));new OnUseEffect(r).executeOnUseEffect()}},{key:"_filterGear",value:function _filterGear(t){if(null!=t.val()){var r=t.val().toLowerCase().trim(),o=$(this.element).find(".inventory .item");o.removeClass("filterHide"),o.filter((function(){return-1==$(this).find("a.item-edit").text().toLowerCase().trim().indexOf(r)})).addClass("filterHide")}}},{key:"_filterTalents",value:function _filterTalents(t){if(null!=t.val()){var r=t.val().toLowerCase().trim(),o=$(this.form).parent().find(".allTalents");o.find(".item, .table-header, .table-title").removeClass("filterHide"),o.addClass("showAll").find(".item").filter((function(){return-1==$(this).find(".talentName").text().toLowerCase().trim().indexOf(r)})).addClass("filterHide"),r.length>0?(o.find(".table-header, .table-title:not(:eq(0))").addClass("filterHide"),o.addClass("filterfull")):o.removeClass("filterfull")}}},{key:"_filterConditions",value:function _filterConditions(t){if(null!=t.val()){var r=t.val().toLowerCase().trim(),o=$(this.form).find(".statusEffectMenu li:not(.search)");o.removeClass("filterHide"),o.filter((function(){return-1==$(this).find("a").attr("data-tooltip").toLowerCase().trim().indexOf(r)})).addClass("filterHide")}}},{key:"_deleteActiveEffect",value:(A=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee18(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:if(this.isEditable){o.next=2;break}return o.abrupt("return");case 2:if(!(r=this.actor.effects.find((function(r){return r.id==t})))){o.next=8;break}if(!(this.token?this.token.actor:this.actor)){o.next=8;break}return o.next=8,this.actor.deleteEmbeddedDocuments("ActiveEffect",[r.id]);case 8:case"end":return o.stop()}}),_callee18,this)}))),function _deleteActiveEffect(t){return A.apply(this,arguments)})},{key:"_deleteItem",value:function _deleteItem(t){var r=this;if(this.isEditable){var o=this._getItemId(t),a=this.actor.items.get(o),i=game.i18n.format("dsk.DIALOG.DeleteItemDetail",{item:a.name});renderTemplate("systems/dsk/templates/dialog/delete-item-dialog.html",{message:i}).then((function(t){new Dialog({title:game.i18n.localize("dsk.DIALOG.deleteConfirmation"),content:t,buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){return r._cleverDeleteItem(o)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},default:"Yes"}).render(!0)}))}}},{key:"_addVantage",value:(C=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee19(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee19$(o){for(;;)switch(o.prev=o.next){case 0:m.Z.needsAdoption(this.actor,t,r);case 1:case"end":return o.stop()}}),_callee19,this)}))),function _addVantage(t,r){return C.apply(this,arguments)})},{key:"_addSpecialAbility",value:(E=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee20(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee20$(o){for(;;)switch(o.prev=o.next){case 0:g.Z.needsAdoption(this.actor,t,r);case 1:case"end":return o.stop()}}),_callee20,this)}))),function _addSpecialAbility(t,r){return E.apply(this,arguments)})},{key:"_cleverDeleteItem",value:(I=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee21(r){var o,a,i,c,u,l,p;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee21$(d){for(;;)switch(d.prev=d.next){case 0:o=this.actor.items.get(r),a=[r],d.t0=o.type,d.next="advantage"===d.t0||"disadvantage"===d.t0?5:"specialability"===d.t0?12:"ahnengeschenk"===d.t0?15:"ahnengabe"===d.t0?18:23;break;case 5:return d.next=7,m.Z.vantageRemoved(this.actor,o);case 7:if(i=o.system.ap*o.system.level,/;/.test(o.system.ap))for(c=o.system.ap.split(";").map((function(t){return Number(t.trim())})),i=0,u=0;u<o.system.level;u++)i+=c[u];return d.next=11,this._updateAPs(-1*i);case 11:case 14:case 17:case 22:return d.abrupt("break",23);case 12:return d.next=14,g.Z.abilityRemoved(this.actor,o);case 15:return d.next=17,this._updateAPs(-1);case 18:for(l=0,p=0;p<=o.system.level;p++)l+=t.Z._calculateAdvCost(p,o.system.StF,0);return d.next=22,this._updateAPs(-1*l);case 23:return d.next=25,this.actor.deleteEmbeddedDocuments("Item",a);case 25:case"end":return d.stop()}}),_callee21,this)}))),function _cleverDeleteItem(t){return I.apply(this,arguments)})},{key:"_getItemId",value:function _getItemId(t){return $(t.currentTarget).parents(".item").attr("data-item-id")}},{key:"_onDragStart",value:function _onDragStart(t){var r=t.currentTarget;if(!t.target.classList.contains("content-link")){var o;if(r.dataset.itemId)o=this.actor.items.get(r.dataset.itemId).toDragData(),r.dataset.mod&&(o.mod=r.dataset.mod);if(r.dataset.id)o=this.actor.effects.get(r.dataset.id).toDragData();o&&t.dataTransfer.setData("text/plain",JSON.stringify(o))}}},{key:"_addUniqueItem",value:(T=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee22(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee22$(r){for(;;)switch(r.prev=r.next){case 0:if(t=duplicate(t),this.actor.items.some((function(r){return o.Z.areEquals(t,r)}))){r.next=5;break}return r.next=4,this.actor.createEmbeddedDocuments("Item",[t]);case 4:return r.abrupt("return",r.sent[0]);case 5:case"end":return r.stop()}}),_callee22,this)}))),function _addUniqueItem(t){return T.apply(this,arguments)})},{key:"handleItemCopy",value:(P=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee23(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:if(!d.Z.equipmentCategories.includes(r)){o.next=5;break}return t.name+=" (Copy)",o.next=4,this._addLoot(t);case 4:return o.abrupt("return",o.sent);case 5:case"end":return o.stop()}}),_callee23,this)}))),function handleItemCopy(t,r){return P.apply(this,arguments)})},{key:"_addLoot",value:(S=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee24(t){var r;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:if(t=duplicate(t),r=this.actor.items.find((function(r){return o.Z.areEquals(t,r)}))){a.next=9;break}return"combat"==this._tabs[0].active&&t.system.worn&&(t.system.worn.value=!0),a.next=6,this.actor.createEmbeddedDocuments("Item",[t]);case 6:case 11:return a.abrupt("return",a.sent[0]);case 9:return a.next=11,o.Z.stackItems(r,t,this.actor);case 12:case"end":return a.stop()}}),_callee24,this)}))),function _addLoot(t){return S.apply(this,arguments)})},{key:"_manageDragItems",value:(O=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee25(t,r){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee25$(o){for(;;)switch(o.prev=o.next){case 0:o.t0=r,o.next="meleeweapon"===o.t0||"rangeweapon"===o.t0||"equipment"===o.t0||"ammunition"===o.t0||"armor"===o.t0||"poison"===o.t0?3:"disadvantage"===o.t0||"advantage"===o.t0?7:"specialability"===o.t0?10:"information"===o.t0||"skill"===o.t0?13:"ahnengabe"===o.t0||"ahnengeschenk"===o.t0?16:"effectwrapper"===o.t0?19:22;break;case 3:return o.next=5,this._addLoot(t);case 5:return o.abrupt("return",o.sent);case 7:return o.next=9,this._addVantage(t,r);case 9:return o.abrupt("break",23);case 10:return o.next=12,this._addSpecialAbility(t,r);case 12:return o.abrupt("break",23);case 13:return o.next=15,this._addUniqueItem(t);case 15:return o.abrupt("break",23);case 16:return o.next=18,this._addSpellOrLiturgy(t);case 18:return o.abrupt("break",23);case 19:return o.next=21,this._handleEffectWrapper(t);case 21:return o.abrupt("break",23);case 22:ui.notifications.error(game.i18n.format("dsk.DSKError.canNotBeAdded",{item:t.name,category:game.i18n.localize(t.type)}));case 23:case"end":return o.stop()}}),_callee25,this)}))),function _manageDragItems(t,r){return O.apply(this,arguments)})},{key:"_updateAPs",value:(x=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee26(t){var r,o=arguments;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},a.next=3,this.actor._updateAPs(t,r);case 3:case"end":return a.stop()}}),_callee26,this)}))),function _updateAPs(t){return x.apply(this,arguments)})},{key:"_addSpellOrLiturgy",value:(w=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee27(r){var o,a;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee27$(i){for(;;)switch(i.prev=i.next){case 0:if(o=this.actor.items.find((function(t){return t.type==r.type&&t.name==r.name})),r=duplicate(r),o){i.next=18;break}i.t0=r.type,i.next="ahnengabe"===i.t0?6:"ahnengeschenk"===i.t0?8:10;break;case 6:return a=t.Z._calculateAdvCost(0,r.system.StF,0),i.abrupt("break",11);case 8:return a=1,i.abrupt("break",11);case 10:return i.abrupt("return");case 11:return i.next=13,this.actor.checkEnoughXP(a);case 13:if(!i.sent){i.next=18;break}return i.next=16,this._updateAPs(a);case 16:return i.next=18,this.actor.createEmbeddedDocuments("Item",[r]);case 18:case"end":return i.stop()}}),_callee27,this)}))),function _addSpellOrLiturgy(t){return w.apply(this,arguments)})},{key:"_handleEffectWrapper",value:(k=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee28(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee28$(r){for(;;)switch(r.prev=r.next){case 0:this.actor.createEmbeddedDocuments("ActiveEffect",t.effects.map((function(t){return t.origin=null,t})));case 1:case"end":return r.stop()}}),_callee28,this)}))),function _handleEffectWrapper(t){return k.apply(this,arguments)})},{key:"_onDropItemCreate",value:(b=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee29(t){return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee29$(r){for(;;)switch(r.prev=r.next){case 0:if(!(t instanceof Array)){r.next=2;break}return r.abrupt("return",this.actor.createEmbeddedDocuments("Item",t));case 2:return r.next=4,this._manageDragItems(t,t.type);case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}),_callee29,this)}))),function _onDropItemCreate(t){return b.apply(this,arguments)})},{key:"_onDropActor",value:(_=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee30(t,r){var o,a,i;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee30$(t){for(;;)switch(t.prev=t.next){case 0:if(this.actor.isOwner){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,itemFromDrop(r,this.id,!1);case 4:if(o=t.sent,a=o.item,i=o.typeClass,!o.selfTarget){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,this._manageDragItems(a,i);case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),_callee30,this)}))),function _onDropActor(t,r){return _.apply(this,arguments)})},{key:"_onDropActiveEffect",value:(v=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee31(t,r){var o,a,i;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee31$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ActiveEffect.implementation.fromDropData(r);case 2:if(a=t.sent,this.actor.isOwner&&a){t.next=5;break}return t.abrupt("return",!1);case 5:if(this.actor.uuid!==(null===(o=a.parent)||void 0===o?void 0:o.uuid)){t.next=7;break}return t.abrupt("return",!1);case 7:return(i=a.toObject()).origin=this.actor.uuid,t.abrupt("return",ActiveEffect.create(i,{parent:this.actor}));case 10:case"end":return t.stop()}}),_callee31,this)}))),function _onDropActiveEffect(t,r){return v.apply(this,arguments)})},{key:"_onDropItem",value:(c=actor_sheet_dsk_asyncToGenerator(actor_sheet_dsk_regeneratorRuntime().mark((function _callee32(t,r){var o,a,i,c,u,l,p;return actor_sheet_dsk_regeneratorRuntime().wrap((function _callee32$(h){for(;;)switch(h.prev=h.next){case 0:if(this.actor.isOwner){h.next=2;break}return h.abrupt("return",!1);case 2:return h.next=4,Item.implementation.fromDropData(r);case 4:if(a=h.sent,i=a.toObject(),y.Z.obfuscateDropData(i,r.tabsinvisible),(u=$(t.target).parents(".item"))&&"bags"==u.attr("data-category")&&d.Z.equipmentCategories.includes(a.type)&&u.attr("data-item-id")!=a.id&&(c=u.attr("data-item-id")),!(l=this.actor.uuid===(null===(o=a.parent)||void 0===o?void 0:o.uuid))){h.next=28;break}if(!t.ctrlKey){h.next=16;break}return h.next=14,this.handleItemCopy(i,a.type);case 14:case 21:h.next=26;break;case 16:if(!c){h.next=23;break}return p={_id:a.id,"system.parent_id":c},a.system.worn&&a.system.worn.value&&(p["system.worn.value"]=!1),h.next=21,this.actor.updateEmbeddedDocuments("Item",[p]);case 23:if(!d.Z.equipmentCategories.includes(a.type)){h.next=26;break}return h.next=26,this.actor.updateEmbeddedDocuments("Item",[{_id:a.id,system:{parent_id:0}}]);case 26:h.next=30;break;case 28:return h.next=30,this._onDropItemCreate(i);case 30:if(!t.altKey||l||!d.Z.equipmentCategories.includes(a.type)){h.next=33;break}return h.next=33,this._handleRemoveSourceOnDrop(a);case 33:case"end":return h.stop()}}),_callee32,this)}))),function _onDropItem(t,r){return c.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_dsk_get(actor_sheet_dsk_getPrototypeOf(ActorSheetDSK),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"skills"}],mergeObject(t,{width:770,height:740,scrollY:[".save-scroll"],dragDrop:[{dragSelector:".content .item",dropSelector:null},{dragSelector:".mainEffects .statusEffect",dropSelector:null}]}),t}}]),ActorSheetDSK}(),_=__webpack_require__(707);function obfuscatemixin_typeof(t){return obfuscatemixin_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},obfuscatemixin_typeof(t)}function obfuscatemixin_regeneratorRuntime(){obfuscatemixin_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==obfuscatemixin_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function obfuscatemixin_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function obfuscatemixin_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){obfuscatemixin_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){obfuscatemixin_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function obfuscatemixin_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function obfuscatemixin_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function obfuscatemixin_get(){return obfuscatemixin_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=obfuscatemixin_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},obfuscatemixin_get.apply(this,arguments)}function obfuscatemixin_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=obfuscatemixin_getPrototypeOf(t)););return t}function obfuscatemixin_setPrototypeOf(t,r){return obfuscatemixin_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},obfuscatemixin_setPrototypeOf(t,r)}function obfuscatemixin_createSuper(t){var r=function obfuscatemixin_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=obfuscatemixin_getPrototypeOf(t);if(r){var i=obfuscatemixin_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return obfuscatemixin_possibleConstructorReturn(this,o)}}function obfuscatemixin_possibleConstructorReturn(t,r){if(r&&("object"===obfuscatemixin_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function obfuscatemixin_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function obfuscatemixin_getPrototypeOf(t){return obfuscatemixin_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},obfuscatemixin_getPrototypeOf(t)}var b=function ItemSheetObfuscation(t){return function(t){!function obfuscatemixin_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&obfuscatemixin_setPrototypeOf(t,r)}(_class,t);var r,o,a=obfuscatemixin_createSuper(_class);function _class(){return obfuscatemixin_classCallCheck(this,_class),a.apply(this,arguments)}return function obfuscatemixin_createClass(t,r,o){return r&&obfuscatemixin_defineProperties(t.prototype,r),o&&obfuscatemixin_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(_class,[{key:"obfuscateItem",value:(o=obfuscatemixin_asyncToGenerator(obfuscatemixin_regeneratorRuntime().mark((function _callee(t){var r;return obfuscatemixin_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return t.stopPropagation(),t.preventDefault(),r=t.currentTarget.dataset.obfuscate,o.next=5,this.item.update((a={},i="system.obfuscation.".concat(r),c=!this.isObfuscated(r),i in a?Object.defineProperty(a,i,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[i]=c,a));case 5:case"end":return o.stop()}var a,i,c}),_callee,this)}))),function obfuscateItem(t){return o.apply(this,arguments)})},{key:"isObfuscated",value:function isObfuscated(t){return getProperty(this.item,"system.obfuscation.".concat(t))}},{key:"activateListeners",value:function activateListeners(t){var r=this;obfuscatemixin_get(obfuscatemixin_getPrototypeOf(_class.prototype),"activateListeners",this).call(this,t),t.on("click",".obfuscateSection",(function(t){return r.obfuscateItem(t)}))}},{key:"obfuscationCss",value:function obfuscationCss(t){return this.isObfuscated(t)?"":" pale"}},{key:"_render",value:(r=obfuscatemixin_asyncToGenerator(obfuscatemixin_regeneratorRuntime().mark((function _callee2(){var t,r,o,a,i,c,u,l,p,d,h,y,m,g,v=arguments;return obfuscatemixin_regeneratorRuntime().wrap((function _callee2$(_){for(;;)switch(_.prev=_.next){case 0:return t=v.length>0&&void 0!==v[0]&&v[0],r=v.length>1&&void 0!==v[1]?v[1]:{},_.next=4,obfuscatemixin_get(obfuscatemixin_getPrototypeOf(_class.prototype),"_render",this).call(this,t,r);case 4:o=!1,a=0,i=["details","effects","description","enchantment"];case 7:if(!(a<i.length)){_.next=18;break}if(c=i[a],(u=$(this._element).find('nav [data-tab="'.concat(c,'"]'))).length){_.next=12;break}return _.abrupt("continue",15);case 12:l=r.tabsinvisible||this.isObfuscated(c),p=game.i18n.localize("dsk.SHEET.".concat(l?"deobfuscateItem":"obfuscateItem")),game.user.isGM?(d="obfuscateSection".concat(this.obfuscationCss(c)),h=u.find(".".concat(d)),y='<a data-tooltip="'.concat(p,'" class="obfuscationBtn ').concat(d,'" data-obfuscate="').concat(c,'"><i class="fas fa-mask"></i></a>'),h.length?h.replaceWith(y):u.append(" ".concat(y))):l&&(u.hasClass("active")&&(o=!0),u.remove(),"details"==c&&$(this._element).find('[name="system.price"]').replaceWith("<label>?</label>"));case 15:a++,_.next=7;break;case 18:if(!o){_.next=28;break}if(!(m=$(this._element).find("nav .item:first-child")).length){_.next=24;break}this.activateTab(m.attr("data-tab")),_.next=28;break;case 24:return _.next=26,renderTemplate("systems/dsk/templates/items/obfuscatedItem.html",{item:this.item});case 26:g=_.sent,$(this._element).find(".content").html(g);case 28:case"end":return _.stop()}}),_callee2,this)}))),function _render(){return r.apply(this,arguments)})}]),_class}(t)};function item_sheet_dsk_typeof(t){return item_sheet_dsk_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},item_sheet_dsk_typeof(t)}function item_sheet_dsk_regeneratorRuntime(){item_sheet_dsk_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==item_sheet_dsk_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function item_sheet_dsk_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function item_sheet_dsk_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){item_sheet_dsk_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){item_sheet_dsk_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function item_sheet_dsk_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function item_sheet_dsk_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function item_sheet_dsk_createClass(t,r,o){return r&&item_sheet_dsk_defineProperties(t.prototype,r),o&&item_sheet_dsk_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function item_sheet_dsk_get(){return item_sheet_dsk_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=item_sheet_dsk_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},item_sheet_dsk_get.apply(this,arguments)}function item_sheet_dsk_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=item_sheet_dsk_getPrototypeOf(t)););return t}function item_sheet_dsk_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&item_sheet_dsk_setPrototypeOf(t,r)}function item_sheet_dsk_setPrototypeOf(t,r){return item_sheet_dsk_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},item_sheet_dsk_setPrototypeOf(t,r)}function item_sheet_dsk_createSuper(t){var r=function item_sheet_dsk_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=item_sheet_dsk_getPrototypeOf(t);if(r){var i=item_sheet_dsk_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return item_sheet_dsk_possibleConstructorReturn(this,o)}}function item_sheet_dsk_possibleConstructorReturn(t,r){if(r&&("object"===item_sheet_dsk_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function item_sheet_dsk_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function item_sheet_dsk_getPrototypeOf(t){return item_sheet_dsk_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},item_sheet_dsk_getPrototypeOf(t)}var k=function(r){item_sheet_dsk_inherits(ItemSheetDSK,ItemSheet);var o,a,i=item_sheet_dsk_createSuper(ItemSheetDSK);function ItemSheetDSK(){return item_sheet_dsk_classCallCheck(this,ItemSheetDSK),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetDSK,[{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,o=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK.prototype),"_getHeaderButtons",this).call(this);return o.unshift({class:"showItemHead",icon:"fas fa-comment",onclick:(t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee(){return item_sheet_dsk_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.item.postItem());case 1:case"end":return t.stop()}}),_callee)}))),function onclick(){return t.apply(this,arguments)})}),o}},{key:"template",get:function get(){return"systems/dsk/templates/items/item-".concat(this.item.type,"-sheet.html")}},{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee2(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return r=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK.prototype),"getData",this).call(this,t).data,o.t0=mergeObject,o.t1=r,o.t2=this.item.actor,o.t3=this.isEditable,o.t4=this.item,o.t5=game.user.isGM,o.next=9,TextEditor.enrichHTML(getProperty(this.item.system,"description.value"),{secrets:!0,async:!0});case 9:return o.t6=o.sent,o.next=12,TextEditor.enrichHTML(getProperty(this.item.system,"description.gminfo"),{secrets:!0,async:!0});case 12:return o.t7=o.sent,o.t8={isOwned:o.t2,editable:o.t3,item:o.t4,isGM:o.t5,enrichedDescription:o.t6,enrichedGmdescription:o.t7},(0,o.t0)(o.t1,o.t8),u.Z.prepareActiveEffects(this.item,r),o.abrupt("return",r);case 17:case"end":return o.stop()}}),_callee2,this)}))),function getData(t){return a.apply(this,arguments)})},{key:"advanceWrapper",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee3(t,r){var o,a;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:if(o=$(t.currentTarget),(a=o.find("i")).hasClass("fa-spin")){i.next=7;break}return a.addClass("fa-spin fa-spinner"),i.next=6,this[r]();case 6:a.removeClass("fa-spin fa-spinner");case 7:case"end":return i.stop()}}),_callee3,this)}))),function advanceWrapper(t,r){return o.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(r){var o=this;item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK.prototype),"activateListeners",this).call(this,r),r.find(".advance-step").mousedown((function(t){return o.advanceWrapper(t,"_advanceStep")})),r.find(".refund-step").mousedown((function(t){return o.advanceWrapper(t,"_refundStep")})),r.find('[data-edit="img"]').mousedown((function(r){2==r.button&&t.Z.showArtwork(o.item)})),r.find(".status-add").click((function(){o.item.actor?ui.notifications.error(game.i18n.localize("dsk.DSKError.nestedEffectNotSupported")):u.Z.createCustomEffect(o.item,"",o.item.name)})),r.find(".condition-show").mousedown((function(t){t.preventDefault();var r=$(t.currentTarget).attr("data-id");0==t.button?o.item.effects.get(r).sheet.render(!0):2==t.button&&o.item.deleteEmbeddedDocuments("ActiveEffect",[r])})),r.find(".condition-toggle").mousedown((function(t){var r=$(t.currentTarget).parents(".statusEffect").attr("data-id"),a=o.item.effects.get(r);a.update({disabled:!a.system.disabled})})),r.find(".condition-edit").click((function(t){o.item.effects.get($(t.currentTarget).attr("data-id")).sheet.render(!0)})),l.Z.bindRollCommands(r),u.Z.bindButtons(r);var a=r.find(".item-header");if(a.length){var i=a.find("svg");if(i){new ResizeObserver((function(t){var r=t[0];(0,_.zJ)(i,r.contentRect.width)})).observe(a.get(0));var c=a.find("input");c.get(0).disabled||(i.click((function(){i.hide(),c.show(),c.focus()})),c.blur((function(){i.show(),c.hide()})))}}}}],[{key:"setupSheets",value:function setupSheets(){Items.unregisterSheet("core",ItemSheet),Items.registerSheet("dsk",S,{makeDefault:!0,types:["meleeweapon"]}),Items.registerSheet("dsk",P,{makeDefault:!0,types:["rangeweapon"]}),Items.registerSheet("dsk",T,{makeDefault:!0,types:["armor"]}),Items.registerSheet("dsk",I,{makeDefault:!0,types:["ammunition"]}),Items.registerSheet("dsk",E,{makeDefault:!0,types:["equipment"]}),Items.registerSheet("dsk",C,{makeDefault:!0,types:["species"]}),Items.registerSheet("dsk",A,{makeDefault:!0,types:["culture"]}),Items.registerSheet("dsk",R,{makeDefault:!0,types:["profession"]}),Items.registerSheet("dsk",G,{makeDefault:!0,types:["advantage"]}),Items.registerSheet("dsk",L,{makeDefault:!0,types:["disadvantage"]}),Items.registerSheet("dsk",D,{makeDefault:!0,types:["specialability"]}),Items.registerSheet("dsk",j,{makeDefault:!0,types:["ahnengeschenk"]}),Items.registerSheet("dsk",M,{makeDefault:!0,types:["ahnengabe"]}),Items.registerSheet("dsk",z,{makeDefault:!0,types:["poison"]}),Items.registerSheet("dsk",N,{makeDefault:!0,types:["skill"]}),Items.registerSheet("dsk",H,{makeDefault:!0,types:["combatskill"]}),Items.registerSheet("dsk",O,{makeDefault:!0,types:["information"]}),Items.registerSheet("dsk",w,{makeDefault:!0,types:["effectwrapper"]}),Items.registerSheet("dsk",x,{makeDefault:!0,types:["trait"]})}},{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetDSK),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content"}],mergeObject(t,{classes:t.classes.concat(["dsk","item"]),width:450,height:500}),t}}]),ItemSheetDSK}(),w=function(t){item_sheet_dsk_inherits(ItemSheetEffectwrapper,t);var r=item_sheet_dsk_createSuper(ItemSheetEffectwrapper);function ItemSheetEffectwrapper(){return item_sheet_dsk_classCallCheck(this,ItemSheetEffectwrapper),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetEffectwrapper)}(k),x=function(t){item_sheet_dsk_inherits(ItemSheetTrait,t);var r,o=item_sheet_dsk_createSuper(ItemSheetTrait);function ItemSheetTrait(){return item_sheet_dsk_classCallCheck(this,ItemSheetTrait),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetTrait,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee4(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetTrait.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{traitCategories:d.Z.traitCategories,ranges:d.Z.meleeRanges}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee4,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetTrait}(k),O=function(r){item_sheet_dsk_inherits(ItemSheetInformation,r);var o,a=item_sheet_dsk_createSuper(ItemSheetInformation);function ItemSheetInformation(){return item_sheet_dsk_classCallCheck(this,ItemSheetInformation),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetInformation,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee5(r){var o;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetInformation.prototype),"getData",this).call(this,r);case 2:return o=a.sent,a.t0=mergeObject,a.t1=o,a.next=7,t.Z.allSkillsList(["skill"]);case 7:return a.t2=a.sent.skills,a.t3={allSkills:a.t2},(0,a.t0)(a.t1,a.t3),a.abrupt("return",o);case 11:case"end":return a.stop()}}),_callee5,this)}))),function getData(t){return o.apply(this,arguments)})}]),ItemSheetInformation}(k),S=function(r){item_sheet_dsk_inherits(ItemSheetMeleeweapon,r);var o,a=item_sheet_dsk_createSuper(ItemSheetMeleeweapon);function ItemSheetMeleeweapon(){return item_sheet_dsk_classCallCheck(this,ItemSheetMeleeweapon),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetMeleeweapon,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee6(r){var o,a,i,c,u,l,p=this;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee6$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetMeleeweapon.prototype),"getData",this).call(this,r);case 2:if(o=h.sent,i="",a=!1){h.next=9;break}i="wrongGrip.yieldTwo",h.next=17;break;case 9:c=game.i18n.localize("LocalizedCTs.".concat(this.item.system.combatskill)),h.t0=c,h.next="Two-Handed Impact Weapons"===h.t0||"Two-Handed Swords"===h.t0?13:16;break;case 13:return u=new RegExp(game.i18n.localize("dsk.wrongGrip.wrongGripBastardRegex")),i=u.test(this.item.name)?"wrongGrip.yieldOneBastard":"wrongGrip.yieldOneSwordBlunt",h.abrupt("break",17);case 16:i="wrongGrip.yieldOnePolearms";case 17:return h.t1=mergeObject,h.t2=o,h.t3=a,h.t4=a?"wrongGrip.oneHanded":"wrongGrip.twoHanded",h.t5=i,h.t6=this.item.system.combatskill==game.i18n.localize("dsk.LocalizedIDs.Shields"),h.next=25,t.Z.allSkillsList(["combatskill"]);case 25:if(h.t7=h.sent.meleeSkills,h.t8=d.Z.meleeRanges,h.t9=d.Z.shieldSizes,h.t10={twoHanded:h.t3,wrongGripLabel:h.t4,wrongGripHint:h.t5,isShield:h.t6,combatskills:h.t7,ranges:h.t8,shieldSizes:h.t9},(0,h.t1)(h.t2,h.t10),this.item.actor&&(l=this.item.actor.items.find((function(t){return"combatskill"==t.type&&t.name==p.item.system.combatskill})),o.canBeOffHand=l&&!l.system.weapontype.twoHanded&&this.item.system.worn.value,o.canBeWrongGrip=!["Daggers","Fencing Weapons"].includes(game.i18n.localize("LocalizedCTs.".concat(this.item.system.combatskill)))),h.t11=game.user.isGM,h.t11){h.next=36;break}return h.next=35,game.settings.get("dsk","playerCanEditSpellMacro");case 35:h.t11=h.sent;case 36:return o.canOnUseEffect=h.t11,h.abrupt("return",o);case 38:case"end":return h.stop()}}),_callee6,this)}))),function getData(t){return o.apply(this,arguments)})}]),ItemSheetMeleeweapon}(b(k)),P=function(r){item_sheet_dsk_inherits(ItemSheetRangeweapon,r);var o,a=item_sheet_dsk_createSuper(ItemSheetRangeweapon);function ItemSheetRangeweapon(){return item_sheet_dsk_classCallCheck(this,ItemSheetRangeweapon),a.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetRangeweapon,[{key:"getData",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee7(r){var o;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetRangeweapon.prototype),"getData",this).call(this,r);case 2:if(o=a.sent,a.t0=mergeObject,a.t1=o,a.t2=game.user.isGM,a.t2){a.next=10;break}return a.next=9,game.settings.get("dsk","playerCanEditSpellMacro");case 9:a.t2=a.sent;case 10:return a.t3=a.t2,a.t4=d.Z.ammunitiongroups,a.next=14,t.Z.allSkillsList(["combatskill"]);case 14:return a.t5=a.sent.rangeSkills,a.t6={canOnUseEffect:a.t3,ammunitiongroups:a.t4,combatskills:a.t5},(0,a.t0)(a.t1,a.t6),a.abrupt("return",o);case 18:case"end":return a.stop()}}),_callee7,this)}))),function getData(t){return o.apply(this,arguments)})}]),ItemSheetRangeweapon}(b(k)),T=function(t){item_sheet_dsk_inherits(ItemSheetArmor,t);var r=item_sheet_dsk_createSuper(ItemSheetArmor);function ItemSheetArmor(){return item_sheet_dsk_classCallCheck(this,ItemSheetArmor),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetArmor)}(b(k)),I=function(t){item_sheet_dsk_inherits(ItemSheetAmmunition,t);var r,o=item_sheet_dsk_createSuper(ItemSheetAmmunition);function ItemSheetAmmunition(){return item_sheet_dsk_classCallCheck(this,ItemSheetAmmunition),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAmmunition,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee8(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAmmunition.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{ammunitiongroups:d.Z.ammunitiongroups}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee8,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetAmmunition}(b(k)),E=function(t){item_sheet_dsk_inherits(ItemSheetEquipment,t);var r,o,a,i=item_sheet_dsk_createSuper(ItemSheetEquipment);function ItemSheetEquipment(){return item_sheet_dsk_classCallCheck(this,ItemSheetEquipment),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetEquipment,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee9(t){var r,o,a=this;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee9$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetEquipment.prototype),"getData",this).call(this,t);case 2:if(r=i.sent,i.t0=mergeObject,i.t1=r,i.t2=d.Z.equipmentTypes,i.t3=game.user.isGM,i.t3){i.next=11;break}return i.next=10,game.settings.get("dsk","playerCanEditSpellMacro");case 10:i.t3=i.sent;case 11:return i.t4=i.t3,i.t5={equipmentTypes:i.t2,canOnUseEffect:i.t4},(0,i.t0)(i.t1,i.t5),this.isBagWithContents()&&(o=0,mergeObject(r,{containerContent:this.item.actor.items.filter((function(t){return d.Z.equipmentCategories.includes(t.type)&&t.system.parent_id==a.item.id})).map((function(t){return t.weight=parseFloat((t.system.weight*t.system.quantity).toFixed(3)),o+=Number(t.weight),t})),weightSum:parseFloat(o.toFixed(3)),weightWidth:'style="width: '.concat(Math.min(this.item.system.capacity?o/this.item.system.capacity*100:0,100),'%"'),weightExceeded:o>Number(this.item.system.capacity)?"exceeded":""})),i.abrupt("return",r);case 16:case"end":return i.stop()}}),_callee9,this)}))),function getData(t){return a.apply(this,arguments)})},{key:"breakOverflow",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee10(t,r){var o,a,i;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:return c.t0=$,c.next=3,renderTemplate("systems/dsk/templates/items/baghover.html",t);case 3:return c.t1=c.sent,o=(0,c.t0)(c.t1),a=r.offset().top+52,i=r.offset().left-75,o.appendTo($("body")),o.css({position:"absolute",left:i+"px",top:a+"px",bottom:"auto",right:"auto","z-index":1e4}),c.abrupt("return",o);case 10:case"end":return c.stop()}}),_callee10)}))),function breakOverflow(t,r){return o.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetEquipment.prototype),"activateListeners",this).call(this,t);var o=t.find(".slot");o.mouseenter(function(){var t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee11(t){var o,a;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee11$(i){for(;;)switch(i.prev=i.next){case 0:return o=$(t.currentTarget),i.next=3,r.breakOverflow({name:o.attr("data-name"),weight:o.attr("data-weight"),quantity:o.attr("data-quantity")},o);case 3:(a=i.sent).fadeIn(),o.mouseleave((function(){a.remove(),o.off("mouseleave")}));case 6:case"end":return i.stop()}}),_callee11)})));return function(r){return t.apply(this,arguments)}}()),o.mousedown(function(){var t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee12(t){var o,a;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee12$(i){for(;;)switch(i.prev=i.next){case 0:if(o=$(t.currentTarget).attr("data-item-id"),a=r.actor.items.get(o),0!=t.button){i.next=6;break}a.sheet.render(!0),i.next=11;break;case 6:if(2!=t.button){i.next=11;break}return $(".itemInfo").remove(),i.next=10,a.update({"system.parent_id":0});case 10:r.render(!0);case 11:case"end":return i.stop()}}),_callee12)})));return function(r){return t.apply(this,arguments)}}())}},{key:"isBagWithContents",value:function isBagWithContents(){return this.item.actor&&"bags"==getProperty(this.item,"system.category")}},{key:"_onDrop",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee13(t){var r,o,a,i,c,u;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee13$(l){for(;;)switch(l.prev=l.next){case 0:if(!this.isBagWithContents()){l.next=22;break}return r=JSON.parse(t.dataTransfer.getData("text/plain")),l.next=4,itemFromDrop(r,void 0);case 4:if(o=l.sent,a=o.item,i=o.typeClass,o.selfTarget,c=this.item.id==a.id,u=this.item.parent.id==r.actorId,!d.Z.equipmentCategories.includes(i)||c){l.next=22;break}if(a.system.parent_id=this.item.id,a.system.worn&&a.system.worn.value&&(a.system.worn.value=!1),!u){l.next=18;break}return l.next=16,this.item.actor.updateEmbeddedDocuments("Item",[a]);case 16:l.next=20;break;case 18:return l.next=20,this.item.actor.sheet._addLoot(a);case 20:return this.render(!0),l.abrupt("return");case 22:return l.next=24,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetEquipment.prototype),"_onDrop",this).call(this,t);case 24:case"end":return l.stop()}}),_callee13,this)}))),function _onDrop(t){return r.apply(this,arguments)})}]),ItemSheetEquipment}(b(k)),C=function(t){item_sheet_dsk_inherits(ItemSheetSpecies,t);var r,o=item_sheet_dsk_createSuper(ItemSheetSpecies);function ItemSheetSpecies(){return item_sheet_dsk_classCallCheck(this,ItemSheetSpecies),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetSpecies,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee14(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSpecies.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{hasLocalization:game.i18n.has("dsk.Racedescr.".concat(this.item.name))}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee14,this)}))),function getData(t){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSpecies),"defaultOptions",this);return mergeObject(t,{width:530,height:570}),t}}]),ItemSheetSpecies}(k),A=function(t){item_sheet_dsk_inherits(ItemSheetCulture,t);var r=item_sheet_dsk_createSuper(ItemSheetCulture);function ItemSheetCulture(){return item_sheet_dsk_classCallCheck(this,ItemSheetCulture),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetCulture,null,[{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetCulture),"defaultOptions",this);return mergeObject(t,{width:700,height:700}),t}}]),ItemSheetCulture}(k),R=function(t){item_sheet_dsk_inherits(ItemSheetProfession,t);var r,o=item_sheet_dsk_createSuper(ItemSheetProfession);function ItemSheetProfession(){return item_sheet_dsk_classCallCheck(this,ItemSheetProfession),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetProfession,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee15(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetProfession.prototype),"getData",this).call(this,t);case 2:return r=o.sent,o.t0=mergeObject,o.t1=r,o.next=7,TextEditor.enrichHTML(getProperty(this.item.system,"description.gear"),{secrets:!0,async:!0});case 7:return o.t2=o.sent,o.t3={enrichedClothing:o.t2},(0,o.t0)(o.t1,o.t3),o.abrupt("return",r);case 11:case"end":return o.stop()}}),_callee15,this)}))),function getData(t){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetProfession),"defaultOptions",this);return mergeObject(t,{width:700,height:700}),t}}]),ItemSheetProfession}(k),G=function(t){item_sheet_dsk_inherits(ItemSheetAdvantage,t);var r,o,a,i=item_sheet_dsk_createSuper(ItemSheetAdvantage);function ItemSheetAdvantage(){return item_sheet_dsk_classCallCheck(this,ItemSheetAdvantage),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAdvantage,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee16(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAdvantage.prototype),"getData",this).call(this,t);case 2:return r=o.sent,o.next=5,TextEditor.enrichHTML(getProperty(this.item.system,"rule"),{secrets:!0,async:!0});case 5:return r.enrichedRule=o.sent,o.abrupt("return",r);case 7:case"end":return o.stop()}}),_callee16,this)}))),function getData(t){return a.apply(this,arguments)})},{key:"_advancable",value:function _advancable(){return this.item.system.max>0}},{key:"_refundStep",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee17(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee17$(o){for(;;)switch(o.prev=o.next){case 0:if(!(this.item.system.level>1)){o.next=7;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level-1]),o.next=5,this.item.actor._updateAPs(-1*t);case 5:return o.next=7,this.item.update({"system.level":this.item.system.level-1});case 7:case"end":return o.stop()}}),_callee17,this)}))),function _refundStep(){return o.apply(this,arguments)})},{key:"_advanceStep",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee18(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:if(!(this.item.system.level<this.item.system.max)){o.next=10;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level]),o.next=5,this.item.actor.checkEnoughXP(t);case 5:if(!o.sent){o.next=10;break}return o.next=8,this.item.actor._updateAPs(t);case 8:return o.next=10,this.item.update({"system.level":this.item.system.level+1});case 10:case"end":return o.stop()}}),_callee18,this)}))),function _advanceStep(){return r.apply(this,arguments)})}]),ItemSheetAdvantage}(k),L=function(t){item_sheet_dsk_inherits(ItemSheetDisadvantage,t);var r=item_sheet_dsk_createSuper(ItemSheetDisadvantage);function ItemSheetDisadvantage(){return item_sheet_dsk_classCallCheck(this,ItemSheetDisadvantage),r.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetDisadvantage)}(G),D=function(t){item_sheet_dsk_inherits(ItemSheetSpecialability,t);var r,o,a,i=item_sheet_dsk_createSuper(ItemSheetSpecialability);function ItemSheetSpecialability(){return item_sheet_dsk_classCallCheck(this,ItemSheetSpecialability),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetSpecialability,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee19(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee19$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSpecialability.prototype),"getData",this).call(this,t);case 2:return r=o.sent,o.t0=mergeObject,o.t1=r,o.t2=d.Z.specialAbilityCategories,o.t3=d.Z.combatSkillSubCategories,o.next=9,TextEditor.enrichHTML(getProperty(this.item.system,"rule"),{secrets:!0,async:!0});case 9:if(o.t4=o.sent,o.t5=game.user.isGM,o.t5){o.next=15;break}return o.next=14,game.settings.get("dsk","playerCanEditSpellMacro");case 14:o.t5=o.sent;case 15:return o.t6=o.t5,o.t7={categories:o.t2,subCategories:o.t3,enrichedRule:o.t4,canOnUseEffect:o.t6},(0,o.t0)(o.t1,o.t7),o.abrupt("return",r);case 19:case"end":return o.stop()}}),_callee19,this)}))),function getData(t){return a.apply(this,arguments)})},{key:"_refundStep",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee20(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee20$(o){for(;;)switch(o.prev=o.next){case 0:if(!(this.item.system.level>1)){o.next=7;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level-1]),o.next=5,this.item.actor._updateAPs(-1*t);case 5:return o.next=7,this.item.update({"system.level":this.item.system.level-1});case 7:case"end":return o.stop()}}),_callee20,this)}))),function _refundStep(){return o.apply(this,arguments)})},{key:"_advanceStep",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee21(){var t,r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee21$(o){for(;;)switch(o.prev=o.next){case 0:if(!(this.item.system.level<this.item.system.max)){o.next=10;break}return t=this.item.system.ap,/;/.test(t)&&(r=t.split(";").map((function(t){return Number(t.trim())})),t=r[this.item.system.level]),o.next=5,this.item.actor.checkEnoughXP(t);case 5:if(!o.sent){o.next=10;break}return o.next=8,this.item.actor._updateAPs(t);case 8:return o.next=10,this.item.update({"system.level":this.item.system.level+1});case 10:case"end":return o.stop()}}),_callee21,this)}))),function _advanceStep(){return r.apply(this,arguments)})},{key:"_advancable",value:function _advancable(){return this.item.system.max>0}}]),ItemSheetSpecialability}(k),j=function(r){item_sheet_dsk_inherits(ItemSheetAhnengeschenk,r);var o,a,i=item_sheet_dsk_createSuper(ItemSheetAhnengeschenk);function ItemSheetAhnengeschenk(){return item_sheet_dsk_classCallCheck(this,ItemSheetAhnengeschenk),i.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAhnengeschenk,[{key:"getData",value:(a=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee22(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAhnengeschenk.prototype),"getData",this).call(this,t);case 2:if(r=o.sent,o.t0=game.user.isGM,o.t0){o.next=8;break}return o.next=7,game.settings.get("dsk","playerCanEditSpellMacro");case 7:o.t0=o.sent;case 8:return r.canOnUseEffect=o.t0,o.abrupt("return",r);case 10:case"end":return o.stop()}}),_callee22,this)}))),function getData(t){return a.apply(this,arguments)})},{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,o=item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAhnengeschenk.prototype),"_getHeaderButtons",this).call(this);return this.item.isOwned&&o.unshift({class:"rolleffect",icon:"fas fa-dice-d20",onclick:(t=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee23(t){return item_sheet_dsk_regeneratorRuntime().wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.setupEffect(t));case 1:case"end":return o.stop()}}),_callee23)}))),function onclick(r){return t.apply(this,arguments)})}),o}},{key:"setupEffect",value:(o=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee24(r){var o,a;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee24$(r){for(;;)switch(r.prev=r.next){case 0:if(!(this.item.actor.system.stats.AeP.value<1)){r.next=2;break}return r.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.NotEnoughAeP")));case 2:return o=game.dsk.config.ItemSubClasses.ahnengeschenk,r.next=5,this.item.actor.update({"system.stats.AeP.value":this.item.actor.system.stats.AeP.value-=1});case 5:return a="<p><b>".concat(this.item.name," - ").concat(game.i18n.localize("ITEM.TypeAhnengeschenk")," ").concat(game.i18n.localize("dsk.probe"),"</b></p><p>").concat(this.item.system.description.value,"</p><p>").concat(o.chatData(this.item.system,"").join("</br>"),"</p>"),r.next=8,ChatMessage.create(t.Z.chatDataSetup(a));case 8:case"end":return r.stop()}}),_callee24,this)}))),function setupEffect(t){return o.apply(this,arguments)})}]),ItemSheetAhnengeschenk}(k),M=function(t){item_sheet_dsk_inherits(ItemSheetAhnengabe,t);var r,o=item_sheet_dsk_createSuper(ItemSheetAhnengabe);function ItemSheetAhnengabe(){return item_sheet_dsk_classCallCheck(this,ItemSheetAhnengabe),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetAhnengabe,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee25(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee25$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetAhnengabe.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{characteristics:d.Z.characteristics,StFs:d.Z.StFs,resistances:d.Z.magicResistanceModifiers}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee25,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetAhnengabe}(k),z=function(t){item_sheet_dsk_inherits(ItemSheetPoison,t);var r,o=item_sheet_dsk_createSuper(ItemSheetPoison);function ItemSheetPoison(){return item_sheet_dsk_classCallCheck(this,ItemSheetPoison),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetPoison,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee26(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetPoison.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{resistances:d.Z.magicResistanceModifiers}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee26,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetPoison}(b(k)),N=function(t){item_sheet_dsk_inherits(ItemSheetSkill,t);var r,o=item_sheet_dsk_createSuper(ItemSheetSkill);function ItemSheetSkill(){return item_sheet_dsk_classCallCheck(this,ItemSheetSkill),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetSkill,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee27(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee27$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetSkill.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{characteristics:d.Z.characteristics,skillGroups:d.Z.skillGroups,skillBurdens:d.Z.skillBurdens,hasLocalization:game.i18n.has("dsk.SKILLdescr.".concat(this.item.name)),StFs:d.Z.StFs}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee27,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetSkill}(k),H=function(t){item_sheet_dsk_inherits(ItemSheetCombatskill,t);var r,o=item_sheet_dsk_createSuper(ItemSheetCombatskill);function ItemSheetCombatskill(){return item_sheet_dsk_classCallCheck(this,ItemSheetCombatskill),o.apply(this,arguments)}return item_sheet_dsk_createClass(ItemSheetCombatskill,[{key:"getData",value:(r=item_sheet_dsk_asyncToGenerator(item_sheet_dsk_regeneratorRuntime().mark((function _callee28(t){var r;return item_sheet_dsk_regeneratorRuntime().wrap((function _callee28$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,item_sheet_dsk_get(item_sheet_dsk_getPrototypeOf(ItemSheetCombatskill.prototype),"getData",this).call(this,t);case 2:return r=o.sent,mergeObject(r,{weapontypes:d.Z.weapontypes,hasLocalization:game.i18n.has("dsk.Combatskilldescr.".concat(this.item.name))}),o.abrupt("return",r);case 5:case"end":return o.stop()}}),_callee28,this)}))),function getData(t){return r.apply(this,arguments)})}]),ItemSheetCombatskill}(N),K=__webpack_require__(404);function dsk_wizard_typeof(t){return dsk_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dsk_wizard_typeof(t)}function dsk_wizard_regeneratorRuntime(){dsk_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dsk_wizard_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dsk_wizard_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function dsk_wizard_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dsk_wizard_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return dsk_wizard_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function dsk_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function dsk_wizard_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dsk_wizard_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dsk_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dsk_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dsk_wizard_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dsk_wizard_get(){return dsk_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dsk_wizard_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dsk_wizard_get.apply(this,arguments)}function dsk_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dsk_wizard_getPrototypeOf(t)););return t}function dsk_wizard_setPrototypeOf(t,r){return dsk_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dsk_wizard_setPrototypeOf(t,r)}function dsk_wizard_createSuper(t){var r=function dsk_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dsk_wizard_getPrototypeOf(t);if(r){var i=dsk_wizard_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dsk_wizard_possibleConstructorReturn(this,o)}}function dsk_wizard_possibleConstructorReturn(t,r){if(r&&("object"===dsk_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dsk_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dsk_wizard_getPrototypeOf(t){return dsk_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dsk_wizard_getPrototypeOf(t)}var W=function(r){!function dsk_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dsk_wizard_setPrototypeOf(t,r)}(WizardDSK,Application);var o,a,i,c,u,l=dsk_wizard_createSuper(WizardDSK);function WizardDSK(t){var r;return function dsk_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,WizardDSK),(r=l.call(this,t)).items=[],r.errors=[],r.attributes=[],r.updating=!1,r}return function dsk_wizard_createClass(t,r,o){return r&&dsk_wizard_defineProperties(t.prototype,r),o&&dsk_wizard_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(WizardDSK,[{key:"updateSkill",value:(u=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee(r,o){var a,i,c,u,l,p,d=this,h=arguments;return dsk_wizard_regeneratorRuntime().wrap((function _callee$(y){for(;;)switch(y.prev=y.next){case 0:a=h.length>2&&void 0!==h[2]?h[2]:1,i=!(h.length>3&&void 0!==h[3])||h[3],c=[],u=dsk_wizard_createForOfIteratorHelper(r),y.prev=4,p=function _loop(){var r=l.value;if(["","-"].includes(r.trim()))return"continue";var u=t.Z.parseAbilityString(r.trim()),p=d.actor.items.find((function(t){return t.type==o&&t.name==u.name}));if(p){var h=duplicate(p);h.system.level=Math.max(0,a*u.step+(i?Number(h.system.level):0)),c.push(h)}else console.warn("Could not find ".concat(o," ").concat(r)),d.errors.push("".concat(t.Z.categoryLocalization(o),": ").concat(r))},u.s();case 7:if((l=u.n()).done){y.next=13;break}if("continue"!==p()){y.next=11;break}return y.abrupt("continue",11);case 11:y.next=7;break;case 13:y.next=18;break;case 15:y.prev=15,y.t0=y.catch(4),u.e(y.t0);case 18:return y.prev=18,u.f(),y.finish(18);case 21:return y.next=23,this.actor.updateEmbeddedDocuments("Item",c);case 23:case"end":return y.stop()}}),_callee,this,[[4,15,18,21]])}))),function updateSkill(t,r){return u.apply(this,arguments)})},{key:"findCompendiumItem",value:(c=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee2(t,r){var o,a,i,c;return dsk_wizard_regeneratorRuntime().wrap((function _callee2$(u){for(;;)switch(u.prev=u.next){case 0:o=dsk_wizard_createForOfIteratorHelper(r),u.prev=1,i=dsk_wizard_regeneratorRuntime().mark((function _loop2(){var r,o;return dsk_wizard_regeneratorRuntime().wrap((function _loop2$(i){for(;;)switch(i.prev=i.next){case 0:return r=a.value,i.next=3,game.dsk.itemLibrary.findCompendiumItem(t,r);case 3:if(!(o=i.sent).length){i.next=6;break}return i.abrupt("return",{v:o.find((function(o){return o.name==t&&o.type==r&&o.system}))});case 6:case"end":return i.stop()}}),_loop2)})),o.s();case 4:if((a=o.n()).done){u.next=11;break}return u.delegateYield(i(),"t0",6);case 6:if("object"!==dsk_wizard_typeof(c=u.t0)){u.next=9;break}return u.abrupt("return",c.v);case 9:u.next=4;break;case 11:u.next=16;break;case 13:u.prev=13,u.t1=u.catch(1),o.e(u.t1);case 16:return u.prev=16,o.f(),u.finish(16);case 19:return u.abrupt("return",void 0);case 20:case"end":return u.stop()}}),_callee2,null,[[1,13,16,19]])}))),function findCompendiumItem(t,r){return c.apply(this,arguments)})},{key:"parseToItem",value:(i=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee4(r,o){var a=this;return dsk_wizard_regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:if(""!=r.trim()){i.next=2;break}return i.abrupt("return",[]);case 2:return i.next=4,Promise.all(r.split(", ").map(function(){var r=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee3(r){var i,c,u,l,p;return dsk_wizard_regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:return i=t.Z.parseAbilityString(r.trim()),d.next=3,a.findCompendiumItem(i.original,o);case 3:if(c=d.sent){d.next=8;break}return d.next=7,a.findCompendiumItem(i.name,o);case 7:c=d.sent;case 8:return c?(l=c.uuid,(c=duplicate(c)).uuid=l,c.tooltip=game.i18n.localize("dsk.details"),(c=K.Z.reverseAdoptionCalculation(a.actor,i,c)).system.ap&&(c.APunparseable=isNaN(c.system.ap),c.apCost=c.APunparseable?c.system.ap:i.step*Number(c.system.ap))):(console.warn("Not found <".concat(r,">")),u=o.map((function(r){return t.Z.categoryLocalization(r)})).join("/"),a.errors.push("".concat(u,": ").concat(r)),c={name:r.trim(),notFound:!0,tooltip:game.i18n.localize("dsk.DSKError.itemNotFound"),apCost:"?"}),c.replaceName=i.original,c.step=i.step,p=null!=a.actor.items.find((function(t){return o.includes(t.type)&&t.name==i.original})),c.disabled=p||c.notFound||c.APunparseable,p&&(c.tooltip=game.i18n.localize("dsk.YouAlreadyHaveit")),d.abrupt("return",c);case 15:case"end":return d.stop()}}),_callee3)})));return function(t){return r.apply(this,arguments)}}()));case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}}),_callee4)}))),function parseToItem(t,r){return i.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;dsk_wizard_get(dsk_wizard_getPrototypeOf(WizardDSK.prototype),"activateListeners",this).call(this,t),t.find("button.ok").click((function(){r.updating||(r.updating=!0,r.updateCharacter().then((function(){return r.updating=!1})))})),t.find("button.cancel").click((function(){r.close()})),t.find(".show-item").click((function(t){var o=$(t.currentTarget).attr("data-id");r.items.find((function(t){return t.id==o})).sheet.render(!0)})),t.find(".optional").change((function(t){var r=$(t.currentTarget).closest(".content"),o=Number(r.attr("data-cost"));r.find(".optional:checked").each((function(){o+=Number($(this).attr("data-cost"))}));var a=r.find(".apCost");a.text(o),WizardDSK.flashElem(a,"emphasize2")})),t.find(".exclusive").change((function(t){var r=$(t.currentTarget).closest(".content"),o=$(t.currentTarget).attr("data-sel"),a=r.find(".allowedCount_".concat(o)),i=Number(a.attr("data-count"));if(r.find(".exclusive_".concat(o,":checked")).length>i)return t.currentTarget.checked=!1,void WizardDSK.flashElem(a)}))}},{key:"_validateInput",value:function _validateInput(t){var r,o=new Set,a=/^exclusive_/,i=dsk_wizard_createForOfIteratorHelper(t.find(".exclusive"));try{for(i.s();!(r=i.n()).done;){var c=r.value;o.add(c.className.split(/\s+/).filter((function(t){return a.test(t)}))[0])}}catch(t){i.e(t)}finally{i.f()}var u,l=dsk_wizard_createForOfIteratorHelper(o);try{for(l.s();!(u=l.n()).done;){var p=u.value,d=t.find(".allowedCount_"+p.split("_")[1]),h=Number(d.attr("data-count"));if(t.find(".".concat(p,":checked")).length!=h){ui.notifications.error(game.i18n.localize("dsk.DSKError.MissingChoices")),WizardDSK.flashElem(d);var y=d.closest(".tab").attr("data-tab");return WizardDSK.flashElem(t.find(".tabs a[data-tab='".concat(y,"']"))),!1}}}catch(t){l.e(t)}finally{l.f()}return!0}},{key:"alreadyAdded",value:(a=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee5(r,o){var a;return dsk_wizard_regeneratorRuntime().wrap((function _callee5$(i){for(;;)switch(i.prev=i.next){case 0:if(""!=r){i.next=2;break}return i.abrupt("return",!1);case 2:return a=!1,i.next=5,new Promise((function(r,a){new Dialog({title:game.i18n.localize("dsk.DIALOG.warning"),content:game.i18n.format("dsk.DIALOG.alreadyAddedCharacterpart",{category:t.Z.categoryLocalization(o)}),default:"ok",buttons:{ok:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("dsk.ok"),default:!0,callback:function callback(){r(!1)}},cancel:{icon:'<i class="fas fa-close"></i>',label:game.i18n.localize("dsk.cancel"),default:!0,callback:function callback(){r(!0)}}}}).render(!0)}));case 5:return a=i.sent,i.abrupt("return",a);case 7:case"end":return i.stop()}}),_callee5)}))),function alreadyAdded(t,r){return a.apply(this,arguments)})},{key:"addSelections",value:(o=dsk_wizard_asyncToGenerator(dsk_wizard_regeneratorRuntime().mark((function _callee6(r){var o,a,i,c,u,l;return dsk_wizard_regeneratorRuntime().wrap((function _callee6$(p){for(;;)switch(p.prev=p.next){case 0:o=[],a=dsk_wizard_createForOfIteratorHelper(r),p.prev=2,a.s();case 4:if((i=a.n()).done){p.next=28;break}if(c=i.value,""!=$(c).val()){p.next=9;break}return p.abrupt("continue",26);case 9:return p.next=11,fromUuid($(c).val());case 11:u=p.sent,l=t.Z.parseAbilityString(u.name),u.name=$(c).attr("name"),p.t0=u.type,p.next="advantage"===p.t0||"disadvantage"===p.t0?17:"specialability"===p.t0?21:26;break;case 17:return u.system.level=Number($(c).attr("data-step")),u=K.Z.reverseAdoptionCalculation(this.actor,l,u),this.mergeLevels(o,u)||m.Z.vantageAdded(this.actor,u),p.abrupt("break",26);case 21:return u.system.level=Number($(c).attr("data-step")),$(c).attr("data-free")&&(u.system.ap=0),u=K.Z.reverseAdoptionCalculation(this.actor,l,u),this.mergeLevels(o,u)||g.Z.abilityAdded(this.actor,u),p.abrupt("break",26);case 26:p.next=4;break;case 28:p.next=33;break;case 30:p.prev=30,p.t1=p.catch(2),a.e(p.t1);case 33:return p.prev=33,a.f(),p.finish(33);case 36:return p.next=38,this.actor.createEmbeddedDocuments("Item",o);case 38:case"end":return p.stop()}}),_callee6,this,[[2,30,33,36]])}))),function addSelections(t){return o.apply(this,arguments)})},{key:"mergeLevels",value:function mergeLevels(t,r){var o=!1,a=t.find((function(t){return t.name==r.name&&t.type==r.type}));if(a){o=!0;var i=Number(getProperty(r,"system.level"));i&&(a.system.level+=i)}else t.push(r);return o}},{key:"finalizeUpdate",value:function finalizeUpdate(){0==this.errors.length?this.close():$(this._element).find(".dialog-buttons").html('<div class="error"><p>'.concat(game.i18n.localize("dsk.DSKError.notUnderstood"),"</p><ul><li>").concat(this.errors.join("</li><li>"),"</li></ul></div>"))}}],[{key:"defaultOptions",get:function get(){var t=dsk_wizard_get(dsk_wizard_getPrototypeOf(WizardDSK),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"description"}],mergeObject(t,{classes:t.classes.concat(["dsk","largeDialog"]),width:750,height:640}),t.resizable=!0,t}},{key:"flashElem",value:function flashElem(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emphasize";t.addClass(r),setTimeout((function(){t.removeClass(r)}),600)}}]),WizardDSK}();function species_wizard_typeof(t){return species_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},species_wizard_typeof(t)}function species_wizard_regeneratorRuntime(){species_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==species_wizard_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function species_wizard_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function species_wizard_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return species_wizard_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return species_wizard_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function species_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function species_wizard_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function species_wizard_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){species_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){species_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function species_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function species_wizard_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function species_wizard_get(){return species_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=species_wizard_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},species_wizard_get.apply(this,arguments)}function species_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=species_wizard_getPrototypeOf(t)););return t}function species_wizard_setPrototypeOf(t,r){return species_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},species_wizard_setPrototypeOf(t,r)}function species_wizard_createSuper(t){var r=function species_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=species_wizard_getPrototypeOf(t);if(r){var i=species_wizard_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return species_wizard_possibleConstructorReturn(this,o)}}function species_wizard_possibleConstructorReturn(t,r){if(r&&("object"===species_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function species_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function species_wizard_getPrototypeOf(t){return species_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},species_wizard_getPrototypeOf(t)}var B=function(t){!function species_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&species_wizard_setPrototypeOf(t,r)}(SpeciesWizard,t);var r,o,a,i,c=species_wizard_createSuper(SpeciesWizard);function SpeciesWizard(){return species_wizard_classCallCheck(this,SpeciesWizard),c.apply(this,arguments)}return function species_wizard_createClass(t,r,o){return r&&species_wizard_defineProperties(t.prototype,r),o&&species_wizard_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(SpeciesWizard,[{key:"_parseBonus",value:(i=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee(t){var r,o,a,i,c,u,l,p;return species_wizard_regeneratorRuntime().wrap((function _callee$(h){for(;;)switch(h.prev=h.next){case 0:r=[],o=[],a=!1,i=Object.keys(d.Z.characteristics),c=new RegExp(game.i18n.localize("dsk.WIZARDPARSER.speciesAdvantage"),"i"),u=species_wizard_createForOfIteratorHelper(t.split(",")),h.prev=6,p=function _loop(){var t=l.value;if(c.test(t)){a=!0;var u=i.filter((function(r){return t.includes(r.toUpperCase())}));return r.push({choices:u,allowedCount:1}),"break"}o.push(t.trim())},u.s();case 9:if((l=u.n()).done){h.next=15;break}if("break"!==p()){h.next=13;break}return h.abrupt("break",15);case 13:h.next=9;break;case 15:h.next=20;break;case 17:h.prev=17,h.t0=h.catch(6),u.e(h.t0);case 20:return h.prev=20,u.f(),h.finish(20);case 23:return h.next=25,this.parseToItem(o.join(", "),["advantage","disadvantage"]);case 25:return o=h.sent,h.abrupt("return",{anyAttributeRequirements:a,attributeRequirements:r,optionals:o});case 27:case"end":return h.stop()}}),_callee,this,[[6,17,20,23]])}))),function _parseBonus(t){return i.apply(this,arguments)})},{key:"getData",value:(a=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee2(t){var r,o,a,i,c,u;return species_wizard_regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,species_wizard_get(species_wizard_getPrototypeOf(SpeciesWizard.prototype),"getData",this).call(this,t);case 2:return r=l.sent,l.next=5,this._parseBonus(this.species.system.advantages);case 5:return o=l.sent,a=o.anyAttributeRequirements,i=o.attributeRequirements,c=o.optionals,u=a,mergeObject(r,{speciesDescription:game.i18n.has("dsk.Racedescr.".concat(this.species.name))?game.i18n.localize("dsk.Racedescr.".concat(this.species.name)):this.species.system.description.value,species:this.species,description:game.i18n.format("dsk.WIZARD.speciesdescr",{species:this.species.name}),title:game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeSpecies")," ").concat(this.species.name)}),generalToChose:u,anyAttributeRequirements:a,optionals:c,attributeRequirements:i}),l.abrupt("return",r);case 12:case"end":return l.stop()}}),_callee2,this)}))),function getData(t){return a.apply(this,arguments)})},{key:"addSpecies",value:(o=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee3(t,r){return species_wizard_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:this.actor=t,this.species=duplicate(r);case 2:case"end":return o.stop()}}),_callee3,this)}))),function addSpecies(t,r){return o.apply(this,arguments)})},{key:"updateCharacter",value:(r=species_wizard_asyncToGenerator(species_wizard_regeneratorRuntime().mark((function _callee4(){var t,r,o,a,i,c;return species_wizard_regeneratorRuntime().wrap((function _callee4$(u){for(;;)switch(u.prev=u.next){case 0:if((t=$(this._element)).find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),r=Number(t.find(".apCost").text()),u.t1=!this._validateInput($(this._element)),u.t1){u.next=8;break}return u.next=7,this.actor.checkEnoughXP(r);case 7:u.t1=!u.sent;case 8:if(u.t0=u.t1,u.t0){u.next=13;break}return u.next=12,this.alreadyAdded(this.actor.system.details.species,"species");case 12:u.t0=u.sent;case 13:if(!u.t0){u.next=16;break}return t.find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),u.abrupt("return");case 16:o={"system.details.species":this.species.name,"system.stats.gs.initial":this.species.system.gs,"system.stats.sk.initial":this.species.system.sk,"system.stats.zk.initial":this.species.system.zk,"system.stats.LeP.initial":this.species.system.LeP,"system.stats.LeP.value":this.species.system.LeP+2*this.actor.system.characteristics.ko.value},a=species_wizard_createForOfIteratorHelper(t.find(".exclusive:checked"));try{for(a.s();!(i=a.n()).done;)c=i.value,o["system.characteristics.".concat($(c).val(),".species")]=1}catch(t){a.e(t)}finally{a.f()}return u.next=21,this.actor.update(o);case 21:return u.next=23,this.actor._updateAPs(r);case 23:return u.next=25,this.addSelections(t.find(".optional:checked"));case 25:return u.next=27,this.actor.removeCondition("incapacitated");case 27:this.finalizeUpdate();case 28:case"end":return u.stop()}}),_callee4,this)}))),function updateCharacter(){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=species_wizard_get(species_wizard_getPrototypeOf(SpeciesWizard),"defaultOptions",this);return t.title=game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeSpecies"))}),t.template="systems/dsk/templates/wizard/add-species-wizard.html",t}}]),SpeciesWizard}(W);function culture_wizard_typeof(t){return culture_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},culture_wizard_typeof(t)}function culture_wizard_regeneratorRuntime(){culture_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==culture_wizard_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function culture_wizard_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function culture_wizard_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){culture_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){culture_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function culture_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function culture_wizard_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function culture_wizard_get(){return culture_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=culture_wizard_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},culture_wizard_get.apply(this,arguments)}function culture_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=culture_wizard_getPrototypeOf(t)););return t}function culture_wizard_setPrototypeOf(t,r){return culture_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},culture_wizard_setPrototypeOf(t,r)}function culture_wizard_createSuper(t){var r=function culture_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=culture_wizard_getPrototypeOf(t);if(r){var i=culture_wizard_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return culture_wizard_possibleConstructorReturn(this,o)}}function culture_wizard_possibleConstructorReturn(t,r){if(r&&("object"===culture_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function culture_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function culture_wizard_getPrototypeOf(t){return culture_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},culture_wizard_getPrototypeOf(t)}var Z=function(r){!function culture_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&culture_wizard_setPrototypeOf(t,r)}(CultureWizard,r);var o,a,i,c=culture_wizard_createSuper(CultureWizard);function CultureWizard(){return culture_wizard_classCallCheck(this,CultureWizard),c.apply(this,arguments)}return function culture_wizard_createClass(t,r,o){return r&&culture_wizard_defineProperties(t.prototype,r),o&&culture_wizard_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(CultureWizard,[{key:"getData",value:(i=culture_wizard_asyncToGenerator(culture_wizard_regeneratorRuntime().mark((function _callee(r){var o;return culture_wizard_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,culture_wizard_get(culture_wizard_getPrototypeOf(CultureWizard.prototype),"getData",this).call(this,r);case 2:return o=a.sent,mergeObject(o,{title:game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(t.Z.categoryLocalization("culture")," ").concat(this.culture.name)}),culture:this.culture,description:game.i18n.format("dsk.WIZARD.culturedescr",{culture:this.culture.name,cost:0})}),a.abrupt("return",o);case 6:case"end":return a.stop()}}),_callee,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"addCulture",value:(a=culture_wizard_asyncToGenerator(culture_wizard_regeneratorRuntime().mark((function _callee2(t,r){return culture_wizard_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:this.actor=t,this.culture=duplicate(r);case 2:case"end":return o.stop()}}),_callee2,this)}))),function addCulture(t,r){return a.apply(this,arguments)})},{key:"updateCharacter",value:(o=culture_wizard_asyncToGenerator(culture_wizard_regeneratorRuntime().mark((function _callee3(){var t,r,o;return culture_wizard_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if((t=$(this._element)).find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),r=Number(t.find(".apCost").text()),a.t1=!this._validateInput($(this._element)),a.t1){a.next=8;break}return a.next=7,this.actor.checkEnoughXP(r);case 7:a.t1=!a.sent;case 8:if(a.t0=a.t1,a.t0){a.next=13;break}return a.next=12,this.alreadyAdded(this.actor.system.details.culture,"culture");case 12:a.t0=a.sent;case 13:if(!a.t0){a.next=16;break}return t.find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),a.abrupt("return");case 16:return o={"system.details.culture":this.culture.name},a.next=19,this.actor.update(o);case 19:return a.next=21,this.actor._updateAPs(r);case 21:return a.next=23,this.updateSkill(this.culture.system.skills.split(","),"skill");case 23:this.finalizeUpdate();case 24:case"end":return a.stop()}}),_callee3,this)}))),function updateCharacter(){return o.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=culture_wizard_get(culture_wizard_getPrototypeOf(CultureWizard),"defaultOptions",this);return t.title=game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeCulture"))}),t.template="systems/dsk/templates/wizard/add-culture-wizard.html",t}}]),CultureWizard}(W);function career_wizard_typeof(t){return career_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},career_wizard_typeof(t)}function career_wizard_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=career_wizard_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function career_wizard_regeneratorRuntime(){career_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==career_wizard_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return career_wizard_arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||career_wizard_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function career_wizard_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return career_wizard_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?career_wizard_arrayLikeToArray(t,r):void 0}}function career_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function career_wizard_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function career_wizard_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){career_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){career_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function career_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function career_wizard_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function career_wizard_get(){return career_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=career_wizard_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},career_wizard_get.apply(this,arguments)}function career_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=career_wizard_getPrototypeOf(t)););return t}function career_wizard_setPrototypeOf(t,r){return career_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},career_wizard_setPrototypeOf(t,r)}function career_wizard_createSuper(t){var r=function career_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=career_wizard_getPrototypeOf(t);if(r){var i=career_wizard_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return career_wizard_possibleConstructorReturn(this,o)}}function career_wizard_possibleConstructorReturn(t,r){if(r&&("object"===career_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function career_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function career_wizard_getPrototypeOf(t){return career_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},career_wizard_getPrototypeOf(t)}var q=function(r){!function career_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&career_wizard_setPrototypeOf(t,r)}(CareerWizard,r);var o,a,i,c,u=career_wizard_createSuper(CareerWizard);function CareerWizard(){return career_wizard_classCallCheck(this,CareerWizard),u.apply(this,arguments)}return function career_wizard_createClass(t,r,o){return r&&career_wizard_defineProperties(t.prototype,r),o&&career_wizard_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(CareerWizard,[{key:"getData",value:(c=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee(r){var o,a,i,c,u;return career_wizard_regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,career_wizard_get(career_wizard_getPrototypeOf(CareerWizard.prototype),"getData",this).call(this,r);case 2:return o=l.sent,l.t0=[],l.t1=_toConsumableArray,l.next=7,this.parseToItem(this.career.system.requirements.advantage,["disadvantage","advantage"]);case 7:return l.t2=l.sent,l.t3=(0,l.t1)(l.t2),l.t4=_toConsumableArray,l.next=12,this.parseToItem(this.career.system.requirements.specialability,["specialability"]);case 12:return l.t5=l.sent,l.t6=(0,l.t4)(l.t5),a=l.t0.concat.call(l.t0,l.t3,l.t6),i=a.filter((function(t){return["advantage","disadvantage"].includes(t.type)&&!t.disabled})),c=a.reduce((function(t,r){return t+(r.disabled?0:Number(r.system.ap)||0)}),0),u=a.filter((function(t){return"specialability"==t.type&&!t.disabled})),mergeObject(o,{title:game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(t.Z.categoryLocalization("profession")," ").concat(this.career.name)}),career:this.career,description:game.i18n.format("dsk.WIZARD.careerdescr",{career:this.career.name,cost:0+c}),baseCost:0,missingVantagesToChose:i.length>0,missingSpecialabiltiesToChose:u.length>0}),l.abrupt("return",o);case 21:case"end":return l.stop()}}),_callee,this)}))),function getData(t){return c.apply(this,arguments)})},{key:"addCareer",value:(i=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee2(t,r){return career_wizard_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:this.actor=t,this.career=duplicate(r);case 2:case"end":return o.stop()}}),_callee2,this)}))),function addCareer(t,r){return i.apply(this,arguments)})},{key:"setAbility",value:(a=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee3(r,o){var a,i,c,u,l,p=this;return career_wizard_regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:if(""!=r.trim()){d.next=2;break}return d.abrupt("return");case 2:a=[],i=[],c=career_wizard_createForOfIteratorHelper(r.split(",")),d.prev=5,l=career_wizard_regeneratorRuntime().mark((function _loop(){var r,c,l,d;return career_wizard_regeneratorRuntime().wrap((function _loop$(h){for(;;)switch(h.prev=h.next){case 0:if(r=u.value,!["","-"].includes(r.trim())){h.next=3;break}return h.abrupt("return","continue");case 3:if(c=t.Z.parseAbilityString(r.trim()),!(l=p.actor.items.find((function(t){return o.includes(t.type)&&t.name==c.original})))){h.next=12;break}(l=duplicate(l)).system.level&&(l.system.level=c.step),l=K.Z.reverseAdoptionCalculation(p.actor,c,l),i.push(l),h.next=20;break;case 12:return h.next=14,p.findCompendiumItem(c.original,o);case 14:if(l=h.sent){h.next=19;break}return h.next=18,p.findCompendiumItem(c.name,o);case 18:l=h.sent;case 19:l?((l=duplicate(l)).name=c.original,l.system.level&&(l.system.level=c.step),l=K.Z.reverseAdoptionCalculation(p.actor,c,l),a.push(l)):(d=o.map((function(r){return t.Z.categoryLocalization(r)})).join("/"),p.errors.push("".concat(d,": ").concat(r)),ui.notifications.error(game.i18n.format("dsk.DSKError.notFound",{category:d,name:r})));case 20:case"end":return h.stop()}}),_loop)})),c.s();case 8:if((u=c.n()).done){d.next=15;break}return d.delegateYield(l(),"t0",10);case 10:if("continue"!==d.t0){d.next=13;break}return d.abrupt("continue",13);case 13:d.next=8;break;case 15:d.next=20;break;case 17:d.prev=17,d.t1=d.catch(5),c.e(d.t1);case 20:return d.prev=20,c.f(),d.finish(20);case 23:return d.next=25,this.actor.updateEmbeddedDocuments("Item",i);case 25:return d.next=27,this.actor.createEmbeddedDocuments("Item",a);case 27:case"end":return d.stop()}}),_callee3,this,[[5,17,20,23]])}))),function setAbility(t,r){return a.apply(this,arguments)})},{key:"updateCharacter",value:(o=career_wizard_asyncToGenerator(career_wizard_regeneratorRuntime().mark((function _callee4(){var t,r,o,a;return career_wizard_regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:if((t=$(this._element)).find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),r=Number(t.find(".apCost").text()),i.t1=!this._validateInput($(this._element)),i.t1){i.next=8;break}return i.next=7,this.actor.checkEnoughXP(r);case 7:i.t1=!i.sent;case 8:if(i.t0=i.t1,i.t0){i.next=13;break}return i.next=12,this.alreadyAdded(this.actor.system.details.profession,"profession");case 12:i.t0=i.sent;case 13:if(!i.t0){i.next=16;break}return t.find("button.ok i").toggleClass("fa-check fa-spinner fa-spin"),i.abrupt("return");case 16:if(o={"system.details.profession":this.career.name},!this.career.system.isAncestor){i.next=22;break}return i.next=20,this.setAbility(this.career.system.ahnengabe,["ahnengabe"]);case 20:return i.next=22,this.setAbility(this.career.system.ahnengeschenk,["ahnengeschenk"]);case 22:return i.next=24,this.setAbility(this.career.system.requirements.specialability,["specialability"]);case 24:return i.next=26,this.setAbility(this.career.system.requirements.advantage,["advantage","disadvantage"]);case 26:return i.next=28,this.actor.update(o);case 28:return i.next=30,this.actor._updateAPs(r);case 30:return a=[].concat(_toConsumableArray(this.career.system.skills.body.split(",")),_toConsumableArray(this.career.system.skills.social.split(",")),_toConsumableArray(this.career.system.skills.mental.split(",")),_toConsumableArray(this.career.system.skills.trade.split(","))),i.next=33,this.updateSkill(a,"skill");case 33:return i.next=35,this.updateSkill(this.career.system.skills.combat.split(","),"combatskill");case 35:this.finalizeUpdate();case 36:case"end":return i.stop()}}),_callee4,this)}))),function updateCharacter(){return o.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=career_wizard_get(career_wizard_getPrototypeOf(CareerWizard),"defaultOptions",this);return t.title=game.i18n.format("dsk.WIZARD.addItem",{item:"".concat(game.i18n.localize("ITEM.TypeProfession"))}),t.template="systems/dsk/templates/wizard/add-career-wizard.html",t}}]),CareerWizard}(W);function actor_sheet_character_typeof(t){return actor_sheet_character_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_character_typeof(t)}function actor_sheet_character_regeneratorRuntime(){actor_sheet_character_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_sheet_character_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function actor_sheet_character_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function actor_sheet_character_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_character_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function actor_sheet_character_get(){return actor_sheet_character_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=actor_sheet_character_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},actor_sheet_character_get.apply(this,arguments)}function actor_sheet_character_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_character_getPrototypeOf(t)););return t}function actor_sheet_character_setPrototypeOf(t,r){return actor_sheet_character_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_character_setPrototypeOf(t,r)}function actor_sheet_character_createSuper(t){var r=function actor_sheet_character_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=actor_sheet_character_getPrototypeOf(t);if(r){var i=actor_sheet_character_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return actor_sheet_character_possibleConstructorReturn(this,o)}}function actor_sheet_character_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_character_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_character_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_character_getPrototypeOf(t){return actor_sheet_character_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_character_getPrototypeOf(t)}var Y=function(t){!function actor_sheet_character_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_character_setPrototypeOf(t,r)}(ActorSheetCharacter,t);var r,o=actor_sheet_character_createSuper(ActorSheetCharacter);function ActorSheetCharacter(){return actor_sheet_character_classCallCheck(this,ActorSheetCharacter),o.apply(this,arguments)}return function actor_sheet_character_createClass(t,r,o){return r&&actor_sheet_character_defineProperties(t.prototype,r),o&&actor_sheet_character_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetCharacter,[{key:"template",get:function get(){return this.showLimited()?"systems/dsk/templates/actors/npc-limited.html":"systems/dsk/templates/actors/actor-sheet.html"}},{key:"_manageDragItems",value:(r=function actor_sheet_character_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){actor_sheet_character_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){actor_sheet_character_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(actor_sheet_character_regeneratorRuntime().mark((function _callee(t,r){var o,a,i;return actor_sheet_character_regeneratorRuntime().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:c.t0=r,c.next="aggregatedTest"===c.t0?3:"species"===c.t0?6:"culture"===c.t0?11:"profession"===c.t0?16:21;break;case 3:return c.next=5,this.actor.createEmbeddedDocuments("Item",[t]);case 5:return c.abrupt("break",22);case 6:return o=new B,c.next=9,o.addSpecies(this.actor,t);case 9:return o.render(!0),c.abrupt("break",22);case 11:return a=new Z,c.next=14,a.addCulture(this.actor,t);case 14:return a.render(!0),c.abrupt("break",22);case 16:return i=new q,c.next=19,i.addCareer(this.actor,t);case 19:return i.render(!0),c.abrupt("break",22);case 21:return c.abrupt("return",actor_sheet_character_get(actor_sheet_character_getPrototypeOf(ActorSheetCharacter.prototype),"_manageDragItems",this).call(this,t,r));case 22:case"end":return c.stop()}}),_callee,this)}))),function _manageDragItems(t,o){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_character_get(actor_sheet_character_getPrototypeOf(ActorSheetCharacter),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","actor","character-sheet"]),width:795}),t}}]),ActorSheetCharacter}(v);function actor_sheet_creature_typeof(t){return actor_sheet_creature_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_creature_typeof(t)}function actor_sheet_creature_regeneratorRuntime(){actor_sheet_creature_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_sheet_creature_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function actor_sheet_creature_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function actor_sheet_creature_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){actor_sheet_creature_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){actor_sheet_creature_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function actor_sheet_creature_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_creature_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function actor_sheet_creature_get(){return actor_sheet_creature_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=actor_sheet_creature_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},actor_sheet_creature_get.apply(this,arguments)}function actor_sheet_creature_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_creature_getPrototypeOf(t)););return t}function actor_sheet_creature_setPrototypeOf(t,r){return actor_sheet_creature_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_creature_setPrototypeOf(t,r)}function actor_sheet_creature_createSuper(t){var r=function actor_sheet_creature_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=actor_sheet_creature_getPrototypeOf(t);if(r){var i=actor_sheet_creature_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return actor_sheet_creature_possibleConstructorReturn(this,o)}}function actor_sheet_creature_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_creature_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_creature_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_creature_getPrototypeOf(t){return actor_sheet_creature_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_creature_getPrototypeOf(t)}var U=function(t){!function actor_sheet_creature_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_creature_setPrototypeOf(t,r)}(ActorSheetCreature,t);var r,o,a,i,c=actor_sheet_creature_createSuper(ActorSheetCreature);function ActorSheetCreature(){return actor_sheet_creature_classCallCheck(this,ActorSheetCreature),c.apply(this,arguments)}return function actor_sheet_creature_createClass(t,r,o){return r&&actor_sheet_creature_defineProperties(t.prototype,r),o&&actor_sheet_creature_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetCreature,[{key:"template",get:function get(){return this.showLimited()?"systems/dsk/templates/actors/creature-limited.html":"systems/dsk/templates/actors/creature-sheet.html"}},{key:"getData",value:(i=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee(t){var r;return actor_sheet_creature_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature.prototype),"getData",this).call(this,t);case 2:return r=o.sent,o.next=5,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.fight"),{secrets:!0,async:!0});case 5:return r.enrichedBehaviour=o.sent,o.next=8,TextEditor.enrichHTML(getProperty(this.actor.system,"notes.specialRules"),{secrets:!0,async:!0});case 8:return r.enrichedSpecialrules=o.sent,o.abrupt("return",r);case 10:case"end":return o.stop()}}),_callee,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"_cleverDeleteItem",value:(a=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee2(t){var r;return actor_sheet_creature_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:r=this.actor.items.find((function(r){return r.id==t})),o.t0=r.type,o.next="trait"===o.t0?4:7;break;case 4:return o.next=6,this._updateAPs(-1*r.system.ap);case 6:return o.abrupt("break",7);case 7:return o.next=9,actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature.prototype),"_cleverDeleteItem",this).call(this,t);case 9:case"end":return o.stop()}}),_callee2,this)}))),function _cleverDeleteItem(t){return a.apply(this,arguments)})},{key:"_addTrait",value:(o=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee3(t){return actor_sheet_creature_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:if(this.actor.items.find((function(r){return"trait"==r.type&&r.name==t.name}))){r.next=6;break}return r.next=4,this._updateAPs(t.system.ap);case 4:return r.next=6,this.actor.createEmbeddedDocuments("Item",[t]);case 6:case"end":return r.stop()}}),_callee3,this)}))),function _addTrait(t){return o.apply(this,arguments)})},{key:"_onDropItemCreate",value:(r=actor_sheet_creature_asyncToGenerator(actor_sheet_creature_regeneratorRuntime().mark((function _callee4(t){return actor_sheet_creature_regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:if("trait"!=t.type){r.next=2;break}return r.abrupt("return",this._addTrait(t));case 2:return r.abrupt("return",actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature.prototype),"_onDropItemCreate",this).call(this,t));case 3:case"end":return r.stop()}}),_callee4,this)}))),function _onDropItemCreate(t){return r.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_creature_get(actor_sheet_creature_getPrototypeOf(ActorSheetCreature),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","actor","creature-sheet"])}),t}}]),ActorSheetCreature}(v);function actor_sheet_npc_typeof(t){return actor_sheet_npc_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_sheet_npc_typeof(t)}function actor_sheet_npc_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_sheet_npc_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function actor_sheet_npc_get(){return actor_sheet_npc_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=actor_sheet_npc_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},actor_sheet_npc_get.apply(this,arguments)}function actor_sheet_npc_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=actor_sheet_npc_getPrototypeOf(t)););return t}function actor_sheet_npc_setPrototypeOf(t,r){return actor_sheet_npc_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_sheet_npc_setPrototypeOf(t,r)}function actor_sheet_npc_createSuper(t){var r=function actor_sheet_npc_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=actor_sheet_npc_getPrototypeOf(t);if(r){var i=actor_sheet_npc_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return actor_sheet_npc_possibleConstructorReturn(this,o)}}function actor_sheet_npc_possibleConstructorReturn(t,r){if(r&&("object"===actor_sheet_npc_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_sheet_npc_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_sheet_npc_getPrototypeOf(t){return actor_sheet_npc_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_sheet_npc_getPrototypeOf(t)}var V=function(t){!function actor_sheet_npc_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_sheet_npc_setPrototypeOf(t,r)}(ActorSheetNPC,t);var r=actor_sheet_npc_createSuper(ActorSheetNPC);function ActorSheetNPC(){return actor_sheet_npc_classCallCheck(this,ActorSheetNPC),r.apply(this,arguments)}return function actor_sheet_npc_createClass(t,r,o){return r&&actor_sheet_npc_defineProperties(t.prototype,r),o&&actor_sheet_npc_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(ActorSheetNPC,[{key:"template",get:function get(){return this.showLimited()?"systems/dsk/templates/actors/npc-limited.html":"systems/dsk/templates/actors/npc-sheet.html"}}],[{key:"defaultOptions",get:function get(){var t=actor_sheet_npc_get(actor_sheet_npc_getPrototypeOf(ActorSheetNPC),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","actor","npc-sheet"])}),t}}]),ActorSheetNPC}(Y);function journal_sheet_typeof(t){return journal_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},journal_sheet_typeof(t)}function journal_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function journal_sheet_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function journal_sheet_get(){return journal_sheet_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=journal_sheet_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},journal_sheet_get.apply(this,arguments)}function journal_sheet_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=journal_sheet_getPrototypeOf(t)););return t}function journal_sheet_setPrototypeOf(t,r){return journal_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},journal_sheet_setPrototypeOf(t,r)}function journal_sheet_createSuper(t){var r=function journal_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=journal_sheet_getPrototypeOf(t);if(r){var i=journal_sheet_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return journal_sheet_possibleConstructorReturn(this,o)}}function journal_sheet_possibleConstructorReturn(t,r){if(r&&("object"===journal_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function journal_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function journal_sheet_getPrototypeOf(t){return journal_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},journal_sheet_getPrototypeOf(t)}var J=function(t){!function journal_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&journal_sheet_setPrototypeOf(t,r)}(DSKJournalSheet,JournalSheet);var r=journal_sheet_createSuper(DSKJournalSheet);function DSKJournalSheet(){return journal_sheet_classCallCheck(this,DSKJournalSheet),r.apply(this,arguments)}return function journal_sheet_createClass(t,r,o){return r&&journal_sheet_defineProperties(t.prototype,r),o&&journal_sheet_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKJournalSheet,null,[{key:"defaultOptions",get:function get(){var t=journal_sheet_get(journal_sheet_getPrototypeOf(DSKJournalSheet),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["dsk","dskjournal"])}),t}}]),DSKJournalSheet}(),Q=__webpack_require__(565);function journal_typeof(t){return journal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},journal_typeof(t)}function journal_regeneratorRuntime(){journal_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==journal_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function journal_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function setupJournal(){Hooks.on("getJournalSheetHeaderButtons",(function(t,r){var o;t.document.sceneNote&&r.unshift({class:"panMapNote",icon:"fas fa-map-pin",onclick:(o=function journal_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){journal_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){journal_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(journal_regeneratorRuntime().mark((function _callee(){return journal_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.document.panToNote());case 1:case"end":return r.stop()}}),_callee)}))),function onclick(){return o.apply(this,arguments)})})}))}function createHotBarMacro(t,r,o,a){var i=game.macros.contents.find((function(o){return o.name===r&&o.command===t}));return i?game.user.assignHotbarMacro(i,a):Macro.create({name:r,type:"script",img:o,command:t},{displaySheet:!1}).then((function(t){return game.user.assignHotbarMacro(t,a)})),!1}function didyouknow_typeof(t){return didyouknow_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},didyouknow_typeof(t)}function didyouknow_regeneratorRuntime(){didyouknow_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==didyouknow_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function didyouknow_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function didyouknow_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){didyouknow_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){didyouknow_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function didyouknow_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var X=function(){function DidYouKnow(){!function didyouknow_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DidYouKnow)}var t,r;return function didyouknow_createClass(t,r,o){return r&&didyouknow_defineProperties(t.prototype,r),o&&didyouknow_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DidYouKnow,null,[{key:"stopFade",value:(r=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee3(t){return didyouknow_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:t.stopPropagation(),t.preventDefault(),this.fadeOut?(this.fadeOut=!1,$(t.currentTarget).find("i").removeClass("fa-stop").addClass("fa-angle-right"),$(".didYouKnow").off("click"),$(".didYouKnow .closeDidYou").click((function(){return $(".didYouKnow").remove()}))):fetch("systems/dsk/lazy/didyouknow/".concat(game.i18n.lang,".json")).then(function(){var t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee(t){return didyouknow_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee2(t){var r,o;return didyouknow_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return r=t.data[Math.floor(Math.random()*t.data.length)],a.next=3,renderTemplate("systems/dsk/templates/system/didyouknow.html",{msg:r,fadeOut:DidYouKnow.fadeOut});case 3:o=a.sent,$("body").find(".didYouKnow").replaceWith(o),DidYouKnow.activateListeners();case 6:case"end":return a.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}());case 3:case"end":return r.stop()}}),_callee3,this)}))),function stopFade(t){return r.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(){var t=this;$(".didYouKnow .stopFade").click(function(){var r=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee4(r){return didyouknow_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,t.stopFade(r);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}}),_callee4)})));return function(t){return r.apply(this,arguments)}}()),$(".didYouKnow").click((function(){return $(".didYouKnow").remove()})),$(".didYouKnow").fadeIn()}},{key:"showOneMessage",value:(t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee7(){var t,r=this,o=arguments;return didyouknow_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:8e3,!game.settings.get("dsk","disableDidYouKnow")){a.next=3;break}return a.abrupt("return");case 3:fetch("systems/dsk/lazy/didyouknow/".concat(game.i18n.lang,".json")).then(function(){var t=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee5(t){return didyouknow_regeneratorRuntime().wrap((function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var o=didyouknow_asyncToGenerator(didyouknow_regeneratorRuntime().mark((function _callee6(o){var a,i;return didyouknow_regeneratorRuntime().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return a=o.data[Math.floor(Math.random()*o.data.length)],c.next=3,renderTemplate("systems/dsk/templates/system/didyouknow.html",{msg:a,fadeOut:DidYouKnow.fadeOut});case 3:i=c.sent,$("body").append(i),r.activateListeners(),setTimeout((function(){DidYouKnow.fadeOut&&$(".didYouKnow").fadeOut(1e3,(function(){return $(".didYouKnow").remove()}))}),t);case 7:case"end":return c.stop()}}),_callee6)})));return function(t){return o.apply(this,arguments)}}());case 4:case"end":return a.stop()}}),_callee7)}))),function showOneMessage(){return t.apply(this,arguments)})}]),DidYouKnow}();function tutorial_typeof(t){return tutorial_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tutorial_typeof(t)}function tutorial_regeneratorRuntime(){tutorial_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==tutorial_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function tutorial_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function tutorial_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){tutorial_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){tutorial_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function tutorial_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}!function didyouknow_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(X,"fadeOut",!0);var ee=function(){function DSKTutorial(){!function tutorial_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKTutorial)}var r,o,a;return function tutorial_createClass(t,r,o){return r&&tutorial_defineProperties(t.prototype,r),o&&tutorial_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKTutorial,null,[{key:"firstTimeMessage",value:(a=tutorial_asyncToGenerator(tutorial_regeneratorRuntime().mark((function _callee(){var r;return tutorial_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,game.settings.get("dsk","firstTimeStart");case 2:if(o.sent){o.next=10;break}return o.next=5,DSKTutorial.setupDefaultOptions();case 5:return r=game.i18n.localize("dsk.WELCOME"),ChatMessage.create(t.Z.chatDataSetup(r)),DSKTutorial.firstTimeLanguage(),o.next=10,game.settings.set("dsk","firstTimeStart",!0);case 10:case"end":return o.stop()}}),_callee)}))),function firstTimeMessage(){return a.apply(this,arguments)})},{key:"firstTimeLanguage",value:function firstTimeLanguage(){for(var t={title:game.i18n.localize("dsk.DIALOG.firstTime"),content:game.i18n.localize("dsk.DIALOG.firstTimeWarning"),default:"de",buttons:{}},r=function _loop(){var r=a[o];t.buttons[r]={label:game.i18n.localize(r),callback:function callback(){return DSKTutorial.setLanguage(r)}}},o=0,a=["de"];o<a.length;o++)r();new Dialog(t).render(!0)}},{key:"setLanguage",value:(o=tutorial_asyncToGenerator(tutorial_regeneratorRuntime().mark((function _callee2(t){return tutorial_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("dsk","firstTimeStart",!0);case 2:return r.next=4,game.settings.set("dsk","forceLanguage",t);case 4:return r.next=6,game.settings.set("core","language",t);case 6:foundry.utils.debouncedReload();case 7:case"end":return r.stop()}}),_callee2)}))),function setLanguage(t){return o.apply(this,arguments)})},{key:"setupDefaultOptions",value:(r=tutorial_asyncToGenerator(tutorial_regeneratorRuntime().mark((function _callee3(){var t;return tutorial_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return(t=game.settings.get("core",Combat.CONFIG_SETTING)).skipDefeated=!0,r.next=4,game.settings.set("core",Combat.CONFIG_SETTING,t);case 4:return r.next=6,game.settings.set("core","leftClickRelease",!0);case 6:case"end":return r.stop()}}),_callee3)}))),function setupDefaultOptions(){return r.apply(this,arguments)})}]),DSKTutorial}();function itemDrop_typeof(t){return itemDrop_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},itemDrop_typeof(t)}function itemDrop_regeneratorRuntime(){itemDrop_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==itemDrop_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function itemDrop_toConsumableArray(t){return function itemDrop_arrayWithoutHoles(t){if(Array.isArray(t))return itemDrop_arrayLikeToArray(t)}(t)||function itemDrop_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||itemDrop_unsupportedIterableToArray(t)||function itemDrop_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function itemDrop_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return itemDrop_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?itemDrop_arrayLikeToArray(t,r):void 0}}function itemDrop_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function itemDrop_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function itemDrop_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){itemDrop_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){itemDrop_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}var te=function(){var r=itemDrop_asyncToGenerator(itemDrop_regeneratorRuntime().mark((function _callee(r,o,a,i){var c,u,l,p,d,h,m,g,v;return itemDrop_regeneratorRuntime().wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:if(!game.user.isGM){_.next=36;break}return _.next=3,t.Z.getFolderForType("Actor",null,"Dropped Items");case 3:return c=_.sent,u=game.users.filter((function(t){return!t.isGM})).map((function(t){return t.id})),l=u.reduce((function(t,r){return t[r]=1,t}),{default:0}),(p=o.toObject()).system.quantity=i,y.Z.obfuscateDropData(p,a.tabsinvisible),getProperty(p,"system.worn.value")&&(p.system.worn.value=!1),d={type:"npc",name:o.name,img:o.img,prototypeToken:{img:o.img,width:.4,height:.4},ownership:l,items:[].concat(itemDrop_toConsumableArray(items),[p]),flags:{core:{sheetClass:"dsk.MerchantSheetDSK"}},folder:c,system:{merchant:{merchantType:"loot",temporary:!0,hidePlayer:1},status:{LeP:{value:16}}}},_.next=13,game.dsk.documents.ActorDSK.create(d);case 13:return h=_.sent,_.next=16,h.getTokenDocument({x:a.x,y:a.y,hidden:!1});case 16:if(m=_.sent,canvas.dimensions.rect.contains(m.x,m.y)){_.next=19;break}return _.abrupt("return",!1);case 19:if(!r){_.next=32;break}return _.next=22,canvas.scene.createEmbeddedDocuments("Token",[m],{noHook:!0});case 22:if(!((g=o.system.quantity-i)<1)){_.next=28;break}return _.next=26,r.deleteEmbeddedDocuments("Item",[o.id]);case 26:_.next=30;break;case 28:return _.next=30,r.updateEmbeddedDocuments("Item",[{_id:o.id,"system.quantity":g}]);case 30:_.next=34;break;case 32:return _.next=34,canvas.scene.createEmbeddedDocuments("Token",[m]);case 34:_.next=38;break;case 36:v={itemId:o.uuid,sourceActorId:null==r?void 0:r.id,data:a,amount:i},game.socket.emit("system.dsk",{type:"itemDrop",payload:v});case 38:case"end":return _.stop()}}),_callee)})));return function dropToGround(t,o,a,i){return r.apply(this,arguments)}}(),re=__webpack_require__(846),ne=__webpack_require__(448);function dialog_react_typeof(t){return dialog_react_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dialog_react_typeof(t)}function dialog_react_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function dialog_react_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dialog_react_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return dialog_react_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function dialog_react_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function dialog_react_regeneratorRuntime(){dialog_react_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dialog_react_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dialog_react_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dialog_react_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dialog_react_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dialog_react_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dialog_react_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dialog_react_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dialog_react_createClass(t,r,o){return r&&dialog_react_defineProperties(t.prototype,r),o&&dialog_react_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function dialog_react_get(){return dialog_react_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dialog_react_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dialog_react_get.apply(this,arguments)}function dialog_react_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dialog_react_getPrototypeOf(t)););return t}function dialog_react_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dialog_react_setPrototypeOf(t,r)}function dialog_react_setPrototypeOf(t,r){return dialog_react_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dialog_react_setPrototypeOf(t,r)}function dialog_react_createSuper(t){var r=function dialog_react_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dialog_react_getPrototypeOf(t);if(r){var i=dialog_react_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dialog_react_possibleConstructorReturn(this,o)}}function dialog_react_possibleConstructorReturn(t,r){if(r&&("object"===dialog_react_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dialog_react_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dialog_react_getPrototypeOf(t){return dialog_react_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dialog_react_getPrototypeOf(t)}var oe=function(t){dialog_react_inherits(DialogReactDSK,Dialog);var r,o,a=dialog_react_createSuper(DialogReactDSK);function DialogReactDSK(){return dialog_react_classCallCheck(this,DialogReactDSK),a.apply(this,arguments)}return dialog_react_createClass(DialogReactDSK,null,[{key:"showDialog",value:(o=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee(t){var r;return dialog_react_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return r=this.callbackResult,o.t0=DialogReactDSK,o.t1=game.i18n.localize("dsk.Unopposed"),o.next=5,this.getTemplate(t);case 5:o.t2=o.sent,o.t3={ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:function callback(o){r(o.find('[name="entryselection"]').val(),t)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}},o.t4={title:o.t1,content:o.t2,default:"ok",buttons:o.t3},new o.t0(o.t4).render(!0);case 9:case"end":return o.stop()}}),_callee,this)}))),function showDialog(t){return o.apply(this,arguments)})},{key:"getTargetActor",value:function getTargetActor(t){if(!canvas.tokens)return{};var r=t.flags.unopposeData.targetSpeaker,o=canvas.tokens.get(r.token).actor;return o?{actor:o,tokenId:r.token}:(ui.notifications.error(game.i18n.localize("dsk.DSKError.noProperActor")),{})}},{key:"getTemplate",value:(r=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee2(t){return dialog_react_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return","");case 1:case"end":return t.stop()}}),_callee2)}))),function getTemplate(t){return r.apply(this,arguments)})},{key:"callbackResult",value:function callbackResult(t,r,o){}},{key:"defaultOptions",get:function get(){var t=dialog_react_get(dialog_react_getPrototypeOf(DialogReactDSK),"defaultOptions",this);return mergeObject(t,{resizable:!0}),t}}]),DialogReactDSK}(),ae=function(t){dialog_react_inherits(ActAttackDialog,Dialog);var o,a,i=dialog_react_createSuper(ActAttackDialog);function ActAttackDialog(){return dialog_react_classCallCheck(this,ActAttackDialog),i.apply(this,arguments)}return dialog_react_createClass(ActAttackDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;dialog_react_get(dialog_react_getPrototypeOf(ActAttackDialog.prototype),"activateListeners",this).call(this,t),t.find(".reactClick").click((function(t){r.callbackResult(t.currentTarget.dataset.value,r.actor,r.tokenId),r.close()}))}},{key:"callbackResult",value:function callbackResult(t,r,o){var a=["meleeweapon","trait","rangeweapon"],i=r.items.find((function(r){return a.includes(r.type)&&r.name==t}));i&&r.setupWeapon(i,"attack",{},o).then((function(t){r.basicTest(t)}))}}],[{key:"showDialog",value:(a=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee4(t,r){var o;return dialog_react_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=ActAttackDialog,a.t1=game.i18n.localize("dsk.attacktest"),a.next=4,this.getTemplate(t);case 4:a.t2=a.sent,a.t3={},a.t4={title:a.t1,content:a.t2,buttons:a.t3},(o=new a.t0(a.t4)).actor=t,o.tokenId=r,o.render(!0);case 11:case"end":return a.stop()}}),_callee4,this)}))),function showDialog(t,r){return a.apply(this,arguments)})},{key:"getTemplate",value:(o=dialog_react_asyncToGenerator(dialog_react_regeneratorRuntime().mark((function _callee5(t){var o,a,i,c,u,l,p,d;return dialog_react_regeneratorRuntime().wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:o=t.items.filter((function(t){return"combatskill"==t.type})).map((function(o){return r.Z._calculateCombatSkillValues(o.toObject(),t.system)})),a=[],i=["meleeweapon","rangeweapon"],c=["meleeAttack","rangeAttack"],u=dialog_react_createForOfIteratorHelper(t.items);try{for(u.s();!(l=u.n()).done;)p=l.value,i.includes(p.type)&&1==p.system.worn.value?(d="meleeweapon"==p.type?r.Z._prepareMeleeWeapon(p.toObject(),o,t):r.Z._prepareRangeWeapon(p.toObject(),[],o,t),a.push({name:p.name,id:p.name,img:p.img,value:d.attack})):"trait"==p.type&&c.includes(p.system.traitType)&&a.push({name:p.name,id:p.name,img:p.img,value:p.system.at})}catch(t){u.e(t)}finally{u.f()}return h.next=8,renderTemplate("systems/dsk/templates/dialog/dialog-reaction-attack.html",{dieClass:"die-mu",items:a,title:"dsk.DIALOG.selectAction"});case 8:return h.abrupt("return",h.sent);case 9:case"end":return h.stop()}}),_callee5)}))),function getTemplate(t){return o.apply(this,arguments)})},{key:"defaultOptions",get:function get(){var t=dialog_react_get(dialog_react_getPrototypeOf(ActAttackDialog),"defaultOptions",this);return mergeObject(t,{width:550}),t}}]),ActAttackDialog}();function combat_tracker_typeof(t){return combat_tracker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},combat_tracker_typeof(t)}function combat_tracker_regeneratorRuntime(){combat_tracker_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==combat_tracker_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function combat_tracker_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function combat_tracker_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return combat_tracker_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return combat_tracker_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function combat_tracker_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function combat_tracker_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function combat_tracker_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){combat_tracker_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){combat_tracker_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function combat_tracker_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function combat_tracker_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function combat_tracker_createClass(t,r,o){return r&&combat_tracker_defineProperties(t.prototype,r),o&&combat_tracker_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function combat_tracker_get(){return combat_tracker_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=combat_tracker_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},combat_tracker_get.apply(this,arguments)}function combat_tracker_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=combat_tracker_getPrototypeOf(t)););return t}function combat_tracker_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&combat_tracker_setPrototypeOf(t,r)}function combat_tracker_setPrototypeOf(t,r){return combat_tracker_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},combat_tracker_setPrototypeOf(t,r)}function combat_tracker_createSuper(t){var r=function combat_tracker_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=combat_tracker_getPrototypeOf(t);if(r){var i=combat_tracker_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return combat_tracker_possibleConstructorReturn(this,o)}}function combat_tracker_possibleConstructorReturn(t,r){if(r&&("object"===combat_tracker_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function combat_tracker_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function combat_tracker_getPrototypeOf(t){return combat_tracker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},combat_tracker_getPrototypeOf(t)}var ie=function(t){combat_tracker_inherits(DSKCombatTracker,CombatTracker);var o,a=combat_tracker_createSuper(DSKCombatTracker);function DSKCombatTracker(){return combat_tracker_classCallCheck(this,DSKCombatTracker),a.apply(this,arguments)}return combat_tracker_createClass(DSKCombatTracker,[{key:"activateListeners",value:function activateListeners(t){combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombatTracker.prototype),"activateListeners",this).call(this,t),t.find(".combatant.actor .aggroButton").click((function(t){t.preventDefault(),t.stopPropagation(),DSKCombatTracker.runActAttackDialog()}))}},{key:"getData",value:(o=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee(t){var o,a,i,c;return combat_tracker_regeneratorRuntime().wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombatTracker.prototype),"getData",this).call(this,t);case 2:o=u.sent,a=combat_tracker_createForOfIteratorHelper(o.turns);try{for(c=function _loop(){var t=i.value,a=o.combat.turns.find((function(r){return r.id==t.id})),c=game.user.isGM||a.actor&&a.actor.testUserPermission(game.user,"OBSERVER")||!game.settings.get("dsk","hideEffects");t.defenseCount=a.getFlag("dsk","defenseCount")||0;var u=[];if(a.actor){var l,p=combat_tracker_createForOfIteratorHelper(a.actor.items);try{for(p.s();!(l=p.n()).done;){var d=l.value;if("rangeweapon"==d.type&&d.system.worn.value&&d.system.reloadTimeprogress>0){var h={name:d.name,remaining:r.Z.calcLZ(d,a.actor)-d.system.reloadTimeprogress};h.remaining>0&&u.push(h)}else if(["spell","liturgy"].includes(d.type)&&d.system.castingTime.modified>0){var y={name:d.name,remaining:d.system.castingTime.modified-d.system.castingTime.progress};y.remaining>0&&u.push(y)}}}catch(t){p.e(t)}finally{p.f()}}(u=u.sort((function(t,r){return t.remaining-r.remaining}))).length>0&&(t.ongoings="".concat(game.i18n.localize("dsk.COMBATTRACKER.ongoing"),"\n").concat(u.map((function(t){return"".concat(t.name," - ").concat(t.remaining)})).join("\n")),t.ongoing=u[0].remaining),t.effects=new Set,a.token&&(a.token.effects.forEach((function(r){return t.effects.add(r)})),a.token.overlayEffect&&t.effects.add(a.token.overlayEffect)),a.actor&&a.actor.temporaryEffects.forEach((function(r){r.getFlag("core","statusId")===CONFIG.Combat.defeatedStatusId?t.defeated=!0:!r.icon||!c||r.notApplicable||!game.user.isGM&&r.getFlag("dsk","hidePlayers")||r.getFlag("dsk","hideOnToken")||t.effects.add(r.icon)}))},a.s();!(i=a.n()).done;)c()}catch(t){a.e(t)}finally{a.f()}return u.abrupt("return",o);case 6:case"end":return u.stop()}}),_callee,this)}))),function getData(t){return o.apply(this,arguments)})}],[{key:"defaultOptions",get:function get(){return foundry.utils.mergeObject(combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombatTracker),"defaultOptions",this),{template:"/systems/dsk/templates/system/combattracker.html"})}},{key:"runActAttackDialog",value:function runActAttackDialog(){if(game.combat){var t=game.combat.combatant;(game.user.isGM||t.isOwner)&&ae.showDialog(t.actor,t.tokenId)}}}]),DSKCombatTracker}(),ce=function(t){combat_tracker_inherits(DSKCombat,Combat);var r,o,a,i,c=combat_tracker_createSuper(DSKCombat);function DSKCombat(t,r){return combat_tracker_classCallCheck(this,DSKCombat),c.call(this,t,r)}return combat_tracker_createClass(DSKCombat,[{key:"refreshTokenbars",value:(i=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee2(){return combat_tracker_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:game.dsk.apps.tokenHotbar&&game.dsk.apps.tokenHotbar.updateDSKHotbar();case 1:case"end":return t.stop()}}),_callee2)}))),function refreshTokenbars(){return i.apply(this,arguments)})},{key:"_onCreate",value:function _onCreate(t,r,o){combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombat.prototype),"_onCreate",this).call(this,t,r,o),this.refreshTokenbars()}},{key:"_onDelete",value:function _onDelete(t,r){combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombat.prototype),"_onDelete",this).call(this,t,r),this.refreshTokenbars()}},{key:"nextRound",value:(a=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee3(){var t,r,o;return combat_tracker_regeneratorRuntime().wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(!game.user.isGM){a.next=20;break}t=combat_tracker_createForOfIteratorHelper(this.turns),a.prev=2,t.s();case 4:if((r=t.n()).done){a.next=10;break}return o=r.value,a.next=8,o.setFlag("dsk","defenseCount",0);case 8:a.next=4;break;case 10:a.next=15;break;case 12:a.prev=12,a.t0=a.catch(2),t.e(a.t0);case 15:return a.prev=15,t.f(),a.finish(15);case 18:a.next=22;break;case 20:return a.next=22,game.socket.emit("system.dsk",{type:"clearCombat",payload:{}});case 22:return a.next=24,combat_tracker_get(combat_tracker_getPrototypeOf(DSKCombat.prototype),"nextRound",this).call(this);case 24:return a.abrupt("return",a.sent);case 25:case"end":return a.stop()}}),_callee3,this,[[2,12,15,18]])}))),function nextRound(){return a.apply(this,arguments)})},{key:"getDefenseCount",value:(o=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee4(t){var r;return combat_tracker_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return r=this.getCombatantFromActor(t),o.abrupt("return",r&&r.getFlag("dsk","defenseCount")||0);case 2:case"end":return o.stop()}}),_callee4,this)}))),function getDefenseCount(t){return o.apply(this,arguments)})},{key:"getCombatantFromActor",value:function getCombatantFromActor(t){var r;return(r=t.token?Array.from(this.combatants).find((function(r){return r.tokenId==t.token})):Array.from(this.combatants).find((function(r){return r.actorId==t.actor})))?this.combatants.get(r.id):void 0}},{key:"updateDefenseCount",value:(r=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee5(t){var r;return combat_tracker_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:if(!game.user.isGM){o.next=7;break}if(!(r=this.getCombatantFromActor(t))||getProperty(r.actor,"system.config.defense")){o.next=5;break}return o.next=5,r.setFlag("dsk","defenseCount",(r.getFlag("dsk","defenseCount")||0)+1);case 5:o.next=9;break;case 7:return o.next=9,game.socket.emit("system.dsk",{type:"updateDefenseCount",payload:{speaker:t}});case 9:case"end":return o.stop()}}),_callee5,this)}))),function updateDefenseCount(t){return r.apply(this,arguments)})}]),DSKCombat}(),se=function(t){combat_tracker_inherits(DSKCombatant,Combatant);var r,o=combat_tracker_createSuper(DSKCombatant);function DSKCombatant(t,r){return combat_tracker_classCallCheck(this,DSKCombatant),null==t.flags&&(t.flags={}),mergeObject(t.flags,{dsk:{defenseCount:0}}),o.call(this,t,r)}return combat_tracker_createClass(DSKCombatant,[{key:"recalcInitiative",value:(r=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee6(){var t,r;return combat_tracker_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:if(!this.initiative){o.next=10;break}return o.next=3,this.getFlag("dsk","baseRoll");case 3:if(o.t0=o.sent,o.t0){o.next=6;break}o.t0=0;case 6:return t=o.t0,r={initiative:t+this.actor.system.stats.ini.value},o.next=10,this.update(r);case 10:case"end":return o.stop()}}),_callee6,this)}))),function recalcInitiative(){return r.apply(this,arguments)})}]),DSKCombatant}();Hooks.on("preCreateCombatant",(function(r,o,a){var i=t.Z.getSpeaker({actor:r.actorId,scene:r.sceneId,token:r.token_id});if("loot"==getProperty(i.system,"merchant.merchantType"))return!1})),Hooks.on("updateCombatant",(function(t,r,o){if(r.initiative){if(!t.getFlag("dsk","baseRoll")){var a="".concat(r.initiative).split("."),i=Number(a[0])-Math.round(t.actor.system.stats.ini.value);t.setFlag("dsk","baseRoll",i)}}else"initiative"in r&&null==r.initiative&&t.update(function combat_tracker_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}({},"flags.dsk.-=baseRoll",null))}));var ue=function(){function RepeatingEffectsHelper(){combat_tracker_classCallCheck(this,RepeatingEffectsHelper)}var r,o,a,i,c;return combat_tracker_createClass(RepeatingEffectsHelper,null,[{key:"updateCombatHook",value:(c=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee7(t,r,o,a){return combat_tracker_regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:if(r.round||r.turn){o.next=2;break}return o.abrupt("return");case 2:if(0==t.round||!t.turns||!t.active){o.next=6;break}if(!(t.previous.round<t.current.round)){o.next=6;break}return o.next=6,RepeatingEffectsHelper.startOfRound(t);case 6:case"end":return o.stop()}}),_callee7)}))),function updateCombatHook(t,r,o,a){return c.apply(this,arguments)})},{key:"startOfRound",value:(i=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee8(t){var r,o,a,i,c,u,l,p;return combat_tracker_regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:if((r=game.users.find((function(t){return t.active&&t.isGM})))&&game.user.id==r.id){d.next=3;break}return d.abrupt("return");case 3:o=combat_tracker_createForOfIteratorHelper(t.turns),d.prev=4,o.s();case 6:if((a=o.n()).done){d.next=37;break}if((i=a.value).defeated){d.next=35;break}c=combat_tracker_createForOfIteratorHelper(i.actor.effects),d.prev=10,c.s();case 12:if((u=c.n()).done){d.next=25;break}if(l=u.value,"bleeding"!=(p=l.getFlag("core","statusId"))){d.next=20;break}return d.next=18,this.applyBleeding(i);case 18:d.next=23;break;case 20:if("burning"!=p){d.next=23;break}return d.next=23,this.applyBurning(i,l);case 23:d.next=12;break;case 25:d.next=30;break;case 27:d.prev=27,d.t0=d.catch(10),c.e(d.t0);case 30:return d.prev=30,c.f(),d.finish(30);case 33:return d.next=35,this.startOfRoundEffects(i);case 35:d.next=6;break;case 37:d.next=42;break;case 39:d.prev=39,d.t1=d.catch(4),o.e(d.t1);case 42:return d.prev=42,o.f(),d.finish(42);case 45:case"end":return d.stop()}}),_callee8,this,[[4,39,42,45],[10,27,30,33]])}))),function startOfRound(t){return i.apply(this,arguments)})},{key:"startOfRoundEffects",value:(a=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee9(r){var o,a,i,c,u,l,p,d,h,y;return combat_tracker_regeneratorRuntime().wrap((function _callee9$(m){for(;;)switch(m.prev=m.next){case 0:o=0,a=["LeP","AeP"];case 2:if(!(o<a.length)){m.next=41;break}i=a[o],c=combat_tracker_createForOfIteratorHelper(r.actor.system.repeatingEffects.startOfRound[i]),m.prev=5,c.s();case 7:if((u=c.n()).done){m.next=30;break}if(l=u.value,!getProperty(r.actor.system.repeatingEffects,"disabled.".concat(i))){m.next=11;break}return m.abrupt("continue",28);case 11:return m.next=13,new Roll(l.value).evaluate({async:!0});case 13:return p=m.sent,m.next=16,p.render();case 16:return d=m.sent,h=game.i18n.localize(p.total>0?"dsk.CHATNOTIFICATION.regenerates":"dsk.CHATNOTIFICATION.getsHurt"),y="".concat(r.actor.name," ").concat(h," ").concat(game.i18n.localize(i)," ").concat(d),m.next=21,ChatMessage.create(t.Z.chatDataSetup(y));case 21:if("LeP"!=i){m.next=26;break}return m.next=24,r.actor.applyDamage(-1*p.total);case 24:m.next=28;break;case 26:return m.next=28,r.actor.applyMana(-1*p.total);case 28:m.next=7;break;case 30:m.next=35;break;case 32:m.prev=32,m.t0=m.catch(5),c.e(m.t0);case 35:return m.prev=35,c.f(),m.finish(35);case 38:o++,m.next=2;break;case 41:case"end":return m.stop()}}),_callee9,null,[[5,32,35,38]])}))),function startOfRoundEffects(t){return a.apply(this,arguments)})},{key:"applyBleeding",value:(o=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee10(r){return combat_tracker_regeneratorRuntime().wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:if(!(r.actor.system.stats.LeP.value<=0)){o.next=2;break}return o.abrupt("return");case 2:return o.next=4,ChatMessage.create(t.Z.chatDataSetup(game.i18n.format("dsk.CHATNOTIFICATION.bleeding",{actor:r.actor.name})));case 4:return o.next=6,r.actor.applyDamage(1);case 6:case"end":return o.stop()}}),_callee10)}))),function applyBleeding(t){return o.apply(this,arguments)})},{key:"applyBurning",value:(r=combat_tracker_asyncToGenerator(combat_tracker_regeneratorRuntime().mark((function _callee11(r,o){var a,i,c,u,l;return combat_tracker_regeneratorRuntime().wrap((function _callee11$(p){for(;;)switch(p.prev=p.next){case 0:if(!(r.actor.system.stats.LeP.value<=0)){p.next=2;break}return p.abrupt("return");case 2:return a=Number(o.getFlag("dsk","value")),i=DSKStatusEffects.resistantToEffect(r.actor,o),c={0:"1",1:"1d3",2:"1d6",3:"2d6"}[a-i]||"1",p.next=7,new Roll(c).evaluate({async:!0});case 7:return u=p.sent,p.next=10,u.render();case 10:return l=p.sent,p.next=13,ChatMessage.create(t.Z.chatDataSetup(game.i18n.format("dsk.CHATNOTIFICATION.burning.".concat(a),{actor:r.actor.name,damage:l})));case 13:return p.next=15,r.actor.applyDamage(u.total);case 15:case"end":return p.stop()}}),_callee11)}))),function applyBurning(t,o){return r.apply(this,arguments)})}]),RepeatingEffectsHelper}();function dsk_ini_tracker_typeof(t){return dsk_ini_tracker_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dsk_ini_tracker_typeof(t)}function dsk_ini_tracker_regeneratorRuntime(){dsk_ini_tracker_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dsk_ini_tracker_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dsk_ini_tracker_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dsk_ini_tracker_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dsk_ini_tracker_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dsk_ini_tracker_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dsk_ini_tracker_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dsk_ini_tracker_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dsk_ini_tracker_get(){return dsk_ini_tracker_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dsk_ini_tracker_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dsk_ini_tracker_get.apply(this,arguments)}function dsk_ini_tracker_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dsk_ini_tracker_getPrototypeOf(t)););return t}function dsk_ini_tracker_setPrototypeOf(t,r){return dsk_ini_tracker_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dsk_ini_tracker_setPrototypeOf(t,r)}function dsk_ini_tracker_createSuper(t){var r=function dsk_ini_tracker_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dsk_ini_tracker_getPrototypeOf(t);if(r){var i=dsk_ini_tracker_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dsk_ini_tracker_possibleConstructorReturn(this,o)}}function dsk_ini_tracker_possibleConstructorReturn(t,r){if(r&&("object"===dsk_ini_tracker_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dsk_ini_tracker_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dsk_ini_tracker_getPrototypeOf(t){return dsk_ini_tracker_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dsk_ini_tracker_getPrototypeOf(t)}Hooks.on("updateCombat",ue.updateCombatHook);var le=function(t){!function dsk_ini_tracker_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dsk_ini_tracker_setPrototypeOf(t,r)}(DSKIniTracker,Application);var r,o,a,i,c=dsk_ini_tracker_createSuper(DSKIniTracker);function DSKIniTracker(){return dsk_ini_tracker_classCallCheck(this,DSKIniTracker),c.apply(this,arguments)}return function dsk_ini_tracker_createClass(t,r,o){return r&&dsk_ini_tracker_defineProperties(t.prototype,r),o&&dsk_ini_tracker_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKIniTracker,[{key:"setPosition",value:function setPosition(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.left,o=t.top,a=t.width,i=t.height,c=t.scale,u=dsk_ini_tracker_get(dsk_ini_tracker_getPrototypeOf(DSKIniTracker.prototype),"setPosition",this).call(this,{left:r,top:o,width:a,height:i,scale:c}),l=this.element[0];if(!l.style.width||a){var p=a||l.offsetWidth,d=l.style.maxWidth||window.innerWidth;u.width=a=Math.clamped(p,0,d),l.style.width=a+"px",a+u.left>window.innerWidth&&(r=u.left)}return game.settings.set("dsk","iniTrackerPosition",{left:u.left,top:u.top}),u}},{key:"updateTracker",value:function updateTracker(t){this.combatData=t,this.render(!0)}},{key:"getData",value:(i=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee(t){var r,o,a,i,c,u,l,p,d,h,y,m,g,v,_,b,k;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.combatData,o=game.settings.get("dsk","iniTrackerSize"),a=r.round,i=r.turns,c=[],u=game.settings.get("core",Combat.CONFIG_SETTING).skipDefeated,l=r.turns.some((function(t){return t.owner&&!t.hasRolled&&(!game.user.isGM||r.combat.combatants.get(t.id).isNPC)})),i.length){for(p=[],d=5,h=!1,y=-1,m=0,g=0;0!=d&&5!=g;)_=duplicate(i[m]),b=r.combat.combatants.get(_.id),h&&m==y&&(_.css=_.css.replace("active","")),!a||_.active&&!h?(h=!0,y=m):b.getFlag("dsk","waitInit")!=r.round+g||b.defeated||!game.user.isGM&&b.hidden||c.push(_),!h||u&&b.defeated||!game.user.isGM&&b.hidden||(_.round=r.round+g,_.owner&&null!==(k=b.token)&&void 0!==k&&k.actor&&(_.maxLP=b.token.actor.system.stats.LeP.max,_.currentLP=b.token.actor.system.stats.LeP.value),v&&v!=_.round&&(_.newRound="newRound"),v=_.round,p.push(_),d--),++m>=i.length&&(m=0,g++);r.turns=p}return this.position.width=5*o+95,this.position.height=o+10,mergeObject(r,{itemWidth:o,unRolled:l,waitingTurns:c}),this.conditionalPanToCurrentCombatant(r),t.abrupt("return",r);case 13:case"end":return t.stop()}}),_callee,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"hasChangedTurn",value:function hasChangedTurn(t){var r=t.turn!=this.lastTurnUpdate||t.round!=this.lastRoundUpdate;return this.lastTurnUpdate=t.turn,this.lastRoundUpdate=t.round,r}},{key:"conditionalPanToCurrentCombatant",value:(a=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee2(t){var r,o;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(game.settings.get("dsk","enableCombatPan")){a.next=2;break}return a.abrupt("return");case 2:if(r=t.turns[0]){a.next=5;break}return a.abrupt("return");case 5:if((o=t.combat.combatants.get(r.id))&&this.hasChangedTurn(t)){a.next=8;break}return a.abrupt("return");case 8:setTimeout((function(){var t=o.token;t&&t.object&&t.object.isVisible&&(canvas.animatePan({x:t.x,y:t.y}),o.actor&&o.actor.isOwner&&t.object.control({releaseOthers:!0}))}),300);case 9:case"end":return a.stop()}}),_callee2,this)}))),function conditionalPanToCurrentCombatant(t){return a.apply(this,arguments)})},{key:"_onWheelResize",value:(o=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee3(t){var r;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return r=game.settings.get("dsk","iniTrackerSize"),r=t.originalEvent.deltaY>0?Math.min(140,r+5):Math.max(30,r-5),o.next=4,game.settings.set("dsk","iniTrackerSize",r);case 4:return o.next=6,this.render(!0);case 6:case"end":return o.stop()}}),_callee3,this)}))),function _onWheelResize(t){return o.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;dsk_ini_tracker_get(dsk_ini_tracker_getPrototypeOf(DSKIniTracker.prototype),"activateListeners",this).call(this,t);var o=t.find(".dragHandler");new Draggable(this,t,o[0],this.options.resizable),o.on("wheel",function(){var t=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee4(t){return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return t.stopPropagation(),t.preventDefault(),o.next=4,r._onWheelResize(t);case 4:return o.abrupt("return",!1);case 5:case"end":return o.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.find(".combat-control").click((function(t){return r._onCombatControl(t)}));var a=t.find(".iniItem");a.hover(this._onCombatantHoverIn.bind(this),this._onCombatantHoverOut.bind(this)),a.click(this._onCombatantMouseDown.bind(this)),t.find(".waitingTackerList .iniItem").mousedown((function(t){return r._onRightClick(t)})),t.find(".combatant-control").click((function(t){return r._onCombatantControl(t)})),t.find(".combatant .aggroButton").click((function(t){t.preventDefault(),t.stopPropagation(),ie.runActAttackDialog()})),t.find(".rollMine").click((function(t){return r.rollMyChars()})),game.user.isGM&&t.find(".rolledInit").click((function(t){return r.editCombatant(t)}))}},{key:"rollMyChars",value:function rollMyChars(){game.user.isGM?this._getCombatApp().viewed.rollNPC({}):this._getCombatApp().viewed.rollAll({})}},{key:"_onRightClick",value:function _onRightClick(t){if(2==t.button){var r=game.combat.combatants.get(t.currentTarget.dataset.combatantId);r.isOwner&&r.unsetFlag("dsk","waitInit")}}},{key:"editCombatant",value:function editCombatant(t){this._getCombatApp()._onConfigureCombatant($(t.currentTarget))}},{key:"_onCombatantControl",value:function _onCombatantControl(t){this._getCombatApp()._onCombatantControl(t)}},{key:"_onCombatControl",value:function _onCombatControl(t){"waitInit"==t.currentTarget.dataset.control?this.waitInit(t):this._getCombatApp()._onCombatControl(t)}},{key:"waitInit",value:(r=dsk_ini_tracker_asyncToGenerator(dsk_ini_tracker_regeneratorRuntime().mark((function _callee5(t){var r;return dsk_ini_tracker_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return r=game.combat.combatants.get(game.combat.current.combatantId),o.next=3,r.setFlag("dsk","waitInit",game.combat.current.round);case 3:t.currentTarget.dataset.control="nextTurn",this._getCombatApp()._onCombatControl(t);case 5:case"end":return o.stop()}}),_callee5,this)}))),function waitInit(t){return r.apply(this,arguments)})},{key:"_onCombatantHoverOut",value:function _onCombatantHoverOut(t){this._getCombatApp()._onCombatantHoverOut(t)}},{key:"_onCombatantHoverIn",value:function _onCombatantHoverIn(t){this._getCombatApp()._onCombatantHoverIn(t)}},{key:"_onCombatantMouseDown",value:function _onCombatantMouseDown(t){this._getCombatApp()._onCombatantMouseDown(t)}},{key:"_getCombatApp",value:function _getCombatApp(){return game.combats.apps[0]}},{key:"_canDragStart",value:function _canDragStart(t){return!1}},{key:"_canDragDrop",value:function _canDragDrop(t){return!1}},{key:"_onDragStart",value:function _onDragStart(t){var r=$(t.currentTarget).closestData("combatant-id");t.dataTransfer.setData("text/plain",JSON.stringify({type:"IniChange",combatantId:r}))}},{key:"_onDrop",value:function _onDrop(t){JSON.parse(t.dataTransfer.getData("text/plain")).type}}],[{key:"defaultOptions",get:function get(){var t=dsk_ini_tracker_get(dsk_ini_tracker_getPrototypeOf(DSKIniTracker),"defaultOptions",this);mergeObject(t,{classes:t.classes.concat(["dsk","initTracker"]),template:"systems/dsk/templates/system/initracker.html",dragDrop:[{dragSelector:".iniItem",dropSelector:[".iniTrackerList"]}],top:100,left:170,title:"dsk.DSKIniTracker"});var r=game.settings.get("dsk","iniTrackerPosition");return mergeObject(t,r),t}},{key:"connectHooks",value:function connectHooks(){Hooks.on("renderDSKCombatTracker",(function(t,r,o){game.settings.get("dsk","enableCombatFlow")&&(game.combat?(game.dsk.apps.initTracker||(game.dsk.apps.initTracker=new DSKIniTracker),game.dsk.apps.initTracker.updateTracker(o)):game.dsk.apps.initTracker&&(game.dsk.apps.initTracker.close(),game.dsk.apps.initTracker=void 0))}))}}]),DSKIniTracker}(),fe=__webpack_require__(604);function tokenHotbar2_typeof(t){return tokenHotbar2_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tokenHotbar2_typeof(t)}function tokenHotbar2_toConsumableArray(t){return function tokenHotbar2_arrayWithoutHoles(t){if(Array.isArray(t))return tokenHotbar2_arrayLikeToArray(t)}(t)||function tokenHotbar2_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||tokenHotbar2_unsupportedIterableToArray(t)||function tokenHotbar2_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tokenHotbar2_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=tokenHotbar2_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function tokenHotbar2_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return tokenHotbar2_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?tokenHotbar2_arrayLikeToArray(t,r):void 0}}function tokenHotbar2_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function tokenHotbar2_regeneratorRuntime(){tokenHotbar2_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==tokenHotbar2_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function tokenHotbar2_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function tokenHotbar2_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){tokenHotbar2_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){tokenHotbar2_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function tokenHotbar2_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function tokenHotbar2_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function tokenHotbar2_createClass(t,r,o){return r&&tokenHotbar2_defineProperties(t.prototype,r),o&&tokenHotbar2_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function tokenHotbar2_get(){return tokenHotbar2_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=tokenHotbar2_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},tokenHotbar2_get.apply(this,arguments)}function tokenHotbar2_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=tokenHotbar2_getPrototypeOf(t)););return t}function tokenHotbar2_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&tokenHotbar2_setPrototypeOf(t,r)}function tokenHotbar2_setPrototypeOf(t,r){return tokenHotbar2_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},tokenHotbar2_setPrototypeOf(t,r)}function tokenHotbar2_createSuper(t){var r=function tokenHotbar2_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=tokenHotbar2_getPrototypeOf(t);if(r){var i=tokenHotbar2_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return tokenHotbar2_possibleConstructorReturn(this,o)}}function tokenHotbar2_possibleConstructorReturn(t,r){if(r&&("object"===tokenHotbar2_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function tokenHotbar2_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function tokenHotbar2_getPrototypeOf(t){return tokenHotbar2_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},tokenHotbar2_getPrototypeOf(t)}var pe=function(t){tokenHotbar2_inherits(TokenHotbar2,Application);var o,a,i,c,u,l,p=tokenHotbar2_createSuper(TokenHotbar2);function TokenHotbar2(t){var r;tokenHotbar2_classCallCheck(this,TokenHotbar2),(r=p.call(this,t)).combatSkills=["selfControl","featOfStrength","bodyControl","perception"].map((function(t){return game.i18n.localize("LocalizedIDs.".concat(t))})),r.defaultSkills=[game.i18n.localize("dsk.LocalizedIDs.perception")];var o=function parentUpdate(t){var r=t.parent?t.parent.id:void 0;r&&TokenHotbar2.hookUpdate(r)};return Hooks.on("controlToken",(function(t,o){r.updateDSKHotbar()})),Hooks.on("updateActor",(function(t,r){TokenHotbar2.hookUpdate(t.id)})),Hooks.on("updateToken",(function(t,o,a){o._id==getProperty(game.dsk.apps.tokenHotbar,"actor.prototypeToken.id")&&r.updateDSKHotbar()})),Hooks.on("updateOwnedItem",(function(t,r){TokenHotbar2.hookUpdate(t.data.id)})),Hooks.on("createOwnedItem",(function(t,r){TokenHotbar2.hookUpdate(t.data.id)})),Hooks.on("deleteOwnedItem",(function(t,r){TokenHotbar2.hookUpdate(t.data.id)})),Hooks.on("updateItem",(function(t,r){o(t)})),Hooks.on("createItem",(function(t,r){o(t)})),Hooks.on("deleteItem",(function(t,r){o(t)})),r}return tokenHotbar2_createClass(TokenHotbar2,[{key:"resetPosition",value:function resetPosition(){var t=$("#hotbar").first().position(),r=game.settings.get("dsk","tokenhotbarSize");this.position.left=t.left+8,this.position.top=t.top-r-25}},{key:"_onWheelResize",value:(l=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee(t){var r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return r=game.settings.get("dsk","tokenhotbarSize"),r=t.originalEvent.deltaY>0?Math.min(100,r+5):Math.max(15,r-5),o.next=4,game.settings.set("dsk","tokenhotbarSize",r);case 4:return o.next=6,this.render(!0);case 6:case"end":return o.stop()}}),_callee,this)}))),function _onWheelResize(t){return l.apply(this,arguments)})},{key:"_cycleLayout",value:(u=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee2(t){var r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:if(2!=t.button){o.next=7;break}return 4==(r=game.settings.get("dsk","tokenhotbarLayout")+1)&&(r=0),o.next=5,game.settings.set("dsk","tokenhotbarLayout",r);case 5:return o.next=7,this.render(!0);case 7:case"end":return o.stop()}}),_callee2,this)}))),function _cycleLayout(t){return u.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"activateListeners",this).call(this,t);var o=t.find(".dragHandler");new Draggable(this,t,o[0],this.options.resizable),o.on("wheel",function(){var t=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee3(t){return tokenHotbar2_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return t.stopPropagation(),t.preventDefault(),o.next=4,r._onWheelResize(t);case 4:return o.abrupt("return",!1);case 5:case"end":return o.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()),o.on("mousedown",function(){var t=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee4(t){return tokenHotbar2_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r._cycleLayout(t);case 2:case"end":return o.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.on("mousedown","li",function(){var t=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee5(t){return tokenHotbar2_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return t.stopPropagation(),o.next=3,r.executeQuickButton(t);case 3:return o.abrupt("return",!1);case 4:case"end":return o.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()),t.on("mouseenter","li.primary",(function(o){var a=o.currentTarget.dataset.category;r.category=a,setTimeout((function(){t.find(".secondary").removeClass("shown"),a==r.category&&t.find('.secondary[data-category="'.concat(a,'"]')).addClass("shown")}),700)})),t.on("mouseleave","li.primary",(function(o){var a=o.currentTarget.dataset.category;r.category=void 0,setTimeout((function(){a!=r.category&&t.find('.secondary[data-category="'.concat(a,'"]')).removeClass("shown")}),50)}))}},{key:"executeQuickButton",value:(c=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee6(t){var r,o,a,i,c,u,l,p;return tokenHotbar2_regeneratorRuntime().wrap((function _callee6$(d){for(;;)switch(d.prev=d.next){case 0:r=canvas.tokens.controlled[0].actor,o=canvas.tokens.controlled[0].id,a=t.currentTarget.dataset.id,i=t.currentTarget.dataset.subfunction,d.t0=i,d.next="addEffect"===d.t0?7:"effect"===d.t0?9:"onUse"===d.t0?31:35;break;case 7:return de.showDialog(),d.abrupt("break",48);case 9:if(c=r.effects.get(a),u=c.getFlag("core","statusId"),0!=t.button){d.next=20;break}if(!u){d.next=17;break}return d.next=15,r.addCondition(u,1,!1,!1);case 15:d.next=18;break;case 17:c.sheet.render(!0);case 18:d.next=28;break;case 20:if(2!=t.button){d.next=28;break}if(!u){d.next=26;break}return d.next=24,r.removeCondition(u,1,!1);case 24:d.next=28;break;case 26:return d.next=28,r.sheet._deleteActiveEffect(a);case 28:return d.next=30,this.render(!0);case 30:return d.abrupt("break",48);case 31:return l=r.items.get(a),new fe.Z(l).executeOnUseEffect(),d.abrupt("break",48);case 35:if(!(p=r.items.get(a))){d.next=48;break}if(2!=t.button){d.next=39;break}return d.abrupt("return",p.sheet.render(!0));case 39:d.t1=p.type,d.next="meleeweapon"===d.t1||"rangeweapon"===d.t1||"trait"===d.t1?42:"ahnengabe"===d.t1?44:"skill"===d.t1?46:48;break;case 42:return r.setupWeapon(p,"attack",{},o).then((function(t){r.basicTest(t)})),d.abrupt("break",48);case 44:return r.setupSpell(p,{},o).then((function(t){r.basicTest(t)})),d.abrupt("break",48);case 46:return r.setupSkill(p,{},o).then((function(t){r.basicTest(t)})),d.abrupt("break",48);case 48:case"end":return d.stop()}}),_callee6,this)}))),function executeQuickButton(t){return c.apply(this,arguments)})},{key:"subWidth",value:function subWidth(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7;return'style="width:'.concat(200*Math.ceil(t.length/o),'px"')}},{key:"getData",value:(i=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee7(){var t,o,a,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,R,G,L,D,j;return tokenHotbar2_regeneratorRuntime().wrap((function _callee7$(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"getData",this).call(this);case 2:if(t=M.sent,o=this.actor,a={attacks:[],spells:[],default:[],skills:[]},u=[],l=[],p=[],d=game.settings.get("dsk","tokenhotbarLayout"),h=d%2,y=TokenHotbar2.defaultOptions.itemWidth,m=["ahnengabe"],!o){M.next=25;break}return g=[],v=[],M.next=17,o.actorEffects();case 17:if(p=M.sent.map((function(t){return{name:t.label,id:t.id,icon:t.icon,cssClass:"effect",abbrev:"".concat(t.label[0]," ").concat(t.getFlag("dsk","value")||""),subfunction:"effect"}})),game.combat){_=o.items.filter((function(t){return"combatskill"==t.type})).map((function(t){return r.Z._calculateCombatSkillValues(t.toObject(),o.system)})),b=["meleeweapon","rangeweapon"],k=["meleeAttack","rangeAttack"],w=tokenHotbar2_createForOfIteratorHelper(o.items);try{for(w.s();!(x=w.n()).done;)"trait"==(O=x.value).type&&k.includes(O.system.traitType)?(S=r.Z._parseDmg(O.toObject()),a.attacks.push({name:O.name,id:O.id,icon:O.img,cssClass:"weapon ".concat(O.id),abbrev:O.name[0],attack:O.system.at,damage:S.damagedie,dadd:S.damageAdd})):b.includes(O.type)&&1==O.system.worn.value?(P="meleeweapon"==O.type?r.Z._prepareMeleeWeapon(O.toObject(),_,o):r.Z._prepareRangeWeapon(O.toObject(),[],_,o),a.attacks.push({name:O.name,id:O.id,icon:O.img,cssClass:"weapon ".concat(O.id),abbrev:O.name[0],attack:P.attack,damage:P.damagedie,dadd:P.damageAdd})):m.includes(O.type)?O.system.effectFormula?a.spells.push({name:O.name,id:O.id,icon:O.img,cssClass:"spell",abbrev:O.name[0]}):v.push({name:O.name,id:O.id,icon:O.img,cssClass:"spell",abbrev:O.name[0]}):["skill"].includes(O.type)&&this.combatSkills.includes(O.name)?a.default.push({name:"".concat(O.name," (").concat(O.system.level,")"),id:O.id,icon:O.img,cssClass:"skill",abbrev:O.name[0]}):["skill"].includes(O.type)?(T={name:"".concat(O.name," (").concat(O.system.level,")"),id:O.id,icon:O.img,cssClass:"skill",addClass:O.system.group,abbrev:O.name[0],tw:O.system.level},g.push(T)):"consumable"==O.type&&u.push({name:O.name,id:O.id,icon:O.img,cssClass:"consumable",abbrev:O.system.quantity}),O.getFlag("dsk","onUseEffect")&&l.push({name:O.name,id:O.id,icon:O.img,cssClass:"onUse",abbrev:O.name[0],subfunction:"onUse"})}catch(t){w.e(t)}finally{w.f()}i=u.pop()}else{E=[],C=tokenHotbar2_createForOfIteratorHelper(o.items);try{for(C.s();!(A=C.n()).done;)R=A.value,["skill"].includes(R.type)&&this.defaultSkills.includes(R.name)?a.default.push({name:"".concat(R.name," (").concat(R.system.level,")"),id:R.id,icon:R.img,cssClass:"skill",abbrev:R.name[0]}):["skill"].includes(R.type)?(G={name:"".concat(R.name," (").concat(R.system.level,")"),id:R.id,icon:R.img,cssClass:"skill",addClass:R.system.group,abbrev:R.name[0],tw:R.system.level},R.system.level>0&&E.push(G),g.push(G)):m.includes(R.type)&&(R.system.effectFormula?a.spells.push({name:R.name,id:R.id,icon:R.img,cssClass:"spell",abbrev:R.name[0]}):v.push({name:R.name,id:R.id,icon:R.img,cssClass:"spell",abbrev:R.name[0]})),R.getFlag("dsk","onUseEffect")&&l.push({name:R.name,id:R.id,icon:R.img,cssClass:"onUse",abbrev:R.name[0],subfunction:"onUse"})}catch(t){C.e(t)}finally{C.f()}(I=a.skills).push.apply(I,tokenHotbar2_toConsumableArray(E.sort((function(t,r){return r.tw-t.tw})).slice(0,5)))}c=l.pop(),0==a.spells.length&&v.length>0&&a.spells.push(v.pop()),a.spells.length>0&&v.length>0&&(a.spells[0].more=v.sort((function(t,r){return t.name.localeCompare(r.name)})),a.spells[0].subwidth=this.subWidth(v,y)),a.default.length>0&&g.length>0&&(a.default[0].more=g.sort((function(t,r){return t.addClass.localeCompare(r.addClass)||t.name.localeCompare(r.name)})),a.default[0].subwidth=this.subWidth(g,y,20)),i&&(u.length>0&&(i.more=u,i.subwidth=this.subWidth(u,y)),a.consumables=[i]),c&&(l.length>0&&(c.more=l,c.subwidth=this.subWidth(l,y)),a.onUsages=[c]);case 25:return this.showEffects&&(L=game.i18n.localize("dsk.CONDITION.add"),D={name:L,id:"",icon:"icons/svg/aura.svg",cssClass:"effect",abbrev:L[0],subfunction:"addEffect"},p.length>0&&(D.more=p,D.subwidth=this.subWidth(p,y)),a.effects=[D]),j=Object.keys(a).reduce((function(t,r){return t+a[r].length}),0),h?(this.position.width=y,this.position.height=y*j+14):(this.position.width=y*j+14,this.position.height=y),mergeObject(t,{items:a,itemWidth:y,direction:d,count:j}),M.abrupt("return",t);case 30:case"end":return M.stop()}}),_callee7,this)}))),function getData(){return i.apply(this,arguments)})},{key:"render",value:(a=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee8(t){var r,o,a=arguments;return tokenHotbar2_regeneratorRuntime().wrap((function _callee8$(i){for(;;)switch(i.prev=i.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},i.next=3,tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"render",this).call(this,t,r);case 3:return o=i.sent,this._element&&this._element.css({zIndex:61}),i.abrupt("return",o);case 6:case"end":return i.stop()}}),_callee8,this)}))),function render(t){return a.apply(this,arguments)})},{key:"setPosition",value:function setPosition(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.left,o=t.top,a=t.width,i=t.height,c=t.scale,u=tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2.prototype),"setPosition",this).call(this,{left:r,top:o,width:a,height:i,scale:c}),l=this.element[0];if(!l.style.width||a){var p=a||l.offsetWidth,d=l.style.maxWidth||window.innerWidth;u.width=a=Math.clamped(p,0,d),l.style.width=a+"px",a+u.left>window.innerWidth&&(r=u.left)}return game.settings.set("dsk","tokenhotbarPosition",{left:u.left,top:u.top}),u}},{key:"updateDSKHotbar",value:(o=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee9(){var t,r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return t=canvas.tokens.controlled,this.actor=void 0,this.showEffects=!1,1===t.length&&(r=t[0].actor)&&r.isOwner&&(this.actor=r),t.length>=1&&(this.showEffects=!0),o.next=7,this.render(!0);case 7:case"end":return o.stop()}}),_callee9,this)}))),function updateDSKHotbar(){return o.apply(this,arguments)})}],[{key:"registerTokenHotbar",value:function registerTokenHotbar(){game.dsk.apps.tokenHotbar||(game.dsk.apps.tokenHotbar=new TokenHotbar2)}},{key:"hookUpdate",value:function hookUpdate(t){t==getProperty(game.dsk.apps.tokenHotbar,"actor.id")&&game.dsk.apps.tokenHotbar.updateDSKHotbar()}},{key:"defaultOptions",get:function get(){var t=tokenHotbar2_get(tokenHotbar2_getPrototypeOf(TokenHotbar2),"defaultOptions",this),r=$("#hotbar").first().position(),o=game.settings.get("dsk","tokenhotbarSize"),a=game.settings.get("dsk","tokenhotbarPosition");return mergeObject(t,{classes:t.classes.concat(["dsk","tokenQuickHot"]),itemWidth:o,resizable:!1,height:o+45,zIndex:61,left:r.left+8,top:r.top-o-25,template:"systems/dsk/templates/status/tokenHotbar.html",title:"TokenHotbar"}),mergeObject(t,a),t}}]),TokenHotbar2}(),de=function(t){tokenHotbar2_inherits(AddEffectDialog,Dialog);var r,o,a=tokenHotbar2_createSuper(AddEffectDialog);function AddEffectDialog(){return tokenHotbar2_classCallCheck(this,AddEffectDialog),a.apply(this,arguments)}return tokenHotbar2_createClass(AddEffectDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;tokenHotbar2_get(tokenHotbar2_getPrototypeOf(AddEffectDialog.prototype),"activateListeners",this).call(this,t),t.find(".reactClick").click((function(t){return r.addEffect(t)}));var o=t.find(".conditionSearch");o.keyup((function(o){return r._filterConditions($(o.currentTarget),t)})),o[0]&&o[0].addEventListener("search",(function filterConditions(o){return r._filterConditions($(o.currentTarget),t)}),!1)}},{key:"_filterConditions",value:function _filterConditions(t,r){if(null!=t.val()){var o=t.val().toLowerCase().trim(),a=r.find(".filterable");r.find(".filterHide").removeClass("filterHide"),a.filter((function(){return-1==$(this).find("span").text().toLowerCase().trim().indexOf(o)})).addClass("filterHide")}}},{key:"addEffect",value:(o=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee10(t){var r,o,a;return tokenHotbar2_regeneratorRuntime().wrap((function _callee10$(i){for(;;)switch(i.prev=i.next){case 0:r=tokenHotbar2_createForOfIteratorHelper(canvas.tokens.controlled),i.prev=1,r.s();case 3:if((o=r.n()).done){i.next=9;break}return a=o.value,i.next=7,a.actor.addCondition(t.currentTarget.dataset.value,1,!1,!1);case 7:i.next=3;break;case 9:i.next=14;break;case 11:i.prev=11,i.t0=i.catch(1),r.e(i.t0);case 14:return i.prev=14,r.f(),i.finish(14);case 17:game.dsk.apps.tokenHotbar.render(!0),this.close();case 19:case"end":return i.stop()}}),_callee10,this,[[1,11,14,17]])}))),function addEffect(t){return o.apply(this,arguments)})}],[{key:"showDialog",value:(r=tokenHotbar2_asyncToGenerator(tokenHotbar2_regeneratorRuntime().mark((function _callee11(){var t,r;return tokenHotbar2_regeneratorRuntime().wrap((function _callee11$(o){for(;;)switch(o.prev=o.next){case 0:return t=duplicate(CONFIG.statusEffects).map((function(t){return{label:game.i18n.localize(t.label),icon:t.icon,description:game.i18n.localize(t.description),id:t.id}})).sort((function(t,r){return t.label.localeCompare(r.label)})),o.t0=AddEffectDialog,o.t1=game.i18n.localize("dsk.CONDITION.add"),o.next=5,renderTemplate("systems/dsk/templates/dialog/addstatusdialog.html",{effects:t});case 5:o.t2=o.sent,o.t3={},o.t4={title:o.t1,content:o.t2,buttons:o.t3},(r=new o.t0(o.t4)).position.height=36*Math.ceil(t.length/3)+170,r.render(!0);case 11:case"end":return o.stop()}}),_callee11)}))),function showDialog(){return r.apply(this,arguments)})},{key:"defaultOptions",get:function get(){var t=tokenHotbar2_get(tokenHotbar2_getPrototypeOf(AddEffectDialog),"defaultOptions",this),r=32*Math.ceil(CONFIG.statusEffects.length/3);return mergeObject(t,{classes:["dsk","tokenStatusEffects"],width:700,resizable:!0,height:r}),t}}]),AddEffectDialog}();function payment_typeof(t){return payment_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},payment_typeof(t)}function payment_regeneratorRuntime(){payment_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==payment_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function payment_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function payment_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function payment_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var he=function(){function DSKPayment(){!function payment_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,DSKPayment)}var r;return function payment_createClass(t,r,o){return r&&payment_defineProperties(t.prototype,r),o&&payment_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKPayment,null,[{key:"payMoney",value:function payMoney(r,o){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=DSKPayment.canPay(r,o,a);return i.success&&DSKPayment._updateMoney(r,i.actorsMoney.sum-i.money),a||""==i.msg||ChatMessage.create(t.Z.chatDataSetup("<p>".concat(i.msg,"</p>"),"roll")),i.success}},{key:"canPay",value:function canPay(t,r,o){var a=this._getPaymoney(r),i={success:!1,msg:"",money:a};return a&&(i.actorsMoney=this._actorsMoney(t),i.actorsMoney.sum>=a?(i.msg=game.i18n.format("dsk.PAYMENT.pay",{actor:t.name,amount:DSKPayment._moneyToString(a)}),i.success=!0):(i.msg=game.i18n.format("dsk.PAYMENT.cannotpay",{actor:t.name,amount:DSKPayment._moneyToString(a)}),o&&ui.notifications.notify(i.msg))),i}},{key:"getMoney",value:function getMoney(r,o){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._getPaidmoney(o);if(i){var c=this._actorsMoney(r);DSKPayment._updateMoney(r,c.sum+i);var u="<p>".concat(game.i18n.format("dsk.PAYMENT.getPaid",{actor:r.name,amount:DSKPayment._moneyToString(i)}),"</p>");return a||ChatMessage.create(t.Z.chatDataSetup(u,"roll")),!0}}},{key:"_updateMoney",value:function _updateMoney(t,r){var o=DSKPayment._moneyToCoins(r);t.update({"system.money":o})}},{key:"createGetPaidChatMessage",value:function createGetPaidChatMessage(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=this._getPaidmoney(r);if(a){var i=o?" (".concat(o,")"):"",c="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.wage"),"</b></p><p>").concat(game.i18n.format("dsk.PAYMENT.getPaidSum",{amount:DSKPayment._moneyToString(a)})).concat(i,'</p><button class="payButton" data-pay="1" data-amount="').concat(a,'">').concat(game.i18n.localize("dsk.PAYMENT.getPaidButton"),"</button>");ChatMessage.create(t.Z.chatDataSetup(c,"roll"))}}},{key:"createPayChatMessage",value:function createPayChatMessage(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=this._getPaymoney(r);if(a){var i=o?" (".concat(o,")"):"",c="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.bill"),"</b></p>").concat(game.i18n.format("dsk.PAYMENT.paySum",{amount:DSKPayment._moneyToString(a)})).concat(i,'</p><button class="payButton" data-pay="0" data-amount="').concat(a,'">').concat(game.i18n.localize("dsk.PAYMENT.payButton"),"</button>");ChatMessage.create(t.Z.chatDataSetup(c,"roll"))}}},{key:"_getPaidmoney",value:function _getPaidmoney(r){var o=this._parseMoneyString(r);if(!o){var a="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.error"),"</b></p><p><i>").concat(game.i18n.localize("dsk.PAYMENT.getPaidexample"),"</i></p>");return ChatMessage.create(t.Z.chatDataSetup(a,"roll")),!1}return o}},{key:"_getPaymoney",value:function _getPaymoney(r){var o=this._parseMoneyString(r);if(!o){var a="<p><b>".concat(game.i18n.localize("dsk.PAYMENT.error"),"</b></p><p><i>").concat(game.i18n.localize("dsk.PAYMENT.payexample"),"</i></p>");return ChatMessage.create(t.Z.chatDataSetup(a,"roll")),!1}return o}},{key:"_parseMoneyString",value:function _parseMoneyString(t){var r=t.replace(",",".").match(/\d{1,}(\.\d{1,3}|,\d{1,3})?/);return!!r&&Number(r[0])}},{key:"_actorsMoney",value:function _actorsMoney(t){return{sum:t.system.money}}},{key:"handlePayAction",value:function handlePayAction(t,r,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if(!game.user.isGM||a){a?h.Z.playMoneySound(!0):a=game.user.character;var i=!1;a&&r?i=DSKPayment.payMoney(a,o):a&&!r?i=DSKPayment.getMoney(a,o):ui.notifications.notify(game.i18n.localize("dsk.PAYMENT.onlyActors")),i&&t&&(t.fadeOut(),game.socket.emit("system.dsk",{type:"updateMsg",payload:{id:t.closest(".message").attr("data-message-id"),updateData:payment_defineProperty({},"flags.dsk.userHidden.".concat(game.user.id),!0)}}))}else ui.notifications.notify(game.i18n.localize("dsk.PAYMENT.onlyActors"))}},{key:"_moneyToCoins",value:function _moneyToCoins(t){return t}},{key:"_moneyToString",value:function _moneyToString(t){var r=DSKPayment._moneyToCoins(t);return'<span class="nobr">'.concat(r,' <span data-tooltip="dsk.money" class="chatmoney" style="background-size:contain;background-image:url(\'systems/dsk/icons/categories/money.webp\');"></span></span>')}},{key:"chatListeners",value:(r=function payment_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){payment_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){payment_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(payment_regeneratorRuntime().mark((function _callee(t){return payment_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:t.on("click",".payButton",(function(t){var r=$(t.currentTarget);DSKPayment.handlePayAction(r,1!=Number(r.attr("data-pay")),r.attr("data-amount")),h.Z.playMoneySound()}));case 1:case"end":return r.stop()}}),_callee)}))),function chatListeners(t){return r.apply(this,arguments)})}]),DSKPayment}();function merchantmixin_slicedToArray(t,r){return function merchantmixin_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function merchantmixin_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==o)return;var a,i,c=[],u=!0,l=!1;try{for(o=o.call(t);!(u=(a=o.next()).done)&&(c.push(a.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==o.return||o.return()}finally{if(l)throw i}}return c}(t,r)||merchantmixin_unsupportedIterableToArray(t,r)||function merchantmixin_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function merchantmixin_typeof(t){return merchantmixin_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},merchantmixin_typeof(t)}function merchantmixin_toConsumableArray(t){return function merchantmixin_arrayWithoutHoles(t){if(Array.isArray(t))return merchantmixin_arrayLikeToArray(t)}(t)||function merchantmixin_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||merchantmixin_unsupportedIterableToArray(t)||function merchantmixin_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function merchantmixin_regeneratorRuntime(){merchantmixin_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==merchantmixin_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function merchantmixin_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=merchantmixin_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function merchantmixin_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return merchantmixin_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?merchantmixin_arrayLikeToArray(t,r):void 0}}function merchantmixin_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function merchantmixin_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function merchantmixin_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){merchantmixin_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){merchantmixin_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function merchantmixin_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function merchantmixin_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function merchantmixin_createClass(t,r,o){return r&&merchantmixin_defineProperties(t.prototype,r),o&&merchantmixin_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function merchantmixin_get(){return merchantmixin_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=merchantmixin_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},merchantmixin_get.apply(this,arguments)}function merchantmixin_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=merchantmixin_getPrototypeOf(t)););return t}function merchantmixin_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&merchantmixin_setPrototypeOf(t,r)}function merchantmixin_setPrototypeOf(t,r){return merchantmixin_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},merchantmixin_setPrototypeOf(t,r)}function merchantmixin_createSuper(t){var r=function merchantmixin_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=merchantmixin_getPrototypeOf(t);if(r){var i=merchantmixin_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return merchantmixin_possibleConstructorReturn(this,o)}}function merchantmixin_possibleConstructorReturn(t,r){if(r&&("object"===merchantmixin_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function merchantmixin_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function merchantmixin_getPrototypeOf(t){return merchantmixin_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},merchantmixin_getPrototypeOf(t)}var ye=function MerchantSheetMixin(r){return function(r){merchantmixin_inherits(_class,r);var a,i,c,u,l,p,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C,A,R=merchantmixin_createSuper(_class);function _class(){return merchantmixin_classCallCheck(this,_class),R.apply(this,arguments)}return merchantmixin_createClass(_class,[{key:"template",get:function get(){if(this.merchantSheetActivated())switch(getProperty(this.actor.system,"merchant.merchantType")){case"merchant":return"systems/dsk/templates/actors/merchant/merchant-limited.html";case"loot":return"systems/dsk/templates/actors/merchant/merchant-limited-loot.html";case"epic":return"systems/dsk/templates/actors/merchant/merchant-epic.html";default:return merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"template",this)}return this.constructor.merchantTemplate}},{key:"merchantSheetActivated",value:function merchantSheetActivated(){return this.showLimited()||this.playerViewEnabled()&&["merchant","loot","epic"].includes(getProperty(this.actor.system,"merchant.merchantType"))}},{key:"allowMerchant",value:(A=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee(t,r){var o,a,i,c,u;return merchantmixin_regeneratorRuntime().wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:o=duplicate(this.actor.ownership),a=r?1:0,i=merchantmixin_createForOfIteratorHelper(t);try{for(i.s();!(c=i.n()).done;)u=c.value,o[u]=a}catch(t){i.e(t)}finally{i.f()}return l.next=6,this.actor.update({ownership:o},{diff:!1,recursive:!1,noHook:!0});case 6:case"end":return l.stop()}}),_callee,this)}))),function allowMerchant(t,r){return A.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"activateListeners",this).call(this,t),t.find(".allowMerchant").click(function(){var t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee2(t){var o,a;return merchantmixin_regeneratorRuntime().wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return o=$(t.currentTarget).attr("data-user-id"),a=$(t.currentTarget).find("i"),i.next=4,r.allowMerchant([o],!a.hasClass("fa-check-circle"));case 4:a.toggleClass("fa-circle fa-check-circle");case 5:case"end":return i.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}()),t.find(".toggleAllAllowMerchant").click(function(){var t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee3(t){var o,a;return merchantmixin_regeneratorRuntime().wrap((function _callee3$(i){for(;;)switch(i.prev=i.next){case 0:return o=game.users.filter((function(t){return!t.isGM})).map((function(t){return t.id})),a="true"==t.currentTarget.dataset.lock,i.next=4,r.allowMerchant(o,a);case 4:r.render();case 5:case"end":return i.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()),t.find(".lockTradeSection").click((function(t){return r.lockTradeSection(t)})),t.find(".item-tradeLock").click((function(t){return r.toggleTradeLock(t)})),t.find(".randomGoods").click((function(t){return r.randomGoods(t)})),t.find(".clearInventory").click((function(t){return r.clearInventory(t)})),t.find(".removeOtherTradeFriend").click((function(){return r.removeOtherTradeFriend()})),t.find(".choseTradefriend").click((function(){return r.choseTradefriend()})),t.find(".setCustomPrice").click((function(t){return $(t.currentTarget).addClass("edit")})),t.find(".customPriceTag").change(function(){var t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee4(t){return merchantmixin_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r.setCustomPrice(t));case 1:case"end":return o.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()).blur((function(t){return $(t.currentTarget).closest(".setCustomPrice").removeClass("edit")})),t.find(".buy-item").click((function(t){r.advanceWrapper(t,"buyItem",t),h.Z.playMoneySound()})),t.find(".sell-item").click((function(t){r.advanceWrapper(t,"sellItem",t),h.Z.playMoneySound()})),t.find(".item-external-edit").click((function(t){t.preventDefault();var o=r._getItemId(t);r.getTradeFriend().items.get(o).sheet.render(!0)})),t.find(".changeAmountAllItems").mousedown((function(t){return r.changeAmountAllItems(t)})),t.find(".gearSearch").prop("disabled",!1)}},{key:"_canDragStart",value:function _canDragStart(t){return!this.merchantSheetActivated()&&this.isEditable}},{key:"toggleTradeLock",value:(C=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee5(t){var r,o;return merchantmixin_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:r=this._getItemId(t),o=this.actor.items.get(r),this.actor.updateEmbeddedDocuments("Item",[{_id:o.id,"system.tradeLocked":!o.system.tradeLocked}]);case 3:case"end":return a.stop()}}),_callee5,this)}))),function toggleTradeLock(t){return C.apply(this,arguments)})},{key:"setCustomPrice",value:(E=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee6(t){var r;return merchantmixin_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return t.stopPropagation(),t.preventDefault(),r=this._getItemId(t),o.next=5,this.actor.updateEmbeddedDocuments("Item",[{_id:r,"flags.dsk.customPriceTag":Number(t.target.value)}]);case 5:case"end":return o.stop()}}),_callee6,this)}))),function setCustomPrice(t){return E.apply(this,arguments)})},{key:"removeOtherTradeFriend",value:function removeOtherTradeFriend(){this.otherTradeFriend=void 0,this.render(!0)}},{key:"choseTradefriend",value:(I=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee7(){return merchantmixin_regeneratorRuntime().wrap((function _callee7$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,me.getDialog(this);case 2:t.sent.render(!0);case 3:case"end":return t.stop()}}),_callee7,this)}))),function choseTradefriend(){return I.apply(this,arguments)})},{key:"lockTradeSection",value:(T=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee8(t){var r,o,a,i,c,u,l;return merchantmixin_regeneratorRuntime().wrap((function _callee8$(p){for(;;)switch(p.prev=p.next){case 0:r=[],o=this.filterRule(t),i=merchantmixin_createForOfIteratorHelper(this.actor.items);try{for(i.s();!(c=i.n()).done;)u=c.value,o(u)&&(l=u.toObject(),void 0===a&&(a=!l.system.tradeLocked),l.system.tradeLocked=a,r.push(l))}catch(t){i.e(t)}finally{i.f()}this.actor.updateEmbeddedDocuments("Item",r);case 5:case"end":return p.stop()}}),_callee8,this)}))),function lockTradeSection(t){return T.apply(this,arguments)})},{key:"filterRule",value:function filterRule(t){var r=t.currentTarget.dataset.type;return d.Z.equipmentTypes[r]?function(t){return"equipment"==t.type&&t.system.category==r}:function(t){return t.type==r&&d.Z.equipmentCategories.includes(t.type)}}},{key:"changeAmountAllItems",value:(P=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee9(t){var r,o,a,i,c,u;return merchantmixin_regeneratorRuntime().wrap((function _callee9$(l){for(;;)switch(l.prev=l.next){case 0:r=[],o=this.filterRule(t),a=merchantmixin_createForOfIteratorHelper(this.actor.items);try{for(a.s();!(i=a.n()).done;)c=i.value,o(c)&&(u=c.toObject(),y.Z.increment(t,u,"system.quantity",0),r.push(u))}catch(t){a.e(t)}finally{a.f()}this.actor.updateEmbeddedDocuments("Item",r);case 5:case"end":return l.stop()}}),_callee9,this)}))),function changeAmountAllItems(t){return P.apply(this,arguments)})},{key:"playerViewEnabled",value:function playerViewEnabled(){return getProperty(this.actor.system,"merchant.playerView")}},{key:"buyItem",value:(S=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee10(t){return merchantmixin_regeneratorRuntime().wrap((function _callee10$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.transferItem(this.actor,this.getTradeFriend(),t,!0);case 2:case"end":return r.stop()}}),_callee10,this)}))),function buyItem(t){return S.apply(this,arguments)})},{key:"sellItem",value:(O=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee11(t){return merchantmixin_regeneratorRuntime().wrap((function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.transferItem(this.getTradeFriend(),this.actor,t,!1);case 2:case"end":return r.stop()}}),_callee11,this)}))),function sellItem(t){return O.apply(this,arguments)})},{key:"transferItem",value:(x=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee12(t,r,o){var a,i,c,u,l=arguments;return merchantmixin_regeneratorRuntime().wrap((function _callee12$(p){for(;;)switch(p.prev=p.next){case 0:if(a=!(l.length>3&&void 0!==l[3])||l[3],i=this._getItemId(o),c=$(o.currentTarget).attr("data-price"),u=o.ctrlKey?10:1,!game.user.isGM){p.next=9;break}return p.next=7,this.constructor.finishTransaction(t,r,c,i,a,u);case 7:p.next=10;break;case 9:(this.constructor.noNeedToPay(r,t,c)||he.canPay(r,c,!0))&&game.socket.emit("system.dsk",{type:"trade",payload:{target:this.constructor.transferTokenData(r),source:this.constructor.transferTokenData(t),price:c,itemId:i,buy:a,amount:u}});case 10:case"end":return p.stop()}}),_callee12,this)}))),function transferItem(t,r,o){return x.apply(this,arguments)})},{key:"getTradeFriend",value:function getTradeFriend(){return this.otherTradeFriend||game.user.character}},{key:"_manageDragItems",value:(w=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee13(t,r){return merchantmixin_regeneratorRuntime().wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:o.t0=r,o.next="creature"===o.t0||"npc"===o.t0||"character"===o.t0?3:5;break;case 3:return this.setTradeFriend(t),o.abrupt("break",6);case 5:return o.abrupt("return",merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"_manageDragItems",this).call(this,t,r));case 6:case"end":return o.stop()}}),_callee13,this)}))),function _manageDragItems(t,r){return w.apply(this,arguments)})},{key:"setTradeFriend",value:function setTradeFriend(t){var r=game.actors.get(t._id);r.isOwner&&(this.otherTradeFriend=r,this.render(!0))}},{key:"_render",value:(k=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee14(){var t,r,o=arguments;return merchantmixin_regeneratorRuntime().wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:if(t=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1&&void 0!==o[1]?o[1]:{},game.user.isGM||"loot"!=getProperty(this.actor.system,"merchant.merchantType")||!getProperty(this.actor.system,"merchant.locked")){a.next=5;break}return AudioHelper.play({src:"sounds/lock.wav",loop:!1},!1),a.abrupt("return");case 5:return a.next=7,merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"_render",this).call(this,t,r);case 7:case"end":return a.stop()}}),_callee14,this)}))),function _render(){return k.apply(this,arguments)})},{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,o=merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"_getHeaderButtons",this).call(this);return this.actor.isOwner&&o.unshift({class:"playerview",icon:"fas fa-toggle-on",onclick:(t=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee15(t){return merchantmixin_regeneratorRuntime().wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",r._togglePlayerview(t));case 1:case"end":return o.stop()}}),_callee15)}))),function onclick(r){return t.apply(this,arguments)})}),o}},{key:"_togglePlayerview",value:function _togglePlayerview(t){this.actor.update({"system.merchant.playerView":!getProperty(this.actor.system,"merchant.playerView")})}},{key:"randomGoods",value:(b=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee16(t){var r,o=this;return merchantmixin_regeneratorRuntime().wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,renderTemplate("systems/dsk/templates/dialog/randomGoods-dialog.html",{categories:d.Z.equipmentCategories});case 2:r=a.sent,new Dialog({title:game.i18n.localize("dsk.MERCHANT.randomGoods"),content:r,default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(r){return o.addRandomGoods(o.actor,r,t)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 4:case"end":return a.stop()}}),_callee16)}))),function randomGoods(t){return b.apply(this,arguments)})},{key:"clearInventory",value:(_=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee17(t){var r=this;return merchantmixin_regeneratorRuntime().wrap((function _callee17$(o){for(;;)switch(o.prev=o.next){case 0:new Dialog({title:game.i18n.localize("dsk.MERCHANT.clearInventory"),content:game.i18n.localize("dsk.MERCHANT.deleteAllGoods"),default:"yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){r.removeAllGoods(r.actor,t)}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 1:case"end":return o.stop()}}),_callee17)}))),function clearInventory(t){return _.apply(this,arguments)})},{key:"addRandomGoods",value:(v=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee18(t,r,o){var a,i,c,u,l,p,d,h;return merchantmixin_regeneratorRuntime().wrap((function _callee18$(y){for(;;)switch(y.prev=y.next){case 0:if(a=$(o.currentTarget).text(),$(o.currentTarget).html(' <i class="fa fa-spin fa-spinner"></i>'),i=[],r.find('input[type="checkbox"]:checked').each((function(){var t=$(this).val();i.push({name:t,count:Number(r.find('input[name="each_'.concat(t,'"]')).val()),number:Number(r.find('input[name="number_'.concat(t,'"]')).val())})})),(c=game.dsk.itemLibrary).equipmentBuild){y.next=8;break}return y.next=8,c.buildEquipmentIndex();case 8:u=[],l=merchantmixin_regeneratorRuntime().mark((function _loop(){var t,r,o;return merchantmixin_regeneratorRuntime().wrap((function _loop$(a){for(;;)switch(a.prev=a.next){case 0:return r=d[p],a.next=3,c.getRandomItems(r.name,r.number);case 3:o=a.sent.map((function(t){var o=t.toObject();return o.system.quantity=r.count,o})),(t=u).push.apply(t,merchantmixin_toConsumableArray(o));case 5:case"end":return a.stop()}}),_loop)})),p=0,d=i;case 11:if(!(p<d.length)){y.next=16;break}return y.delegateYield(l(),"t0",13);case 13:p++,y.next=11;break;case 16:return h={},u=u.filter((function(r){var o=getProperty(r,"system.effect");o="object"===merchantmixin_typeof(o)&&null!==o&&getProperty(o,"attributes")||"";var a=Number(getProperty(r,"system.price"))||0;if(""!=o||a>1e4)return!1;var i="".concat(r.type,"_").concat(r.name);return!h.hasOwnProperty(i)&&(h[i]=!0)&&0==t.items.filter((function(t){return t.type==r.type&&t.name==r.name})).length})),y.next=20,t.createEmbeddedDocuments("Item",u);case 20:$(o.currentTarget).text(a);case 21:case"end":return y.stop()}}),_callee18)}))),function addRandomGoods(t,r,o){return v.apply(this,arguments)})},{key:"removeAllGoods",value:(g=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee19(t,r){var o,a;return merchantmixin_regeneratorRuntime().wrap((function _callee19$(i){for(;;)switch(i.prev=i.next){case 0:return o=$(r.currentTarget).text(),$(r.currentTarget).html(' <i class="fa fa-spin fa-spinner"></i>'),a=t.items.filter((function(t){return d.Z.equipmentCategories.includes(t.type)&&!getProperty(t,"worn.value")})).map((function(t){return t.id})),i.next=5,t.deleteEmbeddedDocuments("Item",a);case 5:$(r.currentTarget).text(o);case 6:case"end":return i.stop()}}),_callee19)}))),function removeAllGoods(t,r){return g.apply(this,arguments)})},{key:"getData",value:(m=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee20(t){var r,o=this;return merchantmixin_regeneratorRuntime().wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,merchantmixin_get(merchantmixin_getPrototypeOf(_class.prototype),"getData",this).call(this,t);case 2:return(r=a.sent).merchantType=getProperty(this.actor.system,"merchant.merchantType")||"none",r.merchantTypes={none:game.i18n.localize("dsk.MERCHANT.typeNone"),merchant:game.i18n.localize("dsk.MERCHANT.typeMerchant"),loot:game.i18n.localize("dsk.MERCHANT.typeLoot"),epic:game.i18n.localize("dsk.MERCHANT.typeEpic")},r.invName=r.merchantTypes[r.merchantType],r.players=game.users.filter((function(t){return!t.isGM})).map((function(t){return t.allowedMerchant=o.actor.testUserPermission(t,"LIMITED",!1),t.buyingFactor=getProperty(o.actor.system,"merchant.factors.buyingFactor.".concat(t.id)),t.sellingFactor=getProperty(o.actor.system,"merchant.factors.sellingFactor.".concat(t.id)),t})),"epic"!=r.merchantType?(this.prepareStorage(r),this.merchantSheetActivated()&&(this.filterWornEquipment(r),this.prepareTradeFriend(r),0==r.actor.inventory.misc.items.length&&(r.actor.inventory.misc.show=!1))):this.prepareStorage(r),r.hasOtherTradeFriend=!!this.otherTradeFriend,a.abrupt("return",r);case 10:case"end":return a.stop()}}),_callee20,this)}))),function getData(t){return m.apply(this,arguments)})},{key:"filterWornEquipment",value:function filterWornEquipment(t){for(var r=0,o=Object.entries(t.actor.inventory);r<o.length;r++){var a=merchantmixin_slicedToArray(o[r],2),i=(a[0],a[1]);i.items=i.items.filter((function(t){return!getProperty(t,"system.worn.value")}))}}},{key:"prepareStorage",value:function prepareStorage(t){if("merchant"==t.merchantType)for(var r=0,o=Object.entries(t.actor.inventory);r<o.length;r++){var a,i=merchantmixin_slicedToArray(o[r],2),c=(i[0],merchantmixin_createForOfIteratorHelper(i[1].items));try{for(c.s();!(a=c.n()).done;){var u=a.value;u.defaultPrice=this.getItemPrice(u),u.calculatedPrice=Number(parseFloat("".concat(u.defaultPrice*(getProperty(this.actor.system,"merchant.sellingFactor")||1))).toFixed(2))*(getProperty(this.actor.system,"merchant.factors.sellingFactor.".concat(game.user.id))||1),u.priceTag=" / ".concat(u.calculatedPrice)}}catch(t){c.e(t)}finally{c.f()}}else if("loot"==t.merchantType)for(var l=0,p=Object.entries(t.actor.inventory);l<p.length;l++){var d,h=merchantmixin_slicedToArray(p[l],2),y=(h[0],merchantmixin_createForOfIteratorHelper(h[1].items));try{for(y.s();!(d=y.n()).done;){var m=d.value;m.calculatedPrice=this.getItemPrice(m)}}catch(t){y.e(t)}finally{y.f()}}}},{key:"getItemPrice",value:function getItemPrice(t){return Number(getProperty(t,"flags.dsk.customPriceTag"))||Number(t.system.price)*("consumable"==t.type?Number(t.system.QL)||0:1)}},{key:"prepareTradeFriend",value:function prepareTradeFriend(t){var r=this.getTradeFriend();if(r){var o=r.prepareItems({details:[]}),a="loot"==getProperty(this.actor.system,"merchant.merchantType")?1:(getProperty(this.actor.system,"merchant.buyingFactor")||1)*(getProperty(this.actor.system,"merchant.factors.buyingFactor.".concat(game.user.id))||1),i=this.prepareSellPrices(o.inventory,a);0==i.misc.items.length&&(i.misc.show=!1),"loot"==t.merchantType&&(i.money={items:o.money.coins.map((function(t){return t.name=game.i18n.localize(t.name),t})),show:!0,dataType:"money"}),mergeObject(t,{tradeFriend:{img:r.img,name:r.name,inventory:i,money:o.money}})}else mergeObject(t,{tradeFriend:{inventory:[],money:{coins:[]}}})}},{key:"prepareSellPrices",value:function prepareSellPrices(t,r){for(var o=0,a=Object.entries(t);o<a.length;o++){var i,c=merchantmixin_slicedToArray(a[o],2),u=(c[0],merchantmixin_createForOfIteratorHelper(c[1].items));try{for(u.s();!(i=u.n()).done;){var l=i.value;l.calculatedPrice=Number(parseFloat("".concat(this.getItemPrice(l)*r)).toFixed(2))}}catch(t){u.e(t)}finally{u.f()}}return t}}],[{key:"defaultOptions",get:function get(){var t=merchantmixin_get(merchantmixin_getPrototypeOf(_class),"defaultOptions",this);return mergeObject(t,{classes:t.classes.concat(["merchant-sheet"])}),t}},{key:"merchantTemplate",get:function get(){return"systems/dsk/templates/actors/merchant/merchant-sheet.html"}},{key:"transferTokenData",value:function transferTokenData(t){var r={actor:t.id};return t.token&&(r.token=t.token.id),r}},{key:"finishTransaction",value:(p=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee21(t,r,o,a,i,c){var u,l;return merchantmixin_regeneratorRuntime().wrap((function _callee21$(p){for(;;)switch(p.prev=p.next){case 0:if(u=t.items.get(a).toObject(),c=Math.min(Number(u.system.quantity),c),!(Number(u.system.quantity)>0)){p.next=24;break}if(!(l=this.noNeedToPay(r,t,o))&&!he.payMoney(r,o,!0)){p.next=24;break}if(getProperty(u,"system.worn.value")&&(u.system.worn.value=!1),!i){p.next=18;break}return p.next=10,this.updateTargetTransaction(r,u,c,t,o);case 10:return p.next=12,this.updateSourceTransaction(t,r,u,o,a,c);case 12:return p.next=14,this.transferNotification(u,r,t,i,o,c,l);case 14:return p.next=16,this.selfDestruction(t);case 16:p.next=24;break;case 18:return p.next=20,this.updateSourceTransaction(t,r,u,o,a,c);case 20:return p.next=22,this.updateTargetTransaction(r,u,c,t,o);case 22:return p.next=24,this.transferNotification(u,t,r,i,o,c,l);case 24:case"end":return p.stop()}}),_callee21,this)}))),function finishTransaction(t,r,o,a,i,c){return p.apply(this,arguments)})},{key:"isTemporaryToken",value:function isTemporaryToken(t){return"loot"==getProperty(t.system,"merchant.merchantType")&&getProperty(t.system,"merchant.temporary")}},{key:"selfDestruction",value:(l=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee22(t){var r;return merchantmixin_regeneratorRuntime().wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:if(!this.isTemporaryToken(t)){o.next=10;break}if(t.items.some((function(t){return d.Z.equipmentCategories.includes(t.type)||"money"==t.type&&t.system.quantity>0}))){o.next=10;break}return game.socket.emit("system.dsk",{type:"hideDeletedSheet",payload:{target:this.transferTokenData(t)}}),r=t.getActiveTokens().map((function(t){return t.id})),o.next=7,canvas.scene.deleteEmbeddedDocuments("Token",r);case 7:return o.next=9,game.actors.get(t.id).delete();case 9:this.hideDeletedSheet(t);case 10:case"end":return o.stop()}}),_callee22,this)}))),function selfDestruction(t){return l.apply(this,arguments)})},{key:"hideDeletedSheet",value:(u=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee23(t){return merchantmixin_regeneratorRuntime().wrap((function _callee23$(r){for(;;)switch(r.prev=r.next){case 0:t.sheet.close(!0);case 1:case"end":return r.stop()}}),_callee23)}))),function hideDeletedSheet(t){return u.apply(this,arguments)})},{key:"transferNotification",value:(c=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee24(r,o,a,i,c,u,l){var p,d,h,y;return merchantmixin_regeneratorRuntime().wrap((function _callee24$(m){for(;;)switch(m.prev=m.next){case 0:if(0!=(p=game.settings.get("dsk","merchantNotification"))&&"service"!=getProperty(r,"system.category")){m.next=3;break}return m.abrupt("return");case 3:return d="MERCHANT."+(i?"buy":"sell")+(l?"Loot":"")+"Notification",h=game.i18n.format(d,{item:r.name,source:o.name,target:a.name,amount:u,price:c,buy:i}),y=t.Z.chatDataSetup(h),2==p&&(y.whisper=ChatMessage.getWhisperRecipients("GM").map((function(t){return t.id}))),m.next=9,ChatMessage.create(y);case 9:case"end":return m.stop()}}),_callee24)}))),function transferNotification(t,r,o,a,i,u,l){return c.apply(this,arguments)})},{key:"noNeedToPay",value:function noNeedToPay(t,r,o){return 0==o||"loot"==getProperty(t.system,"merchant.merchantType")||"loot"==getProperty(r.system,"merchant.merchantType")}},{key:"updateSourceTransaction",value:(i=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee25(t,r,o,a,i,c){var u;return merchantmixin_regeneratorRuntime().wrap((function _callee25$(l){for(;;)switch(l.prev=l.next){case 0:if(u=duplicate(o),!(Number(u.system.quantity)>c||"money"==u.type)){l.next=7;break}return u.system.quantity=Number(u.system.quantity)-c,l.next=5,t.updateEmbeddedDocuments("Item",[u]);case 5:l.next=9;break;case 7:return l.next=9,t.deleteEmbeddedDocuments("Item",[i]);case 9:if(this.noNeedToPay(t,r,a)){l.next=12;break}return l.next=12,he.getMoney(t,a,!0);case 12:case"end":return l.stop()}}),_callee25,this)}))),function updateSourceTransaction(t,r,o,a,c,u){return i.apply(this,arguments)})},{key:"updateTargetTransaction",value:(a=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee26(r,a,i,c,u){var l,p,d;return merchantmixin_regeneratorRuntime().wrap((function _callee26$(h){for(;;)switch(h.prev=h.next){case 0:if(l=duplicate(a),"service"!=getProperty(l,"system.category")){h.next=7;break}p=game.i18n.format("dsk.MERCHANT.buyNotification",{item:l.name,amount:i,source:r.name,target:c.name,price:u}),ChatMessage.create(t.Z.chatDataSetup(p)),h.next=16;break;case 7:if(d=r.items.find((function(t){return o.Z.areEquals(l,t)})),l.system.quantity=i,d){h.next=14;break}return h.next=12,r.createEmbeddedDocuments("Item",[l]);case 12:h.next=16;break;case 14:return h.next=16,o.Z.stackItems(d,l,r);case 16:case"end":return h.stop()}}),_callee26)}))),function updateTargetTransaction(t,r,o,i,c){return a.apply(this,arguments)})}]),_class}(r)},me=function(t){merchantmixin_inherits(SelectTradefriendDialog,Dialog);var r,o=merchantmixin_createSuper(SelectTradefriendDialog);function SelectTradefriendDialog(){return merchantmixin_classCallCheck(this,SelectTradefriendDialog),o.apply(this,arguments)}return merchantmixin_createClass(SelectTradefriendDialog,[{key:"activateListeners",value:function activateListeners(t){var r=this;merchantmixin_get(merchantmixin_getPrototypeOf(SelectTradefriendDialog.prototype),"activateListeners",this).call(this,t),t.find(".combatant").click((function(t){return r.setTargetToUser(t)}))}},{key:"setTargetToUser",value:function setTargetToUser(t){this.actor.setTradeFriend({_id:t.currentTarget.dataset.id}),this.close()}}],[{key:"defaultOptions",get:function get(){var t=merchantmixin_get(merchantmixin_getPrototypeOf(SelectTradefriendDialog),"defaultOptions",this);return mergeObject(t,{}),t}},{key:"getDialog",value:(r=merchantmixin_asyncToGenerator(merchantmixin_regeneratorRuntime().mark((function _callee27(t){var r,o,a;return merchantmixin_regeneratorRuntime().wrap((function _callee27$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,null===(r=game.dsk.apps.gameMasterMenu)||void 0===r?void 0:r.getTrackedHeros();case 2:if(o=i.sent){i.next=5;break}return i.abrupt("return",ui.notifications.warn("The required functionality is not yet available."));case 5:return i.t0=SelectTradefriendDialog,i.t1=game.i18n.localize("dsk.DIALOG.setTargetToUser"),i.next=9,renderTemplate("systems/dsk/templates/dialog/selectTradeFriend.html",{users:o});case 9:return i.t2=i.sent,i.t3={},i.t4={title:i.t1,content:i.t2,default:"yes",buttons:i.t3},(a=new i.t0(i.t4)).actor=t,i.abrupt("return",a);case 15:case"end":return i.stop()}}),_callee27)}))),function getDialog(t){return r.apply(this,arguments)})}]),SelectTradefriendDialog}();function merchant_sheet_typeof(t){return merchant_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},merchant_sheet_typeof(t)}function merchant_sheet_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function merchant_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function merchant_sheet_setPrototypeOf(t,r){return merchant_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},merchant_sheet_setPrototypeOf(t,r)}function merchant_sheet_createSuper(t){var r=function merchant_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=merchant_sheet_getPrototypeOf(t);if(r){var i=merchant_sheet_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return merchant_sheet_possibleConstructorReturn(this,o)}}function merchant_sheet_possibleConstructorReturn(t,r){if(r&&("object"===merchant_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function merchant_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function merchant_sheet_getPrototypeOf(t){return merchant_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},merchant_sheet_getPrototypeOf(t)}var ge=function(t){!function merchant_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&merchant_sheet_setPrototypeOf(t,r)}(MerchantSheetDSK,t);var r=merchant_sheet_createSuper(MerchantSheetDSK);function MerchantSheetDSK(){return merchant_sheet_classCallCheck(this,MerchantSheetDSK),r.apply(this,arguments)}return function merchant_sheet_createClass(t,r,o){return r&&merchant_sheet_defineProperties(t.prototype,r),o&&merchant_sheet_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(MerchantSheetDSK)}(ye(V)),ve=__webpack_require__(61);function ready_typeof(t){return ready_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ready_typeof(t)}function ready_regeneratorRuntime(){ready_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==ready_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function ready_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function ready_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){ready_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){ready_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function adventure_wizard_typeof(t){return adventure_wizard_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},adventure_wizard_typeof(t)}function adventure_wizard_toConsumableArray(t){return function adventure_wizard_arrayWithoutHoles(t){if(Array.isArray(t))return adventure_wizard_arrayLikeToArray(t)}(t)||function adventure_wizard_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||adventure_wizard_unsupportedIterableToArray(t)||function adventure_wizard_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function adventure_wizard_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=adventure_wizard_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function adventure_wizard_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return adventure_wizard_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?adventure_wizard_arrayLikeToArray(t,r):void 0}}function adventure_wizard_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function adventure_wizard_regeneratorRuntime(){adventure_wizard_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==adventure_wizard_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function adventure_wizard_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function adventure_wizard_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){adventure_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){adventure_wizard_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function adventure_wizard_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function adventure_wizard_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function adventure_wizard_createClass(t,r,o){return r&&adventure_wizard_defineProperties(t.prototype,r),o&&adventure_wizard_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function adventure_wizard_get(){return adventure_wizard_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=adventure_wizard_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},adventure_wizard_get.apply(this,arguments)}function adventure_wizard_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=adventure_wizard_getPrototypeOf(t)););return t}function adventure_wizard_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&adventure_wizard_setPrototypeOf(t,r)}function adventure_wizard_setPrototypeOf(t,r){return adventure_wizard_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},adventure_wizard_setPrototypeOf(t,r)}function adventure_wizard_createSuper(t){var r=function adventure_wizard_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=adventure_wizard_getPrototypeOf(t);if(r){var i=adventure_wizard_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return adventure_wizard_possibleConstructorReturn(this,o)}}function adventure_wizard_possibleConstructorReturn(t,r){if(r&&("object"===adventure_wizard_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function adventure_wizard_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function adventure_wizard_getPrototypeOf(t){return adventure_wizard_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},adventure_wizard_getPrototypeOf(t)}var _e=function(r){adventure_wizard_inherits(BookWizard,Application);var o,a,i,c,p,d,h,y,m,g,v,b,k,w,x,O,S,P,T=adventure_wizard_createSuper(BookWizard);function BookWizard(t){var r;return adventure_wizard_classCallCheck(this,BookWizard),(r=T.call(this,t)).adventures=[],r.books=[],r.rshs=[],r}return adventure_wizard_createClass(BookWizard,[{key:"_getHeaderButtons",value:function _getHeaderButtons(){var t,r=this,o=adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"_getHeaderButtons",this).call(this);return o.unshift({label:"Library",class:"library",icon:"fas fa-book",onclick:(t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r._showBooks());case 1:case"end":return t.stop()}}),_callee)}))),function onclick(r){return t.apply(this,arguments)})}),o}},{key:"_render",value:(P=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee2(){var t,r,o=arguments;return adventure_wizard_regeneratorRuntime().wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1&&void 0!==o[1]?o[1]:{},a.next=4,adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"_render",this).call(this,t,r);case 4:$(this._element).find(".library").attr("data-tooltip",game.i18n.localize("dsk.Book.home"));case 5:case"end":return a.stop()}}),_callee2,this)}))),function _render(){return P.apply(this,arguments)})},{key:"_showBooks",value:function _showBooks(){this.book=null,this.bookData=null,this.selectedChapter=null,this.selectedType=null,this.journals=null,this.actors=null,this.scenes=null,this.content=void 0,this.journalIndex=null,this.fulltextsearch=!1,this.currentType=void 0,this.loadPage(this._element)}},{key:"toggleBookVisibility",value:(S=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee3(t,r,o){var a,i,c,u,l,p,d;return adventure_wizard_regeneratorRuntime().wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:return(a=game.settings.get("dsk","expansionPermissions"))[t]=o,h.next=4,game.settings.set("dsk","expansionPermissions",a);case 4:return i=this[r].find((function(r){return r.id==t})),h.next=7,fetch(i.path);case 7:return h.next=9,h.sent.json();case 9:c=h.sent,u=0,l=["actors","journal","scenes"];case 12:if(!(u<l.length)){h.next=22;break}if(p=l[u],c[p]){h.next=16;break}return h.abrupt("continue",19);case 16:return d=game.packs.get(c[p]),h.next=19,d.configure({private:!o});case 19:u++,h.next=12;break;case 22:this.render();case 23:case"end":return h.stop()}}),_callee3,this)}))),function toggleBookVisibility(t,r,o){return S.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r=this;adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"activateListeners",this).call(this,t),t.on("click",".toggleVisibility",function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee4(t){var o,a,i;return adventure_wizard_regeneratorRuntime().wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:o=t.currentTarget.dataset.itemid,a=t.currentTarget.dataset.type,i=$(t.currentTarget).find("i").hasClass("fa-toggle-off"),r.toggleBookVisibility(o,a,i);case 4:case"end":return c.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".showMapNote",(function(t){game.journal.get(t.currentTarget.dataset.entryid).panToNote()})),t.on("search keyup",".filterJournals",(function(t){r.filterToc($(t.currentTarget).val())})),t.on("click",".loadBook",(function(o){r.selectedChapter=void 0,r.selectedType=void 0,r.content=void 0,r.loadBook($(o.currentTarget).text(),t,$(o.currentTarget).attr("data-type"))})),t.on("click",".getChapter",(function(o){r.selectedType=$(o.currentTarget).closest(".toc").attr("data-type"),r.selectedChapter=$(o.currentTarget).attr("data-id"),r.content=void 0,r.loadPage(t)})),t.on("click",".subChapter",(function(t){var o=$(t.currentTarget).text(),a=$(t.currentTarget).attr("data-jid");a?r.loadJournalById(a):($(r._element).find(".subChapter").removeClass("selected"),$(r._element).find('[data-id="'.concat(o,'"]')).addClass("selected"),r.loadJournal(o))})),l.Z.bindRollCommands(t),t.find(".tocCollapser").click((function(r){$(r.currentTarget).find("i").toggleClass("fa-chevron-right fa-chevron-left"),t.find(".tocCollapsing").toggleClass("expanded")})),t.on("mousedown",".openPin",function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee5(t){var o;return adventure_wizard_regeneratorRuntime().wrap((function _callee5$(a){for(;;)switch(a.prev=a.next){case 0:if(o=t.currentTarget.dataset.uuid,0!=t.button){a.next=9;break}return a.t0=r,a.next=5,fromUuid(o);case 5:a.t1=a.sent,a.t0.showJournal.call(a.t0,a.t1),a.next=10;break;case 9:2==t.button&&r.unpinJournal(o);case 10:case"end":return a.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()),t.on("click",".showJournal",(function(t){r.popJournal($(t.currentTarget).closest("h1").attr("data-uuid"))})),t.on("click",".pinJournal",(function(t){var o=$(t.currentTarget).closest("h1"),a=o.attr("data-uuid"),i=o.text();r.pinJournal(a,i)})),t.on("click",".activateScene",(function(t){r.showSzene($(t.currentTarget).attr("data-id"),$(t.currentTarget).attr("data-mode"))})),t.on("click",".fulltextsearch",(function(o){r.fulltextsearch=!r.fulltextsearch,$(o.currentTarget).toggleClass("on"),r.filterToc(t.find(".filterJournals").val())})),t.on("mousedown",".chapter img",(function(t){var o=r.book.id;2==t.button&&game.dsk.apps.DSKUtility.showArtwork({name:o,uuid:"",img:$(t.currentTarget).attr("src")})})),u.Z.bindButtons(t),t.on("click",".importBook",adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee6(){return adventure_wizard_regeneratorRuntime().wrap((function _callee6$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.importBook());case 1:case"end":return t.stop()}}),_callee6)})))),bindImgToCanvasDragStart(t),(0,_.Jp)(t,".breadcrumbs",this.resaveBreadCrumbs),this.heightFix()}},{key:"heightFix",value:function heightFix(){var t=$(this._element).find(".breadcrumbs").height();$(this._element).find(".col.seventy.scrollable").css({"margin-bottom":"".concat(t,"px")})}},{key:"loadJournal",value:(O=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee7(t){var r=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.showJournal(this.journals.find((function(o){return o.name==t&&o.flags.dsk.parent==r.selectedChapter})));case 2:case"end":return o.stop()}}),_callee7,this)}))),function loadJournal(t){return O.apply(this,arguments)})},{key:"loadJournalById",value:(x=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee8(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.showJournal(this.journals.find((function(r){return r.id==t})));case 2:case"end":return r.stop()}}),_callee8,this)}))),function loadJournalById(t){return x.apply(this,arguments)})},{key:"resaveBreadCrumbs",value:(w=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee9(t){var r,o,a,i;return adventure_wizard_regeneratorRuntime().wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:r={},o=adventure_wizard_createForOfIteratorHelper(t.getElementsByTagName("div"));try{for(o.s();!(a=o.n()).done;)i=a.value,r[i.dataset.uuid]=i.innerText}catch(t){o.e(t)}finally{o.f()}return c.next=5,game.settings.set("dsk","breadcrumbs_".concat(game.world.id),JSON.stringify(r));case 5:case"end":return c.stop()}}),_callee9)}))),function resaveBreadCrumbs(t){return w.apply(this,arguments)})},{key:"filterToc",value:(k=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee10(t){var r,o;return adventure_wizard_regeneratorRuntime().wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:if(null==t){a.next=23;break}if(""==(t=t.toLowerCase().trim())){a.next=19;break}if(o=[],!this.fulltextsearch){a.next=14;break}if(this.journalIndex){a.next=9;break}return this.journalIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data"]}}),a.next=9,this.journalIndex.add(this.journals.map((function(t){return new ke(t)})));case 9:return a.next=11,this.journalIndex.search(t);case 11:o=a.sent,a.next=15;break;case 14:o=this.journals.filter((function(r){return-1!=r.name.toLowerCase().trim().indexOf(t)}));case 15:o=o.map((function(t){return'<li class="fas fa-caret-right"><a data-jid="'.concat(t.id,'" class="subChapter">').concat(t.name,"</a></li>")})),$(this._element).find(".tocContent").html("<ul>".concat(o.join("\n"),"</ul>")),a.next=23;break;case 19:return a.next=21,this.getToc();case 21:r=a.sent,$(this._element).find(".adventureWizard > .row-section > .toc").html(r).find(".filterJournals").focus();case 23:case"end":return a.stop()}}),_callee10,this)}))),function filterToc(t){return k.apply(this,arguments)})},{key:"showJournal",value:(b=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee11(t){var r,o,a,i,c,u,l,p,d,h,y,m=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee11$(g){for(;;)switch(g.prev=g.next){case 0:r="",o=adventure_wizard_createForOfIteratorHelper(t.pages),g.prev=2,o.s();case 4:if((a=o.n()).done){g.next=18;break}return i=a.value,c=i.sheet,g.next=9,c.getData();case 9:return u=g.sent,g.next=12,c._renderInner(u);case 12:l=g.sent.get(),p=$(l[l.length-1]).html(),"video"==i.type&&(p='<div class="video-container">'.concat(p,"</div>")),r+=p;case 16:g.next=4;break;case 18:g.next=23;break;case 20:g.prev=20,g.t0=g.catch(2),o.e(g.t0);case 23:return g.prev=23,o.f(),g.finish(23);case 26:return d=this.findSceneNote(t.getFlag("dsk","initId")),g.next=29,TextEditor.enrichHTML(r,{secrets:!0,async:!0});case 29:h=g.sent,this.content='<div><h1 class="journalHeader" data-uuid="'.concat(t.uuid,'">').concat(t.name,'<div class="jrnIcons">').concat(d,'<a class="pinJournal"><i class="fas fa-thumbtack"></i></a><a class="showJournal"><i class="fas fa-eye"></i></a></div></h1>').concat(h),(y=$(this._element).find(".chapter")).html(this.content),bindImgToCanvasDragStart(y),y.find(".documentName-link, .entity-link").click((function(t){var r=$(t.currentTarget);m.bookData&&r.attr("data-pack")==m.bookData.journal&&(t.stopPropagation(),m.loadJournalById(r.attr("data-id")))}));case 35:case"end":return g.stop()}}),_callee11,this,[[2,20,23,26]])}))),function showJournal(t){return b.apply(this,arguments)})},{key:"findSceneNote",value:function findSceneNote(t){if(t){var r=game.journal.find((function(r){return r.getFlag("dsk","initId")==t}));if(r&&r.sceneNote)return'<a class="showMapNote" data-entryId="'.concat(r.id,'"><i class="fas fa-map-pin"></i></a>')}return""}},{key:"importBook",value:(v=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee12(){return adventure_wizard_regeneratorRuntime().wrap((function _callee12$(t){for(;;)switch(t.prev=t.next){case 0:game.user.isGM&&(new be).render(this.bookData.moduleName);case 1:case"end":return t.stop()}}),_callee12,this)}))),function importBook(){return v.apply(this,arguments)})},{key:"loadBook",value:(g=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee15(t,r,o){var a=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee15$(i){for(;;)switch(i.prev=i.next){case 0:return o||(o=this.currentType),this.currentType=o,this.book=this[o].find((function(r){return r.id==t})),i.next=5,fetch(this.book.path).then(function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee13(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee13$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee14(t){var o,i;return adventure_wizard_regeneratorRuntime().wrap((function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return a.bookData=t,o=game.packs.get(t.journal),c.next=4,o.getIndex();case 4:return c.sent,c.next=7,o.getDocuments();case 7:if(i=c.sent,a.journals=i,!t.actors){c.next=15;break}return o=game.packs.get(t.actors),c.next=13,o.getIndex();case 13:i=c.sent,a.actors=i;case 15:if(!t.scenes){c.next=21;break}return o=game.packs.get(t.scenes),c.next=19,o.getIndex();case 19:i=c.sent,a.scenes=i;case 21:a.loadPage(r);case 22:case"end":return c.stop()}}),_callee14)})));return function(r){return t.apply(this,arguments)}}());case 5:case"end":return i.stop()}}),_callee15,this)}))),function loadBook(t,r,o){return g.apply(this,arguments)})},{key:"prefillActors",value:(m=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee16(t){var r,o,a,i,c,u,l=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee16$(p){for(;;)switch(p.prev=p.next){case 0:if(t.actors){p.next=2;break}return p.abrupt("return",[]);case 2:return r=[],p.next=5,game.folders.contents.find((function(t){return t.name==game.i18n.localize("".concat(l.bookData.moduleName,".name"))&&"Actor"==t.type&&null==t.folder}));case 5:if(!(o=p.sent)){p.next=12;break}return p.next=9,game.folders.contents.filter((function(t){var r;return"Actor"==t.type&&(null===(r=t.folder)||void 0===r?void 0:r.id)==o.id})).map((function(t){return t.id}));case 9:p.t0=p.sent,p.next=13;break;case 12:p.t0=void 0;case 13:a=p.t0,i=adventure_wizard_createForOfIteratorHelper(t.actors);try{for(u=function _loop(){var t,o,i,u=c.value,p=null!=a&&a.length?game.actors.contents.find((function(t){var r;return t.name==u&&a.includes(null===(r=t.folder)||void 0===r?void 0:r.id)})):void 0,d=void 0,h=null===(t=p)||void 0===t?void 0:t.id,y=null===(o=p)||void 0===o?void 0:o.uuid;p||(p=l.actors.find((function(t){return t.name==u})),d=l.bookData.actors,h=null===(i=p)||void 0===i?void 0:i._id,y=p?"Compendium.".concat(d,".").concat(h):void 0),r.push({name:u,actor:p,pack:d,id:h,uuid:y})},i.s();!(c=i.n()).done;)u()}catch(t){i.e(t)}finally{i.f()}return p.abrupt("return",r);case 17:case"end":return p.stop()}}),_callee16)}))),function prefillActors(t){return m.apply(this,arguments)})},{key:"popJournal",value:(y=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee17(t){return adventure_wizard_regeneratorRuntime().wrap((function _callee17$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fromUuid(t);case 2:r.sent.sheet.render(!0);case 4:case"end":return r.stop()}}),_callee17)}))),function popJournal(t){return y.apply(this,arguments)})},{key:"showSzene",value:(h=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee18(t){var r,o,a=arguments;return adventure_wizard_regeneratorRuntime().wrap((function _callee18$(i){for(;;)switch(i.prev=i.next){case 0:if(r=a.length>1&&void 0!==a[1]?a[1]:"activate",o=game.scenes.contents.find((function(r){return r.name==t}))){i.next=4;break}return i.abrupt("return",ui.notifications.error(game.i18n.localize("dsk.DSKError.sceneNotInitialized")));case 4:i.t0=r,i.next="activate"===i.t0?7:"view"===i.t0?9:"toggle"===i.t0?11:13;break;case 7:return o.activate(),i.abrupt("break",13);case 9:return o.view(),i.abrupt("break",13);case 11:return o.update({navigation:!o.navigation}),i.abrupt("break",13);case 13:case"end":return i.stop()}}),_callee18)}))),function showSzene(t){return h.apply(this,arguments)})},{key:"getChapter",value:(d=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee19(){var t,r,o,a,i,c,u,l=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee19$(p){for(;;)switch(p.prev=p.next){case 0:if(!this.book){p.next=41;break}if(!this.content){p.next=3;break}return p.abrupt("return",this.content);case 3:if(!this.selectedChapter){p.next=36;break}if("prep"!=this.selectedChapter){p.next=14;break}t={initDescr:game.i18n.format("".concat(this.bookData.moduleName,".importContent"),{defaultText:game.i18n.localize("dsk.importDefault")})},r=this.bookData.modules,o=adventure_wizard_createForOfIteratorHelper(r);try{for(o.s();!(a=o.n()).done;)(i=a.value).enabled=this.moduleEnabled(i.id)}catch(t){o.e(t)}finally{o.f()}return p.next=11,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_preparation.html",{modules:r,info:t});case 11:case 17:case 30:case 35:case 38:case 43:return p.abrupt("return",p.sent);case 14:if("foundryUsage"!=this.selectedChapter){p.next=18;break}return p.next=17,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_foundry.html");case 18:if(c=this.bookData.chapters.find((function(t){return t.name==l.selectedType})).content.find((function(t){return t.id==l.selectedChapter})),u=this.getSubChapters(),!c.scenes&&!c.actors&&0!=u.length){p.next=33;break}return p.t0=renderTemplate,p.t1=c,p.t2=this.getSubChapters(),p.next=26,this.prefillActors(c);case 26:return p.t3=p.sent,p.t4={chapter:p.t1,subChapters:p.t2,actors:p.t3},p.next=30,(0,p.t0)("systems/dsk/templates/wizard/adventure/adventure_chapter.html",p.t4);case 33:return p.next=35,this.loadJournal(u[0].name);case 36:return p.next=38,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_cover.html",{book:this.book,bookData:this.bookData});case 41:return p.next=43,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_intro.html",{rshs:this.filterBooks(this.rshs),rules:this.filterBooks(this.books),adventures:this.filterBooks(this.adventures),isGM:game.user.isGM});case 44:case"end":return p.stop()}}),_callee19,this)}))),function getChapter(){return d.apply(this,arguments)})},{key:"filterBooks",value:function filterBooks(t){var r,o=game.settings.get("dsk","expansionPermissions"),a=adventure_wizard_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=o[i.id]&&(i.visible=o[i.id])}}catch(t){a.e(t)}finally{a.f()}return game.user.isGM?t:t.filter((function(t){return null==t.visible||t.visible})).sort((function(t,r){return t.id.localeCompare(r.id)}))}},{key:"getSubChapters",value:function getSubChapters(){var t=this;return this.journals.filter((function(r){return r.flags.dsk.parent==t.selectedChapter})).sort((function(t,r){return t.flags.dsk.sort>r.flags.dsk.sort?1:-1})).map((function(t){return{name:t.name,id:t.id}}))}},{key:"getToc",value:(p=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee20(){var t,r,o,a,i,c=this;return adventure_wizard_regeneratorRuntime().wrap((function _callee20$(u){for(;;)switch(u.prev=u.next){case 0:if(t=[],!this.book){u.next=29;break}if(t.push.apply(t,adventure_wizard_toConsumableArray(duplicate(this.bookData.chapters))),!this.selectedChapter){u.next=24;break}o=adventure_wizard_createForOfIteratorHelper(t),u.prev=5,o.s();case 7:if((a=o.n()).done){u.next=14;break}if(i=a.value,!(r=i.content.find((function(t){return t.id==c.selectedChapter})))){u.next=12;break}return u.abrupt("break",14);case 12:u.next=7;break;case 14:u.next=19;break;case 16:u.prev=16,u.t0=u.catch(5),o.e(u.t0);case 19:return u.prev=19,o.f(),u.finish(19);case 22:r.cssClass="selected",r.subChapters=this.getSubChapters();case 24:return u.next=26,renderTemplate("systems/dsk/templates/wizard/adventure/adventure_toc.html",{chapters:t,book:this.book,fulltextsearch:this.fulltextsearch?"on":""});case 26:return u.abrupt("return",u.sent);case 29:return u.abrupt("return",'<div class="libraryImg"></div>');case 30:case"end":return u.stop()}}),_callee20,this,[[5,16,19,22]])}))),function getToc(){return p.apply(this,arguments)})},{key:"loadPage",value:(c=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee21(t){var r,o;return adventure_wizard_regeneratorRuntime().wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getChapter();case 2:return r=a.sent,a.next=5,this.getToc();case 5:o=a.sent,t.find(".toc").html(o),t.find(".chapter").html(r);case 8:case"end":return a.stop()}}),_callee21,this)}))),function loadPage(t){return c.apply(this,arguments)})},{key:"getData",value:(i=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee22(t){var r,o,a;return adventure_wizard_regeneratorRuntime().wrap((function _callee22$(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard.prototype),"getData",this).call(this,t);case 2:return r=i.sent,i.next=5,this.getChapter();case 5:return o=i.sent,i.next=8,this.getToc();case 8:return a=i.sent,mergeObject(r,{adventure:this.bookData,currentChapter:o,breadcrumbs:this.renderBreadcrumbs(),toc:a}),i.abrupt("return",r);case 11:case"end":return i.stop()}}),_callee22,this)}))),function getData(t){return i.apply(this,arguments)})},{key:"pinJournal",value:(a=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee23(t){var r,o,a,i=arguments;return adventure_wizard_regeneratorRuntime().wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:if(o=i.length>1&&void 0!==i[1]?i[1]:void 0,a=this.readBreadCrumbs(),o){c.next=18;break}return c.next=5,fromUuid(t);case 5:if(c.t2=r=c.sent,c.t1=null===c.t2,c.t1){c.next=9;break}c.t1=void 0===r;case 9:if(!c.t1){c.next=13;break}c.t3=void 0,c.next=14;break;case 13:c.t3=r.name;case 14:if(c.t0=c.t3,c.t0){c.next=17;break}c.t0="";case 17:o=c.t0;case 18:a[t]=o,game.settings.set("dsk","breadcrumbs_".concat(game.world.id),JSON.stringify(a)),this.render(!0);case 21:case"end":return c.stop()}}),_callee23,this)}))),function pinJournal(t){return a.apply(this,arguments)})},{key:"unpinJournal",value:function unpinJournal(t){var r=this.readBreadCrumbs();delete r[t],game.settings.set("dsk","breadcrumbs_".concat(game.world.id),JSON.stringify(r)),this.render(!0)}},{key:"_canDragDrop",value:function _canDragDrop(t){return!0}},{key:"_onDrop",value:(o=adventure_wizard_asyncToGenerator(adventure_wizard_regeneratorRuntime().mark((function _callee24(t){var r;return adventure_wizard_regeneratorRuntime().wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:o.prev=0,r=JSON.parse(t.dataTransfer.getData("text/plain")),o.next=7;break;case 4:return o.prev=4,o.t0=o.catch(0),o.abrupt("return",!1);case 7:"JournalEntry"==r.type&&this.pinJournal(r.pack?"Compendium.".concat(r.pack,".").concat(r.id):"JournalEntry.".concat(r.id));case 8:case"end":return o.stop()}}),_callee24,this,[[0,4]])}))),function _onDrop(t){return o.apply(this,arguments)})},{key:"readBreadCrumbs",value:function readBreadCrumbs(){var t={};try{t=JSON.parse(game.settings.get("dsk","breadcrumbs_".concat(game.world.id)))}catch(t){console.log("No Journalbrowser notes found")}return t}},{key:"renderBreadcrumbs",value:function renderBreadcrumbs(){var t=this.readBreadCrumbs(),r=Object.entries(t).map((function(t){return'<div data-tooltip="'.concat(t[1],'" data-uuid="').concat(t[0],'" class="openPin item">').concat(t[1],"</div>")}));return r.length>0?'<div id="breadcrumbs" class="breadcrumbs wrap row-section">'.concat(r.join(""),"</div>"):""}},{key:"moduleEnabled",value:function moduleEnabled(r){return t.Z.moduleEnabled(r)}}],[{key:"defaultOptions",get:function get(){var t=adventure_wizard_get(adventure_wizard_getPrototypeOf(BookWizard),"defaultOptions",this);return t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"description"}],mergeObject(t,{classes:t.classes.concat(["dsk","largeDialog","noscrollWizard","bookWizardsheet"]),width:800,height:880,template:"systems/dsk/templates/wizard/adventure/adventure_wizard.html",title:game.i18n.localize("dsk.Book.Wizard"),resizable:!0,dragDrop:[{dragSelector:".item-list .item",dropSelector:null}]}),t}},{key:"initHook",value:function initHook(){BookWizard.wizard=new BookWizard,game.dsk.apps.journalBrowser=BookWizard.wizard,Hooks.on("renderSidebarTab",(function(t,r){if("journal"==t.options.id){var o=$('<div class="header-actions action-buttons flexrow"></div>'),a=$('<button id="openJournalBrowser"><i class="fa fa-book"></i>'.concat(game.i18n.localize("dsk.Book.Wizard"),"</button>"));a.click((function(){BookWizard.wizard.render(!0)})),o.append(a),r.find(".header-actions:first-child").after(o)}}))}}]),BookWizard}();!function adventure_wizard_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(_e,"wizard",void 0);var be=function(t){adventure_wizard_inherits(InitializerForm,FormApplication);var r=adventure_wizard_createSuper(InitializerForm);function InitializerForm(){return adventure_wizard_classCallCheck(this,InitializerForm),r.apply(this,arguments)}return adventure_wizard_createClass(InitializerForm,[{key:"render",value:function render(t){new game.dsk.apps.DSKInitializer("DSK Module Initialization",game.i18n.format("".concat(t,".importContent"),{defaultText:game.i18n.localize("dsk.importDefault")}),t,game.i18n.lang).render(!0)}}]),InitializerForm}(),ke=function(){function JournalSearch(t){adventure_wizard_classCallCheck(this,JournalSearch);var r=t.pages.find((function(t){return!0})).text.content;this.document={name:t.name,data:$("<div>").html(r).text(),id:t.id}}return adventure_wizard_createClass(JournalSearch,[{key:"name",get:function get(){return this.document.name}},{key:"data",get:function get(){return this.document.data}},{key:"id",get:function get(){return this.document.id}}]),JournalSearch}(),we=__webpack_require__(586);function configuration_typeof(t){return configuration_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},configuration_typeof(t)}function configuration_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function configuration_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function configuration_createClass(t,r,o){return r&&configuration_defineProperties(t.prototype,r),o&&configuration_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function configuration_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&configuration_setPrototypeOf(t,r)}function configuration_setPrototypeOf(t,r){return configuration_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},configuration_setPrototypeOf(t,r)}function configuration_createSuper(t){var r=function configuration_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=configuration_getPrototypeOf(t);if(r){var i=configuration_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return configuration_possibleConstructorReturn(this,o)}}function configuration_possibleConstructorReturn(t,r){if(r&&("object"===configuration_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function configuration_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function configuration_getPrototypeOf(t){return configuration_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},configuration_getPrototypeOf(t)}function configuration_regeneratorRuntime(){configuration_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==configuration_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function configuration_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function configuration_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){configuration_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){configuration_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}var xe=function(t){configuration_inherits(ChangelogForm,FormApplication);var r=configuration_createSuper(ChangelogForm);function ChangelogForm(){return configuration_classCallCheck(this,ChangelogForm),r.apply(this,arguments)}return configuration_createClass(ChangelogForm,[{key:"render",value:function render(){(0,we.j)()}}]),ChangelogForm}();var Oe=function combatTurn(t){var r,o;(null===(r=game.combat)||void 0===r||null===(o=r.combatant)||void 0===o?void 0:o.isOwner)&&game.combat[t]()};function setup_typeof(t){return setup_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},setup_typeof(t)}function setup_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function setup_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function setup_setPrototypeOf(t,r){return setup_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},setup_setPrototypeOf(t,r)}function setup_createSuper(t){var r=function setup_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=setup_getPrototypeOf(t);if(r){var i=setup_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return setup_possibleConstructorReturn(this,o)}}function setup_possibleConstructorReturn(t,r){if(r&&("object"===setup_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function setup_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function setup_getPrototypeOf(t){return setup_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},setup_getPrototypeOf(t)}function setup_regeneratorRuntime(){setup_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==setup_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function setup_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function initSetup(){Hooks.once("setup",(function(){!function setupConfiguration(){var t,r,o;game.settings.register("dsk","migrationVersion",{name:"migrationVersion",scope:"world",config:!1,default:2,type:Number}),game.settings.register("dsk","firstTimeStart",{name:"firstTimeStart",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","defaultConfigFinished",{name:"defaultConfigFinished",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","limitCombatSpecAbs",{name:"dsk.SETTINGS.limitCombatSpecAbs",hint:"dsk.SETTINGS.limitCombatSpecAbsHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","merchantNotification",{name:"dsk.SETTINGS.merchantNotification",hint:"dsk.SETTINGS.merchantNotificationHint",scope:"world",config:!0,default:"0",type:String,choices:{0:game.i18n.localize("dsk.no"),1:game.i18n.localize("dsk.yes"),2:game.i18n.localize("dsk.MERCHANT.onlyGM")}}),game.settings.register("dsk","expandChatModifierlist",{name:"dsk.SETTINGS.expandChatModifierlist",hint:"dsk.SETTINGS.expandChatModifierlistHint",scope:"client",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","enableCombatFlow",{name:"dsk.SETTINGS.enableCombatFlow",hint:"dsk.SETTINGS.enableCombatFlowHint",scope:"client",config:!0,default:!0,type:Boolean,onchange:function onchange(t){game.dsk.apps.initTracker&&(game.dsk.apps.initTracker.close(),game.dsk.apps.initTracker=void 0)}}),game.settings.register("dsk","sightAutomationEnabled",{name:"sightAutomationEnabled",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","inventorySound",{name:"dsk.SETTINGS.inventorySound",hint:"dsk.SETTINGS.inventorySoundHint",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","diceSetup",{name:"diceSetup",hint:"diceSetup",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","scrollingFontsize",{name:"dsk.SETTINGS.scrollingFontsize",hint:"dsk.SETTINGS.scrollingFontsizeHint",scope:"client",config:!0,default:16,type:Number,range:{min:6,max:50,step:1}}),game.settings.register("dsk","playerCanEditSpellMacro",{name:"dsk.SETTINGS.playerCanEditSpellMacro",hint:"dsk.SETTINGS.playerCanEditSpellMacroHint",scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","expansionPermissions",{name:"expansionPermissions",scope:"world",config:!1,default:{},type:Object}),game.settings.register("dsk","breadcrumbs_".concat(game.world.id),{name:"dsk.SETTINGS.breadcrumbs",scope:"client",config:!1,default:"",type:String}),game.settings.register("dsk","soundConfig",{name:"dsk.SETTINGS.soundConfig",hint:"dsk.SETTINGS.soundConfigHint",scope:"world",config:!0,default:"",type:String,onChange:(t=configuration_asyncToGenerator(configuration_regeneratorRuntime().mark((function _callee(){return configuration_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:h.Z.loadSoundConfig();case 1:case"end":return t.stop()}}),_callee)}))),function onChange(){return t.apply(this,arguments)})}),game.settings.register("dsk","allowPhysicalDice",{name:"dsk.SETTINGS.allowPhysicalDice",hint:"dsk.SETTINGS.allowPhysicalDiceHint",scope:"world",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","enableItemDropToCanvas",{name:"dsk.SETTINGS.enableItemDropToCanvas",hint:"dsk.SETTINGS.enableItemDropToCanvasHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","hideEffects",{name:"dsk.SETTINGS.hideEffects",hint:"dsk.SETTINGS.hideEffectsHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","indexDescription",{name:"dsk.SETTINGS.indexDescription",scope:"client",config:!1,default:!0,type:Boolean}),game.settings.register("dsk","enableDPS",{name:"dsk.SETTINGS.enableDPS",hint:"dsk.SETTINGS.enableDPSHint",scope:"world",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","indexWorldItems",{name:"dsk.SETTINGS.indexWorldItems",scope:"client",config:!1,default:!0,type:Boolean}),game.settings.register("dsk","tokenizerSetup",{name:"tokenizerSetup",scope:"world",config:!1,default:!1,type:Boolean}),game.settings.register("dsk","forceLanguage",{name:"dsk.SETTINGS.forceLanguage",hint:"dsk.SETTINGS.forceLanguageHint",scope:"world",config:!0,default:"none",type:String,choices:{none:"-",de:"German"}}),game.settings.register("dsk","enableCombatPan",{name:"dsk.SETTINGS.enableCombatPan",hint:"dsk.SETTINGS.enableCombatPanHint",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("dsk","iniTrackerSize",{name:"dsk.SETTINGS.iniTrackerSize",hint:"dsk.SETTINGS.iniTrackerSizeHint",scope:"client",config:!0,default:70,type:Number,range:{min:30,max:140,step:5},onChange:(r=configuration_asyncToGenerator(configuration_regeneratorRuntime().mark((function _callee2(t){return configuration_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:game.dsk.apps.tokenHotbar.constructor.defaultOptions.itemWidth=t;case 1:case"end":return r.stop()}}),_callee2)}))),function onChange(t){return r.apply(this,arguments)})}),game.settings.register("dsk","iniTrackerPosition",{name:"iniTrackerPosition",scope:"client",config:!1,default:{},type:Object}),game.settings.register("dsk","tokenhotbarPosition",{name:"tokenhotbarPosition",scope:"client",config:!1,default:{},type:Object}),game.settings.registerMenu("dsk","changelog",{name:"Changelog",label:"Changelog",hint:game.i18n.localize("dsk.SETTINGS.changelog"),type:xe,restricted:!1}),game.settings.register("dsk","disableDidYouKnow",{name:"dsk.SETTINGS.disableDidYouKnow",hint:"dsk.SETTINGS.disableDidYouKnowHint",scope:"client",config:!0,default:!1,type:Boolean}),game.settings.register("dsk","tokenhotbarSize",{name:"dsk.SETTINGS.tokenhotbarSize",hint:"dsk.SETTINGS.tokenhotbarSizeHint",scope:"client",config:!0,default:35,type:Number,range:{min:15,max:100,step:5},onChange:(o=configuration_asyncToGenerator(configuration_regeneratorRuntime().mark((function _callee3(t){return configuration_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:game.dsk.apps.tokenHotbar.constructor.defaultOptions.itemWidth=t;case 1:case"end":return r.stop()}}),_callee3)}))),function onChange(t){return o.apply(this,arguments)})}),game.settings.register("dsk","obfuscateTokenNames",{name:"dsk.SETTINGS.obfuscateTokenNames",hint:"dsk.SETTINGS.obfuscateTokenNamesHint",scope:"world",config:!0,default:"0",type:String,choices:{0:game.i18n.localize("dsk.no"),1:game.i18n.localize("dsk.SETTINGS.yesNumbered"),2:game.i18n.localize("dsk.SETTINGS.renameNumbered"),3:game.i18n.localize("dsk.yes"),4:game.i18n.localize("dsk.SETTINGS.rename")}}),game.settings.register("dsk","tokenhotbarLayout",{name:"dsk.SETTINGS.tokenhotbarLayout",hint:"dsk.SETTINGS.tokenhotbarLayoutHint",scope:"client",config:!0,default:0,type:Number,choices:{0:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout0"),2:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout1"),1:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout2"),3:game.i18n.localize("dsk.SETTINGS.tokenhotbarLayout3")}})}(),["de","en"].includes(game.i18n.lang)||(console.warn("DSK - ".concat(game.i18n.lang," is not a supported language. Falling back to default language.")),game.settings.set("core","language","de").then((function(){return foundry.utils.debouncedReload()})));var r=game.settings.get("dsk","forceLanguage");["de","en"].includes(r)&&game.i18n.lang!=r&&Se(r),function setupKeybindings(){game.keybindings.register("dsk","combatTrackerNext",{name:"COMBAT.TurnNext",hint:game.i18n.localize("COMBAT.TurnNext"),editable:[{key:"KeyN"}],onDown:function onDown(){return Oe("nextTurn")}}),game.keybindings.register("dsk","combatTrackerPrevious",{name:"COMBAT.TurnPrev",hint:game.i18n.localize("COMBAT.TurnPrev"),editable:[{key:"KeyV"}],onDown:function onDown(){return Oe("previousTurn")}}),game.keybindings.register("dsk","journalBrowser",{name:"Book.Wizard",hint:game.i18n.localize("dsk.KEYBINDINGS.journalBrowser"),editable:[{key:"KeyJ"}],onDown:function onDown(){return t.Z.renderToggle(game.dsk.apps.journalBrowser)}}),game.keybindings.register("dsk","library",{name:"ItemLibrary",hint:game.i18n.localize("dsk.KEYBINDINGS.library"),editable:[{key:"KeyL"}],onDown:function onDown(){return t.Z.renderToggle(game.dsk.itemLibrary)}})}(),function setupScene(){Hooks.on("preCreateScene",(function(t,r,o,a){var i;null!==(i=r.grid)&&void 0!==i&&i.units||t.updateSource({grid:{units:game.i18n.localize("dsk.gridUnits")}})})),Hooks.on("preCreateActiveEffect",(function(t,r,o,a){if("Actor"==t.parent.documentName){var i={duration:{}};t.duration.startTime||(i.duration.startTime=game.time.worldTime),game.combat?(i.duration.combat=game.combat.id,i.duration.startRound=game.combat.round,i.duration.startTurn=game.combat.turn,!t.duration.rounds&&t.duration.seconds&&(i.duration.rounds=t.duration.seconds/5),t.updateSource(i)):t.updateSource(i)}}))}(),_e.initHook(),CONFIG.Canvas.lightAnimations.daylight={label:"LIGHT.daylight",illuminationShader:Pe},m.Z.setupFunctions(),g.Z.setupFunctions()}))}var Se=function showWrongLanguageDialog(t){var r,o={title:game.i18n.localize("dsk.SETTINGS.forceLanguage"),content:game.i18n.format("dsk.DSKError.wrongLanguage",{lang:t}),buttons:{ok:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.ok"),callback:(r=function setup_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){setup_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){setup_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(setup_regeneratorRuntime().mark((function _callee(){return setup_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("core","language",t);case 2:foundry.utils.debouncedReload();case 3:case"end":return r.stop()}}),_callee)}))),function callback(){return r.apply(this,arguments)})},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}};new Dialog(o).render(!0)},Pe=function(t){!function setup_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&setup_setPrototypeOf(t,r)}(DaylightIlluminationShader,AdaptiveIlluminationShader);var r=setup_createSuper(DaylightIlluminationShader);function DaylightIlluminationShader(){return setup_classCallCheck(this,DaylightIlluminationShader),r.apply(this,arguments)}return function setup_createClass(t,r,o){return r&&setup_defineProperties(t.prototype,r),o&&setup_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DaylightIlluminationShader)}();function sidebar_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function sidebar_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return sidebar_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return sidebar_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function sidebar_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function actor_typeof(t){return actor_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},actor_typeof(t)}function actor_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function actor_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function actor_setPrototypeOf(t,r){return actor_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},actor_setPrototypeOf(t,r)}function actor_createSuper(t){var r=function actor_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=actor_getPrototypeOf(t);if(r){var i=actor_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return actor_possibleConstructorReturn(this,o)}}function actor_possibleConstructorReturn(t,r){if(r&&("object"===actor_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function actor_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function actor_getPrototypeOf(t){return actor_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},actor_getPrototypeOf(t)}function actor_regeneratorRuntime(){actor_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==actor_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function actor_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function actor_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){actor_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){actor_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}!function setup_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(Pe,"fragmentShader","\n    ".concat(Pe.SHADER_HEADER,"\n    ").concat(Pe.PERCEIVED_BRIGHTNESS,"\n\n    void main() {\n        ").concat(Pe.FRAGMENT_BEGIN,"\n        ").concat(Pe.TRANSITION,"\n       \n        // Darkness\n        framebufferColor = max(framebufferColor, colorBackground);        \n        // Elevation\n        finalColor = mix(finalColor, max(finalColor, smoothstep( 0.1, 1.0, finalColor ) * 10.0), 1.0) * depth;        \n        // Final\n        gl_FragColor = vec4(finalColor, 1.0);\n      }"));var Te=function(t){!function actor_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&actor_setPrototypeOf(t,r)}(AskForNameDialog,Dialog);var r,o=actor_createSuper(AskForNameDialog);function AskForNameDialog(){return actor_classCallCheck(this,AskForNameDialog),o.apply(this,arguments)}return function actor_createClass(t,r,o){return r&&actor_defineProperties(t.prototype,r),o&&actor_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(AskForNameDialog,null,[{key:"getDialog",value:(r=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee5(t,r){return actor_regeneratorRuntime().wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:new Dialog({title:game.i18n.localize("dsk.SETTINGS.obfuscateTokenNames"),content:'<label for="name">'.concat(game.i18n.localize("dsk.SETTINGS.rename"),'</label> <input dtype="string" name="name" type="text" value="').concat(t.actor.name,'"/>'),default:"Yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function(){var o=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee3(o){var a,i,c,u;return actor_regeneratorRuntime().wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:return a=t.id||t._id,i=o.find('[name="name"]').val(),2==r&&(c=canvas.scene.tokens.filter((function(t){return t.name===i}))).length>0&&(i="".concat(i.replace(/ \d{1,}$/)," ").concat(c.length+1)),u=canvas.scene.tokens.get(a),l.next=6,u.update({name:i});case 6:case"end":return l.stop()}}),_callee3)})));return function callback(t){return o.apply(this,arguments)}}()},unknown:{icon:'<i class="fa fa-question"></i>',label:game.i18n.localize("dsk.unknown"),callback:function(){var r=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee4(r){var o,a;return actor_regeneratorRuntime().wrap((function _callee4$(r){for(;;)switch(r.prev=r.next){case 0:return o=t.id||t._id,a=canvas.scene.tokens.get(o),r.next=4,a.update({name:game.i18n.localize("dsk.unknown")});case 4:case"end":return r.stop()}}),_callee4)})));return function callback(t){return r.apply(this,arguments)}}()},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel")}}}).render(!0);case 1:case"end":return o.stop()}}),_callee5)}))),function getDialog(t,o){return r.apply(this,arguments)})}]),AskForNameDialog}();function dicesonice_typeof(t){return dicesonice_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dicesonice_typeof(t)}function dicesonice_regeneratorRuntime(){dicesonice_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dicesonice_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dicesonice_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dicesonice_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dicesonice_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dicesonice_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dicesonice_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=dicesonice_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function dicesonice_slicedToArray(t,r){return function dicesonice_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function dicesonice_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==o)return;var a,i,c=[],u=!0,l=!1;try{for(o=o.call(t);!(u=(a=o.next()).done)&&(c.push(a.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==o.return||o.return()}finally{if(l)throw i}}return c}(t,r)||dicesonice_unsupportedIterableToArray(t,r)||function dicesonice_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dicesonice_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return dicesonice_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?dicesonice_arrayLikeToArray(t,r):void 0}}function dicesonice_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function dicesonice_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dicesonice_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dicesonice_createClass(t,r,o){return r&&dicesonice_defineProperties(t.prototype,r),o&&dicesonice_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function dicesonice_get(){return dicesonice_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dicesonice_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dicesonice_get.apply(this,arguments)}function dicesonice_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dicesonice_getPrototypeOf(t)););return t}function dicesonice_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dicesonice_setPrototypeOf(t,r)}function dicesonice_setPrototypeOf(t,r){return dicesonice_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dicesonice_setPrototypeOf(t,r)}function dicesonice_createSuper(t){var r=function dicesonice_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dicesonice_getPrototypeOf(t);if(r){var i=dicesonice_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dicesonice_possibleConstructorReturn(this,o)}}function dicesonice_possibleConstructorReturn(t,r){if(r&&("object"===dicesonice_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dicesonice_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dicesonice_getPrototypeOf(t){return dicesonice_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dicesonice_getPrototypeOf(t)}var Ie=function(r){dicesonice_inherits(DiceSoNiceCustomization,Application);var o,a,i=dicesonice_createSuper(DiceSoNiceCustomization);function DiceSoNiceCustomization(){return dicesonice_classCallCheck(this,DiceSoNiceCustomization),i.apply(this,arguments)}return dicesonice_createClass(DiceSoNiceCustomization,[{key:"initConfigs",value:function initConfigs(){var t=game.dice3d.exports.Utils.prepareColorsetList();this.choices={};for(var r=0,o=Object.entries(t);r<o.length;r++){var a=dicesonice_slicedToArray(o[r],2),i=(a[0],a[1]);mergeObject(this.choices,i)}var c={damage:"black"};game.settings.registerMenu("dsk","dicesonicesettings",{name:"DiceSoNiceSettings",label:"DiceSoNice Settings",hint:game.i18n.localize("dsk.SETTINGS.dicesonicesettings"),type:Ee,restricted:!1});var u,l=dicesonice_createForOfIteratorHelper(DiceSoNiceCustomization.attrs);try{for(l.s();!(u=l.n()).done;){var p=u.value;game.settings.register("dsk","dice3d_".concat(p),{name:"CHAR.".concat(p.toUpperCase()),scope:"client",config:!1,default:c[p]||p,type:String}),game.settings.register("dsk","dice3d_system_".concat(p),{name:"CHAR.".concat(p.toUpperCase()),scope:"client",config:!1,default:"standard",type:String})}}catch(t){l.e(t)}finally{l.f()}}},{key:"getAttributeConfiguration",value:function getAttributeConfiguration(r){return t.Z.moduleEnabled("dice-so-nice")?{colorset:game.settings.get("dsk","dice3d_".concat(r)),appearance:{colorset:game.settings.get("dsk","dice3d_".concat(r)),system:game.settings.get("dsk","dice3d_system_".concat(r))}}:{colorset:r}}},{key:"activateListeners",value:function activateListeners(t){dicesonice_get(dicesonice_getPrototypeOf(DiceSoNiceCustomization.prototype),"activateListeners",this).call(this),t.find('[name="entryselection"]').change(function(){var t=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee(t){return dicesonice_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("dsk","dice3d_".concat(t.currentTarget.dataset.attr),t.currentTarget.value);case 2:case"end":return r.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}()),t.find('[name="systemselection"]').change(function(){var t=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee2(t){return dicesonice_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,game.settings.set("dsk","dice3d_system_".concat(t.currentTarget.dataset.attr),t.currentTarget.value);case 2:DiceSoNiceCustomization.preloadDiceAssets([t.currentTarget.value]),game.socket.emit("system.dsk",{type:"preloadDice3d",payload:{toPreload:[t.currentTarget.value]}});case 4:case"end":return r.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}())}},{key:"getData",value:(a=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee3(t){var r,o,a,i;return dicesonice_regeneratorRuntime().wrap((function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,dicesonice_get(dicesonice_getPrototypeOf(DiceSoNiceCustomization.prototype),"getData",this).call(this,t);case 2:(r=c.sent).choices=this.choices,r.systems=game.dice3d.DiceFactory.systems,r.selections={},o=dicesonice_createForOfIteratorHelper(DiceSoNiceCustomization.attrs);try{for(o.s();!(a=o.n()).done;)i=a.value,r.selections[i]={color:game.settings.get("dsk","dice3d_".concat(i)),system:game.settings.get("dsk","dice3d_system_".concat(i))}}catch(t){o.e(t)}finally{o.f()}return c.abrupt("return",r);case 9:case"end":return c.stop()}}),_callee3,this)}))),function getData(t){return a.apply(this,arguments)})}],[{key:"onConnect",value:function onConnect(){game.socket.on("system.dsk",(function(t){switch(t.type){case"preloadDice3d":console.warn("Preloading forced DSK dice assets"),DiceSoNiceCustomization.preloadDiceAssets(t.payload);break;case"getPreloadDice3d":DiceSoNiceCustomization.requestDicePreloads()}})),this.collectPreloads(),game.socket.emit("system.dsk",{type:"getPreloadDice3d"})}},{key:"collectPreloads",value:function collectPreloads(){var t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=new Set,a=dicesonice_createForOfIteratorHelper(DiceSoNiceCustomization.attrs);try{for(a.s();!(t=a.n()).done;){var i=t.value;o.add(game.settings.get("dsk","dice3d_system_".concat(i)))}}catch(t){a.e(t)}finally{a.f()}o=Array.from(o),r&&this.preloadDiceAssets(o),game.socket.emit("system.dsk",{type:"preloadDice3d",payload:o})}},{key:"requestDicePreloads",value:function requestDicePreloads(){this.collectPreloads(!1)}},{key:"preloadDiceAssets",value:(o=dicesonice_asyncToGenerator(dicesonice_regeneratorRuntime().mark((function _callee4(t){var r,o,a,i,c,u,l,p,d,h=arguments;return dicesonice_regeneratorRuntime().wrap((function _callee4$(y){for(;;)switch(y.prev=y.next){case 0:r=h.length>1&&void 0!==h[1]?h[1]:[],console.warn("loading",t),o=dicesonice_createForOfIteratorHelper(t),y.prev=3,o.s();case 5:if((a=o.n()).done){y.next=41;break}if(i=a.value,c=game.dice3d.DiceFactory.systems[i]){y.next=10;break}return y.abrupt("continue",39);case 10:u=c.dice.filter((function(t){return 0==r.length||r.includes(t.type)})),l=dicesonice_createForOfIteratorHelper(u),y.prev=12,l.s();case 14:if((p=l.n()).done){y.next=31;break}if(d=p.value,y.prev=16,!d.modelFile){y.next=22;break}return y.next=20,d.loadModel(game.dice3d.DiceFactory.loaderGLTF);case 20:y.next=24;break;case 22:return y.next=24,d.loadTextures();case 24:y.next=29;break;case 26:y.prev=26,y.t0=y.catch(16),console.warn("Unable to load dice model",i,d);case 29:y.next=14;break;case 31:y.next=36;break;case 33:y.prev=33,y.t1=y.catch(12),l.e(y.t1);case 36:return y.prev=36,l.f(),y.finish(36);case 39:y.next=5;break;case 41:y.next=46;break;case 43:y.prev=43,y.t2=y.catch(3),o.e(y.t2);case 46:return y.prev=46,o.f(),y.finish(46);case 49:case"end":return y.stop()}}),_callee4,null,[[3,43,46,49],[12,33,36,39],[16,26]])}))),function preloadDiceAssets(t){return o.apply(this,arguments)})},{key:"defaultOptions",get:function get(){var t=dicesonice_get(dicesonice_getPrototypeOf(DiceSoNiceCustomization),"defaultOptions",this);return mergeObject(t,{template:"systems/dsk/templates/wizard/dicesonice-configuration.html",title:game.i18n.localize("dsk.SETTINGS.dicesonicesettings"),width:600}),t}}]),DiceSoNiceCustomization}();!function dicesonice_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}(Ie,"attrs",["mu","kl","in","ch","ff","ge","ko","kk","attack","damage"]);var Ee=function(t){dicesonice_inherits(DiceSoNiceForm,FormApplication);var r=dicesonice_createSuper(DiceSoNiceForm);function DiceSoNiceForm(){return dicesonice_classCallCheck(this,DiceSoNiceForm),r.apply(this,arguments)}return dicesonice_createClass(DiceSoNiceForm,[{key:"render",value:function render(){game.dsk.apps.DiceSoNiceCustomization.render(!0)}}]),DiceSoNiceForm}(),Ce=__webpack_require__(614);function statuseffect_typeof(t){return statuseffect_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},statuseffect_typeof(t)}function statuseffect_regeneratorRuntime(){statuseffect_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==statuseffect_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function statuseffect_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function statuseffect_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return statuseffect_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return statuseffect_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function statuseffect_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function statuseffect_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function statuseffect_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){statuseffect_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){statuseffect_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function initTokenHook(){Token.prototype.drawEffects=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee(){var t,r,o,a,i,c,u,l,p,d,h,y;return statuseffect_regeneratorRuntime().wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(this.effects.removeChildren().forEach((function(t){return t.destroy()})),this.effects.bg=this.effects.addChild(new PIXI.Graphics),this.effects.overlay=null,t=this.document.effects,!this.actor){m.next=10;break}return m.next=7,this.actor.actorEffects();case 7:m.t0=m.sent,m.next=11;break;case 10:m.t0=[];case 11:if(r=m.t0,o={src:this.document.overlayEffect,tint:null},!t.length&&!r.length){m.next=41;break}a=[],i=statuseffect_createForOfIteratorHelper(r),m.prev=16,i.s();case 18:if((c=i.n()).done){m.next=29;break}if((l=c.value).icon){m.next=22;break}return m.abrupt("continue",27);case 22:if(p=Color.from(null!==(u=l.tint)&&void 0!==u?u:null),!l.getFlag("core","overlay")){m.next=26;break}return o={src:l.icon,tint:p},m.abrupt("continue",27);case 26:a.push(this._drawEffect(l.icon,p,getProperty(l,"flags.dsk.value")));case 27:m.next=18;break;case 29:m.next=34;break;case 31:m.prev=31,m.t1=m.catch(16),i.e(m.t1);case 34:return m.prev=34,i.f(),m.finish(34);case 37:d=statuseffect_createForOfIteratorHelper(t);try{for(d.s();!(h=d.n()).done;)y=h.value,a.push(this._drawEffect(y,null))}catch(t){d.e(t)}finally{d.f()}return m.next=41,Promise.all(a);case 41:return m.next=43,this._drawOverlay(o.src,o.tint);case 43:this.effects.overlay=m.sent,this._refreshEffects();case 45:case"end":return m.stop()}}),_callee,this,[[16,31,34,37]])}))),Token.prototype._refreshEffects=function(){var t,r=0,o=2*Math.round(canvas.dimensions.size/2/5),a=Math.floor(5*this.document.height),i=this.effects.bg.clear().beginFill(0,.4).lineStyle(1,0),c=statuseffect_createForOfIteratorHelper(this.effects.children);try{for(c.s();!(t=c.n()).done;){var u=t.value;if(u!==i&&!u.isCounter)if(u===this.effects.overlay){var l=Math.min(.6*this.w,.6*this.h);u.width=u.height=l,u.position.set((this.w-l)/2,(this.h-l)/2)}else{if(u.width=u.height=o,u.x=Math.floor(r/a)*o,u.y=r%a*o,i.drawRoundedRect(u.x+1,u.y+1,o-2,o-2,2),u.counter>1&&!u.counterDrawn){var p=game.dsk.config.effectTextStyle,d=game.settings.get("dsk","statusEffectCounterColor");p._fill=/^#[0-9A-F]+$/.test(d)?d:"#000000";var h=this.effects.addChild(new PreciseText(u.counter,p));h.x=u.x,h.y=u.y,h.isCounter=!0,u.counterDrawn=!0}r++}}}catch(t){c.e(t)}finally{c.f()}},Token.prototype._drawEffect=function(){var t=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee2(t,r,o){var a,i;return statuseffect_regeneratorRuntime().wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(t){c.next=2;break}return c.abrupt("return");case 2:return c.next=4,loadTexture(t,{fallback:"icons/svg/hazard.svg"});case 4:return a=c.sent,i=new PIXI.Sprite(a),r&&(i.tint=r),i.counter=o,c.abrupt("return",this.effects.addChild(i));case 9:case"end":return c.stop()}}),_callee2,this)})));return function(r,o,a){return t.apply(this,arguments)}}(),TokenHUD.prototype._onToggleEffect=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.overlay;t.preventDefault();var o=t.currentTarget,a=o.dataset.statusId&&this.object.actor?CONFIG.statusEffects.find((function(t){return t.id===o.dataset.statusId})):o.getAttribute("src");if(a.flags.dsk.editable)return 0==t.button?this.object.incrementCondition(a):2==t.button?this.object.decrementCondition(a):void 0},Token.prototype.incrementCondition=function(){var t=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee3(t){var r,o,a,i,c=arguments;return statuseffect_regeneratorRuntime().wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:{},o=r.active,a=r.overlay,void 0!==a&&a,(i=this.actor.effects.find((function(r){return r.getFlag("core","statusId")===t.id})))&&!Number.isNumeric(getProperty(i,"flags.dsk.value"))){u.next=7;break}return u.next=5,this.actor.addCondition(t.id,1,!1,!1);case 5:u.next=10;break;case 7:if(!i){u.next=10;break}return u.next=10,this.actor.removeCondition(t.id,1,!1);case 10:return this.hasActiveHUD&&canvas.tokens.hud.refreshStatusIcons(),u.abrupt("return",o);case 12:case"end":return u.stop()}}),_callee3,this)})));return function(r){return t.apply(this,arguments)}}(),Token.prototype.decrementCondition=function(){var t=statuseffect_asyncToGenerator(statuseffect_regeneratorRuntime().mark((function _callee4(t){var r,o,a,i=arguments;return statuseffect_regeneratorRuntime().wrap((function _callee4$(c){for(;;)switch(c.prev=c.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},o=r.active,a=r.overlay,void 0!==a&&a,this.actor.removeCondition(t.id,1,!1),this.hasActiveHUD&&canvas.tokens.hud.refreshStatusIcons(),c.abrupt("return",o);case 4:case"end":return c.stop()}}),_callee4,this)})));return function(r){return t.apply(this,arguments)}}();var t=Token.prototype._onClickLeft2;Token.prototype._onClickLeft2=function(r){if(!(game.user.isGM||!game.settings.get("dsk","enableDPS")||!function isMerchant(t){return!!t&&["merchant","loot"].includes(getProperty(t.system,"merchant.merchantType"))}(this.actor)||Q.Z.inDistance(this)))return ui.notifications.warn(game.i18n.localize("dsk.DSKError.notInRangeToLoot"));t.call(this,r)}}function dskrolls_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function dskrolls_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dskrolls_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return dskrolls_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function dskrolls_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function creature_merchant_sheet_typeof(t){return creature_merchant_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},creature_merchant_sheet_typeof(t)}function creature_merchant_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function creature_merchant_sheet_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function creature_merchant_sheet_setPrototypeOf(t,r){return creature_merchant_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},creature_merchant_sheet_setPrototypeOf(t,r)}function creature_merchant_sheet_createSuper(t){var r=function creature_merchant_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=creature_merchant_sheet_getPrototypeOf(t);if(r){var i=creature_merchant_sheet_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return creature_merchant_sheet_possibleConstructorReturn(this,o)}}function creature_merchant_sheet_possibleConstructorReturn(t,r){if(r&&("object"===creature_merchant_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function creature_merchant_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function creature_merchant_sheet_getPrototypeOf(t){return creature_merchant_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},creature_merchant_sheet_getPrototypeOf(t)}var Ae=function(t){!function creature_merchant_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&creature_merchant_sheet_setPrototypeOf(t,r)}(CreatureMerchantSheetDSK,t);var r=creature_merchant_sheet_createSuper(CreatureMerchantSheetDSK);function CreatureMerchantSheetDSK(){return creature_merchant_sheet_classCallCheck(this,CreatureMerchantSheetDSK),r.apply(this,arguments)}return function creature_merchant_sheet_createClass(t,r,o){return r&&creature_merchant_sheet_defineProperties(t.prototype,r),o&&creature_merchant_sheet_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(CreatureMerchantSheetDSK,null,[{key:"merchantTemplate",get:function get(){return"systems/dsk/templates/actors/merchant/creature-merchant-sheet.html"}}]),CreatureMerchantSheetDSK}(ye(U));function character_merchant_sheet_typeof(t){return character_merchant_sheet_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},character_merchant_sheet_typeof(t)}function character_merchant_sheet_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function character_merchant_sheet_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function character_merchant_sheet_setPrototypeOf(t,r){return character_merchant_sheet_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},character_merchant_sheet_setPrototypeOf(t,r)}function character_merchant_sheet_createSuper(t){var r=function character_merchant_sheet_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=character_merchant_sheet_getPrototypeOf(t);if(r){var i=character_merchant_sheet_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return character_merchant_sheet_possibleConstructorReturn(this,o)}}function character_merchant_sheet_possibleConstructorReturn(t,r){if(r&&("object"===character_merchant_sheet_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function character_merchant_sheet_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function character_merchant_sheet_getPrototypeOf(t){return character_merchant_sheet_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},character_merchant_sheet_getPrototypeOf(t)}var Re=function(t){!function character_merchant_sheet_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&character_merchant_sheet_setPrototypeOf(t,r)}(CharacterMerchantSheetDSK,t);var r=character_merchant_sheet_createSuper(CharacterMerchantSheetDSK);function CharacterMerchantSheetDSK(){return character_merchant_sheet_classCallCheck(this,CharacterMerchantSheetDSK),r.apply(this,arguments)}return function character_merchant_sheet_createClass(t,r,o){return r&&character_merchant_sheet_defineProperties(t.prototype,r),o&&character_merchant_sheet_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(CharacterMerchantSheetDSK,null,[{key:"merchantTemplate",get:function get(){return"systems/dsk/templates/actors/merchant/character-merchant-sheet.html"}}]),CharacterMerchantSheetDSK}(ye(Y));function ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){itemlibrary_advanced_filters_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function itemlibrary_advanced_filters_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}var Ge={};Hooks.once("ready",(function(){Promise.all([t.Z.allSkillsList()]).then((function(t){t[0].skills.reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{});var r=t[0].rangeSkills.reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{}),o=t[0].meleeSkills.reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{}),a=t[0].rangeSkills.concat(t[0].meleeSkills).reduce((function(t,r){return _objectSpread(_objectSpread({},t),{},itemlibrary_advanced_filters_defineProperty({},r,r))}),{});mergeObject(Ge,{ammunition:[{label:"dsk.ammunitionType",attr:"ammunitionType",type:"select",options:d.Z.ammunitiongroups}],equipment:[{label:"dsk.category",attr:"category",type:"select",options:d.Z.equipmentTypes}],rangeweapon:[{label:"ITEM.TypeCombatskill",attr:"combatskill",type:"select",options:r},{label:"dsk.ammunitionType",attr:"ammunitionType",type:"select",options:d.Z.ammunitiongroups}],meleeweapon:[{label:"ITEM.TypeCombatskill",attr:"combatskill",type:"select",options:o},{label:"dsk.range",attr:"rw",type:"select",options:d.Z.meleeRanges}],poison:[{label:"dsk.resistanceModifier",attr:"resist",type:"select",options:d.Z.magicResistanceModifiers}],trait:[],profession:[],specialability:[{label:"dsk.category",attr:"category",type:"select",options:d.Z.specialAbilityCategories},{label:"ITEM.TypeCombatskill",attr:"subcategory",type:"select",options:a,notStrict:!0}],ahnengabe:[{label:"dsk.resistanceModifier",attr:"resist",type:"select",options:d.Z.magicResistanceModifiers},{label:"dsk.targetCategory",attr:"targetCategory",type:"text"},{label:"dsk.distribution",attr:"distribution",type:"text"}],ahnengeschenk:[],npc:[{label:"ITEM.TypeSpecies",attr:"details.species",type:"text"},{label:"ITEM.TypeProfession",attr:"details.profession",type:"text"},{label:"ITEM.TypeCulture",attr:"details.culture",type:"text"}],character:[{label:"ITEM.TypeSpecies",attr:"details.species",type:"text"},{label:"ITEM.TypeProfession",attr:"details.profession",type:"text"},{label:"ITEM.TypeCulture",attr:"details.culture",type:"text"}],creature:[{label:"ITEM.TypeSpecies",attr:"details.species",type:"text"},{label:"dsk.sizeCategory",attr:"details.size",type:"select",options:d.Z.sizeCategories}],armor:[{label:"dsk.protection",attr:"rs",type:"select",options:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7"}}]})}))}));const Le=Ge;function itemlibrary_typeof(t){return itemlibrary_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},itemlibrary_typeof(t)}function itemlibrary_toConsumableArray(t){return function itemlibrary_arrayWithoutHoles(t){if(Array.isArray(t))return itemlibrary_arrayLikeToArray(t)}(t)||function itemlibrary_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||itemlibrary_unsupportedIterableToArray(t)||function itemlibrary_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function itemlibrary_get(){return itemlibrary_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=itemlibrary_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},itemlibrary_get.apply(this,arguments)}function itemlibrary_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=itemlibrary_getPrototypeOf(t)););return t}function itemlibrary_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=itemlibrary_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function itemlibrary_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return itemlibrary_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?itemlibrary_arrayLikeToArray(t,r):void 0}}function itemlibrary_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function itemlibrary_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&itemlibrary_setPrototypeOf(t,r)}function itemlibrary_setPrototypeOf(t,r){return itemlibrary_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},itemlibrary_setPrototypeOf(t,r)}function itemlibrary_createSuper(t){var r=function itemlibrary_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=itemlibrary_getPrototypeOf(t);if(r){var i=itemlibrary_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return itemlibrary_possibleConstructorReturn(this,o)}}function itemlibrary_possibleConstructorReturn(t,r){if(r&&("object"===itemlibrary_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function itemlibrary_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function itemlibrary_getPrototypeOf(t){return itemlibrary_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},itemlibrary_getPrototypeOf(t)}function itemlibrary_regeneratorRuntime(){itemlibrary_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==itemlibrary_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function itemlibrary_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function itemlibrary_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){itemlibrary_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){itemlibrary_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function itemlibrary_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function itemlibrary_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function itemlibrary_createClass(t,r,o){return r&&itemlibrary_defineProperties(t.prototype,r),o&&itemlibrary_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}var De=function(){function SearchDocument(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};itemlibrary_classCallCheck(this,SearchDocument);var o=t.documentName||t.type;switch(t.documentName){case"Actor":case"Item":o=t.type}var a="";if(game.settings.get("dsk","indexDescription"))switch(o){case"creature":case"npc":case"character":a=getProperty(t,"system.description.value");break;case"JournalEntry":a=getProperty(t,"system.content");break;default:a=getProperty(t,"description.value")}this.document={name:t.name,filterType:o,data:$("<div>").html(a).text(),id:t.id||t._id,visible:!t.visible||t.visible,compendium:t.compendium?t.compendium.metadata.packageName:r.packageName||"",pack:t.pack||(r.packageName?r.id:void 0),img:t.img}}var t,r;return itemlibrary_createClass(SearchDocument,[{key:"uuid",get:function get(){if(this.document.compendium)return"Compendium.".concat(this.document.pack,".").concat(this.document.id);switch(this.itemType){case"character":case"creature":case"npc":return"Actor.".concat(this.id);case"JournalEntry":return"JournalEntry.".concat(this.id);default:return"Item.".concat(this.id)}}},{key:"name",get:function get(){return this.document.name}},{key:"data",get:function get(){return this.document.data}},{key:"id",get:function get(){return this.document.id}},{key:"itemType",get:function get(){return this.document.filterType}},{key:"getItem",value:(r=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee(){return itemlibrary_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fromUuid(this.uuid);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),_callee,this)}))),function getItem(){return r.apply(this,arguments)})},{key:"hasPermission",value:function hasPermission(){return this.document.visible}},{key:"render",value:(t=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee2(){return itemlibrary_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getItem();case 2:t.sent.sheet.render(!0);case 3:case"end":return t.stop()}}),_callee2,this)}))),function render(){return t.apply(this,arguments)})},{key:"compendium",get:function get(){return this.document.compendium}},{key:"img",get:function get(){return"JournalEntry"==this.itemType?"systems/dsk/icons/categories/DSK-Auge.webp":this.document.img}}]),SearchDocument}(),je=function(t){itemlibrary_inherits(AdvancedSearchDocument,t);var r=itemlibrary_createSuper(AdvancedSearchDocument);function AdvancedSearchDocument(t,o){var a;itemlibrary_classCallCheck(this,AdvancedSearchDocument),a=r.call(this,t);var i,c=itemlibrary_createForOfIteratorHelper(Le[o]||[]);try{for(c.s();!(i=c.n()).done;){var u=i.value;a[u.attr]=u.attr.split(".").reduce((function(t,r){return void 0===t[r]?{}:t[r]}),t.system)}}catch(t){c.e(t)}finally{c.f()}return a}return itemlibrary_createClass(AdvancedSearchDocument)}(De),Fe=function(r){itemlibrary_inherits(DSKItemLibrary,Application);var o,a,i,c,u,l,p,d,h,y,m,g,v,_=itemlibrary_createSuper(DSKItemLibrary);function DSKItemLibrary(t){var r;return itemlibrary_classCallCheck(this,DSKItemLibrary),(r=_.call(this,t)).advancedFiltering=!1,r.journalBuild=!1,r.journalWorldBuild=!1,r.equipmentBuild=!1,r.equipmentWorldBuild,r.zooBuild=!1,r.zooWorldBuild=!1,r.currentDetailFilter={equipment:[],character:[],spell:[],journal:[],zoo:[]},r.journalIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data"]}}),r.equipmentIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data","itemType"]}}),r.zooIndex=new FlexSearch({encode:"simple",tokenize:"reverse",cache:!0,doc:{id:"id",field:["name","data","itemType"]}}),r.detailFilter={},r.pages={equipment:{},character:{},spell:{},journal:{},zoo:{}},r.filters={equipment:{categories:{armor:!1,ammunition:!1,equipment:!1,meleeweapon:!1,rangeweapon:!1,poison:!1},filterBy:{search:""}},character:{categories:{profession:!1,advantage:!1,culture:!1,disadvantage:!1,trait:!1,skill:!1,specialability:!1,species:!1},filterBy:{search:""}},spell:{categories:{ahnengabe:!1,ahnengeschenk:!1},filterBy:{search:""}},journal:{categories:{},filterBy:{search:""}},zoo:{categories:{npc:!1,character:!1,creature:!1},filterBy:{search:""}}},r}return itemlibrary_createClass(DSKItemLibrary,[{key:"getData",value:(v=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee3(t){var r;return itemlibrary_regeneratorRuntime().wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary.prototype),"getData",this).call(this,t);case 2:if((r=o.sent).categories=this.translateFilters(),r.isGM=game.user.isGM,r.items=this.items,r.advancedMode=this.advancedFiltering?"on":"",r.worldIndexed=game.settings.get("dsk","indexWorldItems")?"on":"",r.fullTextEnabled=game.settings.get("dsk","indexDescription")?"on":"",!this.advancedFiltering){o.next=13;break}return o.next=12,this.buildDetailFilter("tbd",this.subcategory);case 12:r.advancedFilter=o.sent;case 13:return o.abrupt("return",r);case 14:case"end":return o.stop()}}),_callee3,this)}))),function getData(t){return v.apply(this,arguments)})},{key:"translateFilters",value:function translateFilters(){return{equipment:this.buildFilter(this.filters.equipment),character:this.buildFilter(this.filters.character),spell:this.buildFilter(this.filters.spell),zoo:this.buildFilter(this.filters.zoo),journal:this.buildFilter(this.filters.journal)}}},{key:"purgeAdvancedFilters",value:function purgeAdvancedFilters(){var t=this;for(var r in this.filters)for(var o in this.filters[r].categories)this.filters[r].categories[o]=!1;$(this._element).find('.filter[type="checkbox"]').prop("checked",!1),this.buildDetailFilter("none","none").then((function(r){$(t._element).find(".advancedSearch .groupbox").html(r)}))}},{key:"buildFilter",value:function buildFilter(t){var r=[];return Object.keys(t.categories).forEach((function(o){r.push({label:game.i18n.localize("ITEM.Type".concat(o.slice(0,1).toUpperCase()).concat(o.slice(1))),selected:t.categories[o],key:o})})),r=r.sort((function(t,r){return t.label.localeCompare(r.label)}))}},{key:"getRandomItems",value:(g=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee4(t,r){var o,a;return itemlibrary_regeneratorRuntime().wrap((function _callee4$(i){for(;;)switch(i.prev=i.next){case 0:return o=[],a=this.equipmentIndex,i.t0=o.push,i.t1=o,i.t2=itemlibrary_toConsumableArray,i.next=7,a.search(t,{field:["itemType"]});case 7:return i.t3=i.sent,i.t4=(0,i.t2)(i.t3),i.t0.apply.call(i.t0,i.t1,i.t4),i.next=12,Promise.all(this.shuffle(o.filter((function(t){return t.hasPermission}))).slice(0,r+5).map((function(t){return t.getItem()})));case 12:return i.abrupt("return",i.sent.filter((function(t){var r=t.getFlag("dsk","enchantments");return!r||!r.find((function(t){return t.talisman}))})).slice(0,r));case 13:case"end":return i.stop()}}),_callee4,this)}))),function getRandomItems(t,r){return g.apply(this,arguments)})},{key:"shuffle",value:function shuffle(t){for(var r,o,a=t.length;0!==a;)o=Math.floor(Math.random()*a),r=t[a-=1],t[a]=t[o],t[o]=r;return t}},{key:"findCompendiumItem",value:(m=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee5(t,r){var o,a,i,c=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee5$(u){for(;;)switch(u.prev=u.next){case 0:if(o=!(c.length>2&&void 0!==c[2])||c[2],this.equipmentBuild){u.next=4;break}return u.next=4,this.buildEquipmentIndex();case 4:return a={field:["name"],where:{itemType:r}},u.next=7,this.equipmentIndex.search(t,a);case 7:return i=u.sent,o&&(i=i.filter((function(t){return""!=t.compendium}))),u.next=11,Promise.all(i.map((function(t){return t.getItem()})));case 11:return u.abrupt("return",u.sent);case 12:case"end":return u.stop()}}),_callee5,this)}))),function findCompendiumItem(t,r){return m.apply(this,arguments)})},{key:"getCategoryItems",value:(y=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee6(t){var r,o=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return r=o.length>1&&void 0!==o[1]&&o[1],a.next=3,this.buildEquipmentIndex();case 3:if(!r){a.next=7;break}return a.next=6,Promise.all(this.equipmentIndex.search(t,{field:["itemType"]}).map((function(t){return t.getItem()})));case 6:return a.abrupt("return",a.sent.map((function(t){return t.toObject()})));case 7:return a.abrupt("return",this.equipmentIndex.search(t,{field:["itemType"]}));case 8:case"end":return a.stop()}}),_callee6,this)}))),function getCategoryItems(t){return y.apply(this,arguments)})},{key:"executeAdvancedFilter",value:(h=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee7(t,r,o,a,i){var c,u,l,p,d,h,y,m=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee7$(g){for(;;)switch(g.prev=g.next){case 0:return c=m.length>5&&void 0!==m[5]?m[5]:[],u=function selFnct(t){var r,a=itemlibrary_createForOfIteratorHelper(o);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(t[2]?t[i[0]]!=i[1]:-1==t[i[0]].indexOf(i[1]))return!1}}catch(t){a.e(t)}finally{a.f()}return!0},l=function txtFnct(t){var r,o=itemlibrary_createForOfIteratorHelper(a);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(-1==t[i[0]].toLowerCase().indexOf(i[1]))return!1}}catch(t){o.e(t)}finally{o.f()}return!0},p=function cbFnct(t){var r,o=itemlibrary_createForOfIteratorHelper(i);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(t[a[0]]!=a[1])return!1}}catch(t){o.e(t)}finally{o.f()}return!0},d=function rangeFct(t){var r,o=itemlibrary_createForOfIteratorHelper(c);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(t[a[0]]<a[1]||t[a[0]]>a[2])return!1}}catch(t){o.e(t)}finally{o.f()}return!0},h=r.where((function(r){return(""==t||-1!=r.name.toLowerCase().indexOf(t))&&u(r)&&l(r)&&p(r)&&d(r)})),y=(y=h).filter((function(t){return t.hasPermission})).sort((function(t,r){return t.name.toLowerCase()>r.name.toLowerCase()?1:-1})),g.abrupt("return",y);case 9:case"end":return g.stop()}}),_callee7)}))),function executeAdvancedFilter(t,r,o,a,i){return h.apply(this,arguments)})},{key:"advancedFilterStuff",value:(d=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee8(t,r){var o,a,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S;return itemlibrary_regeneratorRuntime().wrap((function _callee8$(r){for(;;)switch(r.prev=r.next){case 0:o=$(this._element).find(".detailFilters"),a=o.attr("data-subc"),i=this.filters[t].filterBy.search.toLowerCase(),c=this.detailFilter[a],u=[],l=[],p=[],d=itemlibrary_createForOfIteratorHelper(o.find("select"));try{for(d.s();!(h=d.n()).done;)y=h.value,""!=(m=$(y).val())&&u.push([$(y).attr("name"),m,"true"!=y.dataset.notstrict])}catch(t){d.e(t)}finally{d.f()}g=itemlibrary_createForOfIteratorHelper(o.find('input[type="text"]:not(.manualFilter)'));try{for(g.s();!(v=g.n()).done;)_=v.value,""!=(b=$(_).val())&&l.push([$(_).attr("name"),b.toLowerCase()])}catch(t){g.e(t)}finally{g.f()}k=itemlibrary_createForOfIteratorHelper(o.find('input[type="checkbox"]:checked:not(.manualFilter)'));try{for(k.s();!(w=k.n()).done;)x=w.value,""!=(O=$(x).val())&&p.push([$(x).attr("name"),O.toLowerCase()])}catch(t){k.e(t)}finally{k.f()}return r.next=15,this.executeAdvancedFilter(i,c,u,l,p);case 15:return S=r.sent,this.setBGImage(S,t),r.abrupt("return",S);case 18:case"end":return r.stop()}}),_callee8,this)}))),function advancedFilterStuff(t,r){return d.apply(this,arguments)})},{key:"filterStuff",value:(p=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee9(t,r,o){var a,i,c,u,l,p,d,h;return itemlibrary_regeneratorRuntime().wrap((function _callee9$(y){for(;;)switch(y.prev=y.next){case 0:for(l in a=this.filters[t].filterBy.search,i={field:["name","data"],limit:60,page:o||!0},c=[],u=!1,this.filters[t].categories)this.filters[t].categories[l]&&(d=void 0,""==a?d=r.search(l,{field:["itemType"],limit:60,page:o||!0}):(h=duplicate(i),mergeObject(h,{where:{itemType:l}}),d=r.search(a,h)),this.pages[t].next=d.next,(p=c).push.apply(p,itemlibrary_toConsumableArray(d.result))),u=this.filters[t].categories[l]||u;return u||(c=r.search(a,i),this.pages[t].next=c.next),c=(c=c.result?c.result:c).filter((function(t){return t.hasPermission})).sort((function(t,r){return t.name.toLowerCase()>r.name.toLowerCase()?1:-1})),this.setBGImage(c,t),y.abrupt("return",c);case 10:case"end":return y.stop()}}),_callee9,this)}))),function filterStuff(t,r,o){return p.apply(this,arguments)})},{key:"setBGImage",value:function setBGImage(t,r){$(this._element).find(".".concat(r," .libcontainer"))["".concat(t.length>0?"remove":"add","Class")]("libraryImg")}},{key:"renderResult",value:function renderResult(t,r,o,a){var i=o.index,c=o.itemType,u=t.find(".searchResult .item-list");renderTemplate("systems/dsk/templates/system/libraryItem.html",{items:r}).then((function(t){a||u.empty(),(t=$(t)).each((function(){var t=$(this);t.attr("draggable",!0).on("dragstart",(function(r){var o=i.find($(t).attr("data-item-id"));r.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({type:c,uuid:o.uuid}))}))})),u.append(t)}))}},{key:"filterItems",value:(l=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee10(t,r,o){var a,i,c;return itemlibrary_regeneratorRuntime().wrap((function _callee10$(u){for(;;)switch(u.prev=u.next){case 0:if(a=this.selectIndex(r),!this.advancedFiltering||"journal"==r){u.next=9;break}return u.next=4,this.advancedFilterStuff(r,o);case 4:return i=u.sent,this.renderResult(t,i,a,o),u.abrupt("return",i);case 9:return u.next=11,this.filterStuff(r,a.index,o);case 11:return c=u.sent,this.renderResult(t,c,a,o),u.abrupt("return",c);case 14:case"end":return u.stop()}}),_callee10,this)}))),function filterItems(t,r,o){return l.apply(this,arguments)})},{key:"selectIndex",value:function selectIndex(t){var r="Item",o=this.equipmentIndex;switch(t){case"zoo":r="Actor",o=this.zooIndex;break;case"journal":r="JournalEntry",o=this.journalIndex}return{index:o,itemType:r}}},{key:"_render",value:(u=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee11(){var t,r,o=arguments;return itemlibrary_regeneratorRuntime().wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1&&void 0!==o[1]?o[1]:{},a.next=4,itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary.prototype),"_render",this).call(this,t,r);case 4:this.buildEquipmentIndex();case 5:case"end":return a.stop()}}),_callee11,this)}))),function _render(){return u.apply(this,arguments)})},{key:"buildEquipmentIndex",value:(c=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee12(){return itemlibrary_regeneratorRuntime().wrap((function _callee12$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._createIndex("equipment","Item",game.items);case 2:case"end":return t.stop()}}),_callee12,this)}))),function buildEquipmentIndex(){return c.apply(this,arguments)})},{key:"_createIndex",value:(i=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee14(t,r,o){var a,i,c,u,l,p,d,h,y=this;return itemlibrary_regeneratorRuntime().wrap((function _callee14$(m){for(;;)switch(m.prev=m.next){case 0:if(!this["".concat(t,"Build")]){m.next=2;break}return m.abrupt("return");case 2:return SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:""}),pct:0}),a=$(this._element).find('*[data-tab="'.concat(t,'"]')),this.showLoading(a,t),i=game.packs.filter((function(t){return t.documentName==r&&(game.user.isGM||!t.private)})),c=100/(i.length+1),u=c,l=["name","system.type","system.description.value","img"],p="Actor"==r?function func(t){return t.getIndex({actorFields:l})}:"JournalEntry"==r?function func(t){return t.getDocuments()}:function func(t){return t.getDocuments({type:{$in:game.system.documentTypes.Item}})},d=this.indexWorldItems(o,t),SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:"world items"}),pct:Math.round(c)}),h=i.map(function(){var t=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee13(t){var r;return itemlibrary_regeneratorRuntime().wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,p(t);case 2:r=o.sent,u+=c,SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:"".concat(t.metadata.label," (").concat(t.metadata.id,")")}),pct:Math.round(u)}),d.push.apply(d,itemlibrary_toConsumableArray(r.map((function(r){return new De(r,t.metadata)}))));case 6:case"end":return o.stop()}}),_callee13)})));return function(r){return t.apply(this,arguments)}}()),m.abrupt("return",Promise.all(h).then((function(r){y["".concat(t,"Index")].add(d),y["".concat(t,"Build")]=!0,SceneNavigation.displayProgressBar({label:game.i18n.format("dsk.Library.loading",{item:""}),pct:100}),y.hideLoading(a,t)})));case 14:case"end":return m.stop()}}),_callee14,this)}))),function _createIndex(t,r,o){return i.apply(this,arguments)})},{key:"subcategoryFields",value:function subcategoryFields(t){var r,o=["name","itemType"],a=itemlibrary_createForOfIteratorHelper(Le[t]||[]);try{for(a.s();!(r=a.n()).done;){var i=r.value;o.push(i.attr)}}catch(t){a.e(t)}finally{a.f()}return o}},{key:"indexWorldItems",value:function indexWorldItems(t,r){var o=[];return game.settings.get("dsk","indexWorldItems")&&(o.push.apply(o,itemlibrary_toConsumableArray(t.filter((function(t){return t.visible})).map((function(t){return new De(t)})))),this["".concat(r,"WorldBuild")]=!0),o}},{key:"createDetailIndex",value:(a=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee15(t,r){var o,a,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S;return itemlibrary_regeneratorRuntime().wrap((function _callee15$(P){for(;;)switch(P.prev=P.next){case 0:if(this.detailFilter[r]){P.next=39;break}o=this.subcategoryFields(r),(a=$(this._element).find('*[data-tab="'.concat(t,'"]'))).find(".searchResult ul").html(""),this.showLoading(a,t),this.detailFilter[r]=new FlexSearch({encode:"simple",tokenize:"full",cache:!0,doc:{id:"id",field:o}}),i=this.selectIndex(t),c=i.index,u=i.itemType,l="Item"==u?game.items:game.actors,p=l.filter((function(t){return t.visible&&t.type==r})).map((function(t){return new je(t,r)})),d=c.search(r,{field:["itemType"]}),h={},y=itemlibrary_createForOfIteratorHelper(d),P.prev=12,y.s();case 14:if((m=y.n()).done){P.next=22;break}if((g=m.value).document.pack){P.next=18;break}return P.abrupt("continue",20);case 18:h[g.document.pack]||(h[g.document.pack]=[]),h[g.document.pack].push(g.document.id);case 20:P.next=14;break;case 22:P.next=27;break;case 24:P.prev=24,P.t0=P.catch(12),y.e(P.t0);case 27:return P.prev=27,y.f(),P.finish(27);case 30:for(v=[],_=0,b=Object.entries(h);_<b.length;_++)k=b[_],v.push(game.packs.get(k[0]).getDocuments({_id:{$in:k[1]},type:r}));return P.next=34,Promise.all(v);case 34:w=P.sent,x=itemlibrary_createForOfIteratorHelper(w);try{for(x.s();!(O=x.n()).done;)S=O.value,p.push.apply(p,itemlibrary_toConsumableArray(S.map((function(t){return new je(t,r)}))))}catch(t){x.e(t)}finally{x.f()}this.detailFilter[r].add(p),this.hideLoading(a,t);case 39:case"end":return P.stop()}}),_callee15,this,[[12,24,27,30]])}))),function createDetailIndex(t,r){return a.apply(this,arguments)})},{key:"buildDetailFilter",value:(o=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee16(t,r){var o,a,i;return itemlibrary_regeneratorRuntime().wrap((function _callee16$(c){for(;;)switch(c.prev=c.next){case 0:if(!(o=Le[r]||[])){c.next=11;break}return a=this.createDetailIndex(t,r),c.next=5,renderTemplate("systems/dsk/templates/system/detailFilter.html",{fields:o,subcategory:r});case 5:return i=c.sent,c.next=8,a;case 8:return c.abrupt("return",i);case 11:return c.abrupt("return","<p>".concat(game.i18n.localize("dsk.Library.selectAdvanced"),"</p>"));case 12:case"end":return c.stop()}}),_callee16,this)}))),function buildDetailFilter(t,r){return o.apply(this,arguments)})},{key:"checkWorldStuffIndex",value:function checkWorldStuffIndex(){game.settings.get("dsk","indexWorldItems")&&(!this.journalWorldBuild&&this.journalBuild&&this.journalIndex.add(this.indexWorldItems(game.journal,"journal")),!this.equipmentWorldBuild&&this.equipmentBuild&&this.equipmentIndex.add(this.indexWorldItems(game.items,"equipment")),!this.zooWorldBuild&&this.zooBuild&&this.zooIndex.add(this.indexWorldItems(game.actors,"zoo")))}},{key:"activateListeners",value:function activateListeners(r){var o=this;itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary.prototype),"activateListeners",this).call(this,r),r.on("click",".toggleAdvancedMode",(function(){o.advancedFiltering=!o.advancedFiltering,o.advancedFiltering?($(o._element).find(".toggleAdvancedMode").addClass("on"),$(o._element).find(".advancedSearch").fadeIn(),o.purgeAdvancedFilters()):($(o._element).find(".toggleAdvancedMode").removeClass("on"),$(o._element).find(".advancedSearch").fadeOut())})),r.on("change",".detailFilters input, .detailFilters select",(function(){var t=$(o._element).find(".tab.active"),r=t.attr("data-tab");o.filterItems(t,r)})),r.on("click",".filter",function(){var t=itemlibrary_asyncToGenerator(itemlibrary_regeneratorRuntime().mark((function _callee17(t){var r,a,i,c;return itemlibrary_regeneratorRuntime().wrap((function _callee17$(u){for(;;)switch(u.prev=u.next){case 0:if(r=$(t.currentTarget).closest(".tab"),a=r.attr("data-tab"),i=$(t.currentTarget).attr("data-category"),c=$(t.currentTarget).is(":checked"),!o.advancedFiltering||!c){u.next=13;break}return o.purgeAdvancedFilters(),o.subcategory=i,$(t.currentTarget).prop("checked",c),u.t0=$(o._element).find(".advancedSearch .groupbox"),u.next=11,o.buildDetailFilter(a,i);case 11:u.t1=u.sent,u.t0.html.call(u.t0,u.t1);case 13:o.filters[a].categories[i]=c,o.filterItems(r,a);case 15:case"end":return u.stop()}}),_callee17)})));return function(r){return t.apply(this,arguments)}}()),r.on("click",".item-name",(function(t){o.getItemFromHTML(t).render()})),r.on("mousedown",".item-name",(function(r){2==r.button&&t.Z.showArtwork(o.getItemFromHTML(r))})),r.on("keyup",".filterBy-search",(function(t){var r=$(t.currentTarget).closest(".tab"),a=r.attr("data-tab");o.filters[a].filterBy.search=$(t.currentTarget).val(),o.filterItems(r,a)})),r.find('*[data-tab="journal"]').click((function(t){o._createIndex("journal","JournalEntry",game.journal)})),r.find('*[data-tab="zoo"]').click((function(t){o._createIndex("zoo","Actor",game.actors)})),r.find(".showDetails").click((function(t){var o=$(t.currentTarget).attr("data-btn");$(t.currentTarget).find("i").toggleClass("fa-caret-left fa-caret-right"),r.find(".".concat(o," .detailBox")).toggleClass("dskhidden")})),r.find(".toggleWorldIndex").click((function(t){game.settings.set("dsk","indexWorldItems",!game.settings.get("dsk","indexWorldItems")),o.checkWorldStuffIndex(),$(t.currentTarget).toggleClass("on")})),r.find(".fulltextsearch").click((function(t){game.settings.set("dsk","indexDescription",!game.settings.get("dsk","indexDescription")),$(t.currentTarget).toggleClass("on")}));var a=this;$(this._element).find(".window-content").on("scroll.infinit",debounce((function(t){if(!a.advancedFiltering){var o=$(t.target),i=o.scrollTop()+o.innerHeight()>=o[0].scrollHeight-100,c=r.find(".tabs .item.active").attr("data-tab");if(i&&a.pages[c].next){var u=r.find(".tab.active");a.filterItems.call(a,u,c,a.pages[c].next)}}}),100))}},{key:"getItemFromHTML",value:function getItemFromHTML(t){var r=$(t.currentTarget).parents(".browser-item").attr("data-item-id");switch($(t.currentTarget).closest(".tab").attr("data-tab")){case"zoo":return this.zooIndex.find(r);case"journal":return this.journalIndex.find(r);default:return this.equipmentIndex.find(r)}}},{key:"showLoading",value:function showLoading(t,r){this.setBGImage([1],r),$('<div class="loader"><i class="fa fa-4x fa-spinner fa-spin"></i>'.concat(game.i18n.localize("dsk.Library.buildingIndex"),"</div>")).appendTo(t.find(".searchResult"))}},{key:"hideLoading",value:function hideLoading(t,r){this.setBGImage([],r),t.find(".loader").remove()}}],[{key:"defaultOptions",get:function get(){var t=itemlibrary_get(itemlibrary_getPrototypeOf(DSKItemLibrary),"defaultOptions",this);return t.id="DSKItemLibrary",t.classes.push("dsk","itemlibrary"),t.height=800,t.width=800,t.resizable=!0,t.title=game.i18n.localize("dsk.ItemLibrary"),t.template="systems/dsk/templates/system/itemlibrary.html",t.tabs=[{navSelector:".tabs",contentSelector:".content",initial:"equipment"}],t}}]),DSKItemLibrary}();function dsk_active_effects_typeof(t){return dsk_active_effects_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dsk_active_effects_typeof(t)}function dsk_active_effects_regeneratorRuntime(){dsk_active_effects_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==dsk_active_effects_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function dsk_active_effects_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function dsk_active_effects_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){dsk_active_effects_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){dsk_active_effects_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function dsk_active_effects_ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function dsk_active_effects_objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?dsk_active_effects_ownKeys(Object(o),!0).forEach((function(r){dsk_active_effects_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):dsk_active_effects_ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function dsk_active_effects_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function dsk_active_effects_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return dsk_active_effects_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return dsk_active_effects_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function dsk_active_effects_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function dsk_active_effects_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dsk_active_effects_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function dsk_active_effects_get(){return dsk_active_effects_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=dsk_active_effects_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},dsk_active_effects_get.apply(this,arguments)}function dsk_active_effects_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=dsk_active_effects_getPrototypeOf(t)););return t}function dsk_active_effects_setPrototypeOf(t,r){return dsk_active_effects_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},dsk_active_effects_setPrototypeOf(t,r)}function dsk_active_effects_createSuper(t){var r=function dsk_active_effects_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=dsk_active_effects_getPrototypeOf(t);if(r){var i=dsk_active_effects_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return dsk_active_effects_possibleConstructorReturn(this,o)}}function dsk_active_effects_possibleConstructorReturn(t,r){if(r&&("object"===dsk_active_effects_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function dsk_active_effects_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function dsk_active_effects_getPrototypeOf(t){return dsk_active_effects_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},dsk_active_effects_getPrototypeOf(t)}function dsk_active_effects_defineProperty(t,r,o){return r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}var Me=function(t){!function dsk_active_effects_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&dsk_active_effects_setPrototypeOf(t,r)}(DSKActiveEffect,ActiveEffect);var r,o,a=dsk_active_effects_createSuper(DSKActiveEffect);function DSKActiveEffect(){return dsk_active_effects_classCallCheck(this,DSKActiveEffect),a.apply(this,arguments)}return function dsk_active_effects_createClass(t,r,o){return r&&dsk_active_effects_defineProperties(t.prototype,r),o&&dsk_active_effects_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKActiveEffect,[{key:"apply",value:function apply(t,r){if(!DSKActiveEffect.itemChangeRegex.test(r.key))return dsk_active_effects_get(dsk_active_effects_getPrototypeOf(DSKActiveEffect.prototype),"apply",this).call(this,t,r);var o,a=this._getModifiedItems(t,r),i=dsk_active_effects_createForOfIteratorHelper(a.items);try{for(i.s();!(o=i.n()).done;){var c=o.value,u=foundry.utils.flattenObject(c.overrides||{});u[a.key]=Number.isNumeric(c.value)?Number(a.value):a.value;var l=dsk_active_effects_objectSpread(dsk_active_effects_objectSpread({},r),{},{key:a.key,value:a.value});dsk_active_effects_get(dsk_active_effects_getPrototypeOf(DSKActiveEffect.prototype),"apply",this).call(this,c,l),c.overrides=foundry.utils.expandObject(u)}}catch(t){i.e(t)}finally{i.f()}}},{key:"_getModifiedItems",value:function _getModifiedItems(t,r){var o,a=r.key.split("."),i=a.shift();i=i.replace("@","").toLowerCase();var c=a.shift(),u=a.join("."),l=r.value;return{items:(null==t||null===(o=t.items)||void 0===o?void 0:o.filter((function(t){return t.type==i&&(t.name==c||t.id==c)})))||[],key:u,value:l}}},{key:"_preUpdate",value:(o=dsk_active_effects_asyncToGenerator(dsk_active_effects_regeneratorRuntime().mark((function _callee(t,r,o){return dsk_active_effects_regeneratorRuntime().wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:dsk_active_effects_get(dsk_active_effects_getPrototypeOf(DSKActiveEffect.prototype),"_preUpdate",this).call(this,t,r,o),this._clearModifiedItems();case 2:case"end":return a.stop()}}),_callee,this)}))),function _preUpdate(t,r,a){return o.apply(this,arguments)})},{key:"_clearModifiedItems",value:function _clearModifiedItems(){if(!(!this.parent instanceof CONFIG.Actor.documentClass)){var t,r=dsk_active_effects_createForOfIteratorHelper(this.changes);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(DSKActiveEffect.itemChangeRegex.test(o.key)){var a,i=this._getModifiedItems(this.parent,o),c=dsk_active_effects_createForOfIteratorHelper(i.items);try{for(c.s();!(a=c.n()).done;){var u,l=a.value,p=foundry.utils.flattenObject(l.overrides||{}),d=i.key;delete p[d];var h=getProperty(l._source,d);setProperty(l,d,h),l.overrides=foundry.utils.expandObject(p),null!==(u=l.sheet)&&void 0!==u&&u.rendered&&l.sheet.render(!0)}}catch(t){c.e(t)}finally{c.f()}}}}catch(t){r.e(t)}finally{r.f()}}}},{key:"_preDelete",value:(r=dsk_active_effects_asyncToGenerator(dsk_active_effects_regeneratorRuntime().mark((function _callee2(t,r){return dsk_active_effects_regeneratorRuntime().wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:dsk_active_effects_get(dsk_active_effects_getPrototypeOf(DSKActiveEffect.prototype),"_preDelete",this).call(this,t,r),this._clearModifiedItems();case 2:case"end":return o.stop()}}),_callee2,this)}))),function _preDelete(t,o){return r.apply(this,arguments)})}]),DSKActiveEffect}();dsk_active_effects_defineProperty(Me,"itemChangeRegex",/^@/);function hotbar_typeof(t){return hotbar_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hotbar_typeof(t)}function hotbar_regeneratorRuntime(){hotbar_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==hotbar_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function hotbar_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function hotbar_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){hotbar_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){hotbar_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function hotbar_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function hotbar_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function hotbar_get(){return hotbar_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=hotbar_superPropBase(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},hotbar_get.apply(this,arguments)}function hotbar_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=hotbar_getPrototypeOf(t)););return t}function hotbar_setPrototypeOf(t,r){return hotbar_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},hotbar_setPrototypeOf(t,r)}function hotbar_createSuper(t){var r=function hotbar_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=hotbar_getPrototypeOf(t);if(r){var i=hotbar_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return hotbar_possibleConstructorReturn(this,o)}}function hotbar_possibleConstructorReturn(t,r){if(r&&("object"===hotbar_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function hotbar_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function hotbar_getPrototypeOf(t){return hotbar_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},hotbar_getPrototypeOf(t)}Hooks.on("applyActiveEffect",(function(t,r){return function applyCustomEffect(t,r){var o=getProperty(t,r.key)||null;null==o&&/^system\.(vulnerabilities|resistances)/.test(r.key)&&(o=[],setProperty(t,r.key,o));var a=null;if("Array"===getType(o)){var i,c=[],u=r.effect.label,l=dsk_active_effects_createForOfIteratorHelper("".concat(r.value).split(/[;,]+/));try{for(l.s();!(i=l.n()).done;){var p=i.value.split(" "),d=p.pop(),h=p.join(" ");c.push({source:u,value:d,target:h})}}catch(t){l.e(t)}finally{l.f()}a=o.concat(c)}return null!==a&&setProperty(t,r.key,a),a}(t,r)}));var ze=function(t){!function hotbar_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&hotbar_setPrototypeOf(t,r)}(DSKHotbar,Hotbar);var r,o,a=hotbar_createSuper(DSKHotbar);function DSKHotbar(){return hotbar_classCallCheck(this,DSKHotbar),a.apply(this,arguments)}return function hotbar_createClass(t,r,o){return r&&hotbar_defineProperties(t.prototype,r),o&&hotbar_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKHotbar,[{key:"collapse",value:(o=hotbar_asyncToGenerator(hotbar_regeneratorRuntime().mark((function _callee(){return hotbar_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!this._collapsed){t.next=2;break}return t.abrupt("return",!0);case 2:return $(this.element).addClass("collapsedHotbar"),t.abrupt("return",hotbar_get(hotbar_getPrototypeOf(DSKHotbar.prototype),"collapse",this).call(this));case 4:case"end":return t.stop()}}),_callee,this)}))),function collapse(){return o.apply(this,arguments)})},{key:"expand",value:(r=hotbar_asyncToGenerator(hotbar_regeneratorRuntime().mark((function _callee2(){return hotbar_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(this._collapsed){t.next=2;break}return t.abrupt("return",!0);case 2:return $(this.element).removeClass("collapsedHotbar"),t.abrupt("return",hotbar_get(hotbar_getPrototypeOf(DSKHotbar.prototype),"expand",this).call(this));case 4:case"end":return t.stop()}}),_callee2,this)}))),function expand(){return r.apply(this,arguments)})}]),DSKHotbar}();function initializer_typeof(t){return initializer_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},initializer_typeof(t)}function initializer_slicedToArray(t,r){return function initializer_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function initializer_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==o)return;var a,i,c=[],u=!0,l=!1;try{for(o=o.call(t);!(u=(a=o.next()).done)&&(c.push(a.value),!r||c.length!==r);u=!0);}catch(t){l=!0,i=t}finally{try{u||null==o.return||o.return()}finally{if(l)throw i}}return c}(t,r)||initializer_unsupportedIterableToArray(t,r)||function initializer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function initializer_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=initializer_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}function initializer_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return initializer_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?initializer_arrayLikeToArray(t,r):void 0}}function initializer_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function initializer_regeneratorRuntime(){initializer_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,c,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(values([])));y&&y!==r&&o.call(y,c)&&(d=y);var m=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,d=p.value;return d&&"object"==initializer_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(d).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=t.iterator[r.method];if(void 0===o){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method))return p;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,p;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(m,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(m),define(m,l,"Generator"),define(m,c,(function(){return this})),define(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function initializer_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function initializer_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){initializer_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){initializer_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function initializer_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function initializer_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function initializer_setPrototypeOf(t,r){return initializer_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},initializer_setPrototypeOf(t,r)}function initializer_createSuper(t){var r=function initializer_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=initializer_getPrototypeOf(t);if(r){var i=initializer_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return initializer_possibleConstructorReturn(this,o)}}function initializer_possibleConstructorReturn(t,r){if(r&&("object"===initializer_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function initializer_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function initializer_getPrototypeOf(t){return initializer_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},initializer_getPrototypeOf(t)}var Ne=function(r){!function initializer_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&initializer_setPrototypeOf(t,r)}(DSKInitializer,Dialog);var a,i,c,u=initializer_createSuper(DSKInitializer);function DSKInitializer(t,r,o){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";initializer_classCallCheck(this,DSKInitializer);var c,l,p={title:t,content:r,buttons:{initialize:{label:game.i18n.localize("dsk.initialize"),callback:(l=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee(){return initializer_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!a.lock){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,a.initialize();case 4:case"end":return t.stop()}}),_callee)}))),function callback(){return l.apply(this,arguments)})},cancel:{label:game.i18n.localize("dsk.cancel"),callback:(c=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee2(){return initializer_regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!a.lock){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,a.dontInitialize();case 4:case"end":return t.stop()}}),_callee2)}))),function callback(){return c.apply(this,arguments)})}}};return(a=u.call(this,p)).module=o,a.lang=i,a.folders={},a.journals={},a.scenes={},a.actors={},a.lock=!1,a}return function initializer_createClass(t,r,o){return r&&initializer_defineProperties(t.prototype,r),o&&initializer_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(DSKInitializer,[{key:"initialize",value:(c=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee13(){var t,r,a=this;return initializer_regeneratorRuntime().wrap((function _callee13$(i){for(;;)switch(i.prev=i.next){case 0:if(this.lock=!0,(t=$(this._element).find(".initialize")).prepend('<i class="fas fa-spinner fa-spin"></i>'),r={},i.prev=4,!game.settings.settings.has("".concat(this.module,".initialized"))){i.next=8;break}return i.next=8,game.settings.set(this.module,"initialized",!0);case 8:i.next=12;break;case 10:i.prev=10,i.t0=i.catch(4);case 12:return i.prev=12,i.next=15,fetch("modules/".concat(this.module,"/adventure").concat(this.lang,".json")).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee3(t){return initializer_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee4(t){return initializer_regeneratorRuntime().wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:r=t;case 1:case"end":return o.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}());case 15:i.next=27;break;case 17:return i.prev=17,i.t1=i.catch(12),i.prev=19,i.next=22,fetch("modules/".concat(this.module,"/adventure.json")).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee5(t){return initializer_regeneratorRuntime().wrap((function _callee5$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee6(t){return initializer_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:r=t;case 1:case"end":return o.stop()}}),_callee6)})));return function(r){return t.apply(this,arguments)}}());case 22:i.next=27;break;case 24:i.prev=24,i.t2=i.catch(19),console.warn("Could not find book data for ".concat(this.module," import."));case 27:return i.next=29,fetch("modules/".concat(this.module,"/initialization").concat(this.lang,".json")).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee7(t){return initializer_regeneratorRuntime().wrap((function _callee7$(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.json());case 1:case"end":return r.stop()}}),_callee7)})));return function(r){return t.apply(this,arguments)}}()).then(function(){var t=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee12(t){var i,c,u,l,p,d,h,y,m,g,v;return initializer_regeneratorRuntime().wrap((function _callee12$(_){for(;;)switch(_.prev=_.next){case 0:if(!(i=t.folders)){_.next=17;break}return _.next=4,a.getFolderForType("JournalEntry");case 4:return c=_.sent,u=t.folders[0].name,c&&(a.folders[c.data.name]=c,t.folders.shift()),_.next=9,Folder.create(i);case 9:l=_.sent,Array.isArray(l)||(l=[l]),p=initializer_createForOfIteratorHelper(l);try{for(p.s();!(d=p.n()).done;)h=d.value,a.folders[h.data.name]=h}catch(t){p.e(t)}finally{p.f()}for(m in y=[],a.folders)g=a.folders[m].getFlag("dsk","parent"),(v=g==u?game.i18n.localize("".concat(a.module,".name")):g)&&y.push({_id:a.folders[m].id,parent:a.folders[v].id});return _.next=17,Folder.updateDocuments(y);case 17:if(!t.items){_.next=19;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee8(){var r,i,c,u,l,p;return initializer_regeneratorRuntime().wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,a.getFolderForType("Item");case 2:r=d.sent,i=[],c=[],u=initializer_createForOfIteratorHelper(t.items);try{for(p=function _loop(){var t=l.value;t.folder=r.id;var o=game.items.find((function(o){var a;return o.name==t.name&&(null===(a=o.folder)||void 0===a?void 0:a.id)==r.id}));o?(t._id=o.id,c.push(t)):i.push(t)},u.s();!(l=u.n()).done;)p()}catch(t){u.e(t)}finally{u.f()}return d.next=9,o.Z.create(i);case 9:return d.next=11,o.Z.updateDocuments(c);case 11:case"end":return d.stop()}}),_callee8)}))(),"t0",19);case 19:if(!t.playlists){_.next=21;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee9(){var r,o,i,c,u,l,p,d;return initializer_regeneratorRuntime().wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,a.getFolderForType("Playlist");case 2:return r=h.sent,o=[],i=[],c=game.packs.get(t.playlists),h.next=8,c.getDocuments();case 8:u=h.sent.map((function(t){return t.toObject()})),l=initializer_createForOfIteratorHelper(u);try{for(d=function _loop2(){var t=p.value;t.folder=r.id;var a=game.playlists.find((function(o){var a;return o.name==t.name&&(null===(a=o.folder)||void 0===a?void 0:a.id)==r.id}));a?(t._id=a.data._id,i.push(t)):o.push(t)},l.s();!(p=l.n()).done;)d()}catch(t){l.e(t)}finally{l.f()}return h.next=13,Playlist.create(o,{keepId:!0});case 13:return h.next=15,Playlist.updateDocuments(i);case 15:case"end":return h.stop()}}),_callee9)}))(),"t1",21);case 21:if(!t.scenes){_.next=23;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee10(){var r,o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I;return initializer_regeneratorRuntime().wrap((function _callee10$(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,a.getFolderForType("Scene");case 2:return r=E.sent,o=game.packs.get(t.scenes),E.next=6,o.getDocuments();case 6:return i=E.sent.map((function(t){return t.toObject()})),c=game.packs.get(t.journal),E.next=10,c.getDocuments();case 10:return u=E.sent.map((function(t){return t.toObject()})),E.next=13,a.getFolderForType("JournalEntry");case 13:l=E.sent,p=[],d=[],h=new Map,y=!1,m=initializer_createForOfIteratorHelper(i),E.prev=19,v=initializer_regeneratorRuntime().mark((function _loop3(){var t,o,i,c,m,v,_,b;return initializer_regeneratorRuntime().wrap((function _loop3$(k){for(;;)switch(k.prev=k.next){case 0:if(t=g.value,o=y,i=game.scenes.find((function(o){var a;return o.name==t.name&&(null===(a=o.folder)||void 0===a?void 0:a.id)==r.id})),y||!i){k.next=10;break}return k.next=6,new Promise((function(r,o){new Dialog({title:game.i18n.localize("dsk.Book.sceneReset"),content:game.i18n.format("dsk.Book.sceneResetDescription",{name:t.name}),default:"Yes",buttons:{Yes:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.yes"),callback:function callback(){r([!0,!1])}},all:{icon:'<i class="fa fa-check"></i>',label:game.i18n.localize("dsk.LocalizedIDs.all"),callback:function callback(){r([!0,!0])}},cancel:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("dsk.cancel"),callback:function callback(){r([!1,!1])}}},close:function close(){r([!1,!1])}}).render(!0)}));case 6:c=k.sent,m=initializer_slicedToArray(c,2),o=m[0],y=m[1];case 10:if(!i||o){k.next=13;break}return a.scenes[i.name]=i,k.abrupt("return","continue");case 13:t.folder=r.id,v=initializer_createForOfIteratorHelper(t.notes),k.prev=15,b=initializer_regeneratorRuntime().mark((function _loop4(){var r,o,i,c,p,d;return initializer_regeneratorRuntime().wrap((function _loop4$(y){for(;;)switch(y.prev=y.next){case 0:if(r=_.value,y.prev=1,o=u.find((function(t){return t.flags.dsk.initId==r.entryId})),h.has(o._id)){y.next=26;break}if(i=getProperty(o,"flags.dsk.parent"),c=l,!a.folders[i]){y.next=10;break}c=a.folders[i],y.next=14;break;case 10:if(!i){y.next=14;break}return y.next=13,a.getFolderForType("JournalEntry",l.id,i,0,getProperty(o,"flags.dsk.foldercolor")||"");case 13:c=y.sent;case 14:if(o.folder=c.id,!(p=game.journal.find((function(t){var a;return t.name==o.name&&(null===(a=t.folder)||void 0===a?void 0:a.id)==c.id&&t.flags.dsk.initId==r.entryId})))){y.next=22;break}return y.next=19,p.update(o);case 19:h.set(o._id,p.id),y.next=26;break;case 22:return y.next=24,JournalEntry.create(o);case 24:d=y.sent,h.set(o._id,d.id);case 26:r.entryId=h.get(o._id),y.next=32;break;case 29:y.prev=29,y.t0=y.catch(1),console.warn("Could not initialize Scene Notes for scene :".concat(t.name)+y.t0);case 32:case"end":return y.stop()}}),_loop4,null,[[1,29]])})),v.s();case 18:if((_=v.n()).done){k.next=22;break}return k.delegateYield(b(),"t0",20);case 20:k.next=18;break;case 22:k.next=27;break;case 24:k.prev=24,k.t1=k.catch(15),v.e(k.t1);case 27:return k.prev=27,v.f(),k.finish(27);case 30:i?(t._id=i.id,d.push(t)):p.push(t);case 31:case"end":return k.stop()}}),_loop3,null,[[15,24,27,30]])})),m.s();case 22:if((g=m.n()).done){E.next=29;break}return E.delegateYield(v(),"t0",24);case 24:if("continue"!==E.t0){E.next=27;break}return E.abrupt("continue",27);case 27:E.next=22;break;case 29:E.next=34;break;case 31:E.prev=31,E.t1=E.catch(19),m.e(E.t1);case 34:return E.prev=34,m.f(),E.finish(34);case 37:return E.next=39,Scene.create(p);case 39:_=E.sent,b=initializer_createForOfIteratorHelper(_),E.prev=41,b.s();case 43:if((k=b.n()).done){E.next=53;break}return w=k.value,a.scenes[w.name]=w,E.next=48,w.createThumbnail();case 48:return x=E.sent,E.next=51,w.update({thumb:x.thumb},{diff:!1});case 51:E.next=43;break;case 53:E.next=58;break;case 55:E.prev=55,E.t2=E.catch(41),b.e(E.t2);case 58:return E.prev=58,b.f(),E.finish(58);case 61:O=0,S=d;case 62:if(!(O<S.length)){E.next=71;break}return P=S[O],T=game.scenes.get(P._id),E.next=67,T.update(P);case 67:a.scenes[P.name]=game.scenes.get(P._id);case 68:O++,E.next=62;break;case 71:if(!t.initialScene){E.next=79;break}return I=a.scenes[t.initialScene],E.next=75,game.settings.set("core",NotesLayer.TOGGLE_SETTING,!0);case 75:return E.next=77,I.activate();case 77:return E.next=79,I.update({navigation:!0});case 79:case"end":return E.stop()}}),_callee10,null,[[19,31,34,37],[41,55,58,61]])}))(),"t2",23);case 23:if(!t.actors){_.next=25;break}return _.delegateYield(initializer_regeneratorRuntime().mark((function _callee11(){var o,i,c,u,l,p,d,h,y,m,g,v,_,b,k,w,x,O,S,P,T,I,E,C;return initializer_regeneratorRuntime().wrap((function _callee11$(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,a.getFolderForType("Actor");case 2:return o=A.sent,i=game.packs.get(t.actors),A.next=6,i.getDocuments();case 6:if(c=A.sent.map((function(t){return t.toObject()})),u=[],l=[],p=new Map,d=0,!getProperty(r,"chapters")){A.next=50;break}h=initializer_createForOfIteratorHelper(r.chapters),A.prev=13,h.s();case 15:if((y=h.n()).done){A.next=42;break}m=y.value,g=initializer_createForOfIteratorHelper(m.content),A.prev=18,g.s();case 20:if((v=g.n()).done){A.next=32;break}if(!(_=v.value).actors){A.next=30;break}b=!1,k=initializer_createForOfIteratorHelper(_.actors);try{for(k.s();!(w=k.n()).done;)x=w.value,p.has(x)||(p.set(x,_.name),b=!0)}catch(t){k.e(t)}finally{k.f()}if(!b){A.next=30;break}return A.next=29,a.getFolderForType("Actor",o.id,_.name,d);case 29:d+=1;case 30:A.next=20;break;case 32:A.next=37;break;case 34:A.prev=34,A.t0=A.catch(18),g.e(A.t0);case 37:return A.prev=37,g.f(),A.finish(37);case 40:A.next=15;break;case 42:A.next=47;break;case 44:A.prev=44,A.t1=A.catch(13),h.e(A.t1);case 47:return A.prev=47,h.f(),A.finish(47);case 50:O=initializer_createForOfIteratorHelper(c),A.prev=51,P=initializer_regeneratorRuntime().mark((function _loop5(){var t,r,i;return initializer_regeneratorRuntime().wrap((function _loop5$(c){for(;;)switch(c.prev=c.next){case 0:if(t=S.value,!p.has(t.name)){c.next=7;break}return c.next=4,a.getFolderForType("Actor",o.id,p.get(t.name));case 4:c.t0=c.sent,c.next=8;break;case 7:c.t0=o;case 8:if(r=c.t0,t.folder=r.id,t._id&&delete t._id,!(i=game.actors.find((function(a){var i;return a.name==t.name&&[o.id,r.id].includes(null===(i=a.folder)||void 0===i?void 0:i.id)})))){c.next=19;break}return t._id=i.id,c.next=16,i.deleteEmbeddedDocuments("Item",i.items.map((function(t){return t.id})));case 16:l.push(t),c.next=20;break;case 19:u.push(t);case 20:case"end":return c.stop()}}),_loop5)})),O.s();case 54:if((S=O.n()).done){A.next=58;break}return A.delegateYield(P(),"t2",56);case 56:A.next=54;break;case 58:A.next=63;break;case 60:A.prev=60,A.t3=A.catch(51),O.e(A.t3);case 63:return A.prev=63,O.f(),A.finish(63);case 66:return A.next=68,Actor.create(u);case 68:return T=A.sent,A.next=71,Actor.updateDocuments(l);case 71:I=initializer_createForOfIteratorHelper(T);try{for(I.s();!(E=I.n()).done;)C=E.value,a.actors[C.name]=C}catch(t){I.e(t)}finally{I.f()}case 73:case"end":return A.stop()}}),_callee11,null,[[13,44,47,50],[18,34,37,40],[51,60,63,66]])}))(),"t3",25);case 25:case"end":return _.stop()}}),_callee12)})));return function(r){return t.apply(this,arguments)}}());case 29:return this.lock=!1,t.find("i").remove(),ui.notifications.notify(game.i18n.localize("dsk.initComplete")),i.next=34,this.close();case 34:case"end":return i.stop()}}),_callee13,this,[[4,10],[12,17],[19,24]])}))),function initialize(){return c.apply(this,arguments)})},{key:"dontInitialize",value:(i=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee14(){return initializer_regeneratorRuntime().wrap((function _callee14$(t){for(;;)switch(t.prev=t.next){case 0:if(!game.settings.settings.has("".concat(this.module,".initialized"))){t.next=3;break}return t.next=3,game.settings.set(this.module,"initialized",!0);case 3:return ui.notifications.notify(game.i18n.localize("dsk.initSkipped")),t.next=6,this.close();case 6:case"end":return t.stop()}}),_callee14,this)}))),function dontInitialize(){return i.apply(this,arguments)})},{key:"submit",value:function submit(t){try{t.callback&&t.callback(this.options.jQuery?this.element:this.element[0])}catch(t){throw ui.notifications.error(t),new Error(t)}}},{key:"getFolderForType",value:(a=initializer_asyncToGenerator(initializer_regeneratorRuntime().mark((function _callee15(r){var o,a,i,c,u=arguments;return initializer_regeneratorRuntime().wrap((function _callee15$(l){for(;;)switch(l.prev=l.next){case 0:return o=u.length>1&&void 0!==u[1]?u[1]:null,a=u.length>2&&void 0!==u[2]?u[2]:null,i=u.length>3&&void 0!==u[3]?u[3]:0,c=u.length>4&&void 0!==u[4]?u[4]:"",a||(a=game.i18n.localize("".concat(this.module,".name"))),l.abrupt("return",t.Z.getFolderForType(r,o,a,i,c));case 6:case"end":return l.stop()}}),_callee15,this)}))),function getFolderForType(t){return a.apply(this,arguments)})}]),DSKInitializer}();function roll_memory_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var $e=function(){function RollMemory(){!function roll_memory_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RollMemory),this.tokens={},this.actors={}}return function roll_memory_createClass(t,r,o){return r&&roll_memory_defineProperties(t.prototype,r),o&&roll_memory_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(RollMemory,[{key:"getPath",value:function getPath(t,r,o){var a=o||"",i=r._id||r.type;return t.token?"tokens.".concat(t.token||t.actor,".").concat(i).concat(a):"actors.".concat(t.actor,".").concat(i).concat(a)}},{key:"remember",value:function remember(t,r,o,a){var i=this.formDataSerialize(a);Object.entries(i).length>0&&setProperty(this,this.getPath(t,r,o),i)}},{key:"recall",value:function recall(t,r,o){return getProperty(this,this.getPath(t,r,o))}},{key:"formDataSerialize",value:function formDataSerialize(t){var r=t.find("form"),o={};return r.find("select").each((function(){var t=$(this).attr("name");RollMemory.wantedKeys.includes(t)&&(o[t]=$(this).val())})),r.find('input[type="checkbox"]').each((function(){var t=$(this).attr("name");RollMemory.wantedKeys.includes(t)&&(o[t]=this.checked)})),r.find(".specAbs.active").each((function(){o.specAbs||(o.specAbs=[]),o.specAbs.push({id:$(this).attr("data-id"),step:$(this).attr("data-step")})})),t.find('[name="situationalModifiers"] option').each((function(){o.situationalModifiers||(o.situationalModifiers=[]),o.situationalModifiers.push({name:$(this).text().trim(),selected:this.selected})})),o}}],[{key:"wantedKeys",get:function get(){var t=[];return game.settings.get("dsk","enableDPS")||t.push("distance"),t}}]),RollMemory}();Hooks.once("init",(function(){var i,c,l;console.log("Initializing DSK system"),CONFIG.statusEffects=d.Z.statusEffects,game.dsk={apps:(i={DSKUtility:t.Z,DSKInitializer:Ne,DSKChatListeners:p.Z,SpecialabilityRulesDSK:g.Z,AdvantageRulesDSK:m.Z,Migrakel:a,DPS:Q.Z,DiceDSK:Ce.Z,DSKStatusEffects:u.Z},c="DSKInitializer",l=Ne,c in i?Object.defineProperty(i,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):i[c]=l,i),documents:{ActorDSK:r.Z,ItemDSK:o.Z},sheets:{ActorSheetDSK:v,ItemSheetDSK:k,ActorSheetCreature:U,ActorSheetCharacter:Y,ActorSheetNPC:V},config:d.Z,memory:new $e,itemLibrary:new Fe},CONFIG.Actor.documentClass=r.Z,CONFIG.Item.documentClass=o.Z,CONFIG.ActiveEffect.documentClass=Me,CONFIG.ui.combat=ie,CONFIG.ui.hotbar=ze,CONFIG.Combat.documentClass=ce,CONFIG.Combatant.documentClass=se,CONFIG.ActiveEffect.documentClass=Me,CONFIG.ChatMessage.template="systems/dsk/templates/chat/chat-message.html"})),function initHooks(){setupJournal(),function setupHandlebars(){Handlebars.registerHelper({roman:function roman(t,r){return null!=r&&Number(r)<2?"":[" I"," II"," III"," IV"," V"," VI"," VII"," VIII"," IX"," X"][t-1]},itemCategory:function itemCategory(r){return t.Z.categoryLocalization(r)},diceThingsUp:function diceThingsUp(r,o){return t.Z.replaceDies(r,!1)},concat:function concat(){var t;return(t=HandlebarsHelpers).concat.apply(t,arguments).string},replaceConditions:t.Z.replaceConditions,attrLoc:function attrLoc(t,r){return game.i18n.localize("dsk.characteristics.".concat(t,".").concat(r))},floor:function floor(t){return Math.floor(Number(t))}})}(),function setupMacros(){Hooks.on("hotbarDrop",(function(t,r,o){if("Item"==r.type){var a=fromUuidSync(r.uuid);if(!["ahnengabe","meleeweapon","rangeweapon","skill","combatskill","char","trait"].includes(a.type))return;if(!("meleeweapon"!=a.type&&"combatskill"!=a.type||["attack","parry"].includes(r.mod)))return;if(("rangeweapon"==a.type||"trait"==a.type)&&!["attack"].includes(r.mod))return;var i='{mod: "'.concat(r.mod,'"}');return createHotBarMacro(game.user.isGM||null==r.actorId?'game.dsk.macro.itemMacro("'.concat(a.name,'", "').concat(a.type,'", ').concat(i,");"):'game.dsk.macro.itemMacroById("'.concat(r.actorId,'", "').concat(a.name,'", "').concat(a.type,'", ').concat(i,")"),null==r.mod?a.name:"".concat(a.name," - ").concat(game.i18n.localize("dsk.characteristics."+r.mod+".name")),a.img,o)}if("Actor"==r.type||"JournalEntry"==r.type){var c=fromUuidSync(r.uuid);return createHotBarMacro("(await fromUuid('".concat(r.uuid,"')).sheet.render(true)"),c.name,c.img,o)}}))}(),function initSidebar(){Hooks.on("renderSettings",(function(t,r,o){var a=$('<button id="reportADSKBug"><i class="fas fa-bug"></i> '.concat(game.i18n.localize("dsk.DSKError.reportBug"),"</button>"));a.click((function(){window.open("https://github.com/Plushtoast/dsk-foundryVTT/issues","_blank")})),r.find("#settings-documentation").append(a),(a=$('<button class="fshopButton"><div></div> F-Shop</button>')).click((function(){window.open(game.i18n.localize("dsk.fshopLink"),"_blank")})),r.find("#settings-documentation").append(a);var i=game.system.title.split("/")["de"==game.i18n.lang?0:1],c=r.find("#game-details .system span").html();r.find("#game-details .system").html("".concat(i,"<span>").concat(c,"</span>"))})),Hooks.on("renderCompendiumDirectory",(function(t,r,o){var a=$('<button id="openLibrary"><i class="fas fa-university"></i>'.concat(game.i18n.localize("dsk.ItemLibrary"),"</button>")),i=r.find(".header-actions");i.append(a),a.click((function(){game.dsk.itemLibrary.render(!0)}));var c,u="de"==game.i18n.lang?"en":"de",l=sidebar_createForOfIteratorHelper(game.packs.filter((function(t){return getProperty(t.metadata,"flags.dsklang")==u})));try{for(l.s();!(c=l.n()).done;){var p=c.value,d="".concat(p.metadata.packageName,".").concat(p.metadata.name);game.packs.delete(d),r.find('li[data-pack="'.concat(d,'"]')).hide()}}catch(t){l.e(t)}finally{l.f()}var h=$('\n        <div class="header-search flexrow">\n            <i class="fas fa-search"></i>\n            <input type="search" name="search" value="" placeholder="'.concat(game.i18n.localize("dsk.searchCompendium"),'" autocomplete="off">\n            <a></a>\n        </div>'));i.after(h),h.find('[name="search"]').keyup((function(t){var o,a=t.currentTarget.value.toLowerCase(),i=sidebar_createForOfIteratorHelper(r.find(".compendium-pack"));try{for(i.s();!(o=i.n()).done;){var c=o.value,u=$(c).find(".pack-title").text().trim().toLowerCase(),l=$(c).find("footer span:nth-child(2)").text().trim().toLowerCase();c.style.display=!a||u.indexOf(a)>=0||l.indexOf(a)>=0?"block":"none"}}catch(t){i.e(t)}finally{i.f()}}))})),Hooks.on("renderActorDirectory",(function(t,r,o){if(!game.user.isGM){var a,i=sidebar_createForOfIteratorHelper(t.documents.filter((function(t){return t.isMerchant()&&getProperty(t,"merchant.hidePlayer")})));try{for(i.s();!(a=i.n()).done;){var c=a.value;r.find('[data-document-id="'.concat(c.id,'"]')).remove()}}catch(t){i.e(t)}finally{i.f()}}}))}(),function initActorHooks(){function checkIniChange(t){if(game.user.isGM&&game.combat&&t.changes.some((function(t){return/(system\.stats\.ini|system\.characteristics.mu|system\.characteristics\.ge)/.test(t.key)}))){var r=t.parent.id,o=game.combat.combatants.find((function(t){return t.actor.id==r}));o&&o.recalcInitiative()}}Hooks.on("deleteActiveEffect",(function(t,r){if(!r.noHook){var o=t.parent;if(o&&"Actor"==o.documentName){var a=getProperty(t,"flags.core.statusId");if("bloodrush"==a)return o.addCondition("stunned",2,!1,!1),!1;if("dead"==a&&game.combat)return o.markDead(!1),!1;if(ve.Z.onEffectRemove(o,t),!1===Hooks.call("deleteActorActiveEffect",o,t))return!1}}})),Hooks.on("dropActorSheetData",(function(t,r,o){var a;switch(null===(a=o.data)||void 0===a?void 0:a.type){case"condition":return t.addCondition(o.data.payload.id,1,!1,!1),!1;case"lookup":return r._handleLookup(o.data),!1;case"fullpack":return r._addFullPack(o.data),!1}})),Hooks.on("createActiveEffect",(function(t,r,o){checkIniChange(t)})),Hooks.on("deleteActiveEffect",(function(t,r,o){checkIniChange(t)}));var r=function(){var t=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee(t,r){return actor_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:(game.dsk.apps.AskForNameDialog||Te).getDialog(t,r);case 2:case"end":return o.stop()}}),_callee)})));return function askForName(r,o){return t.apply(this,arguments)}}(),o=function(){var o=actor_asyncToGenerator(actor_regeneratorRuntime().mark((function _callee2(o,a){var i,c,u,l;return actor_regeneratorRuntime().wrap((function _callee2$(p){for(;;)switch(p.prev=p.next){case 0:if(t.Z.isActiveGM()){p.next=2;break}return p.abrupt("return");case 2:if(!(i=o.actor).hasPlayerOwner){p.next=5;break}return p.abrupt("return");case 5:if(0!=(c=Number(game.settings.get("dsk","obfuscateTokenNames")))&&"loot"!=getProperty(i,"merchant.merchantType")){p.next=8;break}return p.abrupt("return");case 8:if(u=canvas.scene.tokens.filter((function(t){return t.actor&&t.actor.id===i.id})),l=game.i18n.localize("dsk.unknown"),![2,4].includes(c)){p.next=16;break}if(o.id||o._id){p.next=14;break}return p.abrupt("return");case 14:return r(o,c),p.abrupt("return");case 16:u.length>0&&c<3&&(l="".concat(u[0].name.replace(/ \d{1,}$/)," ").concat(u.length+1)),a.name=l;case 18:case"end":return p.stop()}}),_callee2)})));return function obfuscateName(t,r){return o.apply(this,arguments)}}();Hooks.on("preCreateToken",(function(r,a,i,c){var u=r.actor;if(u){var l={};"loot"==getProperty(u,"system.merchant.merchantType")?mergeObject(l,{displayBars:0}):getProperty(u,"system.config.autoBar")&&(mergeObject(l,{bar1:{attribute:"status.LeP"}}),u.system.isMage?mergeObject(l,{bar2:{attribute:"status.AeP"}}):mergeObject(l,{bar2:{attribute:"tbd"}})),getProperty(u,"system.config.autoSize")&&t.Z.calcTokenSize(u,l),o(r,l),r.updateSource(l)}})),Hooks.on("createToken",(function(t,r,a){r.noHook||o(t,{})}))}(),function initDSN(){Hooks.once("init",(function(){game.dsk.apps.DiceSoNiceCustomization=new Ie})),Hooks.once("diceSoNiceReady",(function(t,r,o,a){t.addColorset({name:"mu",description:"DSK.mu",category:"DSK.dies",foreground:"#FFFFFF",background:"#b3241a",edge:"#b3241a",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"kl",description:"DSK.kl",category:"DSK.dies",foreground:"#FFFFFF",background:"#8259a3",edge:"#8259a3",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"in",description:"DSK.in",category:"DSK.dies",foreground:"#FFFFFF",background:"#388834",edge:"#388834",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ch",description:"DSK.ch",category:"DSK.dies",foreground:"#FFFFFF",background:"#0d0d0d",edge:"#0d0d0d",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ff",description:"DSK.ff",category:"DSK.dies",foreground:"#000000",background:"#d5b467",edge:"#d5b467",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ge",description:"DSK.ge",category:"DSK.dies",foreground:"#000000",background:"#688ec4",edge:"#688ec4",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"ko",description:"DSK.ko",category:"DSK.dies",foreground:"#000000",background:"#a3a3a3",edge:"#a3a3a3",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"kk",description:"DSK.kk",category:"DSK.dies",foreground:"#000000",background:"#d6a878",edge:"#d6a878",outline:"#FFFFFF",texture:"none"}),t.addColorset({name:"attack",description:"DSK.attack",category:"DSK.dies",foreground:"#FFFFFF",background:"#b3241a",edge:"#b3241a",outline:"#b3241a",texture:"none"}),game.dsk.apps.DiceSoNiceCustomization.initConfigs(),Ie.onConnect()}))}(),function initChatlogHooks(){Hooks.on("renderChatLog",(function(t,r,o){Ce.Z.chatListeners(r),he.chatListeners(r);var a=new l.Z;Hooks.call("startDSKChatAutoCompletion",a),a.chatListeners(r),p.Z.chatListeners(r)})),Hooks.on("renderChatMessage",(function(r,o,a){if(game.user.isGM)o.find(".chat-button-player").remove();else{var i;o.find(".chat-button-gm").remove();var c=o.find(".chat-button-target");c.length&&(i=oe.getTargetActor(a.message))&&i.actor&&!i.actor.isOwner&&c.remove();var l=t.Z.getSpeaker(a.message.speaker);l&&!l.isOwner&&(o.find(".selfButton").remove(),o.find(".d20").data("tooltip",""));var p=o.find(".onlyTarget");p.length&&(i=t.Z.getSpeaker({token:p.attr("data-token"),actor:p.attr("data-actor"),scene:canvas.scene?canvas.scene.id:null}))&&!i.isOwner&&p.remove(),o.find(".hideData").remove(),getProperty(a.message,"flags.dsk.userHidden.".concat(game.user.id))&&o.find(".payButton").remove()}game.settings.get("dsk","expandChatModifierlist")&&(o.find(".expand-mods i").toggleClass("fa-minus fa-plus"),o.find(".expand-mods + ul").css({display:"block"})),u.Z.bindButtons(o)})),Hooks.on("chatMessage",(function(r,o,a){var i=o.match(/^\/(pay|getPaid|help$|conditions$|tables)/);switch(i=i?i[0]:""){case"/pay":return game.user.isGM?he.createPayChatMessage(o):he.payMoney(t.Z.getSpeaker(a.speaker),o),!1;case"/getPaid":return game.user.isGM?he.createGetPaidChatMessage(o):he.getMoney(t.Z.getSpeaker(a.speaker),o),!1;case"/help":return p.Z.getHelp(),!1;case"/conditions":return p.Z.showConditions(),!1;case"/tables":return p.Z.showTables(),!1}}))}(),initTokenHook(),function initTokenHUD(){Hooks.on("renderTokenHUD",(function(t,r,o){var a=t.object.actor;a&&game.dsk.apps.LightDialog&&game.dsk.apps.LightDialog.lightHud(r,a,o),r.find('.control-icon[data-action="target"]').mousedown((function(t){2==t.button&&(game.user.updateTokenTargets([]),$(t.currentTarget).click(),t.preventDefault())})),r.find(".attribute input").off("change")}))}(),function initRollsFunction(){Roll.prototype.editRollAtIndex=function(t){var r,o=[],a=dskrolls_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i,c=r.value,u=c.index,l=c.val,p=0,d=dskrolls_createForOfIteratorHelper(this.terms);try{for(d.s();!(i=d.n()).done;){var h=i.value,y=h instanceof DiceTerm||"DiceTerm"==h.class||h instanceof Die||"Die"==h.class,m=h instanceof OperatorTerm;if(y||h.faces){if(h.results[u-p]){var g=h.results[u-p].result;h.results[u-p].result=l,o.push(g)}y||(h.total=h.results.reduce((function(t,r){return t+r.result}),0)),p+=h.results.length}else m||"OperatorTerm"!=h.class&&!h.operator||(h.total=h.operator)}}catch(t){d.e(t)}finally{d.f()}o.push(0)}}catch(t){a.e(t)}finally{a.f()}return this._total=this._evaluateTotal(),o}}(),(0,we.Z)(),Hooks.once("init",(function(){loadTemplates(["systems/dsk/templates/items/item-equipment.html","systems/dsk/templates/items/item-header.html","systems/dsk/templates/items/item-description.html","systems/dsk/templates/items/item-effects.html","systems/dsk/templates/items/item-stat.html","systems/dsk/templates/actors/parts/healthbar.html","systems/dsk/templates/actors/actor-talents.html","systems/dsk/templates/actors/actor-combat.html","systems/dsk/templates/actors/actor-equipment.html","systems/dsk/templates/actors/parts/gearSearch.html","systems/dsk/templates/actors/parts/purse.html","systems/dsk/templates/actors/parts/characteristics-small.html","systems/dsk/templates/actors/parts/status_effects.html","systems/dsk/templates/actors/parts/containerContent.html","systems/dsk/templates/actors/actor-notes.html","systems/dsk/templates/actors/creature/creature-combat.html","systems/dsk/templates/actors/creature/creature-main.html","systems/dsk/templates/actors/creature/creature-magic.html","systems/dsk/templates/status/advanced_functions.html","systems/dsk/templates/actors/creature/creature-loot.html","systems/dsk/templates/dialog/default-dialog.html","systems/dsk/templates/actors/character/actor-magic.html","systems/dsk/templates/actors/parts/characteristics-large.html","systems/dsk/templates/actors/npc/npc-main.html","systems/dsk/templates/actors/parts/rollhead.html","systems/dsk/templates/actors/actor-main.html","systems/dsk/templates/chat/roll/test-card.html","systems/dsk/templates/dialog/parts/targets.html","systems/dsk/templates/dialog/default-combat-dialog.html","systems/dsk/templates/actors/creature/creature-notes.html","systems/dsk/templates/dialog/enhanced-default-dialog.html","systems/dsk/templates/actors/parts/information.html","systems/dsk/templates/actors/merchant/merchant-commerce.html","systems/dsk/templates/actors/parts/normalhead.html"])})),Actors.unregisterSheet("core",ActorSheet),Actors.registerSheet("dsk",Y,{types:["character"],makeDefault:!0}),Actors.registerSheet("dsk",U,{types:["creature"],makeDefault:!0}),Actors.registerSheet("dsk",V,{types:["npc"],makeDefault:!0}),Actors.registerSheet("dsk",ge,{types:["npc"]}),Actors.registerSheet("dsk",Ae,{types:["creature"]}),Actors.registerSheet("dsk",Re,{types:["character"]}),DocumentSheetConfig.registerSheet(ActiveEffect,"dsk",ve.Z,{makeDefault:!0}),Journal.registerSheet("dsk",J,{makeDefault:!0}),k.setupSheets(),function initReady(){Hooks.once("ready",ready_asyncToGenerator(ready_regeneratorRuntime().mark((function _callee(){return ready_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return game.socket.on("system.dsk",(function(t){if("hideDeletedSheet"===t.type){var r=t.payload.target.token?game.actors.tokens[t.payload.target.token]:game.actors.get(t.payload.target.actor);ge.hideDeletedSheet(r)}})),game.user.isGM&&game.socket.on("system.dsk",(function(t){switch(t.type){case"target":var r=game.scenes.get(t.payload.scene);new Token(r.getEmbeddedDocument("Token",t.payload.target)).actor.update({"flags.oppose":t.payload.opposeFlag});break;case"addEffect":ve.Z.applyEffect(t.payload.id,t.payload.mode,t.payload.actors);break;case"updateDefenseCount":case"updateDefenseCount":game.combat&&game.combat.updateDefenseCount(t.payload.speaker);break;case"updateMsg":game.messages.get(t.payload.id).update(t.payload.updateData);break;case"deleteMsg":game.messages.get(t.payload.id).delete();break;case"showDamage":ne.Z.showDamage(game.messages.get(t.payload.id),t.payload.hide);break;case"updateGroupCheck":RequestRoll.rerenderGC(game.messages.get(t.payload.messageId),t.payload.data);break;case"updateAttackMessage":game.messages.get(t.payload.messageId).update({"flags.data.unopposedStartMessage":t.payload.startMessageId});break;case"clearCombat":game.combat&&game.combat.nextRound();break;case"trade":var o=t.payload.source.token?game.actors.tokens[t.payload.source.token]:game.actors.get(t.payload.source.actor),a=t.payload.target.token?game.actors.tokens[t.payload.target.token]:game.actors.get(t.payload.target.actor);ge.finishTransaction(o,a,t.payload.price,t.payload.itemId,t.payload.buy,t.payload.amount);break;case"playWhisperSound":t.payload.whisper.includes(game.user.id)&&AudioHelper.play({src:t.payload.soundPath,volume:.8,loop:!1},!1);break;case"socketedConditionAddActor":fromUuid(t.payload.id).then((function(r){new fe.Z(r).socketedConditionAddActor(t.payload.actors.map((function(t){return game.actors.get(t)})),t.payload.data)}));break;case"socketedConditionAdd":fromUuid(t.payload.id).then((function(r){new fe.Z(r).socketedConditionAdd(t.payload.targets,t.payload.data)}));break;case"socketedRemoveCondition":fromUuid(t.payload.id).then((function(r){new fe.Z(r).socketedRemoveCondition(t.payload.targets,t.payload.coreId)}));break;case"socketedActorTransformation":fromUuid(t.payload.id).then((function(r){new fe.Z(r).socketedActorTransformation(t.payload.targets,t.payload.update)}));break;case"itemDrop":var i=t.payload.sourceActorId?game.actors.get(t.payload.sourceActorId):void 0;fromUuid(t.payload.itemId).then((function(r){te(i,r,t.payload.data,t.payload.amount)}));break;default:console.warn("Unhandled socket data type ".concat(t.type))}})),r.next=4,ee.firstTimeMessage();case 4:if(X.showOneMessage(),r.t1=t.Z.moduleEnabled("vtta-tokenizer"),!r.t1){r.next=10;break}return r.next=9,game.settings.get("dsk","tokenizerSetup");case 9:r.t1=!r.sent;case 10:if(r.t0=r.t1,!r.t0){r.next=13;break}r.t0=game.user.isGM;case 13:if(!r.t0){r.next=22;break}return r.next=16,game.settings.set("vtta-tokenizer","default-frame-pc","[data] systems/dsk/icons/backgrounds/token_green.webp");case 16:return r.next=18,game.settings.set("vtta-tokenizer","default-frame-npc","[data] systems/dsk/icons/backgrounds/token_black.webp");case 18:return r.next=20,game.settings.set("vtta-tokenizer","default-frame-neutral","[data] systems/dsk/icons/backgrounds/token_blue.webp");case 20:return r.next=22,game.settings.set("dsk","tokenizerSetup",!0);case 22:if(r.t3=t.Z.moduleEnabled("dice-so-nice"),!r.t3){r.next=27;break}return r.next=26,game.settings.get("dsk","diceSetup");case 26:r.t3=!r.sent;case 27:if(r.t2=r.t3,!r.t2){r.next=30;break}r.t2=game.user.isGM;case 30:if(!r.t2){r.next=35;break}return r.next=33,game.settings.set("dice-so-nice","immediatelyDisplayChatMessages",!0);case 33:return r.next=35,game.settings.set("dsk","diceSetup",!0);case 35:o.Z.setupSubClasses(),le.connectHooks(),pe.registerTokenHotbar(),(0,re.v)();case 39:case"end":return r.stop()}}),_callee)}))))}(),initSetup(),Q.Z.initDoorMinDistance()}()})()})();